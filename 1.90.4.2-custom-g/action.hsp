*act_throw
	if ( inv(INV_ITEM_PROPERTY, ci) == PROP_NPC | inv(INV_ITEM_PROPERTY, ci) == PROP_SPECIAL ) {
		snd SOUNDLIST_FAIL1
		txt_notyours
		goto *pc_turn
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_FURNITURE | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_JUNK | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ENVIRONMENT ) {
		if ( limit(inv(INV_ITEM_WEIGHT, ci) / 1000, 0, 1000) > sdata(SKILL_NORMAL_WEIGHT_LIFTING, CHARA_PLAYER) + 5 ) {
			txt lang("重すぎて投げられない…！", "It is too heavy!")
			snd SOUNDLIST_FAIL1
			goto *pc_turn
		}
	}
	if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
		snd SOUNDLIST_FAIL1
		txt_nodrop
		goto *pc_turn
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION | inv(INV_ITEM_ID, ci) == ITEM_ID_TOMATO | inv(INV_ITEM_ID, ci) == ITEM_ID_BUTTER | inv(INV_ITEM_ID, ci) == ITEM_ID_YOGURT | inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO ) {
		if ( inv(INV_ITEM_ID, ci) != ITEM_ID_EMPTY_BOTTLE ) {
			stc = -1
			if ( map(tlocx, tlocy, 1) != 0 ) {
				stc = map(tlocx, tlocy, 1) - 1
				if ( cc == CHARA_PLAYER ) {
					if ( cdata(CDATA_IN_TAGTEAM, stc) != 0 ) {
						txtselecttc 2
						repeat 2
							promptAdd s(cnt), key_select(cnt)
						loop
						val = promptx, prompty, 200, 0
						gosub *prompt_key
						if ( rtval == 1 ) {
							stc = cdata(CDATA_TAGTEAM_PARTNER, stc)
						}
					}
				}
			}
		}
	}
	if ( kakeru != 100 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は" + itemname(ci, 1) + "を投げた。", name(cc) + " throw" + _s(cc) + " " + itemname(ci, 1) + ".")
		}
	}
	if ( kakeru == 100 ) {
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は" + itemname(ci, 1) + "を自分にかけた。", name(cc) + " pour" + _s(cc) + " " + itemname(ci, 1) + " on " + yourself(cc) + ".")
		}
	}
	if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tlocx, tlocy) * 4 > rnd(sdata(SKILL_WEAPON_THROWING, cc) + 10) + sdata(SKILL_WEAPON_THROWING, cc) / 4 ) {
		x = tlocx + rnd(2) - rnd(2)
		y = tlocy + rnd(2) - rnd(2)
		if ( x >= 0 ) {
			if ( y >= 0 ) {
				if ( x < mdata(MDATA_WIDTH) ) {
					if ( y < mdata(MDATA_HEIGHT) ) {
						if ( (chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
							tlocx = x
							tlocy = y
						}
					}
				}
			}
		}
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CHESTNUT & inv(INV_ITEM_PARAM2, ci) == 0 & cdatan(CDATAN_FAKE_CLASS, cc) == "錬金術士" ) {
		txt lang("「うにーっ！」", cnvtalk("Urchinn!"))
	}
	animeid = ANIMATION_THROW
	aniref = inv(INV_ITEM_PIC, ci), inv(INV_ITEM_COL, ci)
	anix = tlocx
	aniy = tlocy
	gosub *anime
	ti = inv_getfreeid(-1)
	removeitem ci, 1
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MONSTER_BALL | (inv(INV_ITEM_ID, ci) == ITEM_ID_CHESTNUT & inv(INV_ITEM_PARAM2, ci) == 0) | inv(INV_ITEM_ID, ci) == ITEM_ID_DUEL_GLOVE | inv(INV_ITEM_ID, ci) == ITEM_ID_LULWYS_PHOTO_COLLECTION | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_FURNITURE | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_JUNK | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ENVIRONMENT | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
		if ( ti != (-1) ) {
			item_copy ci, ti
			inv(INV_ITEM_NUM, ti) = 1
			inv(INV_ITEM_X, ti) = tlocx
			inv(INV_ITEM_Y, ti) = tlocy
			ci = ti
		}
	}
	if ( cc == CHARA_PLAYER ) {
		gosub *calcBurdenPc
	}
	animeid = ANIMATION_CRUSH
	x = tlocx
	y = tlocy
	gosub *anime
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MONSTER_BALL | inv(INV_ITEM_ID, ci) == ITEM_ID_LITTLE_BALL ) {
		snd SOUNDLIST_THROW2
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
				if ( tc != CHARA_PLAYER ) {
					if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
					txt_guard
				}
			}
			txtmore
			txt_hittarget
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MONSTER_BALL ) {
				if ( tc < 57 | cdata(CDATA_ROLE, tc) != ROLE_NONE | cdata(CDATA_QUALITY, tc) == FIX_QUALITY_UNIQUE | cbit(CHARA_BIT_PRECIOUS, tc) == 1 | cbit(CHARA_BIT_NECRO, tc) == 1 | gdata(GDATA_FLAG_DUEL_TARGET) == tc ) {
					txt lang("その生物には無効だ。", "The creature can't be captured.")
					goto *turn_end
				}
				if ( cdata(CDATA_LEVEL, tc) > inv(INV_ITEM_PARAM2, ci) ) {
					txt lang("その生物を捕獲するには、より高レベルのモンスターボールが必要だ。", "Power level of the ball is not enough to capture the creature.")
					goto *turn_end
				}
				if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) / 10 ) {
					txt lang("捕獲するためにはもっと弱らせる必要がある。", "You need to weaken the creature to capture it.")
					goto *turn_end
				}
				if ( gdata(GDATA_AREA) == AREA_ARENA | gdata(GDATA_AREA) == AREA_PET_ARENA | gdata(GDATA_AREA) == AREA_SHOW_HOUSE | (gdata(GDATA_AREA) == AREA_SHELTER & gdata(GDATA_LEVEL) == 1) ) {
					txt lang("この場所では捕獲できない。", "This doesn't work in this area.")
					goto *turn_end
				}
				txtef COLOR_GREEN
				txt lang(name(tc) + "をモンスターボールに捕獲した。", "You capture " + name(tc) + ".")
				animeload ANIMATION_FIZZLE, tc
				inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
				inv(INV_ITEM_PARAM3, ci) = cdata(CDATA_LEVEL, tc)
				inv(INV_ITEM_WEIGHT, ci) = 10000
				inv(INV_ITEM_VALUE, ci) = 1000
			}
			else {
				if ( cdata(CDATA_ID, tc) != CREATURE_ID_LITTLE_SISTER | tc < MAX_CHARA_FOLLOWER | gdata(GDATA_FLAG_DUEL_TARGET) == tc ) {
					txt_nothinghappens
					goto *turn_end
				}
				if ( gdata(GDATA_AREA) == AREA_ARENA | gdata(GDATA_AREA) == AREA_PET_ARENA | gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
					txt lang("この場所では効果がない。", "This doesn't work in this area.")
					goto *turn_end
				}
				rc = tc
				gosub *add_ally
			}
			chara_vanquish tc
			check_quest
		}
		goto *turn_end
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION | inv(INV_ITEM_ID, ci) == ITEM_ID_TOMATO | inv(INV_ITEM_ID, ci) == ITEM_ID_BUTTER | inv(INV_ITEM_ID, ci) == ITEM_ID_YOGURT | inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO ) {
		if ( inv(INV_ITEM_ID, ci) != ITEM_ID_EMPTY_BOTTLE ) {
			if ( synccheck(tlocx, tlocy) ) {
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HANDFUL_SNOW ) {
					snd SOUNDLIST_SNOW
				}
				else {
					if ( inv(INV_ITEM_ID, ci) != ITEM_ID_NATTO ) {
						snd SOUNDLIST_CRUSH2
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO ) {
						snd SOUNDLIST_WATER2
					}
				}
			}
			if ( map(tlocx, tlocy, 1) != 0 ) {
				tc = map(tlocx, tlocy, 1) - 1
				if ( stc != (-1) ) {
					tc = stc
				}
				if ( kakeru != 100 ) {
					txt_hittarget
				}
				if ( kakeru != 0 ) {
					kakeru = 0
				}
				if ( inv(INV_ITEM_ID, ci) != ITEM_ID_MOLOTOV & inv(INV_ITEM_ID, ci) != ITEM_ID_BOTTLE_SULFURIC & inv(INV_ITEM_ID, ci) != ITEM_ID_HANDFUL_SNOW & inv(INV_ITEM_ID, ci) != ITEM_ID_TOMATO & inv(INV_ITEM_ID, ci) != ITEM_ID_ESSENTIAL_OIL & inv(INV_ITEM_ID, ci) != ITEM_ID_GASOLINE & inv(INV_ITEM_ID, ci) != ITEM_ID_BUTTER & inv(INV_ITEM_ID, ci) != ITEM_ID_YOGURT & inv(INV_ITEM_ID, ci) != ITEM_ID_NATTO ) {
					wet tc, 25
				}
				rowact_check tc
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HANDFUL_SNOW ) {
					if ( synccheck(tc, -1) ) {
						if ( tc != CHARA_PLAYER ) {
							txtef COLOR_SKY_BLUE
							txtmore
							txt lang("「いてー！」", cnvtalk("Hey!")), lang("「やったな」", cnvtalk("Now you did it.")), lang(" *クスクス* ", "*chuckle*"), lang("「キャハハ」", cnvtalk("Tee-hee-hee!")), lang("「こやつめ」", cnvtalk("You'll pay for this.")), lang("「むむっ」", "*grin*")
						}
					}
					goto *turn_end
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TOMATO ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt lang(" *ぷちゅ* ", " *crumble* ")
					}
					if ( inv(INV_ITEM_ROT, ci) == (-1) ) {
						if ( synccheck(tc, -1) ) {
							txtef COLOR_BLUE
							txt lang(name(tc) + "は怒りに体を奮わせた！", name(tc) + " " + is(tc) + " engulfed in fury!")
						}
						if ( cdata(CDATA_CONDITION_ANGRY, tc) == 0 ) {
							cdata(CDATA_CONDITION_ANGRY, tc) += rnd(10) + 5
						}
					}
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					goto *turn_end
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt lang(" *ねばー* ", " *crumble* ")
					}
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt lang(name(tc) + "は怒りに体を奮わせた！", name(tc) + " " + is(tc) + " engulfed in fury!")
					}
					if ( cdata(CDATA_CONDITION_ANGRY, tc) == 0 ) {
						cdata(CDATA_CONDITION_ANGRY, tc) += 5 + inv(INV_ITEM_LEVEL, ci)
					}
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					goto *turn_end
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BUTTER ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_YELLOW
						txt lang(name(tc) + "は香ばしいバターまみれになった。「べちゃべちゃする…」", name(tc) + " was covered in savory butter." + cnvtalk("It's gooey..."))
					}
					if ( cdata(CDATA_BRUSH_LEVEL, tc) <= 1 ) {
						cdata(CDATA_BRUSH_LEVEL, tc)++
					}
					cdata(CDATA_CONDITION_OIL, tc) += 15
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					goto *turn_end
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_YOGURT ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt lang(name(tc) + "は怒りに体を奮わせた！", name(tc) + " " + is(tc) + " engulfed in fury!")
					}
					cdata(CDATA_CONDITION_ANGRY, tc) += rnd(3) + 5
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					goto *turn_end
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MOLOTOV ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt lang(name(tc) + "は、燃料まみれになった。", name(tc) + " was covered in oil.")
					}
					cdata(CDATA_CONDITION_OIL, tc) += 5
				}
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					if ( cbit(CHARA_BIT_LIVESTOCK, tc) != 1 ) {
						hostileaction cc, tc
					}
				}
				ccthrowpotion = cc
				potionthrow = 100
				cc = tc
				dbmode = DBMODE_ON_DRINK
				dbid = inv(INV_ITEM_ID, ci)
				gosub *db_item
				cc = ccthrowpotion
				if ( gdata(GDATA_QUICK_USE) == 1 & cc == CHARA_PLAYER ) {
					snd SOUNDLIST_THROW2
					gdata(GDATA_QUICK_USE) = 0
					goto *pc_turn
				}
				else {
					goto *turn_end
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HANDFUL_SNOW ) {
				if ( map(tlocx, tlocy, 4) != 0 ) {
					cell_itemlist tlocx, tlocy
					f = 0
					repeat listmax
						p = list(0, cnt)
						if ( inv(INV_ITEM_ID, p) == ITEM_ID_SNOW_MAN ) {
							if ( synccheck(tlocx, tlocy) ) {
								txtmore
								txt lang(itemname(p, 1) + "に命中して、雪だるまは崩れた。", "It hits " + itemname(p, 1) + " and breaks it.")
							}
							inv(INV_ITEM_NUM, p)--
							f = 1
							break
						}
					loop
					if ( f == 1 ) {
						cell_refresh tlocx, tlocy
						goto *turn_end
					}
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HANDFUL_SNOW ) {
				if ( chipm(CHIPM_ROLE, map(tlocx, tlocy, 0)) == MAP_CHIP_ROLE_SNOW ) {
					goto *turn_end
				}
				if ( synccheck(tlocx, tlocy) ) {
					txtmore
					txt lang("それは地面に落ちて溶けた。", "It falls on the ground and melts.")
				}
			}
			else {
				if ( synccheck(tlocx, tlocy) ) {
					txtmore
					txt lang("それは地面に落ちて砕けた。", "It falls on the ground and shatters.")
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_YOGURT | inv(INV_ITEM_ID, ci) == ITEM_ID_BUTTER | inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO ) {
				if ( synccheck(tlocx, tlocy) ) {
					txtef COLOR_BLUE
					txt lang(" *べちゃ* ", " *crumble* ")
				}
				goto *turn_end
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TOMATO ) {
				if ( synccheck(tlocx, tlocy) ) {
					txtef COLOR_BLUE
					txt lang(" *ぷちゅ* ", " *crumble* ")
				}
				goto *turn_end
			}
			efp = 50 + sdata(SKILL_WEAPON_THROWING, cc) * 10
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BOTTLE_SULFURIC ) {
				addmef tlocx, tlocy, 3, 19, rnd(15) + 5, efp, cc
				goto *turn_end
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MOLOTOV ) {
				addmef tlocx, tlocy, 5, 24, rnd(15) + 25, efp, cc
				mapitem_fire tlocx, tlocy
				goto *turn_end
			}
			addmef tlocx, tlocy, 6, 27, -1, efp, cc, inv(INV_ITEM_ID, ci), inv(INV_ITEM_STATUS, ci), inv(INV_ITEM_COL, ci)
			if ( gdata(GDATA_QUICK_USE) == 1 & cc == CHARA_PLAYER ) {
				snd SOUNDLIST_THROW2
				gdata(GDATA_QUICK_USE) = 0
				goto *pc_turn
			}
			else {
				goto *turn_end
			}
		}
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SUIGARA ) {
		snd SOUNDLIST_THROW2
		snd SOUNDLIST_FIRE1
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( synccheck(tc, -1) ) {
				txt_hittarget
			}
			rowact_check tc
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				hostileaction cc, tc
			}
			efid = SKILL_EFFECT_POTION_MOLOTOV
			efp = 40
			gosub *effect
		}
		else {
			addmef tlocx, tlocy, 5, 24, 0, 40, cc
			mapitem_fire tlocx, tlocy
		}
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CHESTNUT & inv(INV_ITEM_PARAM2, ci) == 0 ) {
		snd SOUNDLIST_THROW2
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
				if ( tc != CHARA_PLAYER ) {
					if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
					txt_guard
				}
			}
			if ( synccheck(tc, -1) ) {
				txt_hittarget
			}
			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != 1 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != 1 & cbit(CHARA_BIT_SUMMONED, tc) != 1 & cbit(CHARA_BIT_LIVESTOCK, tc) != 1 & cbit(CHARA_BIT_NECRO, tc) != 1 & tc != CHARA_PLAYER ) {
				if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 | TweakData(52, 2) == 1 ) {
					skillexp SKILL_NORMAL_TACTICS, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 3 - sdata(SKILL_NORMAL_TACTICS, cc) + 1, 5, 80)
					skillexp SKILL_WEAPON_THROWING, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 3 - sdata(SKILL_WEAPON_THROWING, cc) + 1, 5, 80)
				}
			}
			rowact_check tc
			snd SOUNDLIST_ATK2
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				hostileaction cc, tc
			}
			dmghp tc, rnd(sdata(SKILL_WEAPON_THROWING, cc) * 2) + 1, cc, SKILL_RESDMG_CHESTNUT, 1000
			dmghp tc, (sdata(SKILL_WEAPON_THROWING, cc) + 2) / 2, cc, SKILL_RESDMG_CUT, 500
			if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHESTNUT_GIANT ) {
				txt lang("「お、おのれ！卑劣な真似を！」", "Chestnut giant yells, " + cnvtalk("You idiot!"))
				dmghp tc, cdata(CDATA_MAX_HP, tc) / 10, cc, SKILL_RESDMG_CHESTNUT, 1000
			}
			if ( gdata(GDATA_FLAG_THROWN_CHESTNUTS) < 100 ) {
				gdata(GDATA_FLAG_THROWN_CHESTNUTS)++
			}
		}
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_LULWYS_PHOTO_COLLECTION ) {
		snd SOUNDLIST_THROW2
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "の足元に落ちた。", "It hits " + name(tc) + "!")
			}
			rowact_check tc
		}
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_DUEL_GLOVE ) {
		snd SOUNDLIST_THROW2
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( synccheck(tc, -1) ) {
				txt lang(name(tc) + "の足元に落ちた。", "It hits " + name(tc) + "!")
			}
			rowact_check tc
			if ( cdata(CDATA_CONDITION_SLEEP, tc) != 0 | cdata(CDATA_CONDITION_PARALYZE, tc) != 0 | cdata(CDATA_CONDITION_BLIND, tc) != 0 | cdata(CDATA_CONDITION_FEAR, tc) != 0 | cdata(CDATA_CONDITION_DIM, tc) != 0 ) {
				goto *turn_end
			}
			if ( gdata(GDATA_FLAG_DUEL_TARGET) <= 0 & gdata(GDATA_FLAG_DUEL_TARGET) != tc & cdata(CDATA_RELATION, tc) == 0 & tc >= MAX_CHARA_FOLLOWER ) {
				gdata(GDATA_FLAG_DUEL_TARGET) = tc
				gdata(GDATA_FLAG_TIMES_DUELED)++
				snd SOUNDLIST_GET1
				txt lang(name(tc) + "は手袋を拾い上げ、臨戦態勢に入った。＊決闘開始＊", name(tc) + " picked up the glove and assumed a fighting stance. *Duel*")
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				snd SOUNDLIST_CHEER
				cdata(CDATA_EMO_ICON, tc) = 18 + 100 * 4
				cdata(CDATA_RELATION, tc) = -3
				cdata(CDATA_AI_AGGRO, tc) = 80
				cdata(CDATA_TARGET, tc) = 0
			}
			else {
				if ( tc != CHARA_PLAYER ) {
					txt lang(name(tc) + "に鼻で笑われた。", name(tc) + " ridiculed you.")
				}
			}
		}
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SOYBEAN | inv(INV_ITEM_ID, ci) == ITEM_ID_TOFU ) {
		snd SOUNDLIST_THROW2
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( synccheck(tc, -1) ) {
				txt_hittarget
			}
			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != 1 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != 1 & cbit(CHARA_BIT_SUMMONED, tc) != 1 & cbit(CHARA_BIT_LIVESTOCK, tc) != 1 & cbit(CHARA_BIT_NECRO, tc) != 1 & tc != CHARA_PLAYER ) {
				if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 | TweakData(52, 2) == 1 ) {
					skillexp SKILL_NORMAL_TACTICS, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 3 - sdata(SKILL_NORMAL_TACTICS, cc) + 1, 5, 80)
					skillexp SKILL_WEAPON_THROWING, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 3 - sdata(SKILL_WEAPON_THROWING, cc) + 1, 5, 80)
				}
			}
			rowact_check tc
			snd SOUNDLIST_ATK2
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				hostileaction cc, tc
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SOYBEAN ) {
				dmghp tc, sdata(SKILL_WEAPON_THROWING, cc), cc, SKILL_RES_DARKNESS, 3000 * inv(INV_ITEM_LEVEL, ci)
				if ( cdata(CDATA_ID, tc) >= CREATURE_ID_SMASH_OGRE & cdata(CDATA_ID, tc) <= CREATURE_ID_SHINE_OGRE ) {
					if ( cdata(CDATA_HP, tc) > 10 ) {
						dmghp tc, cdata(CDATA_HP, tc) - rnd(10), cc
					}
					else {
						dmghp tc, rnd(20000), cc
					}
				}
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TOFU ) {
				snd SOUNDLIST_BASH1
				dmghp tc, sdata(SKILL_WEAPON_THROWING, cc) * inv(INV_ITEM_LEVEL, ci) + rnd(sdata(SKILL_WEAPON_THROWING, cc) + 10) + 1, cc, SKILL_RESDMG_TOFU, 1000
			}
		}
		goto *turn_end
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_FURNITURE | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_JUNK | refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ENVIRONMENT ) {
		if ( map(tlocx, tlocy, 1) != 0 ) {
			tc = map(tlocx, tlocy, 1) - 1
			if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
				if ( tc != CHARA_PLAYER ) {
					if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
					txt_guard
				}
			}
			if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) != FILTER_ITEM_FOOD ) {
				if ( synccheck(tc, -1) ) {
					txt_hittarget
				}
			}
			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != 1 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != 1 & cbit(CHARA_BIT_NECRO, tc) != 1 & cbit(CHARA_BIT_SUMMONED, tc) != 1 & cbit(CHARA_BIT_LIVESTOCK, tc) != 1 & tc != CHARA_PLAYER ) {
				if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 | TweakData(52, 2) == 1 ) {
					skillexp SKILL_NORMAL_TACTICS, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 3 - sdata(SKILL_NORMAL_TACTICS, cc) + 1, 5, 80)
					skillexp SKILL_WEAPON_THROWING, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 3 - sdata(SKILL_WEAPON_THROWING, cc) + 1, 5, 80)
				}
			}
			rowact_check tc
			if ( inv(INV_ITEM_ID, ci) != ITEM_ID_OHUDA ) {
				snd SOUNDLIST_BASH1
			}
			if ( tc >= MAX_CHARA_FOLLOWER ) {
				hostileaction cc, tc
			}
			if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD & cdata(CDATA_HUNGER, tc) < 10000 & cdata(CDATA_CONDITION_SLEEP, tc) == 0 & cdata(CDATA_CONDITION_DIM, tc) < 60 ) {
				cc = tc
				txt lang(name(tc) + "は思わず" + itemname(ci, 1) + "に食いついた！", "It hits " + name(tc) + "!")
				gosub *insta_eat
				cc = CHARA_PLAYER
				if ( tc != CHARA_PLAYER ) {
					if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) > 10 ) {
						cdata(CDATA_CONDITION_SUFFOCATION, tc) = 10
					}
				}
				if ( rnd(8) == 0 ) {
					if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) == 0 ) {
						snd SOUNDLIST_EAT1
						txt lang(name(tc) + "はむせた。「げほっげほっ！」", "It hits " + name(tc) + "!")
					}
					if ( tc != CHARA_PLAYER ) {
						if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) < 10 ) {
							cdata(CDATA_CONDITION_SUFFOCATION, tc) = 10
						}
					}
					if ( tc == CHARA_PLAYER ) {
						cdata(CDATA_CONDITION_SUFFOCATION, tc) = 10
					}
				}
			}
			else {
				if ( inv(INV_ITEM_ID, ci) != ITEM_ID_MAGISTUS & inv(INV_ITEM_ID, ci) != ITEM_ID_TRISMAGISTUS & inv(INV_ITEM_ID, ci) != ITEM_ID_OHUDA & inv(INV_ITEM_ID, ci) != ITEM_ID_PRESENT & inv(INV_ITEM_ID, ci) != ITEM_ID_WILD_FLOWER ) {
					dmghp tc, limit(sdata(SKILL_WEAPON_THROWING, cc) / 5, 1, 200) * limit(inv(INV_ITEM_WEIGHT, ci) / 1000, 1, 500) + rnd(inv(INV_ITEM_WEIGHT, ci) / 1000 + sdata(SKILL_WEAPON_THROWING, cc) + 1), cc
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKULL_SWORD | inv(INV_ITEM_ID, ci) == ITEM_ID_VIOLENT_SKULL_SWORD ) {
					if ( inv(INV_ITEM_PARAM2, ci) == 0 ) {
						inv(INV_ITEM_PARAM2, ci) = 1
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SKULL_SWORD ) {
						dmghp tc, limit(sdata(SKILL_WEAPON_THROWING, cc) / 5, 1, 200) * limit(inv(INV_ITEM_PARAM2, ci) / 4, 1, 500) + rnd(inv(INV_ITEM_PARAM2, ci) / 4 + sdata(SKILL_WEAPON_THROWING, cc) + 1), cc, SKILL_RES_NETHER, 1000
					}
					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_VIOLENT_SKULL_SWORD ) {
						dmghp tc, limit(sdata(SKILL_WEAPON_THROWING, cc) / 5, 1, 200) * limit(inv(INV_ITEM_PARAM2, ci) / 4, 1, 500) * 2 + rnd(inv(INV_ITEM_PARAM2, ci) / 4 + sdata(SKILL_WEAPON_THROWING, cc) + 1), cc, SKILL_RES_NETHER, 1000
						dmghp tc, limit(sdata(SKILL_WEAPON_THROWING, cc) / 5, 1, 200) * limit(inv(INV_ITEM_PARAM2, ci) / 4, 1, 500) + rnd(inv(INV_ITEM_PARAM2, ci) / 4 + sdata(SKILL_WEAPON_THROWING, cc) + 1), cc, SKILL_RES_MAGIC, 1000
					}
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_OHUDA ) {
					repeat MAX_BLESSINGS + MAX_HEXES
						i = MAX_BLESSINGS + MAX_HEXES - cnt - 1
						if ( bdataref(0, cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc)) != 1 ) {
							continue
						}
						if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == BUFF_PUNISHMENT ) {
							continue
						}
						if ( cdata(STARTING_CDATA_BUFF + i * ARRAY_CDATA_BUFF, tc) == 0 ) {
							continue
						}
						delbuff tc, i
						break
					loop
					waitbk = cfg_animewait
					if ( cfg_animewait > 0 ) {
						cfg_animewait = 1
					}
					animeload ANIMATION_BLOOD, tc
					cfg_animewait = waitbk
					dmghp tc, limit(sdata(SKILL_WEAPON_THROWING, cc) / 5, 1, 200) * limit((sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) + 1) / 3, 1, 500) + rnd(sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) + sdata(SKILL_WEAPON_THROWING, cc) + 1), cc, SKILL_RES_MAGIC, 1000
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_PRESENT ) {
					if ( cdata(CDATA_RELATION, tc) == (-3) | tc == CHARA_PLAYER ) {
						dmghp tc, limit(sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) / 5, 1, 400) * limit(sdata(SKILL_ATTR_WIL, cc) / 6, 1, 200) + rnd(sdata(SKILL_ATTR_WIL, cc) + 1) + sdata(SKILL_NORMAL_MAGIC_DEVICE, cc), cc, SKILL_RES_CHAOS, 3000
					}
					else {
						snd SOUNDLIST_HEAL1
						healhp tc, sqrt(sdata(SKILL_ATTR_WIL, tc)) * limit(sdata(SKILL_ATTR_WIL, cc) / 4, 1, 500) + sdata(SKILL_ATTR_WIL, cc) + rnd(sdata(SKILL_ATTR_WIL, tc) + 1)
					}
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_WILD_FLOWER ) {
					if ( inv(INV_ITEM_PARAM2, ci) != 5 ) {
						dmghp tc, limit(sdata(SKILL_WEAPON_THROWING, cc) / 5, 1, 200) * limit(inv(INV_ITEM_WEIGHT, ci) / 1000, 1, 500) + rnd(inv(INV_ITEM_WEIGHT, ci) / 1000 + sdata(SKILL_WEAPON_THROWING, cc) + 1), cc
					}
					if ( inv(INV_ITEM_PARAM2, ci) == 5 ) {
						dmghp tc, sdata(SKILL_WEAPON_THROWING, cc) * (10 + inv(INV_ITEM_LEVEL, ci)) / 5, cc, SKILL_RESDMG_CUT, 400 * (10 + inv(INV_ITEM_LEVEL, ci)) / 10
					}
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MAGISTUS ) {
					tcbk = tc
					efid = SKILL_SPELL_MAGIC_STORM
					efp = inv(INV_ITEM_PARAM2, ci) * 6 + 5
					gosub *effect
					tc = tcbk
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TRISMAGISTUS ) {
					tcbk = tc
					magist = 3
					repeat 3
						efid = SKILL_SPELL_MAGIC_STORM
						efp = inv(INV_ITEM_PARAM2, ci) * 6 + 5
						gosub *effect
					loop
					magist = 0
					tc = tcbk
				}
			}
		}
		else {
			snd SOUNDLIST_THROW2
		}
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		goto *turn_end
	}
	if ( synccheck(tlocx, tlocy) ) {
		txt lang("それは地面に落ちて砕けた。", "It falls on the ground and shatters.")
		snd SOUNDLIST_CRUSH2
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_KITTY_BANK ) {
		if ( inv(INV_ITEM_PROPERTY, ci) != PROP_SPECIAL ) {
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, tlocx, tlocy, inv(INV_ITEM_PARAM1, ci)
		}
	}
	goto *turn_end

*act_pray
	item_find FILTER_FURNITURE_ALTAR
	if ( stat != (-1) ) {
		ci = stat
		if ( inv(INV_ITEM_GOD, ci) != cdata(CDATA_GOD, CHARA_PLAYER) ) {
			gosub *god_select
			goto *turn_end
		}
	}
	goto *god_pray

*act_exchange
	item_exchange ci, ti
	return

*act_get
	if ( cc != (-1) ) {
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GOLD_PIECE | inv(INV_ITEM_ID, ci) == ITEM_ID_PLATINUM_COIN ) {
			snd SOUNDLIST_GETGOLD1
			ti = ci
			in = inv(INV_ITEM_NUM, ci)
			inv(INV_ITEM_NUM, ci) = 0
			msgkeep = 1
			txt lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GOLD_PIECE ) {
				cdata(CDATA_GOLD, cc) += in
			}
			else {
				cdata(CDATA_PLATINUM, cc) += in
				gdata(GDATA_FLAG_TOTAL_PLATINUM) += in
			}
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GOLD_PIECE ) {
				if ( in > 1 ) {
					if ( cdata(CDATA_ALLIED, cc) == 100 ) {
						if ( cdata(CDATA_IN_TAGTEAM, cc) != 0 ) {
							txt lang(name(cc) + "はパートナーに金貨を分けてあげた。", name(cc) + " shared coins with partner.")
							cdata(CDATA_GOLD, cdata(CDATA_TAGTEAM_PARTNER, cc)) += in / 2
							cdata(CDATA_GOLD, cc) -= in / 2
						}
					}
				}
			}
			return 1
		}
	}
	if ( cc == CHARA_PLAYER ) {
		if ( inv(INV_ITEM_SHOP_SAMPLE, ci) == 100 ) {
			inv(INV_ITEM_SHOP_SAMPLE, ci) = 0
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			if ( inv_sum(CHARA_PLAYER) > 20 ) {
				txt lang("これ以上持ち歩けない。", "You can carry nothing more.")
				return 0
			}
		}
		if ( gdata(GDATA_RIDER) != 0 ) {
			if ( cdata(CDATA_ROW_ACT, gdata(GDATA_RIDER)) != ACTION_NONE ) {
				if ( cdata(CDATA_ITEM_USING, gdata(GDATA_RIDER)) == ci ) {
					txt lang("それは" + name(gdata(GDATA_RIDER)) + "が使用中だ。", name(gdata(GDATA_RIDER)) + " " + is(gdata(GDATA_RIDER)) + " using it.")
					return 1
				}
			}
		}
		if ( cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER) > 0 ) {
			if ( cdata(CDATA_ROW_ACT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) != ACTION_NONE ) {
				if ( cdata(CDATA_ITEM_USING, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) == ci ) {
					txt lang("それはタッグパートナーが使用中だ。", "The tag partner is using it.")
					return 1
				}
			}
		}
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
			if ( inv(INV_ITEM_PROPERTY, ci) == PROP_QUEST ) {
				if ( cdata(CDATA_ROW_ACT, CHARA_PLAYER) == ACTION_NONE ) {
					if ( inv_getspace(CHARA_PLAYER) == 0 ) {
						txt_invfull
						return 0
					}
					gdata(GDATA_ROW_ACT) = ACTION_HARVEST
					gosub *generalAct
					return -1
				}
			}
		}
		if ( inv(INV_ITEM_PROPERTY, ci) == PROP_CONSTRUCT ) {
			txt lang(itemname(ci) + "を撤去する？ ", "Do you want to remove " + itemname(ci) + "? ")
			promptYesNo
			if ( rtval == 0 ) {
				snd SOUNDLIST_BUILD1
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SHELTER ) {
					midbk = mid
					mid = "" + 30 + "_" + (STARTING_ITEM_ROLE_FILE_SHELTER + inv(INV_ITEM_FILE, ci))
					existwrapper exedir + "tmp\\mdata_" + mid + ".s2"
					if ( strsize != (-1) ) {
						fmode = 11
						gosub *game_ctrlFile
					}
					mid = midbk
					inv(INV_ITEM_FILE, ci) = ITEM_ROLE_FILE_NONE
					inv(INV_ITEM_PARAM2, ci) = 100
					inv(INV_ITEM_PROPERTY, ci) = PROP_NONE
				}
			}
			else {
				return 0
			}
		}
		if ( inv_getfreeid(cc) == (-1) ) {
			txt_invfull2
			return 0
		}
	}
	if ( qdata(QDATA_EXIST, rq) == QUEST_TYPE_HARVEST ) {
		if ( gdata(GDATA_ROW_ACT) == ACTION_HARVEST ) {
			in = 1
			gdata(GDATA_ROW_ACT) = ACTION_NONE
		}
	}
	inumbk = inv(INV_ITEM_NUM, ci) - in
	inv(INV_ITEM_NUM, ci) = in
	if ( cc == CHARA_PLAYER ) {
		if ( trait(TRAIT_ETHER_ABSORB_ROD) != 0 ) {
			if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_ROD ) {
				if ( inv(INV_ITEM_CHARGE, ci) > 0 ) {
					dbmode = DBMODE_ON_ZAP
					dbid = inv(INV_ITEM_ID, ci)
					gosub *db_item
					txt lang("あなたは" + itemname(ci) + "から魔力を吸い取った。", "You absorb magic from " + itemname(ci) + ".")
					if ( efid >= STARTING_SKILL_SPELL & efid < MAX_SPELL ) {
						skillgain CHARA_PLAYER, efid, 1, inv(INV_ITEM_CHARGE, ci) * 5 * inv(INV_ITEM_NUM, ci) + 10
						txtef COLOR_BLUE
						txt lang(name(CHARA_PLAYER) + "は" + skillname(efid) + "の魔法のストックを得た。", s + "you gain knowledge of a spell, " + skillname(efid) + ".")
					}
					else {
						healmp 0, inv(INV_ITEM_CHARGE, ci) * 5 * inv(INV_ITEM_NUM, ci)
						txt lang(name(CHARA_PLAYER) + "のマナが回復した。", name(CHARA_PLAYER) + your(CHARA_PLAYER) + " mana is restored.")
					}
					inv(INV_ITEM_CHARGE, ci) = 0
				}
			}
		}
		if ( trait(TRAIT_ETHER_POISON_HANDS) != 0 ) {
			if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION ) {
				if ( inv(INV_ITEM_ID, ci) != ITEM_ID_POISON & inv(INV_ITEM_ID, ci) != ITEM_ID_POTION_CURE_CORRUPTION ) {
					if ( rnd(5) == 0 ) {
						txt lang("あなたの手から毒が滴った。", "Poison drips from your hands.")
						if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HANDFUL_SNOW ) {
							txt lang("毒で雪が溶けてしまった…。", "Poison has melted the snow...")
							inv(INV_ITEM_NUM, ci)--
							cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
							return 0
						}
						inv(INV_ITEM_ID, ci) = ITEM_ID_POISON
					}
				}
			}
		}
	}
	if ( inv(INV_ITEM_PROPERTY, ci) < PROP_NONE ) {
		inv(INV_ITEM_PROPERTY, ci) = PROP_NONE
	}
	ibitmod ITEM_BIT_DROP, ci, 0
	item_stack cc, ci
	if ( stat == 0 ) {
		ti = inv_getfreeid(cc)
		if ( ti == (-1) ) {
			inv(INV_ITEM_NUM, ci) = inumbk + in
			if ( invctrl == 12 ) {
				txt lang("店の倉庫が一杯のため売れない。", "Shopkeeper's inventory is full.")
			}
			else {
				txt_invfull2
			}
			return 0
		}
		item_copy ci, ti
		inv(INV_ITEM_NUM, ti) = in
	}
	inv(INV_ITEM_NUM, ci) = inumbk
	if ( mode == MODELIST_SHOP ) {
		if ( refitem(inv(INV_ITEM_ID, ti), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
			if ( invctrl == 11 | invctrl == 22 ) {
				if ( invctrl == 22 & invctrl(1) == 3 ) {
					if ( inv(INV_ITEM_ROT, ti) > 0 ) {
						inv(INV_ITEM_ROT, ti) += gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12
					}
				}
				else {
					if ( inv(INV_ITEM_MATERIAL, ci) == ITEM_MATERIAL_RAW ) {
						if ( inv(INV_ITEM_ROT, ti) != 0 ) {
							inv(INV_ITEM_ROT, ti) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + refitem(inv(INV_ITEM_ID, ti), DBSPEC_PARAM3_ORG)
							if ( inv(INV_ITEM_PARAM2, ti) != 0 ) {
								inv(INV_ITEM_ROT, ti) += 72
							}
						}
					}
				}
			}
			if ( invctrl == 24 & invctrl(1) == 3 ) {
				if ( inv(INV_ITEM_ROT, ti) > 0 ) {
					inv(INV_ITEM_ROT, ti) = inv(INV_ITEM_ROT, ti) - (gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12)
				}
			}
		}
		if ( invctrl == 11 ) {
			msgkeep = 1
			txtmore
			txt lang(itemname(ti, in) + "を買った。", "You buy " + itemname(ti, in) + ".")
			sellgold = calcitemvalue(ti, 0) * in
			snd SOUNDLIST_PAYGOLD1
			cdata(CDATA_GOLD, CHARA_PLAYER) -= sellgold
			cdata(CDATA_GOLD, tc) += sellgold
			if ( cdata(CDATA_ROLE, tc) == ROLE_SHOP_TRADE ) {
				if ( inv(INV_ITEM_PARAM2, ti) == 0 ) {
					p = sellgold + cdata(CDATA_SHOP_INVEST, tc)
					repeat 30
						if ( p >= calcinvestvalue() ) {
							p -= calcinvestvalue()
							cdata(CDATA_ROLE_SHOP_LEVEL, tc) += rnd(2) + 2
						}
					loop
					cdata(CDATA_SHOP_INVEST, tc) = p
				}
			}
			if ( refitem(inv(INV_ITEM_ID, ti), DBSPEC_TYPE) == FILTER_CARGO_TRADE ) {
				inv(INV_ITEM_PARAM2, ti) = calcitemvalue(ti, 0)
				inv(INV_ITEM_PARAM3, ti) = gdata(GDATA_AREA)
			}
		}
		if ( invctrl == 12 ) {
			msgkeep = 1
			sellgold = calcitemvalue(ci, 1) * in
			if ( ibit(ITEM_BIT_STOLEN, ti) == 0 ) {
				txt lang(itemname(ti, in) + "を売った。", "You sell " + itemname(ti, in) + ".")
				if ( cdata(CDATA_ROLE, tc) == ROLE_SHOP_TRADE ) {
					if ( inv(INV_ITEM_PARAM3, ti) != gdata(GDATA_AREA) ) {
						repeat MAX_CHARA_TOTAL
							if ( cdata(CDATA_ROLE, cnt) == ROLE_SHOP_TRADE ) {
								continue
							}
							if ( (cdata(CDATA_ROLE, cnt) >= ROLE_SHOP_MIN & cdata(CDATA_ROLE, cnt) < ROLE_GUEST_MIN | cdata(CDATA_ROLE, cnt) == ROLE_GUEST_MERCHANT) != 1 ) {
								continue
							}
							cdata(CDATA_FAME, cnt) += sellgold
						loop
					}
				}
			}
			else {
				ibitmod ITEM_BIT_STOLEN, ti, 0
				txt lang("盗品の" + itemname(ti, in) + "を売却した。", "You sell " + itemname(ti, in) + ". (Stolen item sold)")
				if ( gdata(GDATA_FLAG_GUILD_THIEF_NORMA) > 0 ) {
					gdata(GDATA_FLAG_GUILD_THIEF_NORMA) -= sellgold
					if ( gdata(GDATA_FLAG_GUILD_THIEF_NORMA) < 0 ) {
						gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = 0
					}
					txtmore
					txt lang("盗賊ギルドのノルマ達成まで、あと金貨" + gdata(GDATA_FLAG_GUILD_THIEF_NORMA) + "枚相当の盗品を売却する必要がある。", "You still need to sell stuff worth " + gdata(GDATA_FLAG_GUILD_THIEF_NORMA) + " gold pieces in order to advance ranks in the Thieves Guild.")
				}
			}
			snd SOUNDLIST_GETGOLD1
			cdata(CDATA_GOLD, CHARA_PLAYER) += sellgold
			cdata(CDATA_GOLD, tc) -= sellgold
			if ( cdata(CDATA_GOLD, tc) < 0 ) {
				cdata(CDATA_GOLD, tc) = 0
			}
			inv(INV_ITEM_KNOWN, ti) = ITEM_KNOWN_FULL
		}
		if ( invctrl == 22 | invctrl == 24 ) {
			snd SOUNDLIST_GET1 + rnd(2)
			msgkeep = 1
			if ( invctrl == 22 ) {
				txt lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
			}
			else {
				txt lang(itemname(ti, in) + "を保管した。", "You put " + itemname(ti, in) + " in the container.")
			}
		}
		else {
			r1 = CHARA_PLAYER
			r2 = sellgold
			gosub *expTrade
		}
	}
	else {
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		map(inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci), 5) = map(inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci), 4)
		snd SOUNDLIST_GET1 + rnd(2)
		msgkeep = 1
		txt lang(name(cc) + "は" + itemname(ti, in) + "を拾った。", name(cc) + " pick" + _s(cc) + " up " + itemname(ti, in) + ".")
	}
	if ( cc == CHARA_PLAYER ) {
		if ( inv(INV_ITEM_ID, ti) == ITEM_ID_CAMPFIRE ) {
			inv_getheader -1
			if ( mdata(MDATA_FIRE_SOUND) == 1 ) {
				f = 0
				repeat invrange, invhead
					if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
						continue
					}
					if ( inv(INV_ITEM_ID, cnt) == ITEM_ID_CAMPFIRE ) {
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					mdata(MDATA_FIRE_SOUND) = 0
					gosub *music_play
				}
			}
		}
		convertartifact ti
		ti = stat
		if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_MUSEUM ) {
			if ( mode == MODELIST_MAIN ) {
				gosub *museum_update
			}
		}
		if ( gdata(GDATA_AREA) == AREA_HOME ) {
			if ( mode == MODELIST_MAIN ) {
				gosub *house_update
			}
		}
		gosub *calcBurdenPc
	}
	if ( cc == (-1) ) {
		gosub *calcBurdenPc
	}
	return 1

*act_drop
	inumbk = inv(INV_ITEM_NUM, ci) - in
	inv(INV_ITEM_NUM, ci) = in
	inv(INV_ITEM_X, ci) = cdata(CDATA_X, cc)
	inv(INV_ITEM_Y, ci) = cdata(CDATA_Y, cc)
	itemturn ci
	if ( inv(INV_ITEM_ID, ci) != ITEM_ID_BOTTLE_WATER ) {
		item_stack -1, ci
	}
	if ( stat == 0 | dropval == 0 ) {
		ti = inv_getfreeid(-1)
		if ( ti == (-1) ) {
			txt lang("もう周りに物を置くスペースがない！ ", "The place is too crowded. You can't drop stuff anymore.")
			gosub *screen_draw
			return 0
		}
		item_copy ci, ti
	}
	if ( dropval == 1 ) {
		inv(INV_ITEM_PROPERTY, ti) = PROP_CONSTRUCT
		inv(INV_ITEM_FILE, ti) = gdata(GDATA_COUNT_SHELTER) + 5
		gdata(GDATA_COUNT_SHELTER)++
		if ( inv(INV_ITEM_FILE, ti) > 50 ) {
			inv(INV_ITEM_PARAM2, ti) = 10
		}
	}
	inv(INV_ITEM_NUM, ci) = inumbk
	cell_refresh inv(INV_ITEM_X, ti), inv(INV_ITEM_Y, ti)
	if ( dropval == 0 ) {
		screenupdate = -1
		gosub *screen_draw
		snd SOUNDLIST_DROP1
		txt lang(itemname(ti, in) + "を地面に置いた。", "You drop " + itemname(ti, in) + ".")
	}
	gosub *calcBurdenPc
	if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_SHOP ) {
		if ( chipm(CHIPM_ROLE, map(inv(INV_ITEM_X, ti), inv(INV_ITEM_Y, ti), 0)) == MAP_CHIP_ROLE_DISPLAY_SPACE ) {
			inv(INV_ITEM_SHOP_SAMPLE, ti) = 100
		}
	}
	if ( inv(INV_ITEM_ID, ti) == ITEM_ID_BOTTLE_WATER ) {
		item_find FILTER_FURNITURE_ALTAR, 0
		if ( stat != (-1) ) {
			p = stat
			if ( inv(INV_ITEM_GOD, p) == cdata(CDATA_GOD, cc) ) {
				if ( inv(INV_ITEM_STATUS, ti) != ITEM_STATUS_BLESSED ) {
					snd SOUNDLIST_PRAY1
					inv(INV_ITEM_STATUS, ti) = ITEM_STATUS_BLESSED
					txtef COLOR_GREEN
					txt lang("水は祝福を受けた。", "The water is blessed.")
				}
			}
		}
		item_stack -1, ti
	}
	if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_MUSEUM ) {
		if ( mode == MODELIST_MAIN ) {
			gosub *museum_update
		}
	}
	if ( gdata(GDATA_AREA) == AREA_HOME ) {
		if ( mode == MODELIST_MAIN ) {
			gosub *house_update
		}
	}
	if ( inv(INV_ITEM_ID, ti) == ITEM_ID_CAMPFIRE ) {
		mdata(MDATA_FIRE_SOUND) = 1
		gosub *music_play
	}
	return 1

*act_equip
	if ( ci == (-1) ) {
		return 0
	}
	if ( cdata(body, r1) \ EXT_EQUIP_SLOTS != 0 ) {
		return 0
	}
	if ( inv(INV_ITEM_EQUIP, ci) != 0 ) {
		return 0
	}
	item_separate ci
	if ( r1 == CHARA_PLAYER ) {
		item_identify ci, ITEM_KNOWN_QUALITY
	}
	inv(INV_ITEM_EQUIP, ci) = body
	cdata(body, r1) = cdata(body, r1) / EXT_EQUIP_SLOTS * EXT_EQUIP_SLOTS + ci + 1
	return 1

*act_unequip
	p = cdata(body, r1) \ EXT_EQUIP_SLOTS
	if ( p == 0 ) {
		rtval = -2
		return
	}
	ci = p - 1
	cdata(body, r1) = cdata(body, r1) / EXT_EQUIP_SLOTS * EXT_EQUIP_SLOTS
	inv(INV_ITEM_EQUIP, ci) = 0
	item_stack r1, ci
	return

*act_unequip_part
	repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
		if ( cdata(cnt, r1) / EXT_EQUIP_SLOTS == body ) {
			p = cdata(cnt, r1) \ EXT_EQUIP_SLOTS
			if ( p == 0 ) {
				continue
			}
			p--
			inv(INV_ITEM_EQUIP, p) = 0
			cdata(cnt, r1) = cdata(cnt, r1) / EXT_EQUIP_SLOTS * EXT_EQUIP_SLOTS
		}
	loop
	return

*act_read
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RECIPE ) {
		if ( inv(INV_ITEM_SUB_NAME, ci) == CREATURE_ID_BUG ) {
			txt lang("最後に調合したアイテムを、レシピに加えることができる。", "You can add a recipe of the item you previously created.(Not implemented yet)")
			goto *turn_end
		}
	}
	efid = EFFECT_NONE
	dbmode = DBMODE_ON_READ
	dbid = inv(INV_ITEM_ID, ci)
	gosub *db_item
	if ( efid == SKILL_EFFECT_CREATE_BUILDING ) {
		goto *building_new
	}
	if ( gdata(GDATA_QUICK_USE) == 1 & cc == CHARA_PLAYER ) {
		snd SOUNDLIST_THROW2
		gdata(GDATA_QUICK_USE) = 0
		goto *pc_turn
	}
	else {
		goto *turn_end
	}

*act_eat
	if ( cc == CHARA_PLAYER ) {
		cargocheck
		if ( stat == 0 ) {
			gosub *screen_draw
			goto *pc_turn
		}
		if ( itemusingfind(ci) > 0 ) {
			txt lang("そのアイテムは他の誰かが使用中だ。", "Someone else is using the item.")
			goto *pc_turn
		}
	}
	else {
		if ( itemusingfind(ci) != (-1) ) {
			tc = itemusingfind(ci)
			if ( tc != cc ) {
				rowactend tc
				if ( synccheck(cc, -1) ) {
					txt lang(name(cc) + "は" + name(tc) + "の食べ物を横取りした。", name(cc) + " snatch" + _s(cc) + " " + name(tc) + your(tc) + " food.")
				}
			}
		}
	}
	cdata(CDATA_EMO_ICON, cc) = 16 + 100
	gosub *eat
	goto *turn_end

*act_drink
	dbmode = DBMODE_ON_DRINK
	dbid = inv(INV_ITEM_ID, ci)
	gosub *db_item
	if ( gdata(GDATA_QUICK_USE) == 1 & cc == CHARA_PLAYER ) {
		snd SOUNDLIST_THROW2
		gdata(GDATA_QUICK_USE) = 0
		goto *pc_turn
	}
	else {
		goto *turn_end
	}

*act_zap
	if ( cc != CHARA_PLAYER ) {
		if ( rnd(2) == 0 | cdata(CDATA_TARGET, cc) == 0 | cdata(CDATA_TARGET, cc) == 0 | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE ) {
			goto *ai_action
		}
	}
	dbmode = DBMODE_ON_ZAP
	dbid = inv(INV_ITEM_ID, ci)
	gosub *db_item
	gosub *zapStaff
	if ( cc == CHARA_PLAYER ) {
		if ( stat == 0 ) {
			gosub *screen_draw
			goto *pc_turn
		}
	}
	if ( cc != CHARA_PLAYER ) {
		if ( stat == 0 ) {
			gosub *screen_draw
			goto *ai_action
		}
	}
	if ( gdata(GDATA_QUICK_USE) == 1 & cc == CHARA_PLAYER ) {
		snd SOUNDLIST_THROW2
		gdata(GDATA_QUICK_USE) = 0
		goto *pc_turn
	}
	else {
		goto *turn_end
	}

*act_bash
	if ( map(x, y, 5) != 0 ) {
		if ( mapitemfind(x, y, ITEM_ID_TREE_FRUIT) != (-1) ) {

			/********** ORIGINAL - BEGINNING **********

			ci = mapitemfind(x, y, ITEM_ID_TREE_FRUIT)
			item_separate ci
			snd SOUNDLIST_BASH1
			txt lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if ( inv(INV_ITEM_PROPERTY, ci) == PROP_SPECIAL | inv(INV_ITEM_PARAM1, ci) <= 0 ) {
				txtmore
				txt lang("もう実はないようだ… ", "It seems there are no fruits left on the tree.")
				goto *turn_end
			}
			inv(INV_ITEM_PARAM1, ci)--
			if ( inv(INV_ITEM_PARAM1, ci) <= 0 ) {
				inv(INV_ITEM_PIC, ci) = xy2pic(31, 17)
				cell_refresh x, y
			}
			if ( y + 1 < mdata(MDATA_HEIGHT) ) {
				if ( (chipm(CHIPM_ATTRIB, map(x, y + 1, 0)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
					y++
				}
			}
			flt
			itemcreate -1, inv(INV_ITEM_PARAM2, ci), x, y, 0

			 ********** ORIGINAL - ENDING **********/

			/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Bash all fruit.

			ci = mapitemfind(x, y, ITEM_ID_TREE_FRUIT)

			if ( TweakData(TWEAK_GAMEPLAY_BASH_ALL_FRUIT, TWEAK_CATEGORY_GAMEPLAY) == 0 ) {
				item_separate ci
			}

			snd SOUNDLIST_BASH1
			txt lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if ( inv(INV_ITEM_PROPERTY, ci) == PROP_SPECIAL | inv(INV_ITEM_PARAM1, ci) <= 0 ) {
				txtmore
				txt lang("もう実はないようだ… ", "It seems there are no fruits left on the tree.")
				goto *turn_end
			}
			if ( y + 1 < mdata(MDATA_HEIGHT) ) {
				if ( (chipm(CHIPM_ATTRIB, map(x, y + 1, 0)) & CHIPM_ATTRIB_CANT_PASS) == 0 ) {
					y++
				}
			}

			bash_tree = ci
			bash_counter = 1
			bash_tree_number = 1

			if ( TweakData(TWEAK_GAMEPLAY_BASH_ALL_FRUIT, TWEAK_CATEGORY_GAMEPLAY) == 1 ) {
				bash_tree_number = inv(INV_ITEM_NUM, bash_tree)
				bash_counter = inv(INV_ITEM_PARAM1, bash_tree)
			}

			repeat bash_counter * bash_tree_number
				flt
				itemcreate -1, inv(INV_ITEM_PARAM2, bash_tree), x, y, 0
			loop

			inv(INV_ITEM_PARAM1, bash_tree) -= bash_counter

			if ( inv(INV_ITEM_PARAM1, bash_tree) <= 0 ) {
				inv(INV_ITEM_PIC, bash_tree) = xy2pic(31, 17)
				cell_refresh inv(INV_ITEM_X, bash_tree), inv(INV_ITEM_Y, bash_tree)
			}

			cell_refresh x, y // This is so the items stack properly

			/********** BLOODYSHADE CUSTOM - ENDING **********/

			txt lang(itemname(ci, 1) + "が降ってきた。", itemname(ci, 1) + " falls down from the tree.")
			goto *turn_end
		}
	}
	if ( map(x, y, 5) != 0 ) {
		if ( mapitemfind(x, y, ITEM_ID_KITTY_BANK) != (-1) ) {
			ci = mapitemfind(x, y, ITEM_ID_KITTY_BANK)
			item_separate ci
			snd SOUNDLIST_BASH1
			txt lang(itemname(ci) + "に体当たりした。", "You throw your weight against " + itemname(ci) + ".")
			if ( inv(INV_ITEM_PROPERTY, ci) != PROP_SPECIAL ) {
				okane = inv(INV_ITEM_PARAM1, ci)
				inv(INV_ITEM_NUM, ci)--
				snd SOUNDLIST_CRUSH2
				flt
				itemcreate -1, ITEM_ID_GOLD_PIECE, tlocx, tlocy, okane
			}
			goto *turn_end
		}
	}
	if ( map(x, y, 1) != 0 ) {
		tc = map(x, y, 1) - 1
		if ( cc == CHARA_PLAYER ) {
			if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
				txtselecttc 2
				repeat 2
					promptAdd s(cnt), key_select(cnt)
				loop
				val = promptx, prompty, 200, 0
				gosub *prompt_key
				if ( rtval == 1 ) {
					tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
				}
			}
		}
		if ( cdata(CDATA_CONDITION_SLEEP, tc) == 0 & cdata(CDATA_CONDITION_DIM, tc) < 60 ) {
			if ( cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_RELATION, tc) >= 0 ) {
					gosub *com_confirmAttack
					if ( stat == 0 ) {
						goto *pc_turn
					}
				}
			}
			if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) ) {
				snd SOUNDLIST_BASH1
				txt lang(name(cc) + "は" + name(tc) + "に全力で体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + " at full power.")
				dmghp tc, sdata(SKILL_ATTR_STR, cc) * 2, cc
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					txt lang(name(tc) + "は食べ物を吐き出した。", name(tc) + " spit" + _s(tc) + " out the food.")
					txt lang("「助かったよ！」", cnvtalk("You saved me!"))
					cdata(CDATA_CONDITION_SUFFOCATION, tc) = 0
					if ( tc != CHARA_PLAYER ) {
						modimp tc, 10
					}
				}
			}
			else {
				snd SOUNDLIST_BASH1
				txt lang(name(cc) + "は" + name(tc) + "に体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + ".")
				hostileaction cc, tc
			}
		}
		else {
			snd SOUNDLIST_BASH1
			txt lang(name(cc) + "は" + name(tc) + "に体当たりした。", name(cc) + " bash" + _s(cc) + " up " + name(tc) + ".")
			txt lang(name(tc) + "は睡眠を妨害された。", name(cc) + " disturb" + _s(cc) + " " + his(tc) + " sleep.")
			modkarma cc, -1
			cdata(CDATA_EMO_ICON, tc) = 18 + 100 * 4
		}
		if ( cdata(CDATA_CONDITION_DIM, tc) > 60 ) {
			cdata(CDATA_CONDITION_DIM, tc) = 59
		}
		cdata(CDATA_CONDITION_SLEEP, tc) = 0
		goto *turn_end
	}
	if ( map(x, y, 6) != 0 ) {
		cell_featread x, y
		if ( feat(1) == CELL_FEATURE_POT ) {
			map(x, y, 6) = 0
			spillfrag x, y, 2
			flt calcobjlv(gdata(GDATA_LEVEL) * (gdata(GDATA_AREA) != AREA_SHELTER)), calcfixlv(FIX_QUALITY_GOOD)
			flttypemajor = fsetbarrel(rnd(length(fsetbarrel)))
			itemcreate -1, ITEM_ID_DUMMY, x, y, 0
			if ( synccheck(cc, -1) ) {
				snd SOUNDLIST_BASH1
				txt lang(name(cc) + "は壷を割った。", name(cc) + " shatter" + _s(cc) + " the pot.")
				snd SOUNDLIST_CRUSH1
				animeid = ANIMATION_CRUSH
				gosub *anime
			}
			goto *turn_end
		}
		if ( feat(1) == CELL_FEATURE_DOOR_CLOSED ) {
			snd SOUNDLIST_BASH1
			p = feat(2) * 3 + 30
			if ( gdata(GDATA_AREA) == AREA_JAIL ) {
				p *= 20
			}
			if ( rnd(p) < sdata(SKILL_ATTR_STR, cc) & rnd(2) ) {
				txt lang("扉に体当たりして破壊した。", "You bash up the door. The door is destroyed.")
				if ( feat(2) > sdata(SKILL_ATTR_STR, cc) ) {
					skillexp SKILL_ATTR_STR, cc, (feat(2) - sdata(SKILL_ATTR_STR, cc)) * 15
				}
				cell_featset x, y, 0, 0, 0, 0
				goto *turn_end
			}
			else {
				txt lang("扉に体当たりした。", "You bash up the door.")
				if ( gdata(GDATA_AREA) == AREA_JAIL ) {
					txt lang("さすがに牢獄の扉は頑丈だ。", "As might be expected, the door of the Jail is hard.")
				}
				if ( rnd(4) == 0 ) {
					tc = cc
					efid = SKILL_EFFECT_CONFUSE
					efp = 200
					gosub *effect
				}
				if ( rnd(3) == 0 ) {
					tc = cc
					efid = SKILL_EFFECT_PARALYZE
					efp = 200
					gosub *effect
				}
				if ( rnd(3) == 0 ) {
					if ( cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE & encfind(cc, ENCHANT_SUSTAIN * EXT_ENCHANTMENT + STARTING_SKILL_ATTR) == (-1) ) {
						cdata(STARTING_CDATA_ATTR, cc)--
						r1 = cc
						gosub *charaRefresh
						if ( synccheck(cc, -1) ) {
							txtmore
							txtef COLOR_PURPLE
							txt lang(name(cc) + "は筋肉を痛めた。", name(cc) + " hurt" + _s(cc) + " " + his(cc) + " muscle.")
						}
					}
				}
				if ( rnd(3) == 0 ) {
					if ( feat(2) > 0 ) {
						feat(2)--
						cell_featset x, y, feat(0), feat(1), feat(2), feat(3)
						if ( synccheck(cc, -1) ) {
							txt lang("扉は少しだけ壊れた。", "The door is cracked a bit.")
						}
					}
				}
				goto *turn_end
			}
		}
	}
	txt_check 0
	txt lang(name(cc) + "は空気に体当たりした。", name(cc) + " bash" + _s(cc) + " up the air.")
	snd SOUNDLIST_MISS
	goto *turn_end
	gosub *search_for_chara
	return

*search_for_chara
	listmax2 = 0
	if ( cc == CHARA_PLAYER ) {
		repeat 17
			y = cdata(CDATA_Y, cc) - 17 / 2 + cnt
			if ( y < 0 | y >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat fovlist(1, cnt), fovlist(0, cnt)
				x = cdata(CDATA_X, cc) - 17 / 2 + cnt
				if ( x < 0 | x >= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( map(x, y, 1) != 0 ) {
					p = map(x, y, 1) - 1
					if ( cc != p ) {
						if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), x, y) != 0 ) {
							listmax2++
						}
					}
				}
			loop
		loop
	}
	else {
		repeat cdata(CDATA_FOV, cc) - 2
			y = cdata(CDATA_Y, cc) - cdata(CDATA_FOV, cc) / 2 + cnt + 1
			if ( y < 0 | y >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat cdata(CDATA_FOV, cc) - 2
				x = cdata(CDATA_X, cc) - cdata(CDATA_FOV, cc) / 2 + cnt + 1
				if ( x < 0 | x >= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( map(x, y, 1) != 0 ) {
					p = map(x, y, 1) - 1
					if ( cc != p ) {
						if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), x, y) != 0 ) {
							listmax2++
						}
					}
				}
			loop
		loop
	}
	return

*act_movePC
	f = 0
	if ( cdata(CDATA_CONDITION_DRUNK, cc) != 0 ) {
		if ( rnd(5 + cdata(CDATA_ALCOHOL_CONSUMED, cc)) == 0 ) {
			txtef COLOR_SKY_BLUE
			txtmore
			txt lang(" *ふらり* ", " *stagger* ")
			f = 1
		}
	}
	if ( cdata(CDATA_CONDITION_SUFFOCATION, cc) != 0 | cdata(CDATA_CONDITION_CONFUSE, cc) != 0 | f == 1 ) {
		cdata(CDATA_X_NEW, cc) = cdata(CDATA_X, cc) + rnd(3) - 1
		cdata(CDATA_Y_NEW, cc) = cdata(CDATA_Y, cc) + rnd(3) - 1
	}
	if ( gdata(GDATA_RIDER) != 0 ) {
		if ( cdata(CDATA_ROW_ACT, gdata(GDATA_RIDER)) != ACTION_NONE ) {
			if ( cdata(CDATA_ACTION_PERIOD, gdata(GDATA_RIDER)) > 0 ) {
				if ( cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) < 200 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "はあなたを睨み付けた。", name(gdata(GDATA_RIDER)) + " glare" + _s(gdata(GDATA_RIDER)) + " at you.")
				}
				if ( cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) >= 200 & cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) < 250 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "はあなたを不満げに見つめた。", name(gdata(GDATA_RIDER)) + " looked away from you with dissatisfaction.")
				}
				if ( cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) >= 250 & cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) < 300 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "は残念そうにうなだれた。", name(gdata(GDATA_RIDER)) + " looked disappointed.")
				}
				if ( cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) >= 300 & cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) < 350 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "は小さく頷いた。", name(gdata(GDATA_RIDER)) + " nodded slightly.")
				}
				if ( cdata(CDATA_IMPRESSION, gdata(GDATA_RIDER)) + cdata(CDATA_MASTER_SERVANT, gdata(GDATA_RIDER)) >= 350 ) {
					txt lang(name(gdata(GDATA_RIDER)) + "は何も言わず一歩下がった。", name(gdata(GDATA_RIDER)) + " stepped back without a word.")
				}
				cdata(CDATA_ROW_ACT, gdata(GDATA_RIDER)) = ACTION_NONE, 0
				txtmore
			}
		}
	}
	if ( cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER) > 0 ) {
		if ( cdata(CDATA_ROW_ACT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) != ACTION_NONE ) {
			if ( cdata(CDATA_ACTION_PERIOD, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) > 0 ) {
				if ( cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) < 200 ) {
					txt lang("タッグパートナーはあなたを睨み付けた。", "Tag partner glare" + _s(cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + " you.")
				}
				if ( cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) >= 200 & cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) < 250 ) {
					txt lang("タッグパートナーはあなたを不満げに見つめた。", "Tag partner looked away you with dissatisfaction.")
				}
				if ( cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) >= 250 & cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) < 300 ) {
					txt lang("タッグパートナーは残念そうにうなだれた。", "Tag partner looked disappointing.")
				}
				if ( cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) >= 300 & cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) < 350 ) {
					txt lang("タッグパートナーは小さく頷いた。", "Tag partner nodded small.")
				}
				if ( cdata(CDATA_IMPRESSION, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) + cdata(CDATA_MASTER_SERVANT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) >= 350 ) {
					txt lang("タッグパートナーは何も言わず一歩下がった。", "Tag partner went down one step without saying anything.")
				}
				cdata(CDATA_ROW_ACT, cdata(CDATA_TAGTEAM_PARTNER, CHARA_PLAYER)) = ACTION_NONE, 0
				txtmore
			}
		}
	}
	cell_check cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc)
	if ( cdata(CDATA_BURDEN, CHARA_PLAYER) >= 4 ) {
		msgdup++
		txt lang("潰れていて動けない！ ", "You carry too much to move!")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		if ( gdata(GDATA_CARGO_WEIGHT) > gdata(GDATA_CARGO_LIMIT) * 2 ) {
			msgdup++
			txt lang("荷車が重すぎて動けない！ ", "You carry too heavy cargo to move!")
			gosub *screen_draw
			goto *pc_turn
		}
	}
	if ( cellchara != (-1) & cellchara != 0 ) {
		tc = cellchara
		if ( cdata(CDATA_RELATION, tc) >= 10 | (cdata(CDATA_RELATION, tc) == (-1) & cfg_ignoredislike != 0) | (cdata(CDATA_RELATION, tc) == 0 & (adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_MUSEUM | adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_SHOP)) ) {
			if ( cbit(CHARA_BIT_SANDBAG, tc) == 0 ) {
				if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
					goto *move_skip
				}
				if ( cfg_scroll ) {
					cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, tc)
					cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, tc)
					gosub *screen_scroll
				}
				cell_swap cc, tc
				txt lang(name(tc) + "と入れ替わった。", "You displace " + name(tc) + ".")
				txtmore
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_ROGUE ) {
					if ( rnd(5) == 0 ) {
						if ( cdata(CDATA_CONDITION_SLEEP, tc) == 0 ) {
							p = rnd(limit(cdata(CDATA_GOLD, cc), 0, 20) + 1)
							if ( cbit(CHARA_BIT_RES_STEAL, cc) ) {
								p = 0
							}
							if ( p != 0 ) {
								snd SOUNDLIST_GETGOLD1
								cdata(CDATA_GOLD, cc) -= p
								cdata(CDATA_GOLD, tc) += p
								txt lang("「おっと、ごめんよ」", cnvtalk("Oops, sorry.")), lang("「気をつけな」", cnvtalk("Watch it."))
							}
						}
					}
				}
				if ( cdata(CDATA_ROW_ACT, tc) == ACTION_EAT ) {
					if ( cdata(CDATA_ACTION_PERIOD, tc) > 0 ) {
						if ( cdata(CDATA_TAMER_WHIP_PICKUP, tc) == 10 ) {
							if ( cdata(CDATA_ITEM_USING, tc) >= RANGE_INV2 ) {
								txt lang(name(tc) + "はバツが悪そうにあなたを見た。", name(tc) + " stares in your face.")
								cdata(CDATA_ROW_ACT, tc) = ACTION_NONE, 0
							}
							if ( cdata(CDATA_CUSTOM_TALK_LINE, tc) < gdata(GDATA_YEAR) * 10000 + gdata(GDATA_MONTH) * 100 + gdata(GDATA_DAY) ) {
								modimp2 tc, 20
								cdata(CDATA_CUSTOM_TALK_LINE, tc) = gdata(GDATA_YEAR) * 10000 + gdata(GDATA_MONTH) * 100 + gdata(GDATA_DAY)
							}
							txtmore
						}
					}
				}
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					ttc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					if ( cdata(CDATA_ROW_ACT, ttc) == ACTION_EAT ) {
						if ( cdata(CDATA_TAMER_WHIP_PICKUP, ttc) == 10 ) {
							if ( cdata(CDATA_ACTION_PERIOD, ttc) > 0 ) {
								if ( cdata(CDATA_ITEM_USING, ttc) >= RANGE_INV2 ) {
									txt lang(cdatan(CDATAN_NAME, ttc) + "はバツが悪そうにあなたを見た。", cdatan(CDATAN_NAME, ttc) + " stares in your face.")
									cdata(CDATA_ROW_ACT, ttc) = ACTION_NONE, 0
								}
							}
							if ( cdata(CDATA_CUSTOM_TALK_LINE, ttc) < gdata(GDATA_YEAR) * 10000 + gdata(GDATA_MONTH) * 100 + gdata(GDATA_DAY) ) {
								modimp2 ttc, 20
								cdata(CDATA_CUSTOM_TALK_LINE, ttc) = gdata(GDATA_YEAR) * 10000 + gdata(GDATA_MONTH) * 100 + gdata(GDATA_DAY)
							}
							txtmore
						}
					}
				}
				if ( cdata(CDATA_ROW_ACT, tc) == ACTION_EAT ) {
					if ( cdata(CDATA_ACTION_PERIOD, tc) > 0 ) {
						if ( cdata(CDATA_TAMER_WHIP_PICKUP, tc) != 10 ) {
							if ( cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) < 200 ) {
								txt lang(name(tc) + "はあなたを睨み付けた。", name(tc) + " glare" + _s(tc) + " at you.")
							}
							if ( cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) >= 200 & cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) < 250 ) {
								txt lang(name(tc) + "はあなたを不満げに見つめた。", name(tc) + " looked away from you with dissatisfaction.")
							}
							if ( cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) >= 250 & cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) < 300 ) {
								txt lang(name(tc) + "は残念そうにうなだれた。", name(tc) + " looked disappointed.")
							}
							if ( cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) >= 300 & cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) < 350 ) {
								txt lang(name(tc) + "は小さく頷いた。", name(tc) + " nodded slightly.")
							}
							if ( cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) >= 350 ) {
								txt lang(name(tc) + "は何も言わず一歩下がった。", name(tc) + " stepped back without a word.")
							}
							cdata(CDATA_ROW_ACT, tc) = ACTION_NONE, 0
							txtmore
						}
					}
				}
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					ttc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					if ( cdata(CDATA_ROW_ACT, ttc) == ACTION_EAT ) {
						if ( cdata(CDATA_TAMER_WHIP_PICKUP, ttc) != 10 ) {
							if ( cdata(CDATA_ACTION_PERIOD, ttc) > 0 ) {
								if ( cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) < 200 ) {
									txt lang(cdatan(CDATAN_NAME, ttc) + "はあなたを睨み付けた。", cdatan(CDATAN_NAME, ttc) + " glare" + _s(ttc) + " at you.")
								}
								if ( cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) >= 200 & cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) < 250 ) {
									txt lang(cdatan(CDATAN_NAME, ttc) + "はあなたを不満げに見つめた。", cdatan(CDATAN_NAME, ttc) + " looked away from you with dissatisfaction.")
								}
								if ( cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) >= 250 & cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) < 300 ) {
									txt lang(cdatan(CDATAN_NAME, ttc) + "は残念そうにうなだれた。", cdatan(CDATAN_NAME, ttc) + " looked disappointed.")
								}
								if ( cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) >= 300 & cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) < 350 ) {
									txt lang(cdatan(CDATAN_NAME, ttc) + "は小さく頷いた。", cdatan(CDATAN_NAME, ttc) + " nodded slightly.")
								}
								if ( cdata(CDATA_IMPRESSION, ttc) + cdata(CDATA_MASTER_SERVANT, ttc) >= 350 ) {
									txt lang(cdatan(CDATAN_NAME, ttc) + "は何も言わず一歩下がった。", cdatan(CDATAN_NAME, ttc) + " stepped back without a word.")
								}
								cdata(CDATA_ROW_ACT, ttc) = ACTION_NONE, 0
								txtmore
							}
						}
					}
				}
				gosub *cell_info
				goto *turn_end
			}
		}
		if ( gdata(GDATA_RIDER) != 0 ) {
			if ( cdata(CDATA_RELATION, tc) < (-1) ) {
				if ( findbuff(CHARA_PLAYER, BUFF_HYPER_DASH) != (-1) ) {
					cdata(CDATA_TARGET, CHARA_PLAYER) = tc
					if ( cbit(CHARA_BIT_INVISIBLE, tc) == 1 ) {
						if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == 0 ) {
							if ( cdata(CDATA_CONDITION_WET, tc) == 0 ) {
								cdata(CDATA_TARGET, CHARA_PLAYER) = 0
							}
						}
					}
					if ( cfg_scroll ) {
						cdata(CDATA_X_NEW, CHARA_PLAYER) = cdata(CDATA_X, tc)
						cdata(CDATA_Y_NEW, CHARA_PLAYER) = cdata(CDATA_Y, tc)
						gosub *screen_scroll
					}
					cell_swap cc, tc
					snd SOUNDLIST_BASH1
					txt lang(name(tc) + "を轢いた。", "You ran over " + name(tc) + ".")
					txtmore
					dmghp tc, (sdata(SKILL_ACTIVE_RIDING, CHARA_PLAYER) / 4 + 4) * (sdata(SKILL_ATTR_WIL, CHARA_PLAYER) / 4 + 3) + rnd(sdata(SKILL_ATTR_SPD, CHARA_PLAYER) + 5), DAMAGE_FROM_CHARA, SKILL_RESDMG_CRUSH, 1000
					if ( cdata(CDATA_CONDITION_WINCE, tc) < 0 ) {
						cdata(CDATA_CONDITION_WINCE, tc) = 1
					}
					if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != 1 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != 1 & cbit(CHARA_BIT_SUMMONED, tc) != 1 & cbit(CHARA_BIT_LIVESTOCK, tc) != 1 & cbit(CHARA_BIT_NECRO, tc) != 1 & tc != CHARA_PLAYER ) {
						if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 | TweakData(52, 2) == 1 ) {
							skillexp SKILL_ACTIVE_RIDING, CHARA_PLAYER, 30
							skillexp SKILL_ACTIVE_RIDING, gdata(GDATA_RIDER), 20
						}
					}
					gosub *cell_info
					goto *turn_end
				}
			}
		}
		if ( running ) {
			if ( cdata(CDATA_RELATION, tc) >= (-2) | keybd_wait >= 40 ) {
				goto *pc_turn
			}
		}
		if ( cdata(CDATA_RELATION, tc) <= (-1) ) {
			cdata(CDATA_TARGET, CHARA_PLAYER) = tc
			if ( cbit(CHARA_BIT_INVISIBLE, tc) == 1 ) {
				if ( cbit(CHARA_BIT_SEE_INVISIBLE, CHARA_PLAYER) == 0 ) {
					if ( cdata(CDATA_CONDITION_WET, tc) == 0 ) {
						cdata(CDATA_TARGET, CHARA_PLAYER) = 0
					}
				}
			}
			if ( keybd_attacking == 0 ) {
				keybd_wait = 1
				keybd_attacking = 1
			}

			/********** ORIGINAL - BEGINNING **********

			gosub *act_melee
			goto *turn_end

			 ********** ORIGINAL - ENDING **********/

			/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Prevent bump attacking

			if ( TweakData(TWEAK_MISC_PREVENT_BUMP_ATTACK, TWEAK_CATEGORY_MISC) == 0 ) {
				gosub *act_melee
			}
			goto *turn_end

			/********** BLOODYSHADE CUSTOM - ENDING **********/

		}
		gosub *chat
		if ( chatteleport == 1 ) {
			chatteleport = 0
			goto *map_exit
		}
		goto *turn_end
	}
	else {
		keybd_attacking = 0
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		if ( dbg_freemove ) {
			x = cdata(CDATA_X_NEW, CHARA_PLAYER)
			y = cdata(CDATA_Y_NEW, CHARA_PLAYER)
			if ( x >= 0 & x < mdata(MDATA_WIDTH) & y >= 0 & y < mdata(MDATA_HEIGHT) ) {
				if ( map(x, y, 1) == 0 ) {
					cellaccess = 1
				}
			}
		}
	}
	if ( cellaccess == 1 ) {
*move_skip
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			if ( 264 <= map(cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc), 0) & map(cdata(CDATA_X_NEW, cc), cdata(CDATA_Y_NEW, cc), 0) < 363 ) {
				goto *pc_turn
			}
		}
		goto *act_move
	}
	if ( gdata(GDATA_LEVEL) == 1 | mdata(MDATA_TYPE) == MAP_TYPE_FIELD ) {
		if ( gdata(GDATA_AREA) != AREA_DOCK ) {
			if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
				if ( cdata(CDATA_X_NEW, cc) < 0 | cdata(CDATA_X_NEW, cc) > mdata(MDATA_WIDTH) - 1 | cdata(CDATA_Y_NEW, cc) < 0 | cdata(CDATA_Y_NEW, cc) > mdata(MDATA_HEIGHT) - 1 ) {
					if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
						snd SOUNDLIST_FAIL1
						txt_duel
						goto *pc_turn
					}
					if ( adata(ADATA_FESTIVAL, gdata(GDATA_AREA)) != 9999 ) {
						if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_DUNGEON ) {
							mdatan(MDATAN_NAME) = lang("ダンジョン", "dungeon")
						}
					}
					txt lang(mdatan(MDATAN_NAME) + "を去る？ ", "Do you want to leave " + mdatan(MDATAN_NAME) + "? ")
					if ( mdata(MDATA_TYPE) == MAP_TYPE_QUEST ) {
						if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY | gdata(GDATA_QUEST) == QUEST_TYPE_HARVEST | gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
							txtmore
							txt lang("注意！現在のクエストは現時点で終了となる。", "Warning! You are going to abandon your current quest.")
						}
						else {
							if ( gdata(GDATA_QUEST_STATUS) != QUEST_STATE_SUCCESS ) {
								txtmore
								txt lang("注意！現在のクエストは失敗に終わってしまう。", "Warning! You are going to abandon your current quest.")
							}
						}
					}
					promptYesNo
					gosub *screen_draw
					if ( rtval == 0 ) {
						if ( gdata(GDATA_QUEST) == QUEST_TYPE_PARTY | gdata(GDATA_QUEST) == QUEST_TYPE_HARVEST | gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
							gdata(GDATA_TIME_LIMIT) = 0
							if ( qexit == 0 ) {
								evadd EVENT_QUEST_TIMEOUT
							}
							goto *turn_end
						}
						gdata(GDATA_LAST_EDGE_X) = cdata(CDATA_X, CHARA_PLAYER)
						gdata(GDATA_LAST_EDGE_Y) = cdata(CDATA_Y, CHARA_PLAYER)
						snd SOUNDLIST_EXITMAP1
						if ( gdata(GDATA_QUEST) == QUEST_TYPE_THIEVES ) {
							gdata(GDATA_QUEST) = QUEST_TYPE_NONE
						}
						if ( qexit == 0 ) {
							gdata(GDATA_LEVEL)--
							levelexitby = 4
							goto *map_exit
						}
						if ( qexit == 100 ) {
							goto *turn_end
						}
					}
					goto *pc_turn
				}
			}
		}
	}
	if ( cellfeat != (-1) ) {
		if ( cellfeat == 21 ) {
			goto *act_move
		}
		keyhalt = 1
		if ( cellfeat == 23 ) {
			snd SOUNDLIST_CHAT
			goto *com_quest
		}
		if ( cellfeat == 31 ) {
			snd SOUNDLIST_CHAT
			gosub *com_vote_new
			goto *turn_end
		}
		if ( cellfeat == 33 ) {
			menucycle = 1
			gosub *com_politics_chart
			goto *pc_turn
		}
	}
	if ( cdata(CDATA_CONDITION_CONFUSE, CHARA_PLAYER) != 0 ) {
		msgdup++
		txt lang(" *ごつん* ", " *bump* ")
		gosub *screen_draw
	}
	goto *pc_turn

*act_move

	/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // Prevent home stayers from moving

	if ( TweakData(TWEAK_MISC_PREVENT_STAYER_MOVEMENT, TWEAK_CATEGORY_MISC) == 1 ) {
		if ( cc != CHARA_PLAYER & ( cdata(CDATA_AREA, cc) == AREA_HOME | gdata(GDATA_AREA) == AREA_HOME ) ) {
			if( cdata(CDATA_ROLE, cc) > ROLE_NONE & cdata(CDATA_ROLE, cc) < ROLE_GUEST_MIN | cdata(CDATA_HOME, cc) == gdata(GDATA_LEVEL) ) {
				goto *turn_end
			}
		}
	}

	/********** BLOODYSHADE CUSTOM - ENDING **********/

	if ( cc == CHARA_PLAYER ) {
		gdata(STARTING_GDATA_FLAG + 373) = 0
	}
	if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE ) {
		if ( cdata(CDATA_TARGET, cc) != 0 ) {
			goto *turn_end
		}
	}
	if ( cdata(CDATA_CONDITION_BIND, cc) > 0 ) {
		goto *turn_end
	}
	if ( cdata(CDATA_IN_TAGTEAM, cc) == (-1) ) {
		tcc = cdata(CDATA_TAGTEAM_PARTNER, cc)
		if ( cdata(CDATA_ROW_ACT, tcc) == ACTION_EAT ) {
			if ( cdata(CDATA_ACTION_PERIOD, tcc) > 0 ) {
				goto *turn_end
			}
		}
	}
	if ( cbit(CHARA_BIT_RIDE, cc) ) {
		goto *turn_end
	}
	if ( cdata(CDATA_IN_TAGTEAM, cc) == 1 ) {
		goto *turn_end
	}
	dx = cdata(CDATA_X_NEW, cc)
	dy = cdata(CDATA_Y_NEW, cc)
	if ( cc < MAX_CHARA_FOLLOWER ) {
		if ( cc != CHARA_PLAYER ) {
			if ( dx != cdata(CDATA_X, cc) ) {
				if ( cdata(CDATA_X, cc) > dx ) {
					cdata(CDATA_DIR, cc) = 1
				}
				else {
					cdata(CDATA_DIR, cc) = 2
				}
			}
			if ( dy != cdata(CDATA_Y, cc) ) {
				if ( cdata(CDATA_Y, cc) > dy ) {
					cdata(CDATA_DIR, cc) = 3
				}
				else {
					cdata(CDATA_DIR, cc) = 0
				}
			}
		}
	}
	if ( map(dx, dy, 6) != 0 ) {
		cell_featread dx, dy
		if ( feat(1) == CELL_FEATURE_DOOR_CLOSED ) {
			goto *act_openDoor
		}
		if ( feat(1) == CELL_FEATURE_POT ) {
			x = dx
			y = dy
			goto *act_bash
		}
	}
	if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 8) != 0 ) {
		i = map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 8) - 1
		if ( mef(0, i) == 1 ) {
			if ( cdatan(CDATAN_RACE, cc) != "spider" ) {
				txtmore
				if ( rnd(mef(5, i) + 25) < rnd(sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_ATTR_DEX, cc) + 1) ) {
					if ( synccheck(cc, -1) ) {
						txt lang(name(cc) + "は蜘蛛の巣を振り払った。", name(cc) + " destroy" + _s(cc) + " the cobweb.")
					}
					delmef i
				}
				else {
					mef(5, i) = mef(5, i) * 3 / 4
					if ( synccheck(cc, -1) ) {
						txt lang(name(cc) + "は蜘蛛の巣にひっかかった。", name(cc) + " " + is(cc) + " caught in a cobweb.")
					}
					goto *turn_end
				}
			}
		}
	}
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		if ( cc == CHARA_PLAYER ) {
			if ( traveldone == 0 ) {
				gosub *travel
				keybd_wait = 1
				goto *turn_end
			}
			else {
				traveldone = 0
			}
		}
	}
	gosub *procMove
	p = map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0)
	if ( chipm(CHIPM_ROLE, p) == MAP_CHIP_ROLE_WATER ) {
		if ( chipm(CHIPM_ROLE_SUB, p) == MAP_CHIP_ROLE_MOUNTAIN_WATER ) {
			if ( gdata(GDATA_AREA) == AREA_LARNA | gdata(GDATA_AREA) == AREA_ARCBELC | gdata(GDATA_AREA) == AREA_SMOKE_AND_PIPE | gdata(GDATA_AREA) == AREA_LUDUS ) {
				healsan cc, 1
			}
		}
		addefmap cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 1, 3
		if ( cdata(CDATA_CONDITION_WET, cc) == 0 ) {
			wet cc, 20
		}
		if ( gdata(GDATA_FLAG_CHOCOLATE_KIT_YOURSELF) != 0 ) {
			txtef COLOR_YELLOW
			txt lang("付着していたチョコが流れ落ちた。", "Your chocolate coating was washed off.")
			gdata(GDATA_FLAG_CHOCOLATE_KIT_YOURSELF) = 0
		}
	}
	gosub *cell_info
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
		if ( gdata(GDATA_WORLD) != AREA_AIMWELL ) {
			if ( cc == CHARA_PLAYER ) {
				encounter = 0
				gdata(GDATA_WORLD_TILE) = map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0)
				if ( gdata(STARTING_GDATA_FLAG + 375) > 0 ) {
					gdata(STARTING_GDATA_FLAG + 375)--
					if ( gdata(STARTING_GDATA_FLAG + 375) <= 0 ) {
						txtef COLOR_RED
						txt lang("魔よけが切れた。", "Encounter canceller effect is gone.")
					}
					mile = gdata(STARTING_GDATA_FLAG + 375) * 4
					txt lang("残り" + mile + "マイル。", "Encounters cancelled for " + mile + " miles.")
				}
				if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 6) == 0 ) {
					if ( gdata(GDATA_AREA) == AREA_NORTH_TYRIS ) {
						enarea = 1
					}
					if ( gdata(GDATA_AREA) == AREA_SOUTH_TYRIS ) {
						enarea = 2
					}
					p = map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0)
					if ( rnd(30) == 0 ) {
						encounter = 1
					}
					if ( gdata(GDATA_WEATHER) == WEATHER_HARD_RAIN ) {
						if ( rnd(10) == 0 ) {
							encounter = 1
						}
					}
					if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
						if ( rnd(13) == 0 ) {
							encounter = 1
						}
					}
					if ( gdata(GDATA_FLAG_THROWN_CHESTNUTS) >= 100 ) {
						if ( rnd(5) == 0 ) {
							encounter = 5
						}
					}
					if ( 33 <= p & p < 66 ) {
						if ( rnd(2) == 0 ) {
							encounter = 0
						}
						if ( rnd(100) == 0 ) {
							encounter = 2
						}
					}
					plevel = limit(cdata(CDATA_LEVEL, CHARA_PLAYER) * 10, 1, 500)
					if ( rnd(220 + plevel - limit(gdata(GDATA_CARGO_WEIGHT) * 150 / (gdata(GDATA_CARGO_LIMIT) + 1), 0, 210 + plevel)) == 0 ) {
						encounter = 4
					}
					if ( rnd(40) == 0 ) {
						repeat 5
							rq = gdata(GDATA_QUEST_POOL + cnt)
							if ( qdata(QDATA_EXIST, rq) == QUEST_TYPE_ESCORT ) {
								if ( qdata(QDATA_STATUS, rq) == QUEST_STATE_ONGOING ) {
									if ( qdata(QDATA_VAR, rq) == 0 ) {
										if ( qdata(QDATA_ENCOUNTER, rq) < 2 ) {
											encounter = 3
											encounterref = rq
											qdata(QDATA_ENCOUNTER, rq)++
											break
										}
									}
								}
							}
						loop
					}
				}
				if ( encounter == 4 ) {
					encounterlv = cdata(CDATA_FAME, CHARA_PLAYER) / 1000
					levelexitby = 4
					goto *map_exit
				}
				if ( encounter == 3 ) {
					txt lang("暗殺者につかまった。あなたはクライアントを守らなければならない。", "You are caught by assassins. You have to protect your client.")
					msg_halt
					gdata(GDATA_RETURN_AREA) = gdata(GDATA_AREA), gdata(GDATA_LEVEL), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
					levelexitby = 4
					goto *map_exit
				}
				if ( encounter == 2 ) {
					encounterlv = 10 + rnd(100)
					levelexitby = 4
					goto *map_exit
				}
				if ( encounter == 5 ) {
					encounterlv = 111 + sdata(SKILL_WEAPON_THROWING, CHARA_PLAYER)
					levelexitby = 4
					goto *map_exit
				}
				if ( gdata(STARTING_GDATA_FLAG + 375) <= 0 ) {
					if ( encounter == 1 ) {
						p = rnd(gdata(GDATA_DEEPEST_LEVEL) + 1) + 50
						if ( enarea == 1 ) {
							p = limit(rnd(rnd(gdata(GDATA_DEEPEST_LEVEL) + 1) + 1), 1, 50)
						}
						if ( enarea == 2 ) {
							p = limit(rnd(gdata(GDATA_DEEPEST_LEVEL) + 1), 50, 100)
						}
						encounterlv = p * 4 / 5 - 10
						if ( cdata(CDATA_LEVEL, CHARA_PLAYER) <= 5 ) {
							encounterlv /= 2
						}
						if ( 33 <= map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0) & map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0) < 66 ) {
							encounterlv /= 2
						}
						else {
							if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
								encounterlv = encounterlv * 3 / 2 + 10
							}
						}
						if ( encounterlv < 0 ) {
							encounterlv = 1
						}
						if ( encounterlv >= 999 ) {
							p = 999
						}
						valn = lang(" (危険度:" + p + " 敵勢力:", " (Danger Level: " + p + " Enemy strength: ")
						repeat 1
							if ( encounterlv < 5 ) {
								valn += lang("プチ級", "Puti Rank")
								break
							}
							if ( encounterlv < 10 ) {
								valn += lang("オーク級", "Orc Rank")
								break
							}
							if ( encounterlv < 20 ) {
								valn += lang("グリズリー級", "Grizzly Bear Rank")
								break
							}
							if ( encounterlv < 30 ) {
								valn += lang("ドレイク級", "Drake Rank")
								break
							}
							if ( encounterlv < 40 ) {
								valn += lang("リッチ級", "Lich Rank")
								break
							}
							if ( encounterlv < 60 ) {
								valn += lang("ドラゴン級", "Dragon Rank")
								break
							}
							if ( encounterlv < 70 ) {
								valn += lang("イス級", "Yith Rank")
								break
							}
							if ( encounterlv >= 70 ) {
								valn += lang("不明", "???? Rank")
							}
						loop
						valn += ")"
						txt lang("襲撃だ！", "Ambush!") + valn
						msg_halt
						levelexitby = 4
						goto *map_exit
					}
				}
				encounter = 0
			}
		}
	}
	goto *turn_end

*cell_info
	if ( cc == CHARA_PLAYER ) {
		gdata(GDATA_LAST_EDGE_X) = -1
		gdata(GDATA_LAST_EDGE_Y) = -1
		x = cdata(CDATA_X, CHARA_PLAYER)
		y = cdata(CDATA_Y, CHARA_PLAYER)
		if ( key_shift & gdata(GDATA_RUN) == 0 & cdata(CDATA_CONDITION_CONFUSE, CHARA_PLAYER) == 0 ) {
			if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
				gdata(GDATA_RUN) = 1
				cell_check cdata(CDATA_X, cc) + 1, cdata(CDATA_Y, cc)
				gdata(GDATA_RUN_RIGHT) = cellaccess
				cell_check cdata(CDATA_X, cc) - 1, cdata(CDATA_Y, cc)
				gdata(GDATA_RUN_LEFT) = cellaccess
				cell_check cdata(CDATA_X, cc), cdata(CDATA_Y, cc) + 1
				gdata(GDATA_RUN_DOWN) = cellaccess
				cell_check cdata(CDATA_X, cc), cdata(CDATA_Y, cc) - 1
				gdata(GDATA_RUN_UP) = cellaccess
			}
		}
		if ( map(x, y, 4) != 0 ) {
			if ( cdata(CDATA_CONDITION_BLIND, CHARA_PLAYER) == 0 ) {
				txt txtitemoncell(x, y)
			}
			else {
				txt lang("地面に何かがあるようだ。", "You sense something under your foot.")
			}
		}
		p = chipm(CHIPM_ROLE, map(x, y, 0))
		if ( p != MAP_CHIP_ROLE_NONE ) {
			if ( tname(p) != "" ) {
				txtmore
				txt lang("足元には" + tname(p) + "がある。", "You walk into " + tname(p) + ".")
			}
			if ( p == MAP_CHIP_ROLE_WATER ) {
				snd SOUNDLIST_WATER2
			}
			if ( p == 12 ) {
				snd SOUNDLIST_FOOT1A
			}
			if ( p == 13 ) {
				snd SOUNDLIST_PIANO1
			}
			if ( p == 14 ) {
				snd SOUNDLIST_PIANO2B
			}
			if ( p == 15 ) {
				snd SOUNDLIST_PIANO3
			}
			if ( p == 16 ) {
				snd SOUNDLIST_PIANO4B
			}
			if ( p == 17 ) {
				snd SOUNDLIST_PIANO5
			}
			if ( p == 18 ) {
				snd SOUNDLIST_PIANO6
			}
			if ( p == 19 ) {
				snd SOUNDLIST_PIANO7B
			}
			if ( p == 20 ) {
				snd SOUNDLIST_PIANO8
			}
			if ( p == 21 ) {
				snd SOUNDLIST_PIANO9B
			}
			if ( p == 22 ) {
				snd SOUNDLIST_PIANO10
			}
			if ( p == 23 ) {
				snd SOUNDLIST_PIANO11B
			}
			if ( p == 24 ) {
				snd SOUNDLIST_PIANO12
			}
			if ( p == 25 ) {
				snd SOUNDLIST_PIANO13
			}
			if ( p == 26 ) {
				snd SOUNDLIST_PIANO14B
			}
			if ( p == 27 ) {
				snd SOUNDLIST_PIANO15
			}
			if ( p == 28 ) {
				snd SOUNDLIST_PIANO16B
			}
			if ( p == 29 ) {
				snd SOUNDLIST_PIANO17
			}
			if ( p == 30 ) {
				snd SOUNDLIST_PIANO18
			}
			if ( p == 31 ) {
				snd SOUNDLIST_PIANO19B
			}
			if ( p == 32 ) {
				snd SOUNDLIST_PIANO20
			}
			if ( p == 33 ) {
				snd SOUNDLIST_PIANO21B
			}
			if ( p == 34 ) {
				snd SOUNDLIST_PIANO22
			}
			if ( p == 35 ) {
				snd SOUNDLIST_PIANO23B
			}
			if ( p == 36 ) {
				snd SOUNDLIST_PIANO24
			}
			if ( p == MAP_CHIP_ROLE_SNOW ) {
				addefmap cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 3, 10, dirsub, rnd(2)
				if ( keybd_wait <= cfg_walkwait * cfg_startrun | cdata(CDATA_TURN, CHARA_PLAYER) \ 2 == 0 | mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
					snd SOUNDLIST_FOOT2A + foot \ 3
					foot += 1 + rnd(2)
				}
			}
			if ( p == MAP_CHIP_ROLE_SAND | p == MAP_CHIP_ROLE_SAND_HARD ) {
				addefmap cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 2, 10, dirsub
				snd SOUNDLIST_FOOT2A + foot \ 3
				foot += 1 + rnd(2)
			}
		}
		else {
			if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
				addefmap cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 2, 10, dirsub
				snd SOUNDLIST_FOOT1A + foot \ 2
				foot++
			}
		}
		if ( map(x, y, 6) != 0 ) {
			cell_featread x, y
			if ( feat(1) == CELL_FEATURE_UPSTAIRS ) {
				txt lang("昇り階段がある。", "There is a stair leading upwards here.")
			}
			if ( feat(1) == CELL_FEATURE_DOWNSTAIRS ) {
				txt lang("降り階段がある。", "There is a stair leading downwards here.")
			}
			if ( feat(1) == CELL_FEATURE_NEFIA ) {
				txt mapname(feat(2) + feat(3) * 100, 1)
				if ( adata(ADATA_ID, feat(2) + feat(3) * 100) == AREA_RANDOM_DUNGEON ) {
					if ( cfg_extrahelp ) {
						if ( gdata(STARTING_GDATA_HELP + 6) == 0 ) {
							if ( mode == MODELIST_MAIN ) {
								if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
									gdata(STARTING_GDATA_HELP + 6) = 1
									ghelp = 6
									gosub *elona_help
								}
							}
						}
					}
				}
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_DETECTION ) {
				txt lang("何かが見つかりそうだ。", "You can search this location to collect some materials.")
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
				txt lang("採掘場がある。", "You can collect materials from the mining spot here.")
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
				txt lang("泉がある。", "You can collect materials from the spring here.")
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GENE_ENGINEER ) {
				txt lang("何かの残骸がある。", "You can collect materials from the remains lying here.")
			}
			if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
				txt lang("色んな植物が生えている。", "You can collect materials from plants here.")
			}
			if ( feat(1) == CELL_FEATURE_PLANTED_SEED ) {
				if ( feat(2) == CELL_SUB_FEATURE_SEED_VEGETABLE ) {
					s = lang("野菜", "vegetable")
				}
				if ( feat(2) == CELL_SUB_FEATURE_SEED_FRUIT ) {
					s = lang("果物", "fruit")
				}
				if ( feat(2) == CELL_SUB_FEATURE_SEED_HERB ) {
					s = lang("ハーブ", "herb")
				}
				if ( feat(2) == CELL_SUB_FEATURE_SEED_STRANGE ) {
					s = lang("何か", "strange")
				}
				if ( feat(2) == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
					s = lang("アーティファクト", "artifact")
				}
				if ( feat(2) == CELL_SUB_FEATURE_SEED_GEM ) {
					s = lang("宝石", "gem")
				}
				if ( feat(2) == CELL_SUB_FEATURE_SEED_MAGIC ) {
					s = lang("魔法の木", "magic")
				}
				if ( feat == tile_plant ) {
					txt lang("" + s + "の種が植えてある。", "A " + s + " seed is planted.")
				}
				if ( feat == tile_plant + 1 ) {
					txt lang("" + s + "が育っている。", "A " + s + " bud is growing.")
				}
				if ( feat == tile_plant + 2 ) {
					txt lang("" + s + "の実が成っている。", "A " + s + " tree has bore a lot of fruit.")
				}
				if ( feat == tile_plant + 3 ) {
					txt lang("" + s + "の草は枯れてしまっている… ", "A " + s + " tree has withered...")
				}
				if ( feat == tile_plant + 6 ) {
					txt lang("" + s + "の実が成っている。", "A " + s + " tree has bore a lot of fruit.")
				}
			}
			if ( feat(1) == CELL_FEATURE_SMALL_MEDAL ) {
				txtef COLOR_YELLOW
				txt lang(" *キラン* ", " *twinkle* ")
			}
			if ( feat(1) == CELL_FEATURE_BUILDING ) {
				txt txtbuilding(feat(2), feat(3))
			}
			if ( feat(1) >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & feat(1) <= CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
				if ( cfg_extrahelp ) {
					if ( gdata(STARTING_GDATA_HELP + 5) == 0 ) {
						if ( mode == MODELIST_MAIN ) {
							if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
								gdata(STARTING_GDATA_HELP + 5) = 1
								ghelp = 5
								gosub *elona_help
							}
						}
					}
				}
			}
		}
	}
	return

*act_moveLevel
	if ( dbg_freemove ) {
		txt lang("デバッグ中はその操作はできない。", "You can't perform the action while in debug mode.")
		goto *pc_turn
	}
	item_find ITEM_ID_MOON_GATE, 3, -1
	if ( stat != (-1) ) {
		if ( mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
			if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
				snd SOUNDLIST_FAIL1
				txt lang("今は決闘中だ！", "You can not run away from the duel!")
				goto *pc_turn
			}
			inv(INV_ITEM_NUM, stat)--
			cell_refresh inv(INV_ITEM_X, stat), inv(INV_ITEM_Y, stat)
			comctrl = 2
			gosub *com_import
			if ( stat == 1 ) {
				goto *extract_map
			}
		}
	}
	cell_featread cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
	movelevelbystairs = 0
	if ( val == 1 ) {
		if ( mapitemfind(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), ITEM_ID_KOTATSU) != (-1) ) {
			txt lang("本当にこたつの中に入る？", "Really get into the Kotatsu?")
			promptYesNo
			if ( rtval != 0 ) {
				gosub *screen_draw
				goto *pc_turn
			}
			txt lang("まっくらだ！", "It's dark here!")
			cdata(CDATA_CONDITION_BLIND, CHARA_PLAYER) += 2
			goto *turn_end
		}
	}
	if ( gdata(GDATA_FLAG_MAIN) >= 715 & gdata(GDATA_FLAG_MAIN) < 760 & gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179 ) {
		snd SOUNDLIST_FAIL1
		txt lang("無力化しないと奴が神の間から出てきてしまう！", "If you do not weaken the <Chaos Child>, it will come out of God's Prison!")
		goto *pc_turn
	}
	if ( gdata(GDATA_AREA) == AREA_HOME ) {
		if ( val == 1 ) {
			if ( mapitemfind(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), ITEM_ID_DOWNSTAIRS) != (-1) ) {
				if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
					snd SOUNDLIST_FAIL1
					txt_duel
					goto *pc_turn
				}
				if ( gdata(GDATA_LEVEL) >= adata(ADATA_MAX_LEVEL, gdata(GDATA_AREA)) ) {
					txt lang("これ以上降りられない。", "You can't go down any more.")
					goto *pc_turn
				}
				else {
					movelevelbystairs = 1
				}
			}
		}
		if ( val == 2 ) {
			if ( mapitemfind(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), ITEM_ID_UPSTAIRS) != (-1) ) {
				if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
					snd SOUNDLIST_FAIL1
					txt_duel
					goto *pc_turn
				}
				if ( gdata(GDATA_LEVEL) <= adata(ADATA_MIN_LEVEL, gdata(GDATA_AREA)) ) {
					txt lang("これ以上昇れない。", "You can't go up any more.")
					goto *pc_turn
				}
				else {
					movelevelbystairs = 1
				}
			}
		}
	}
	if ( movelevelbystairs == 0 ) {
		if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
			if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
				snd SOUNDLIST_FAIL1
				txt_duel
				goto *pc_turn
			}
			if ( val == 1 ) {
				if ( feat(1) != CELL_FEATURE_DOWNSTAIRS ) {
					txt lang("降りる階段は見つからない。", "There're no downstairs here.")
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					movelevelbystairs = 1
					if ( gdata(GDATA_AREA) == AREA_VOID & gdata(GDATA_LEVEL) >= gdata(GDATA_VOID_BOSS) ) {
						txt lang("階段は不思議なバリアで塞がれている。", "The path is blocked by a strange barrier.")
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_LESIMAS & gdata(GDATA_LEVEL) == 30 & gdata(STARTING_GDATA_FLAG + 361) < 35 ) {
						txt lang("階段は不思議なバリアで塞がれている。「先には進ませない」", "The path is blocked by a mysterious barrier." + cnvtalk("I will not let you proceed."))
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_LESIMAS & gdata(GDATA_LEVEL) == 40 & gdata(STARTING_GDATA_FLAG + 361) < 55 ) {
						txt lang("階段は不思議なバリアで塞がれている。「緊急防御プラグラム作動中」", "The path is blocked by a mysterious barrier." + cnvtalk("Emergency Defense Program in operation."))
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_REMIDO & gdata(GDATA_LEVEL) == 114 & gdata(GDATA_FLAG_MAIN) < 270 ) {
						txt lang("階段は混沌の力で塞がれている。", "The path is blocked by chaos barrier.")
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 143 & gdata(GDATA_FLAG_MAIN) < 382 ) {
						txt lang("エリステアに銀熊のことを報告するのが先だ。", "I need to bring information of the silver bear to Erystia at once.")
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 146 & gdata(GDATA_FLAG_MAIN) < 455 ) {
						txt lang("階段は混沌の力で塞がれている。", "The path is blocked by chaos barrier.")
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 149 & gdata(GDATA_FLAG_MAIN) < 490 ) {
						txt lang("先に依頼を完了させて報告しなくては。", "I need to report to Gavela completion of the request.")
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 154 & gdata(GDATA_FLAG_MAIN) < 525 ) {
						txt lang("ノルン「神は言っているよ。まだ進む定めではないと…」", "Norne says: \"The gods say you can't move forward just yet...\"")
						goto *pc_turn
					}
					if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 173 ) {
						tc = findchara(CREATURE_ID_ALFRED_THE_CANGNAN_WIND)
						if ( tc != CHARA_PLAYER ) {
							animeload ANIMATION_OFFER, tc
							snd SOUNDLIST_BALL1
							txt lang(name(tc) + "の身体が弾け飛んだ。", name(tc) + " shatter" + _s(tc) + ".")
							dmghp tc, 99999, DAMAGE_FROM_SUICIDE
							chara_vanquish tc
							gdata(GDATA_FLAG_MAIN) = 640
							gdata(GDATA_FLAG_MAIN_CHAOS_CRADLE_34) = 1
						}
					}
				}
			}
			if ( val == 2 ) {
				if ( feat(1) != CELL_FEATURE_UPSTAIRS ) {
					txt lang("昇る階段は見つからない。", "There're no upstairs here.")
					gosub *screen_draw
					goto *pc_turn
				}
				else {
					movelevelbystairs = 1
				}
			}
		}
	}
	if ( feat == tile_downlocked ) {
		f = 0
		if ( gdata(GDATA_AREA) == AREA_LESIMAS ) {
			if ( gdata(GDATA_LEVEL) == 3 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 65 ) {
					f = 1
				}
			}
			if ( gdata(GDATA_LEVEL) == 17 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 115 ) {
					f = 1
				}
			}
			if ( gdata(GDATA_LEVEL) == 25 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 125 ) {
					f = 1
				}
			}
			if ( gdata(GDATA_LEVEL) == 44 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 125 ) {
					f = 1
				}
			}
		}
		if ( gdata(GDATA_AREA) == AREA_REMIDO ) {
			if ( gdata(GDATA_LEVEL) == 106 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 267 ) {
					f = 1
				}
			}
			if ( gdata(GDATA_LEVEL) == 122 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 282 ) {
					f = 1
				}
			}
		}
		if ( gdata(GDATA_AREA) == AREA_CHAOS_CRADLE ) {
			if ( gdata(GDATA_LEVEL) == 142 ) {
				f = 1
			}
			if ( gdata(GDATA_LEVEL) == 159 ) {
				if ( gdata(GDATA_FLAG_MAIN) >= 560 ) {
					f = 1
				}
			}
		}
		if ( f == 1 ) {
			if ( gdata(GDATA_LEVEL) == 44 ) {
				txt lang("厳重に封印された扉の前に立つと、三つの魔石が鈍い光を放った。", "The magic stones shine softly as you approach the sealed door.")
			}
			else {
				txt lang("地下への扉を開けた。", "You unlock the door.")
			}
			snd SOUNDLIST_CHEST1
			cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tile_downstairs, CELL_FEATURE_DOWNSTAIRS
			goto *turn_end
		}
		snd SOUNDLIST_LOCKED1
		txt lang("鍵のかかった扉が行く手を塞いでいる。", "The door is locked. It seems you need a specific key to unlock the door.")
		goto *turn_end
	}
	if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANDOM_DUNGEON ) {
		if ( gdata(GDATA_LEVEL) == adata(ADATA_MAX_LEVEL, gdata(GDATA_AREA)) ) {
			if ( adata(ADATA_BOSS, gdata(GDATA_AREA)) != (-1) ) {
				txt lang("クエストを放棄して階を移動する？", "Really give up the quest and move over?")
				promptYesNo
				if ( rtval != 0 ) {
					gosub *screen_draw
					goto *pc_turn
				}
			}
		}
	}
	if ( movelevelbystairs == 1 ) {
		actionsp CHARA_PLAYER, 15
		if ( stat == 0 | cdata(CDATA_BURDEN, CHARA_PLAYER) >= 3 ) {
			if ( stat == 0 | rnd(4 + 1 - cdata(CDATA_BURDEN, CHARA_PLAYER)) == 0 ) {
				txt lang("うわああ！" + name(CHARA_PLAYER) + "は階段から足を踏み外した。", "Noooo! You lost your step and roll down!")
				dmghp cc, cdata(CDATA_MAX_HP, cc) * (cdata(CDATA_INV_WEIGHT, CHARA_PLAYER) * 10 / cdata(CDATA_CARRY_LIMIT, CHARA_PLAYER) + 10) / 100 + 1, DAMAGE_FROM_TUMBLE
				msg_halt
			}
			if ( cdata(CDATA_EXIST, CHARA_PLAYER) == CHAR_STATE_DEAD ) {
				goto *main_init
			}
		}
	}
	if ( feat(1) == CELL_FEATURE_NEFIA ) {
		if ( feat(2) + feat(3) * 100 == 35 ) {
			comctrl = 0
			gosub *com_import
			if ( stat == 1 ) {
				goto *extract_map
			}
			else {
				goto *pc_turn
			}
		}
	}
	snd SOUNDLIST_EXITMAP1
	levelexitby = 4
	goto *map_exit

*lockpick_val
	nannido = val
*lockpick
	item_find ITEM_ID_LOCKPICK, 3
	if ( stat == (-1) ) {
		txt lang("ロックピックを所持していない。", "You don't have lockpicks.")
		return 0
	}
	ti = stat
	txt lang("ロックピックを使用した。", "You use a lockpick.")
	txtmore
	snd SOUNDLIST_LOCKED1
	item_find ITEM_ID_SKELETON_KEY, 3
	if ( stat != (-1) ) {
		i = sdata(SKILL_NORMAL_LOCK_PICKING, CHARA_PLAYER) * 150 / 100 + 5
		txt lang("スケルトンキーも使用した。", "You also use the skeleton key.")
	}
	else {
		i = sdata(SKILL_NORMAL_LOCK_PICKING, CHARA_PLAYER)
	}
	f = 0
	if ( i * 2 < nannido ) {
		txt lang("この鍵を開ける技術はない。", "The lock mechanism is beyond your skill.")
		f = 1
	}
	if ( f == 0 ) {
		if ( i / 2 >= nannido ) {
			txt lang("楽勝だ。", "Easy.")
		}
		else {
			if ( rnd(rnd(i * 2) + 1) < nannido ) {
				txt lang("開錠に失敗した。", "You fail to unlock it.")
				f = 1
			}
		}
	}
	if ( f ) {
		if ( rnd(3) == 0 ) {
			inv(INV_ITEM_NUM, ti)--
			cell_refresh inv(INV_ITEM_X, ti), inv(INV_ITEM_Y, ti)
			txtmore
			txt lang("ロックピックは壊れた。", "Your lockpick breaks.")
		}
		txtnew
		txt lang("もう一度試みる？", "Try again?")
		promptYesNo
		if ( rtval == 0 ) {
			goto *lockpick_WHILE1_CONTINUE
		}
		return 0
	}
	goto *lockpick_WEND1
*lockpick_WHILE1_CONTINUE
	goto *lockpick
*lockpick_WEND1
	txtmore
	txt lang("開錠に成功した。", "You successfully unlock it.")
	skillexp SKILL_NORMAL_LOCK_PICKING, cc, 100 + limit(nannido * 2, 1, 400)
	return 1

*act_open
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SHOPKEEPERS_TRUNK ) {
		modkarma CHARA_PLAYER, -10
		invctrl = 22, 0
		invfile = inv(INV_ITEM_PARAM1, ci)
		snd SOUNDLIST_CHEST1
		gosub *shop
		screenupdate = -1
		gosub *screen_draw
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MASTERS_DELIVERY_CHEST ) {
		invctrl = 24, 0
		snd SOUNDLIST_INV
		goto *com_inventory
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TAX_MASTERS_TAX_BOX ) {
		invctrl = 24, 2
		snd SOUNDLIST_INV
		goto *com_inventory
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GIANTS_SHACKLE ) {
		snd SOUNDLIST_LOCKED1
		txt lang("足枷を外した。", "You unlock the shackle.")
		if ( gdata(GDATA_AREA) == AREA_NOYEL ) {
			if ( gdata(GDATA_LEVEL) == 1 ) {
				if ( gdata(GDATA_FLAG_FIRE_GIANT) == 0 ) {
					if ( cdata(CDATA_EXIST, gdata(GDATA_FLAG_GIANT_ID)) == CHAR_STATE_ALIVE ) {
						tc = findchara(CREATURE_ID_MOYER_THE_CROOKED)
						if ( tc != CHARA_PLAYER ) {
							txtef COLOR_SKY_BLUE
							txtmore
							txt lang("モイアー「馬鹿やろう！！」", "Moyer yells, " + cnvtalk("You idiot!"))
							cdata(CDATA_TARGET, gdata(GDATA_FLAG_GIANT_ID)) = tc
							cdata(CDATA_AI_AGGRO, gdata(GDATA_FLAG_GIANT_ID)) = 1000
						}
						gdata(GDATA_FLAG_FIRE_GIANT) = 1
					}
				}
			}
		}
		goto *turn_end
	}
	if ( inv(INV_ITEM_FILE, ci) != ITEM_ROLE_FILE_NONE ) {
		invfile = inv(INV_ITEM_FILE, ci)
		invcontainer(1) = ci
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_COOLER_BOX ) {
			refweight = -1
		}
		else {
			refweight = 0
		}
		if ( inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_HEIR_TRUNK | inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_INCOME | inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_FREEZER | inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_POTION_RACK | inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_BOOKSHELF | inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_BREAD_DISPLAY ) {
			if ( gdata(GDATA_AREA) != AREA_HOME & gdata(GDATA_AREA) != AREA_MAID_MANSION ) {
				txt lang("それは家の中でのみ使用できる。", "You can only use it at your home.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		if ( inv(INV_ITEM_FILE, ci) == ITEM_ROLE_FILE_SHOP_INCOME ) {
			if ( adata(ADATA_ID, gdata(GDATA_AREA)) != AREA_SHOP ) {
				txt lang("それは店の中でのみ使用できる。", "You can only use it at your shop.")
				gosub *screen_draw
				goto *pc_turn
			}
		}
		file = "shoptmp.s2"
		fmode = 4
		gosub *game_ctrlFile
		file = "shop" + invfile + ".s2"
		existwrapper exedir + "tmp\\" + file
		if ( strsize != (-1) ) {
			fmode = 3
			gosub *game_ctrlFile
		}
		else {
			inv_getheader -1
			repeat invrange, invhead
				inv(INV_ITEM_NUM, cnt) = 0
			loop
		}
		shoptrade = 0
		invsubroutine = 1
		invctrl = 22, 2
		if ( invfile == 3 ) {
			txt lang("残り" + gdata(GDATA_HEIR_DEED) + "個分のアイテムの相続権を持っている。", "You can claim " + gdata(GDATA_HEIR_DEED) + " more heirloom" + _s3(gdata(GDATA_HEIR_DEED)) + ".")
			invctrl(1) = 1
		}
		if ( invfile == 6 | inv(INV_ITEM_ID, invcontainer(1)) == ITEM_ID_COOLER_BOX ) {
			if ( invfile == 6 ) {
				invcontainer = 15
			}
			else {
				invcontainer = 4
			}
			menucycle = 1
			invctrl(1) = 3
		}
		if ( invfile == 9 ) {
			invcontainer = 15
			menucycle = 1
			invctrl(1) = 6
		}
		if ( invfile == 10 ) {
			invcontainer = 60
			menucycle = 1
			invctrl(1) = 7
		}
		if ( invfile == 11 ) {
			invcontainer = 20
			menucycle = 1
			invctrl(1) = 8
		}
		if ( invfile == 12 ) {
			invcontainer = 100
			menucycle = 1
			invctrl(1) = 9
		}
		mode = MODELIST_SHOP
		snd SOUNDLIST_INV
		gosub *com_inventory
		invcontainer = 0
		if ( refweight == (-1) ) {
			refweight = inv_weight(-1) + 2500
		}
		file = "shop" + invfile + ".s2"
		fmode = 4
		gosub *game_ctrlFile
		file = "shoptmp.s2"
		fmode = 3
		gosub *game_ctrlFile
		if ( refweight != 0 ) {
			inv(INV_ITEM_WEIGHT, invcontainer(1)) = refweight
			gosub *calcBurdenPc
		}
		gosub *screen_draw
		mode = MODELIST_MAIN
		goto *turn_end
	}
	item_separate ci
	if ( inv(INV_ITEM_PARAM1, ci) != 0 ) {
		if ( inv(INV_ITEM_PARAM2, ci) != 0 ) {
			if ( inv(INV_ITEM_ID, ci) != ITEM_ID_CARD_PACK & inv(INV_ITEM_ID, ci) != ITEM_ID_MYSTERIOUS_ENVELOPE ) {
				val = inv(INV_ITEM_PARAM2, ci)
				gosub *lockpick_val
				if ( stat == 0 ) {
					screenupdate = -1
					gosub *screen_draw
					goto *turn_end
				}
			}
		}
	}
	if ( inv(INV_ITEM_PARAM1, ci) == 0 ) {
		txt lang("中身は空っぽだ。", "It's empty!")
	}
	else {
		_switch_val = inv(INV_ITEM_ID, ci)
		if ( _switch_val == ITEM_ID_NEW_YEARS_GIFT | _switch_sw ) {
			_switch_sw = 0
			gosub *open_newYear
			goto *act_open_SWEND1
		}
		if ( _switch_val == ITEM_ID_SCHRODINGERS_CAT | _switch_sw ) {
			_switch_sw = 0
			gosub *open_catbox
			goto *act_open_SWEND1
		}
		if ( _switch_val == ITEM_ID_MYSTERIOUS_ENVELOPE | _switch_sw ) {
			_switch_sw = 0
			snd SOUNDLIST_BOOK1
			txt lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
			msg_halt
			museum = inv(INV_ITEM_PARAM1, ci)
			inv(INV_ITEM_PARAM1, ci) = 0
			flt
			itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), museum
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			goto *act_open_SWEND1
		}
		if ( _switch_val == ITEM_ID_CARD_PACK | _switch_sw ) {
			_switch_sw = 0
			snd SOUNDLIST_CHEST1
			txt lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
			msg_halt
			snd SOUNDLIST_DING2
			randomize
			ri = ci
			cc = CHARA_PLAYER
			inv(INV_ITEM_PARAM1, ri) = 0
			if ( gdata(GDATA_FLAG_MAIN) < 200 ) {
				cardno = rnd(347) + 1
				if ( cardno <= 2 ) {
					cardno = 3
				}
				if ( cardno <= 23 & cardno > 18 ) {
					cardno = 18
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) < 350 & gdata(GDATA_FLAG_MAIN) >= 200 ) {
				cardno = rnd(528) + 1
				if ( cardno <= 458 & cardno > 453 ) {
					cardno = 453
				}
				if ( cardno <= 435 & cardno > 430 ) {
					cardno = 430
				}
				if ( cardno <= 380 & cardno > 375 ) {
					cardno = 375
				}
				if ( cardno <= 534 & cardno > 529 ) {
					cardno = 529
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
				cardno = rnd(918) + 1
				if ( gdata(GDATA_FLAG_SUB_REGULUS_ZANAN) < 1003 ) {
					if ( cardno <= 805 & cardno > 800 ) {
						cardno = 800
					}
				}
				if ( gdata(GDATA_FLAG_MAIN) < 540 ) {
					if ( cardno <= 842 & cardno > 837 ) {
						cardno = 837
					}
				}
				if ( gdata(GDATA_FLAG_MAIN) < 540 ) {
					if ( cardno <= 911 & cardno > 904 ) {
						cardno = 904
					}
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 715 ) {
				cardno = rnd(932) + 1
			}
			flt
			itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_SUB_NAME, ci) = cardno
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			flt
			itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_SUB_NAME, ci) = cardno + 1
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			flt
			itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_SUB_NAME, ci) = cardno + 2
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			flt
			itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_SUB_NAME, ci) = cardno + 3
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			flt
			itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
			inv(INV_ITEM_SUB_NAME, ci) = cardno + 4
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
			goto *act_open_SWEND1
		}
		gosub *open_chest
		goto *act_open_SWEND1
*act_open_SWEND1
		item_stack cc, ri
	}
	screenupdate = -1
	gosub *screen_draw
	goto *turn_end

*open_chest
	snd SOUNDLIST_CHEST1
	txt lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	msg_halt
	ri = ci
	if ( inv(INV_ITEM_ID, ri) == ITEM_ID_MATERIAL_BOX ) {
		tc = cc
		efid = SKILL_EFFECT_CREATE_MATERIAL
		efp = 100 + inv(INV_ITEM_PARAM1, ri) * 10
		inv(INV_ITEM_PARAM1, ri) = 0
		gosub *effect
		return
	}
	p = 3 + rnd(5)
	if ( inv(INV_ITEM_ID, ri) == ITEM_ID_TREASURE_BALL | inv(INV_ITEM_ID, ri) == ITEM_ID_RARE_TREASURE_BALL | inv(INV_ITEM_ID, ri) == ITEM_ID_SMALL_GAMBLE_CHEST ) {
		p = 1
	}
	randomize inv(INV_ITEM_PARAM3, ri)
	repeat p
		dbid = 0
		if ( cnt == 0 ) {
			p = 3
		}
		else {
			p = 2
		}
		if ( inv(INV_ITEM_ID, ri) == ITEM_ID_BEJEWELED_CHEST ) {
			if ( cnt == 0 & rnd(3) == 0 ) {
				p = 4
			}
			else {
				p = 3
			}
			if ( rnd(60) == 0 ) {
				dbid = ITEM_ID_POTION_CURE_CORRUPTION
			}
		}
		flt calcobjlv(inv(INV_ITEM_PARAM1, ri)), calcfixlv(p)
		flttypemajor = fsetchest(rnd(length(fsetchest)))
		if ( cnt > 0 ) {
			if ( rnd(3) != 0 ) {
				if ( rnd(3) != 0 ) {
					flttypeminor = FILTER_NOTHING
					flttypemajor = FILTER_GOLD
				}
				else {
					flttypemajor = FILTER_NOTHING
					flttypeminor = FILTER_ORE_GEM
				}
			}
		}
		if ( inv(INV_ITEM_ID, ri) == ITEM_ID_SAFE ) {
			if ( rnd(3) != 0 ) {
				flttypeminor = FILTER_NOTHING
				flttypemajor = FILTER_GOLD
			}
			else {
				flttypemajor = FILTER_NOTHING
				flttypeminor = FILTER_ORE_GEM
			}
		}
		if ( inv(INV_ITEM_ID, ri) == ITEM_ID_TREASURE_BALL | inv(INV_ITEM_ID, ri) == ITEM_ID_RARE_TREASURE_BALL ) {
			flttypeminor = FILTER_NOTHING
			flttypemajor = fsetwear(rnd(length(fsetwear)))
			fixlv = FIX_QUALITY_GREAT
			if ( inv(INV_ITEM_ID, ri) == ITEM_ID_RARE_TREASURE_BALL ) {
				fixlv = FIX_QUALITY_MIRACLE
			}
			if ( rnd(30) == 0 ) {
				dbid = ITEM_ID_POTION_CURE_CORRUPTION
			}
		}
		in = 0
		if ( inv(INV_ITEM_ID, ri) == ITEM_ID_SMALL_GAMBLE_CHEST ) {
			dbid = ITEM_ID_GOLD_PIECE
			atari = 0
			randomize
			if ( rnd(30) == 0 & gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
				in = 20 * inv(INV_ITEM_VALUE, ci)
				atari = 1
			}
			else {
				in = rnd(inv(INV_ITEM_VALUE, ci) / 10 + 1) + 1
			}
			randomize
			if ( rnd(75) == 0 & gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
				in = 50 * inv(INV_ITEM_VALUE, ci) + 7500
				atari = 2
			}
			r1 = CHARA_PLAYER
			gosub *expOpenLock
			if ( atari == 1 ) {
				snd SOUNDLIST_DING1
				txtef COLOR_SKY_BLUE
				txt lang("当たりだ！", "Jackpot!")
			}
			if ( atari == 2 ) {
				snd SOUNDLIST_COMPLETE1
				snd SOUNDLIST_CHEER
				txtef COLOR_YELLOW2
				txt lang("これは…大当たりだ！！", "<Jackpot>")
			}
		}
		if ( inv(INV_ITEM_ID, ri) == ITEM_ID_WALLET ) {
			dbid = ITEM_ID_GOLD_PIECE
			in = rnd(1000) + 1
			if ( rnd(5) == 0 ) {
				in = rnd(9) + 1
			}
			if ( rnd(10) == 0 ) {
				in = rnd(5000) + 5000
			}
			if ( rnd(20) == 0 ) {
				in = rnd(20000) + 10000
			}
		}
		itemcreate -1, dbid, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), in
	loop
	randomize
	f = 0
	if ( inv(INV_ITEM_ID, ri) != ITEM_ID_SMALL_GAMBLE_CHEST ) {
		if ( rnd(10) == 0 ) {
			f = 1
		}
	}
	if ( inv(INV_ITEM_ID, ri) == ITEM_ID_BEJEWELED_CHEST | inv(INV_ITEM_ID, ri) == ITEM_ID_CHEST ) {
		if ( rnd(10) == 0 ) {
			f = 1
		}
	}
	if ( f ) {
		flt
		itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
	}
	f = 0
	if ( inv(INV_ITEM_ID, ri) == ITEM_ID_CHEST ) {
		if ( inv(INV_ITEM_ATTACK, ri) == 7 ) {
			if ( rnd(30) == 0 ) {
				f = 1
			}
		}
	}
	if ( f ) {
		flt
		itemcreate -1, ITEM_ID_ROD_WISHING, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
	}
	snd SOUNDLIST_DING2
	txtmore
	txt lang(itemname(ri) + "から溢れ出た高級品が、足元に散らばった。", "Several quality goods spread out from " + itemname(ri) + ".")
	autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
	inv(INV_ITEM_PARAM1, ri) = 0
	if ( inv(INV_ITEM_ID, ri) == ITEM_ID_WALLET ) {
		modkarma CHARA_PLAYER, -4
	}
	if ( inv(INV_ITEM_ID, ri) == ITEM_ID_SUITCASE ) {
		modkarma CHARA_PLAYER, -8
	}
	return

*open_newYear
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift" + " ct:" + ct
	snd SOUNDLIST_CHEST1
	txt lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	msg_halt
	snd SOUNDLIST_DING2
	randomize
	ri = ci
	cc = CHARA_PLAYER
	inv(INV_ITEM_PARAM1, ri) = 0
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift1" + " ct:" + ct
	if ( inv(INV_ITEM_PARAM3, ri) < 100 ) {
		if ( rnd(3) == 0 ) {
			procid = (procid + 1) \ 4
			proclist(procid) = "new year gift1-1" + " ct:" + ct
			if ( synccheck(cc, -1) ) {
				txt lang("悪意を持った何かが袋から飛び出してきた！", "Something jumps out from the pack!")
			}
			repeat 3 + rnd(3)
				flt calcobjlv(cdata(CDATA_LEVEL, CHARA_PLAYER) * 3 / 2 + 3), calcfixlv(FIX_QUALITY_GOOD)
				characreate -1, CREATURE_ID_BUG, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
			loop
			return
		}
		if ( rnd(3) == 0 ) {
			procid = (procid + 1) \ 4
			proclist(procid) = "new year gift1-2" + " ct:" + ct
			if ( synccheck(cc, -1) ) {
				txt lang("罠だ！お年玉袋は発火した。", "It's a trap! The gift ignites.")
			}
			repeat 6
				tlocx = cdata(CDATA_X, CHARA_PLAYER) + rnd(3) - rnd(3)
				tlocy = cdata(CDATA_Y, CHARA_PLAYER) - rnd(3) + rnd(3)
				if ( tlocx < 0 | tlocx >= mdata(MDATA_WIDTH) | tlocy < 0 | tlocy >= mdata(MDATA_HEIGHT) ) {
					continue
				}
				addmef tlocx, tlocy, 5, 24, rnd(15) + 20, 50, 0
				mapitem_fire tlocx, tlocy
			loop
			return
		}
		if ( synccheck(cc, -1) ) {
			txt lang("中には呪いの手紙が入っていた。", "You find a cursed letter inside.")
		}
		efid = SKILL_EFFECT_CURSE
		efp = 1000
		tc = CHARA_PLAYER
		gosub *effect
		return
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift2" + " ct:" + ct
	if ( inv(INV_ITEM_PARAM3, ri) < 200 ) {
		if ( rnd(4) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txtef COLOR_YELLOW
				txt lang(" *チリリリリーン* ", " *ring ring ring* ")
			}
			flt
			characreate -1, CREATURE_ID_PLATINA_BELL + rnd(2), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
			if ( stat != 0 ) {
				if ( cdata(CDATA_RELATION, cc) <= (-3) ) {
					cdata(CDATA_RELATION, rc) = -1
					cdata(CDATA_RELATION_ORG, rc) = -1
				}
			}
			return
		}
		if ( rnd(5) == 0 ) {
			if ( synccheck(cc, -1) ) {
				txt lang("妹が入っていた！", "The pack contains your younger sister!")
			}
			flt
			characreate -1, CREATURE_ID_YOUNGER_SISTER, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
			if ( stat != 0 ) {
				cdata(CDATA_GOLD, rc) = 5000
			}
			return
		}
		if ( synccheck(cc, -1) ) {
			txt lang("何かが袋から出てきた。", "There's something inside the pack.")
		}
		flt
		itemcreate -1, isetgiftminor(rnd(length(isetgiftminor))), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
		return
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift3" + " ct:" + ct
	if ( rnd(3) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txtef COLOR_YELLOW
			txt lang(" *チリリリリーン* ", " *ring ring ring* ")
		}
		repeat 2 + rnd(3)
			flt
			characreate -1, CREATURE_ID_PLATINA_BELL + rnd(2), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
			if ( stat != 0 ) {
				if ( cdata(CDATA_RELATION, cc) <= (-3) ) {
					cdata(CDATA_RELATION, rc) = -1
					cdata(CDATA_RELATION_ORG, rc) = -1
				}
			}
		loop
		return
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift4" + " ct:" + ct
	if ( rnd(10) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang("これは素晴らしい贈り物だ！", "This is truly a wonderful gift!")
		}
		flt
		itemcreate -1, isetgiftgrand(rnd(length(isetgiftgrand))), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
		return
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift5" + " ct:" + ct
	if ( synccheck(cc, -1) ) {
		txt lang("何かが袋から出てきた。", "There's something inside the pack.")
	}
	flt
	itemcreate -1, isetgiftmajor(rnd(length(isetgiftmajor))), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
	procid = (procid + 1) \ 4
	proclist(procid) = "new year gift end" + " ct:" + ct
	return

*open_catbox
	procid = (procid + 1) \ 4
	proclist(procid) = "catbox" + " ct:" + ct
	snd SOUNDLIST_CHEST1
	txt lang("あなたは" + itemname(ci) + "を開けた。", "You open " + itemname(ci) + ".")
	msg_halt
	snd SOUNDLIST_DING2
	randomize
	ri = ci
	cc = CHARA_PLAYER
	inv(INV_ITEM_PARAM1, ri) = 0
	if ( rnd(2) == 0 ) {
		if ( synccheck(cc, -1) ) {
			txt lang("猫が入っていた！", "The box contains a cat!")
		}
		flt
		characreate -1, CREATURE_ID_CAT, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
		if ( stat != 0 ) {
			cdata(CDATA_GOLD, rc) = 1000
		}
		return
	}
	else {
		if ( synccheck(cc, -1) ) {
			txt lang("死んだ猫が入ってい…ゾンビだこれー！？", "There's something inside the box.")
		}
		flt
		characreate -1, CREATURE_ID_CAT_ZOMBIE, cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
		if ( stat != 0 ) {
			cdata(CDATA_GOLD, rc) = 1000
		}
		return
	}
	procid = (procid + 1) \ 4
	proclist(procid) = "catbox end" + " ct:" + ct
	return

*act_openDoor
	cell_featread dx, dy
	if ( feat == tile_doorclosed4 & feat(2) > 0 ) {
		if ( cc == CHARA_PLAYER ) {
			val = feat(2)
			gosub *lockpick_val
			if ( stat == 0 ) {
				screenupdate = -1
				gosub *screen_draw
				await 100
				goto *turn_end
			}
			feat(2) = 0
		}
		else {
			goto *turn_end
		}
	}
	if ( feat(2) > 0 ) {
		f = 0
		if ( rnd(feat(2) * 20 + 150) < sdata(SKILL_NORMAL_LOCK_PICKING, cc) * 20 + 20 ) {
			f = 1
		}
	}
	else {
		if ( cdata(CDATA_ALLIED, cc) == 100 ) {
			if ( cc != CHARA_PLAYER ) {
				goto *turn_end
			}
		}
		f = 1
	}
	if ( f ) {
		if ( feat(2) > 0 ) {
			skillexp SKILL_NORMAL_LOCK_PICKING, cc, 100 + limit(feat(2), 1, 100)
		}
		cell_featset dx, dy, tile_dooropen, CELL_FEATURE_DOOR_OPENED, 0, -1
		if ( synccheck(cc, -1) ) {
			txt lang(name(cc) + "は扉を開けた。", name(cc) + " open" + _s(cc) + " the door.")
			if ( mdata(MDATA_TILESET) == 8 | (gdata(GDATA_AREA) == AREA_MACHINERY_FORT & gdata(GDATA_LEVEL) == adata(ADATA_MAX_LEVEL, gdata(GDATA_AREA))) ) {
				snd SOUNDLIST_DOOR2
			}
			else {
				if ( mdata(MDATA_TILESET) == 9 | (gdata(GDATA_AREA) == AREA_KURUALM & gdata(GDATA_LEVEL) == 5) ) {
					snd SOUNDLIST_CARD1
				}
				else {
					snd SOUNDLIST_DOOR1
				}
			}
		}
	}
	else {
		msgdup++
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_LOCKED1
			txt lang(aln(cc) + "開錠に失敗した。", name(cc) + " fail" + _s(cc) + " to open the door.")
		}
	}
	if ( cc == CHARA_PLAYER ) {
		await 100
	}
	goto *turn_end

*act_close
	txt lang("何を閉める？", "Which door do you want to close? ")
	gosub *screen_draw
	val = 0
	gosub *prompt_direction
	if ( stat == 0 ) {
		txt_impossible
		gosub *screen_draw
		goto *pc_turn
	}
	cell_featread x, y
	if ( feat(1) != CELL_FEATURE_DOOR_OPENED ) {
		txt lang("その方向に閉められるものはない。", "There's nothing to close.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( map(x, y, 1) != 0 ) {
		txt lang("何かが邪魔で閉められない。", "There's something on the floor.")
		gosub *screen_draw
		goto *pc_turn
	}
	cell_featset x, y, tile_doorclosed, CELL_FEATURE_DOOR_CLOSED, -1, -1
	txt lang(name(cc) + "は扉を閉めた。", name(cc) + " close the door.")
	goto *turn_end

*act_fire
	if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
		actaa = SKILL_SPELL_MAGIC_DART
		bvar = sdata(SKILL_RES_MAGIC, cc)
		if ( sdata(SKILL_RES_DARKNESS, cc) > bvar ) {
			actaa = SKILL_SPELL_DARK_EYE
			bvar = sdata(SKILL_RES_DARKNESS, cc)
		}
		if ( sdata(SKILL_RES_NETHER, cc) > bvar ) {
			actaa = SKILL_SPELL_NETHER_ARROW
			bvar = sdata(SKILL_RES_NETHER, cc)
		}
		if ( sdata(SKILL_RES_CHAOS, cc) > bvar ) {
			actaa = SKILL_SPELL_CHAOS_EYE
			bvar = sdata(SKILL_RES_CHAOS, cc)
		}
		if ( sdata(SKILL_RES_NERVE, cc) > bvar ) {
			actaa = SKILL_SPELL_NERVE_ARROW
			bvar = sdata(SKILL_RES_NERVE, cc)
		}
		if ( sdata(SKILL_RES_MAGIC, cc) >= bvar ) {
			actaa = SKILL_SPELL_MAGIC_DART
		}
		bvar = 0
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) != 0 ) {
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 4 ) {
				actaa = SKILL_SPELL_DARK_EYE
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 7 ) {
				actaa = SKILL_SPELL_NETHER_ARROW
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 9 ) {
				actaa = SKILL_SPELL_NERVE_ARROW
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 10 ) {
				actaa = SKILL_SPELL_CHAOS_EYE
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 11 ) {
				actaa = SKILL_SPELL_MAGIC_DART
			}
		}
		efid = actaa
		gosub *cast
		return
	}
	attackrange = 1
	attacknum = 0
	ele = SKILL_NONE
	ammoproc = -1
	ammox = cdata(CDATA_X, tc)
	ammoy = cdata(CDATA_Y, tc)
	attackitem = cw
	if ( ammo != (-1) ) {
		if ( inv(INV_ITEM_AMMO, ammo) != (-1) ) {
			if ( inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ammo) * 2 + 1, ammo) \ 1000 <= 0 ) {
				txt lang("通常弾を装填した。", "You load normal ammo.")
				inv(INV_ITEM_AMMO, ammo) = -1
			}
			else {
				ammoproc = inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ammo) * 2, ammo) \ EXT_ENCHANTMENT
				if ( cc == CHARA_PLAYER ) {
					if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
						if ( cdata(CDATA_SP, CHARA_PLAYER) < rnd(75) ) {
							txt_exhausted
							dmgsp CHARA_PLAYER, encammoref(2, ammoproc) / 2 + 1
							ammoproc = -1
							return 1
						}
					}
					dmgsp CHARA_PLAYER, rnd(encammoref(2, ammoproc) + 1)
				}
				inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ammo) * 2 + 1, ammo)--
			}
		}
	}
	if ( ammo != (-1) ) {
		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_ALLIED, cc) == 0 ) {
			if ( sdata(SKILL_NORMAL_MARKSMAN, cc) >= 50 ) {
				if ( cdata(CDATA_QUALITY, cc) * cdata(CDATA_QUALITY, cc) > rnd(720) ) {
					ammoproc = -1
					if ( cdata(CDATA_PV, tc) < 200 | rnd(10) == 0 ) {
						ammoproc = ENCHANT_AMMO_RAPID
					}
					if ( cdata(CDATA_PV, tc) >= 200 | rnd(10) == 0 ) {
						ammoproc = ENCHANT_AMMO_PIERCING
					}
					if ( cdata(CDATA_DV, tc) >= 200 | rnd(10) == 0 ) {
						ammoproc = ENCHANT_AMMO_EXPLOSIVE
					}
					if ( rnd(10) == 0 ) {
						ammoproc = ENCHANT_AMMO_BURST
					}
					if ( rnd(10) == 0 ) {
						ammoproc = ENCHANT_AMMO_MAGIC
					}
					if ( ammoproc != (-1) ) {
						snd SOUNDLIST_AMMO
					}
				}
			}
		}
	}
	if ( ammoproc == ENCHANT_AMMO_RAPID ) {
		gdata(GDATA_RAPID_FIRE) = 100
		repeat 3
			gosub *FindRangeWeapon
			ele = SKILL_NONE
			extraattack = 0
			gosub *act_attack
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				gosub *findTarget
				if ( stat == 0 ) {
					break
				}
				else {
					tc = cdata(CDATA_TARGET, cc)
					if ( relationbetween(cc, tc) != (-3) ) {
						break
					}
				}
			}
		loop
		gdata(GDATA_RAPID_FIRE) = 0
	}
	else {
		if ( ammoproc == ENCHANT_AMMO_BURST ) {
			repeat 20
				gosub *FindRangeWeapon
				ele = SKILL_NONE
				gosub *com_findTarget
				if ( listmax == 0 ) {
					break
				}
				tc = list(0, rnd(listmax))
				if ( cc == CHARA_PLAYER | cdata(CDATA_RELATION, cc) >= 0 ) {
					if ( cdata(CDATA_RELATION, tc) >= 0 ) {
						if ( cnt == 0 ) {
							continue
						}
					}
					if ( cdata(CDATA_RELATION, tc) >= 0 ) {
						if ( cnt != 0 ) {
							continue cnt + (rnd(5) == 0)
						}
					}
				}
				else {
					if ( cdata(CDATA_RELATION, tc) == cdata(CDATA_RELATION, cc) ) {
						continue cnt + (rnd(5) == 0)
					}
				}
				extraattack = 0
				gosub *act_attack
			loop
		}
		else {
			extraattack = 0
			gosub *act_attack
		}
	}
	attackvar = 0
	ammoproc = -1
	return

*act_melee
	if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
		actaa = 414
		bvar = sdata(SKILL_RES_MAGIC, cc)
		if ( sdata(SKILL_RES_DARKNESS, cc) > bvar ) {
			actaa = 418
			bvar = sdata(SKILL_RES_DARKNESS, cc)
		}
		if ( sdata(SKILL_RES_NETHER, cc) > bvar ) {
			actaa = 415
			bvar = sdata(SKILL_RES_NETHER, cc)
		}
		if ( sdata(SKILL_RES_CHAOS, cc) > bvar ) {
			actaa = 417
			bvar = sdata(SKILL_RES_CHAOS, cc)
		}
		if ( sdata(SKILL_RES_NERVE, cc) > bvar ) {
			actaa = 416
			bvar = sdata(SKILL_RES_NERVE, cc)
		}
		if ( sdata(SKILL_RES_MAGIC, cc) >= bvar ) {
			actaa = 414
		}
		bvar = 0
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) != 0 ) {
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 4 ) {
				actaa = 418
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 7 ) {
				actaa = 415
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 9 ) {
				actaa = 416
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 10 ) {
				actaa = 417
			}
			if ( cdata(CDATA_ELEMENTS_EYES_ELE, cc) == 11 ) {
				actaa = 414
			}
		}
		efid = actaa
		gosub *cast
		return
	}
	if ( cc != CHARA_PLAYER ) {
		if ( cdata(CDATA_BARRIER, tc) ) {
			if ( distance < 6 ) {
				if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) ) {
					gosub *FindRangeWeapon
					if ( stat == 1 ) {
						gosub *act_fire
					}
				}
			}
			p = cdata(CDATA_BARRIER, tc) \ 1000
			if ( p == 61 ) {
				if ( cdata(CDATA_HP, cc) < cdata(CDATA_MAX_HP, cc) / 2 ) {
					return
				}
			}
		}
	}
	if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
		return
	}
	attacknum = 0
	attackrange = 0
	attackskill = SKILL_WEAPON_MARTIAL_ARTS
	ammo = -1
	ele = SKILL_NONE
	powsel = 0
	if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
		if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
			powsel = 100
		}
	}
	if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
		if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
			powsel = 100
		}
	}
	if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
		powsel = 100
	}
	if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
		powsel = 100
	}
	if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
		if ( exgauge != 100 ) {
			powsel = 0
		}
	}
	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
		powsel = 0
	}
	if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
		if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
			powsel = 0
		}
	}
	if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
		powsel = 0
	}
	if ( cc == CHARA_PLAYER ) {
		if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
			powsel = 0
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( powsel == 100 ) {
			if ( cdata(CDATA_SHIELD_STYLE_TYPE, cc) == SHIELD_STYLE_NORMAL ) {
				if ( cdata(CDATA_ATTACK_STYLE, cc) & STYLE_SHIELD ) {
					weap = sdata(SKILL_NORMAL_SHIELD, cc)
					efid = SKILL_SPACT_SHIELD_STRIKE
					gosub *effect
					weap = 0
				}
			}
		}
	}
	repeat MAX_EQUIP_SLOT_TOTAL
		body = CDATA_STARTING_EQUIP_SLOTS + cnt
		if ( cdata(body, cc) \ EXT_EQUIP_SLOTS == 0 ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == EQUIP_SLOT_SHOOT ) {
			continue
		}
		if ( cdata(body, cc) / EXT_EQUIP_SLOTS == EQUIP_SLOT_AMMO ) {
			continue
		}
		cw = cdata(body, cc) \ EXT_EQUIP_SLOTS - 1
		attackitem = cw
		if ( inv(INV_ITEM_DICE1, cw) > 0 ) {
			attackskill = inv(INV_ITEM_SKILL_REF, cw)
			if ( iequiploc(cw) == EQUIP_SLOT_SHOOT ) {
				attackskill = SKILL_WEAPON_BLUNT
			}
			attacknum++
			extraattack = 0
			gosub *act_attack
		}
	loop
	if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
		extraattack = 0
		gosub *act_attack
	}
	attackvar = 0
	return

*act_attack
	if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
		return
	}
	if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
		return
	}
	if ( cdata(CDATA_CONDITION_FEAR, cc) != 0 ) {
		msgdup++
		txt lang(name(cc) + "は怖気づいた。", name(cc) + " " + is(cc) + " frightened.")
		return
	}
	gdata(STARTING_GDATA_FLAG + 373)++
	if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
		if ( cdata(CDATA_GAUGE_COOLDOWN, cc) == 0 ) {
			cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
			cdata(CDATA_POWER_GAUGE, cc) += 2
			if ( cdata(CDATA_ID, cc) == CREATURE_ID_TALON_SOLDIER ) {
				cdata(CDATA_POWER_GAUGE, cc) += 2
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
		if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
			cdata(CDATA_POWER_GAUGE, cc) = 100
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
		cdata(CDATA_POWER_GAUGE, cc) = 200
	}
	if ( cbit(CHARA_BIT_QUICK_SHOOTING, tc) ) {
		if ( cbit(CHARA_BIT_SANDBAG, tc) != 1 ) {
			if ( slinger == 0 ) {
				if ( gdata(GDATA_TEMPORARY_FLAGS3) == 0 ) {
					if ( gdata(GDATA_TEMPORARY_FLAGS2) == 0 ) {
						if ( attackrange != 0 ) {
							if ( cdata(CDATA_CONDITION_DIM, tc) < 60 & cdata(CDATA_CONDITION_SLEEP, tc) == 0 & cdata(CDATA_CONDITION_PARALYZE, tc) == 0 & cdata(CDATA_CONDITION_BLIND, tc) == 0 & gdata(GDATA_TIME_STOP_TIME) == 0 ) {
								if ( synccheck(cc, -1) ) {
									txtef COLOR_PURPLE
									txt lang(name(tc) + "は反射的に先制射撃を行った。" + name(cc) + "は怯んだ。", name(cc) + " " + is(cc) + " struck by several thorns.")
								}
								waitbk = cfg_animewait
								if ( cfg_animewait > 0 ) {
									cfg_animewait = 1
								}
								snd SOUNDLIST_PUNISH1
								animeload 62, cc
								cfg_animewait = waitbk
								slinger = 100
								if ( cdata(CDATA_CONDITION_WINCE, cc) < 2 ) {
									cdata(CDATA_CONDITION_WINCE, cc) = 2
								}
								dmghp cc, sdata(SKILL_NORMAL_MARKSMAN, tc) + rnd(10) + 1, tc
							}
						}
					}
				}
			}
		}
	}
	if ( cdata(CDATA_EXIST, cc) != CHAR_STATE_ALIVE ) {
		return
	}
	if ( map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 8) != 0 ) {
		i = map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 8) - 1
		if ( mef(0, i) == 2 ) {
			if ( rnd(4) == 0 ) {
				if ( synccheck(cc, -1) ) {
					txtmore
					txt lang(name(cc) + "は霧の中の幻影を攻撃した。", name(cc) + " attack" + _s(cc) + " an illusion in the mist.")
				}
				return
			}
		}
	}
	if ( attackrange == 1 ) {
		animeid = attackskill
		aniref = cw
		gosub *anime
	}
	if ( attacknum > 1 | cc != CHARA_PLAYER ) {
		txtmore
	}
	expmodifer = 1 + cbit(CHARA_BIT_SANDBAG, tc) * 1000 + cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) * 1000 + cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) * 1000 + (gdata(GDATA_AREA) == AREA_SHOW_HOUSE) * 1000
	if ( TweakData(52, 2) == 1 ) {
		expmodifer = 1 + cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) * 1000 + cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) * 1000 + (gdata(GDATA_AREA) == AREA_SHOW_HOUSE) * 1000
	}
	hit = calcattackhit()
	i = 0
	if ( hit == 1 ) {
		dmg = calcattackdmg()
		if ( cc == CHARA_PLAYER & cfg_attackanime == 1 | (cc < MAX_CHARA_FOLLOWER & cfg_attackanime == 2) | cfg_attackanime == 3 ) {
			animeid = ANIMATION_NORMAL_ATTACK
			aniref = dmg * 100 / cdata(CDATA_MAX_HP, tc)
			gosub *anime
		}
		if ( critical ) {
			if ( cc == CHARA_PLAYER ) {
				txtef COLOR_RED
				txt lang("会心の一撃！ ", "Critical Hit!")
				txtmore
			}
		}
		if ( critical ) {
			if ( cc != CHARA_PLAYER ) {
				txtef COLOR_BLUE
				txt lang("会心の一撃！ ", "Critical Hit!")
				txtmore
			}
		}
		if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( inv(INV_ITEM_QUALITY, cw) >= FIX_QUALITY_MIRACLE ) {
				if ( inv(INV_ITEM_QUALITY, cw) == FIX_QUALITY_UNIQUE ) {
					s(1) = lang("", "The ") + iknownnameref(inv(INV_ITEM_ID, cw))
				}
				else {
					if ( inv(INV_ITEM_SUB_NAME, cw) >= 40000 ) {
						randomize inv(INV_ITEM_SUB_NAME, cw) - 40000
						s(1) = random_title(1)
						randomize
					}
					else {
						s(1) = lang("", "The ") + iknownnameref(inv(INV_ITEM_ID, cw))
					}
				}
				s(1) = lang("『", "<") + s(1) + lang("』", ">")
				if ( inv(INV_ITEM_PARAM4, cw) != 0 ) {
					if ( inv(INV_ITEM_PARAM4, cw) == 1 ) {
						exist exedir + "user\\item\\plan1.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 2 ) {
						exist exedir + "user\\item\\plan2.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 3 ) {
						exist exedir + "user\\item\\plan3.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 4 ) {
						exist exedir + "user\\item\\plan4.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 5 ) {
						exist exedir + "user\\item\\plan5.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 6 ) {
						exist exedir + "user\\item\\plan6.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 7 ) {
						exist exedir + "user\\item\\plan7.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 8 ) {
						exist exedir + "user\\item\\plan8.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 9 ) {
						exist exedir + "user\\item\\plan9.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 10 ) {
						exist exedir + "user\\item\\plan10.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 11 ) {
						exist exedir + "user\\item\\plan11.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 12 ) {
						exist exedir + "user\\item\\plan12.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 13 ) {
						exist exedir + "user\\item\\plan13.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 14 ) {
						exist exedir + "user\\item\\plan14.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 15 ) {
						exist exedir + "user\\item\\plan15.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 16 ) {
						exist exedir + "user\\item\\plan16.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 17 ) {
						exist exedir + "user\\item\\plan17.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 18 ) {
						exist exedir + "user\\item\\plan18txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 19 ) {
						exist exedir + "user\\item\\plan19.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 20 ) {
						exist exedir + "user\\item\\plan20.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 21 ) {
						exist exedir + "user\\item\\plan21.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 22 ) {
						exist exedir + "user\\item\\plan22.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 23 ) {
						exist exedir + "user\\item\\plan23.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 24 ) {
						exist exedir + "user\\item\\plan24.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 25 ) {
						exist exedir + "user\\item\\plan25.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 26 ) {
						exist exedir + "user\\item\\plan26.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 27 ) {
						exist exedir + "user\\item\\plan27.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 28 ) {
						exist exedir + "user\\item\\plan28.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 29 ) {
						exist exedir + "user\\item\\plan29.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 30 ) {
						exist exedir + "user\\item\\plan30.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 31 ) {
						exist exedir + "user\\item\\plan31.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 32 ) {
						exist exedir + "user\\item\\plan32.txt"
					}
					if ( inv(INV_ITEM_PARAM4, cw) == 33 ) {
						exist exedir + "user\\item\\plan33.txt"
					}
					if ( strsize != (-1) ) {
						sdim buff, strsize
						notesel buff
						if ( inv(INV_ITEM_PARAM4, cw) == 1 ) {
							noteload exedir + "user\\item\\plan1.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 2 ) {
							noteload exedir + "user\\item\\plan2.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 3 ) {
							noteload exedir + "user\\item\\plan3.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 4 ) {
							noteload exedir + "user\\item\\plan4.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 5 ) {
							noteload exedir + "user\\item\\plan5.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 6 ) {
							noteload exedir + "user\\item\\plan6.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 7 ) {
							noteload exedir + "user\\item\\plan7.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 8 ) {
							noteload exedir + "user\\item\\plan8.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 9 ) {
							noteload exedir + "user\\item\\plan9.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 10 ) {
							noteload exedir + "user\\item\\plan10.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 11 ) {
							noteload exedir + "user\\item\\plan11.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 12 ) {
							noteload exedir + "user\\item\\plan12.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 13 ) {
							noteload exedir + "user\\item\\plan13.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 14 ) {
							noteload exedir + "user\\item\\plan14.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 15 ) {
							noteload exedir + "user\\item\\plan15.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 16 ) {
							noteload exedir + "user\\item\\plan16.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 17 ) {
							noteload exedir + "user\\item\\plan17.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 18 ) {
							noteload exedir + "user\\item\\plan18.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 19 ) {
							noteload exedir + "user\\item\\plan19.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 20 ) {
							noteload exedir + "user\\item\\plan20.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 21 ) {
							noteload exedir + "user\\item\\plan21.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 22 ) {
							noteload exedir + "user\\item\\plan22.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 23 ) {
							noteload exedir + "user\\item\\plan23.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 24 ) {
							noteload exedir + "user\\item\\plan24.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 25 ) {
							noteload exedir + "user\\item\\plan25.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 26 ) {
							noteload exedir + "user\\item\\plan26.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 27 ) {
							noteload exedir + "user\\item\\plan27.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 28 ) {
							noteload exedir + "user\\item\\plan28.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 29 ) {
							noteload exedir + "user\\item\\plan29.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 30 ) {
							noteload exedir + "user\\item\\plan30.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 31 ) {
							noteload exedir + "user\\item\\plan31.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 32 ) {
							noteload exedir + "user\\item\\plan32.txt"
						}
						if ( inv(INV_ITEM_PARAM4, cw) == 33 ) {
							noteload exedir + "user\\item\\plan33.txt"
						}
						t = "%txtName"
						p = instr(buff, 0, t + "," + lang("JP", "EN"))
						buff = strmid(buff, p, instr(buff, p + 1, "%"))
						if ( noteinfo(0) > 1 ) {
							p = noteinfo(0) - 1
							noteget t, p
							if ( t != "" ) {
								buff = t
							}
						}
						s(1) = buff
						p = 0
					}
				}
				if ( synccheck(cc, -1) ) {
					if ( rnd(5) == 0 ) {
						txtef COLOR_SKY_BLUE
						txt lang(name(cc) + "は" + s(1) + "を誇らしげに構えた。", name(cc) + " wield" + _s(cc) + " " + s(1) + " proudly.")
						txtmore
					}
				}
				i = 1
			}
		}
		if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( cdata(CDATA_ELEMENT, cc) != SKILL_NONE ) {
				ele = cdata(CDATA_ELEMENT, cc) / 100000
				elep = cdata(CDATA_ELEMENT, cc) \ 100000
			}
		}
		if ( synccheck(tc, -1) ) {
			if ( extraattack ) {
				ele = SKILL_NONE
				dmg = calcattackdmg()
				txt lang("さらに", "Furthermore,")
				txtcontinue
			}
			kickhantei = 0
			if ( rnd(2) == 0 ) {
				kickhantei = 10
			}
			if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
				if ( cdata(CDATA_CONDITION_JIU_JITSU, cc) != 0 ) {
					melbk = cdata(CDATA_MELEE_STYLE, cc)
					cdata(CDATA_MELEE_STYLE, cc) = 9
				}
				if ( cdata(CDATA_MELEE_STYLE, cc) == 12 ) {
					if ( bakuretu != 200 ) {
						if ( kickhantei == 10 ) {
							if ( tc >= MAX_CHARA_FOLLOWER ) {
								gdata(GDATA_DMG_TYPE) = 2
								txt lang(aln(cc) + name(tc) + "を蹴り抜いて", name(cc) + " kick" + _s(cc) + " " + name(tc) + " and")
							}
							else {
								txt lang(aln(tc) + name(cc) + "に蹴り飛ばされた。", name(cc) + " kick" + _s(cc) + " " + name(tc) + ".")
							}
						}
						if ( kickhantei == 0 ) {
							if ( tc >= MAX_CHARA_FOLLOWER ) {
								gdata(GDATA_DMG_TYPE) = 2
								txt lang(aln(cc) + name(tc) + "を殴って", name(cc) + "punch" + _s(cc, 1) + " " + name(tc) + " and")
							}
							else {
								txt lang(aln(tc) + name(cc) + "に殴られた。", name(cc) + " punch" + _s(cc, 1) + " " + name(tc) + ".")
							}
						}
					}
				}
				if ( cdata(CDATA_MELEE_STYLE, cc) != 12 ) {
					if ( bakuretu != 200 ) {
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt lang(aln(cc) + name(tc) + "を" + _melee(0, cdata(CDATA_MELEE_STYLE, cc)), name(cc) + " " + _melee(0, cdata(CDATA_MELEE_STYLE, cc)) + _s(cc) + " " + name(tc) + " and")
						}
						else {
							txt lang(aln(tc) + name(cc) + "に" + _melee(1, cdata(CDATA_MELEE_STYLE, cc)), name(cc) + " " + _melee(1, cdata(CDATA_MELEE_STYLE, cc)) + _s(cc) + " " + name(tc) + ".")
						}
					}
				}
				if ( bakuretu == 200 ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						gdata(GDATA_DMG_TYPE) = 2
						txt lang(aln(cc) + name(tc) + "を蹴り抜いて", name(cc) + " kick" + _s(cc) + " " + name(tc) + " and")
					}
					else {
						txt lang(aln(tc) + name(cc) + "に蹴り飛ばされた。", name(cc) + " kick" + _s(cc) + " " + name(tc) + ".")
					}
				}
				if ( cdata(CDATA_CONDITION_JIU_JITSU, cc) != 0 ) {
					cdata(CDATA_MELEE_STYLE, cc) = melbk
				}
			}
			if ( attackskill == SKILL_WEAPON_BOW ) {
				s = lang("弓", "bow")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
				s = lang("クロスボウ", "crossbow")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_FIREARM ) {
				s = lang("銃", "gun")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を射撃し", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で撃たれた。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_LONGSWORD ) {
				s = lang("長剣", "sword")
				if ( inv(INV_ITEM_ID, cw) == ITEM_ID_FLEURE | inv(INV_ITEM_ID, cw) == ITEM_ID_EPECLAIR ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						gdata(GDATA_DMG_TYPE) = 2
						txt lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
					}
					else {
						txt lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
					}
				}
				else {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						gdata(GDATA_DMG_TYPE) = 2
						txt lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
					}
					else {
						txt lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
					}
				}
			}
			if ( attackskill == SKILL_WEAPON_POLEARM ) {
				s = lang("槍", "spear")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_STAVE ) {
				s = lang("杖", "staff")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_SHORTSWORD ) {
				s = lang("短剣", "dagger")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を突き刺して", name(cc) + " stab" + _s(cc) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で刺された。", name(cc) + " stab" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_BLUNT ) {
				s = lang("鈍器", "mace")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_AXE ) {
				s = lang("斧", "axe")
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
			if ( attackskill == SKILL_WEAPON_SCYTHE ) {
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) <= 1 ) {
					s = lang("鎌", "scythe")
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						gdata(GDATA_DMG_TYPE) = 2
						txt lang(aln(cc) + name(tc) + "を切り払い", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " and")
					}
					else {
						txt lang(aln(tc) + name(cc) + "に" + s(i) + "で切られた。", name(cc) + " slash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
					}
				}
				if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) >= 2 ) {
					s = lang("鎖分銅", "chain weight")
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						gdata(GDATA_DMG_TYPE) = 2
						txt lang(aln(cc) + name(tc) + "を打って", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " and")
					}
					else {
						txt lang(aln(tc) + name(cc) + "に" + s(i) + "で打たれた。", name(cc) + " smash" + _s(cc, 1) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
					}
				}
			}
			if ( attackskill == SKILL_WEAPON_THROWING ) {
				s = itemname(cw, 1, 1)
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					gdata(GDATA_DMG_TYPE) = 2
					txt lang(aln(cc) + name(tc) + "に" + s(i) + "を投げ", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " and")
				}
				else {
					txt lang(aln(tc) + name(cc) + "に" + s(i) + "で攻撃された。", name(cc) + " shoot" + _s(cc) + " " + name(tc) + " with " + his(cc) + " " + s(i) + ".")
				}
			}
		}
		dmghp tc, dmg, cc, ele, elep
		ele = SKILL_NONE
		if ( critical ) {
			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) == 0 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) == 0 ) {
				skillexp SKILL_NORMAL_EYE_OF_MIND, cc, 60 / expmodifer, 2
			}
			critical = 0
		}
		if ( rtdmg > cdata(CDATA_MAX_HP, tc) / 20 | rtdmg > sdata(SKILL_NORMAL_HEALING, tc) | rnd(5) == 0 ) {
			if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
				skillexp carmor(tc), tc, limit(250 * rtdmg / cdata(CDATA_MAX_HP, tc) + 1, 3, 100) / expmodifer, 0, 5
				if ( cdata(CDATA_ATTACK_STYLE, tc) & STYLE_SHIELD ) {
					skillexp SKILL_NORMAL_SHIELD, tc, 40 / expmodifer, 0, 4
				}
			}
			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) == 0 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) == 0 ) {
				skillexp attackskill, cc, limit(sdata(SKILL_NORMAL_EVASION, tc) * 2 - sdata(attackskill, cc) + 1, 5, 50) / expmodifer, 0, 4
				if ( attackrange == 0 ) {
					skillexp SKILL_NORMAL_TACTICS, cc, 20 / expmodifer, 0, 4
					if ( cdata(CDATA_ATTACK_STYLE, cc) & STYLE_TWOHAND ) {
						skillexp SKILL_NORMAL_TWO_HAND, cc, 20 / expmodifer, 0, 4
					}
					if ( cdata(CDATA_ATTACK_STYLE, cc) & STYLE_DUAL_WIELD ) {
						skillexp SKILL_NORMAL_DUAL_WIELD, cc, 20 / expmodifer, 0, 4
					}
					if ( cdata(CDATA_ATTACK_STYLE, cc) & STYLE_SHIELD ) {
						skillexp SKILL_NORMAL_SHIELD, cc, 20 / expmodifer, 0, 4
					}
				}
				else {
					if ( attackskill == SKILL_WEAPON_THROWING ) {
						skillexp SKILL_NORMAL_TACTICS, cc, 10 / expmodifer, 0, 4
					}
					else {
						skillexp SKILL_NORMAL_MARKSMAN, cc, 25 / expmodifer, 0, 4
					}
				}
				if ( tc == CHARA_PLAYER ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						skillexp SKILL_ACTIVE_RIDING, CHARA_PLAYER, 30 / expmodifer, 0, 5
					}
				}
				if ( tc == gdata(GDATA_RIDER) ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						skillexp SKILL_ACTIVE_RIDING, gdata(GDATA_RIDER), 20 / expmodifer, 0, 5
					}
				}
			}
		}
		if ( cdata(CDATA_EXTRA_ATTACKS_TYPE, cc) == 0 ) {
			if ( cdata(CDATA_EXTRA_ATTACKS, cc) != 0 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					if ( orgdmg > 0 ) {
						cw2 = -1
						repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
							if ( cdata(cnt, cc) == 0 ) {
								continue
							}
							if ( rnd(10) != 0 ) {
								continue
							}
							cw2 = cdata(cnt, cc) - cdata(cnt, cc) / EXT_EQUIP_SLOTS * EXT_EQUIP_SLOTS - 1
							break
						loop
						if ( cw2 != (-1) ) {
							repeat RANGE_INV_ITEM_ENCHANT
								if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw2) == 0 ) {
									break
								}
								enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw2)
								if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) <= 1 ) {
									if ( enc == ENCHANT_PROXIMITY_ASSIST ) {
										cdata(CDATA_EXTRA_ATTACKS_TYPE, cc) = 1
										shootp = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw2)
										break
									}
								}
								if ( enc == ENCHANT_SHOOTING_MECHANISM ) {
									cdata(CDATA_EXTRA_ATTACKS_TYPE, cc) = 2
									shootp = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw2)
									break
								}
							loop
							if ( cdata(CDATA_EXTRA_ATTACKS_TYPE, cc) != 0 ) {
								if ( inv(INV_ITEM_QUALITY, cw2) >= FIX_QUALITY_MIRACLE ) {
									if ( inv(INV_ITEM_QUALITY, cw2) == FIX_QUALITY_UNIQUE ) {
										s(1) = lang("", "The ") + iknownnameref(inv(INV_ITEM_ID, cw2))
									}
									else {
										if ( inv(INV_ITEM_SUB_NAME, cw2) >= 40000 ) {
											randomize inv(INV_ITEM_SUB_NAME, cw2) - 40000
											s(1) = random_title(1)
											randomize
										}
										else {
											s(1) = lang("", "The ") + iknownnameref(inv(INV_ITEM_ID, cw2))
										}
									}
									s(1) = lang("『", "<") + s(1) + lang("』", ">")
									if ( inv(INV_ITEM_PARAM4, cw2) != 0 ) {
										if ( inv(INV_ITEM_PARAM4, cw2) == 1 ) {
											exist exedir + "user\\item\\plan1.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 2 ) {
											exist exedir + "user\\item\\plan2.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 3 ) {
											exist exedir + "user\\item\\plan3.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 4 ) {
											exist exedir + "user\\item\\plan4.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 5 ) {
											exist exedir + "user\\item\\plan5.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 6 ) {
											exist exedir + "user\\item\\plan6.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 7 ) {
											exist exedir + "user\\item\\plan7.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 8 ) {
											exist exedir + "user\\item\\plan8.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 9 ) {
											exist exedir + "user\\item\\plan9.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 10 ) {
											exist exedir + "user\\item\\plan10.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 11 ) {
											exist exedir + "user\\item\\plan11.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 12 ) {
											exist exedir + "user\\item\\plan12.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 13 ) {
											exist exedir + "user\\item\\plan13.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 14 ) {
											exist exedir + "user\\item\\plan14.txt"
										}
										if ( inv(INV_ITEM_PARAM4, cw2) == 15 ) {
											exist exedir + "user\\item\\plan15.txt"
										}
										if ( strsize != (-1) ) {
											sdim buff, strsize
											notesel buff
											if ( inv(INV_ITEM_PARAM4, cw2) == 1 ) {
												noteload exedir + "user\\item\\plan1.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 2 ) {
												noteload exedir + "user\\item\\plan2.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 3 ) {
												noteload exedir + "user\\item\\plan3.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 4 ) {
												noteload exedir + "user\\item\\plan4.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 5 ) {
												noteload exedir + "user\\item\\plan5.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 6 ) {
												noteload exedir + "user\\item\\plan6.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 7 ) {
												noteload exedir + "user\\item\\plan7.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 8 ) {
												noteload exedir + "user\\item\\plan8.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 9 ) {
												noteload exedir + "user\\item\\plan9.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 10 ) {
												noteload exedir + "user\\item\\plan10.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 11 ) {
												noteload exedir + "user\\item\\plan11.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 12 ) {
												noteload exedir + "user\\item\\plan12.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 13 ) {
												noteload exedir + "user\\item\\plan13.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 14 ) {
												noteload exedir + "user\\item\\plan14.txt"
											}
											if ( inv(INV_ITEM_PARAM4, cw2) == 15 ) {
												noteload exedir + "user\\item\\plan15.txt"
											}
											t = "%txtName"
											p = instr(buff, 0, t + "," + lang("JP", "EN"))
											buff = strmid(buff, p, instr(buff, p + 1, "%"))
											if ( noteinfo(0) > 1 ) {
												p = noteinfo(0) - 1
												noteget t, p
												if ( t != "" ) {
													buff = t
												}
											}
											s(1) = buff
											p = 0
										}
									}
								}
								else {
									s(1) = ioriginalnameref(inv(INV_ITEM_ID, cw2))
								}
							}
							if ( cdata(CDATA_EXTRA_ATTACKS_TYPE, cc) == 1 ) {
								txtef COLOR_PINK
								txt lang(name(cc) + "は" + s(1) + "で追撃した！", "Furthermore, " + name(cc) + " attacked with " + s(1) + "!")
								if ( cdata(CDATA_PROT_PENALTY, tc) < 2 ) {
									cdata(CDATA_PROT_PENALTY, tc) = 2
									txtef COLOR_PURPLE
									txt lang(name(tc) + "はよろめいた。", name(tc) + " stagger" + _s(tc) + ".")
								}
								snd SOUNDLIST_PUNISH1
								if ( cfg_attackanime ) {
									animeload ANIMATION_UNISON_IMPACT1, tc
								}
								dmghp tc, (shootp / 40 * (orgdmg / 3) + rnd(sdata(SKILL_NORMAL_TACTICS, cc) * 10 + 1)) * 200 / limit(sdata(carmor(tc), tc) * 2 + 200, 200, 1200), cc
							}
							if ( cdata(CDATA_EXTRA_ATTACKS_TYPE, cc) == 2 ) {
								txtef COLOR_PINK
								txt lang(name(cc) + "は" + s(1) + "による射撃を加えた！", "Furthermore, " + name(cc) + " fired " + s(1) + "!")
								if ( cdata(CDATA_EVASION_PENALTY, tc) < 2 ) {
									cdata(CDATA_EVASION_PENALTY, tc) = 2
									txtef COLOR_PURPLE
									txt lang(name(tc) + "は体勢を崩した。", name(tc) + " was knocked off balance.")
								}
								snd SOUNDLIST_PUNISH1
								if ( cfg_attackanime ) {
									animeload ANIMATION_UNISON_IMPACT1, tc
								}
								dmghp tc, (shootp / 50 * (orgdmg / 3) + rnd(sdata(SKILL_NORMAL_MARKSMAN, cc) * 5 + 1)) * 200 / limit(sdata(carmor(tc), tc) * 2 + 200, 200, 1200), cc
							}
						}
					}
				}
			}
		}
		if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
			if ( findbuff(cc, BUFF_ATTRIBUTE) != (-1) ) {
				if ( gdata(GDATA_TEMPORARY_FLAGS2) == 0 ) {
					ele = cdata(CDATA_ATTRIBUTE_ELE, cc) + STARTING_SKILL_RESIST
					gdata(GDATA_DMG_TYPE) = 1
					if ( ele == SKILL_RES_MAGIC ) {
						dmghp tc, orgdmg / 10 * (rnd(400) + limit(sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) * 2, 200, 2000)) / 100 + 1, cc, ele, 1000
					}
					else {
						dmghp tc, orgdmg / 10 * (rnd(400) + limit(sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) * 4, 200, 3000)) / 100 + 1, cc, ele, 1000
					}
					subdmg = 0
					ele = SKILL_NONE
				}
			}
			if ( bakuretu == 100 ) {
				if ( synccheck(cc, -1) ) {
					txt lang(name(cc) + "は爆裂拳を発動した。", name(cc) + "'s fist exploded the air.")
				}
				tcbk = tc
				efid = SKILL_SPACT_GRENADE
				efp = limit(sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) * 10 + 500, 800, 30000)
				gosub *effect
				tc = tcbk
				bakucut = 100
				bakuretu = 0
			}
			if ( bakuretu == 200 ) {
				if ( cdata(CDATA_POWER_GAUGE, cc) >= 25 ) {
					cdata(CDATA_POWER_GAUGE, cc) -= 25
					if ( synccheck(cc, -1) ) {
						txt lang(name(cc) + "は迅雷脚を発動した。", name(cc) + "'s kick discharge lightning.")
					}
					tcbk = tc
					efid = SKILL_SPACT_GRENADE
					efp = limit(sdata(SKILL_ATTR_STR, cc) + sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) * 10 + 500, 800, 30000)
					gosub *effect
					tc = tcbk
				}
				bakucut = 100
				bakuretu = 0
			}
			if ( bakuretu == 300 ) {
				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
					tcbk = tc
					if ( synccheck(cc, -1) ) {
						txt lang(name(cc) + "は強烈なボディブローを叩き込んだ。", name(cc) + "'s fist exploded the air.")
					}
					snd SOUNDLIST_BASH1
					dmghp tc, sdata(SKILL_ATTR_STR, cc) / 10 * (sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) + 1) / 10 + 5, cc
					if ( cdata(CDATA_HP, tc) >= 0 ) {
						chara_vomit tc
					}
					tc = tcbk
				}
				bakucut = 100
				bakuretu = 0
			}
			powsel = 0
			if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
				if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
					powsel = 100
				}
			}
			if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
				if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
					powsel = 100
				}
			}
			if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
				powsel = 100
			}
			if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
				powsel = 100
			}
			if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
				if ( exgauge != 100 ) {
					powsel = 0
				}
			}
			if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
				powsel = 0
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
				if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
					powsel = 0
				}
			}
			if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
				powsel = 0
			}
			if ( cc == CHARA_PLAYER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
					powsel = 0
				}
			}
			if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
				if ( powsel == 100 ) {
					if ( cdata(CDATA_SHIELD_STYLE_TYPE, cc) == 0 | cdata(CDATA_SHIELD_STYLE_TYPE, cc) == SHIELD_STYLE_TONFA ) {
						if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
							weap = sdata(SKILL_WEAPON_MARTIAL_ARTS, cc)
							efid = SKILL_SPACT_EXPLOSION
							gosub *effect
							weap = 0
						}
					}
				}
			}
		}
		else {
			bakucut = 0
			bakuretu = 0
			gosub *act_attackSub
		}
		if ( cdata(CDATA_REFLECT_DAMAGE, tc) > 0 & bakucut == 0 ) {
			if ( attackrange == 0 ) {
				dmghp cc, limit(cdata(CDATA_REFLECT_DAMAGE, tc) / 100 * dmg + 1, 1, cdata(CDATA_MAX_HP, tc) / 5), tc, SKILL_RESDMG_CUT, 100
			}
		}
		if ( cbit(CHARA_BIT_AWAKE_DIM_ATTACKER, tc) ) {
			if ( bakucut == 0 ) {
				if ( attackrange == 0 ) {
					dmgcon cc, CONDITION_DIM, limit(sdata(SKILL_ATTR_CHA, tc), 200, 1000)
				}
			}
		}
		bakucut = 0
		if ( cdata(CDATA_BARRIER, tc) != 0 ) {
			p = cdata(CDATA_BARRIER, tc) \ 1000
			ccbk = cc
			repeat 1
				if ( attackrange == 0 ) {
					if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) <= 1 ) {
						if ( p == 61 ) {
							if ( synccheck(cc, -1) ) {
								txtef COLOR_PURPLE
								txt lang("棘が" + name(cc) + "に刺さった。", name(cc) + " " + is(cc) + " struck by several thorns.")
							}
							dmghp cc, limit(dmg / 10, 1, cdata(CDATA_MAX_HP, tc) / 10), tc, p, cdata(CDATA_BARRIER, tc) / 1000
							break
						}
						if ( p == 62 ) {
							if ( synccheck(cc, -1) ) {
								txtef COLOR_PURPLE
								txt lang("エーテルの棘が" + name(cc) + "に刺さった。", name(cc) + " " + is(cc) + " struck by several ether thorns.")
							}
							dmghp cc, limit(dmg / 10, 1, cdata(CDATA_MAX_HP, tc) / 10), tc, p, cdata(CDATA_BARRIER, tc) / 1000
							break
						}
						if ( p == 63 ) {
							if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
								if ( rnd(5) == 0 ) {
									item_acid cc, cw
								}
							}
						}
					}
				}
				if ( dmg > cdata(CDATA_MAX_HP, tc) / 10 ) {
					cc = tc
					tlocx = cdata(CDATA_X, cc)
					tlocy = cdata(CDATA_Y, cc)
					if ( p == 63 ) {
						if ( synccheck(tc, -1) ) {
							txtef COLOR_PURPLE
							txt lang("酸が飛び散った。", "Acid spreads over the ground.")
						}
						if ( zero2 != 200 ) {
							efid = SKILL_SPELL_ACID_GROUND
							efp = cdata(CDATA_BARRIER, tc) / 1000
							gosub *effect
						}
						break
					}
				}
			loop
			cc = ccbk
		}
	}
	else {
		if ( cc == CHARA_PLAYER & cfg_attackanime == 1 | (cc < MAX_CHARA_FOLLOWER & cfg_attackanime == 2) | cfg_attackanime == 3 ) {
			snd SOUNDLIST_MISS
		}
		if ( sdata(attackskill, cc) > sdata(SKILL_NORMAL_EVASION, tc) | rnd(5) == 0 ) {
			p = limit(sdata(attackskill, cc) - sdata(SKILL_NORMAL_EVASION, tc) / 2 + 1, 1, 20) / expmodifer
			skillexp SKILL_NORMAL_EVASION, tc, p, 0, 4
			skillexp SKILL_NORMAL_GREATER_EVASION, tc, p, 0, 4
			if ( tc == CHARA_PLAYER ) {
				if ( gdata(GDATA_RIDER) != 0 ) {
					skillexp SKILL_ACTIVE_RIDING, CHARA_PLAYER, p, 0, 4
				}
			}
			if ( tc == gdata(GDATA_RIDER) ) {
				if ( gdata(GDATA_RIDER) != 0 ) {
					skillexp SKILL_ACTIVE_RIDING, gdata(GDATA_RIDER), p, 0, 4
				}
			}
		}
		bakuretu = 0
	}
	if ( findbuff(tc, BUFF_SHIELD_PARRY) != (-1) & attackrange == 0 & cdata(CDATA_SHIELD_STYLE_TYPE, tc) == SHIELD_STYLE_NORMAL & (cdata(CDATA_ATTACK_STYLE, tc) & STYLE_SHIELD) ) {
		if ( hit == (-1) | hit == (-2) ) {
			snd SOUNDLIST_AMMO
			if ( gdata(GDATA_TEMPORARY_FLAGS3) >= 100 ) {
				if ( extraattack ) {
					txt lang("さらに", "Furthermore,")
					txtcontinue
				}
			}
			if ( tc < MAX_CHARA_FOLLOWER ) {
				txt lang(aln(tc) + name(cc) + "の攻撃を盾で弾いた。", name(tc) + " parry" + _s(tc) + " " + name(cc) + ".")
			}
			else {
				txt lang(aln(cc) + "攻撃を盾で弾かれた。", name(cc) + " was parry" + _s(cc, 1) + " by shield.")
			}
			dmgcon cc, CONDITION_INVERT, 2
		}
	}
	else {
		if ( hit == (-1) ) {
			if ( synccheck(cc, -1) ) {
				if ( gdata(GDATA_TEMPORARY_FLAGS3) >= 100 ) {
					if ( extraattack ) {
						txt lang("さらに", "Furthermore,")
						txtcontinue
					}
				}
				if ( tc < MAX_CHARA_FOLLOWER ) {
					txt lang(aln(tc) + name(cc) + "の攻撃を避けた。", name(tc) + " evade" + _s(tc) + " " + name(cc) + ".")
				}
				else {
					txt lang(aln(cc) + "攻撃をかわされた。", name(cc) + " miss" + _s(cc, 1) + " " + name(tc) + ".")
				}
			}
		}
		if ( hit == (-2) ) {
			if ( synccheck(cc, -1) ) {
				if ( extraattack ) {
					txt lang("さらに", "Furthermore,")
					txtcontinue
				}
				if ( tc < MAX_CHARA_FOLLOWER ) {
					txt lang(aln(tc) + name(cc) + "の攻撃を華麗に避けた。", name(tc) + " skillfully evade" + _s(tc) + " " + name(cc) + ".")
				}
				else {
					txt lang(aln(cc) + "攻撃を華麗にかわされた。", name(tc) + " skillfully evade" + _s(tc) + " " + name(cc) + ".")
				}
			}
		}
	}
	if ( findbuff(tc, BUFF_KILLING_DANCE) != (-1) & cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
		if ( hit == (-1) | hit == (-2) ) {
			snd SOUNDLIST_SWING
			if ( tc < MAX_CHARA_FOLLOWER ) {
				txt lang("さらに回避運動から流れるように反撃を繰り出した！", "Furthermore, the attack is avoided and a counterattack flows from the same movement!")
			}
			else {
				txt lang("さらに反撃を叩き込まれた！", "Furthermore, a counterattack is delivered!")
			}
			dmghp cc, sdata(SKILL_NORMAL_EVASION, tc) * 5 + rnd(sdata(SKILL_NORMAL_EVASION, tc) + 10), tc
		}
	}
	if ( tc == CHARA_PLAYER ) {
		gdata(GDATA_RUN) = 0
	}
	rowact_check tc
	if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
		if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
			cw = attackitem
			if ( ibit(ITEM_BIT_ALIVE, cw) ) {
				if ( inv(INV_ITEM_GROWTH, cw) < 15 ) {
					if ( inv(INV_ITEM_EXP, cw) < calcexpalive(inv(INV_ITEM_GROWTH, cw)) ) {
						if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != 1 & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != 1 & cbit(CHARA_BIT_SUMMONED, tc) != 1 & cbit(CHARA_BIT_LIVESTOCK, tc) != 1 & cbit(CHARA_BIT_NECRO, tc) != 1 & cdata(CDATA_ROLE, tc) != ROLE_BOUNTY_HUNTER & cdata(CDATA_ROLE, tc) != ROLE_GUARD ) {
							ikihosei = 0
						}
						else {
							ikihosei = 50
						}
						inv(INV_ITEM_EXP, cw) += rnd(cdata(CDATA_LEVEL, tc) / (inv(INV_ITEM_GROWTH, cw) + ikihosei) + 1)
						if ( inv(INV_ITEM_EXP, cw) >= calcexpalive(inv(INV_ITEM_GROWTH, cw)) ) {
							txtef COLOR_GREEN
							snd SOUNDLIST_DING3
							txt lang(itemname(cw) + "は十分に血を味わった！", itemname(cw) + " has tasted enough blood!")
						}
					}
				}
			}
		}
	}
	if ( extraattack == 0 ) {
		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) != 1 ) {
			if ( gdata(GDATA_TEMPORARY_FLAGS3) == 0 ) {
				if ( gdata(GDATA_TEMPORARY_FLAGS2) == 0 ) {
					if ( gdata(GDATA_TEMPORARY_FLAGS) == 0 ) {
						if ( attackrange ) {
							if ( cdatan(CDATAN_CLASS, cc) == "gunner" ) {
								if ( rnd(100) < rnd(cdata(CDATA_EXTRA_SHOOT, cc) * 2 + 1) + 5 ) {
									ammoproc = -1
									extraattack++
									ele = SKILL_NONE
									goto *act_attack
								}
							}
							if ( cdatan(CDATAN_CLASS, cc) != "gunner" ) {
								if ( rnd(100) < rnd(cdata(CDATA_EXTRA_SHOOT, cc) * 2 + 1) ) {
									ammoproc = -1
									extraattack++
									ele = SKILL_NONE
									goto *act_attack
								}
							}
						}
						else {
							if ( cdatan(CDATAN_CLASS, cc) == "warrior" ) {
								if ( rnd(100) < rnd(cdata(CDATA_EXTRA_MELEE, cc) * 2 + 1) + 5 ) {
									extraattack++
									ele = SKILL_NONE
									goto *act_attack
								}
							}
							else {
								if ( rnd(100) < rnd(cdata(CDATA_EXTRA_MELEE, cc) * 2 + 1) ) {
									extraattack++
									ele = SKILL_NONE
									goto *act_attack
								}
							}
						}
					}
				}
			}
		}
	}
	if ( extraattack >= 1 ) {
		if ( extraattack < 3 | (cdata(CDATA_SHIELD_STYLE_TYPE, cc) == 0 & extraattack < 7 & attackskill == SKILL_WEAPON_MARTIAL_ARTS) ) {
			if ( gdata(GDATA_TEMPORARY_FLAGS3) == 0 ) {
				if ( gdata(GDATA_TEMPORARY_FLAGS2) == 0 ) {
					if ( attackrange == 0 ) {
						handkazu = 0
						repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
							if ( cdata(cnt, cc) / EXT_EQUIP_SLOTS == EQUIP_SLOT_HAND ) {
								handkazu++
							}
						loop
						if ( attackskill == SKILL_WEAPON_MARTIAL_ARTS ) {
							if ( cdata(CDATA_SHIELD_STYLE_TYPE, cc) == 0 ) {
								handkazu = 0
							}
						}
						if ( handkazu <= 2 ) {
							handkazu = 0
						}
						if ( rnd(100) + (handkazu + 1) * (handkazu + 10) * extraattack < rnd(cdata(CDATA_EXTRA_MELEE, cc) * 2 + 1) ) {
							extraattack++
							ele = SKILL_NONE
							goto *act_attack
						}
						handkazu = 0
					}
				}
			}
		}
	}
	powsel = 0
	if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
		if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
			powsel = 100
		}
	}
	if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
		if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
			powsel = 100
		}
	}
	if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
		powsel = 100
	}
	if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
		powsel = 100
	}
	if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
		if ( exgauge != 100 ) {
			powsel = 0
		}
	}
	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
		powsel = 0
	}
	if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
		if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != DIRECTIVE_MODE_OFFENSIVE ) {
			powsel = 0
		}
	}
	if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
		powsel = 0
	}
	if ( cc == CHARA_PLAYER ) {
		if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
			powsel = 0
		}
	}
	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 1200 ) {
		powsel = 0
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( powsel == 100 ) {
				if ( attackskill == SKILL_WEAPON_FIREARM ) {
					if ( inv(INV_ITEM_ID, ammo) == ITEM_ID_MAGNUM ) {
						weap = sdata(SKILL_WEAPON_FIREARM, cc)
						efid = SKILL_SPACT_IMPACT_GUNFIRE
						gosub *effect
					}
				}
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( powsel == 100 ) {
				if ( attackskill == SKILL_WEAPON_FIREARM ) {
					if ( inv(INV_ITEM_ID, ammo) == ITEM_ID_BULLET ) {
						weap = sdata(SKILL_WEAPON_FIREARM, cc)
						efid = SKILL_SPACT_ONE_POINT_SHOOT
						gosub *effect
					}
				}
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( powsel == 100 ) {
				if ( attackskill == SKILL_WEAPON_FIREARM ) {
					if ( inv(INV_ITEM_ID, ammo) == ITEM_ID_ENERGY_CELL ) {
						weap = sdata(SKILL_WEAPON_FIREARM, cc)
						efid = SKILL_SPACT_CRITICAL_PARTICLE_CANNON
						gosub *effect
					}
				}
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( powsel == 100 ) {
				if ( attackskill == SKILL_WEAPON_BOW ) {
					weap = sdata(SKILL_WEAPON_BOW, cc)
					efid = SKILL_SPACT_ARROW_RAIN
					gosub *effect
				}
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( powsel == 100 ) {
				if ( attackskill == SKILL_WEAPON_CROSSBOW ) {
					weap = sdata(SKILL_WEAPON_CROSSBOW, cc)
					efid = SKILL_SPACT_HELM_SMASHER
					gosub *effect
				}
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			if ( powsel == 100 ) {
				if ( attackskill == SKILL_WEAPON_THROWING ) {
					weap = sdata(SKILL_WEAPON_THROWING, cc)
					efid = SKILL_SPACT_SPINNING_THROW
					gosub *effect
				}
			}
		}
	}
	if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
		if ( powsel == 100 ) {
			if ( attackskill != SKILL_WEAPON_THROWING ) {
				if ( attackskill != SKILL_WEAPON_FIREARM ) {
					if ( attackskill != SKILL_WEAPON_BOW ) {
						if ( attackskill != SKILL_WEAPON_CROSSBOW ) {
							if ( attackskill != SKILL_WEAPON_MARTIAL_ARTS ) {
								if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_SCIMITAR | inv(INV_ITEM_ID, cw) == ITEM_ID_WAKIZASHI | inv(INV_ITEM_ID, cw) == ITEM_ID_DYNAMIC_SABER | inv(INV_ITEM_ID, cw) == ITEM_ID_BLACK_MONKSHOOD ) {
										weap = sdata(SKILL_WEAPON_SHORTSWORD, cc)
										efid = SKILL_SPACT_FLASH_OF_SWIFTNESS
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_LONG_SWORD | inv(INV_ITEM_ID, cw) == ITEM_ID_KATANA | inv(INV_ITEM_ID, cw) == ITEM_ID_LIGHTSABRE | inv(INV_ITEM_ID, cw) == ITEM_ID_DIABLOS | inv(INV_ITEM_ID, cw) == ITEM_ID_ZANTETSUKEN | inv(INV_ITEM_ID, cw) == ITEM_ID_MOURNBLADE | inv(INV_ITEM_ID, cw) == ITEM_ID_RAGNAROK | inv(INV_ITEM_ID, cw) == ITEM_ID_HIRYU_TO | inv(INV_ITEM_ID, cw) == ITEM_ID_STORM_BRINGER | inv(INV_ITEM_ID, cw) == ITEM_ID_MOONLIGHT | inv(INV_ITEM_ID, cw) == ITEM_ID_HOUSENKA | inv(INV_ITEM_ID, cw) == ITEM_ID_THE_WHITE_HAWK | inv(INV_ITEM_ID, cw) == ITEM_ID_FLEURE | inv(INV_ITEM_ID, cw) == ITEM_ID_EPECLAIR ) {
										weap = sdata(SKILL_WEAPON_LONGSWORD, cc)
										efid = SKILL_SPACT_FLASH_OF_SWIFTNESS
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_DAGGER | inv(INV_ITEM_ID, cw) == ITEM_ID_KITCHEN_KNIFE | inv(INV_ITEM_ID, cw) == ITEM_ID_ETHER_DAGGER | inv(INV_ITEM_ID, cw) == ITEM_ID_LUCKY_DAGGER | inv(INV_ITEM_ID, cw) == ITEM_ID_OTI_TUBAKI | inv(INV_ITEM_ID, cw) == ITEM_ID_MELODYUS | inv(INV_ITEM_ID, cw) == ITEM_ID_KUNAI | inv(INV_ITEM_ID, cw) == ITEM_ID_GO_RENGE ) {
										weap = sdata(SKILL_WEAPON_SHORTSWORD, cc)
										efid = SKILL_SPACT_UNDERHAND_DROP
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_SPEAR | inv(INV_ITEM_ID, cw) == ITEM_ID_TRIDENT | inv(INV_ITEM_ID, cw) == ITEM_ID_HALBERD | inv(INV_ITEM_ID, cw) == ITEM_ID_RANKIS | inv(INV_ITEM_ID, cw) == ITEM_ID_HOLY_LANCE | inv(INV_ITEM_ID, cw) == ITEM_ID_PILE_DRIVER | inv(INV_ITEM_ID, cw) == ITEM_ID_UNICORN_DRILL | inv(INV_ITEM_ID, cw) == ITEM_ID_TRISHULA | inv(INV_ITEM_ID, cw) == ITEM_ID_SPADILLE | inv(INV_ITEM_ID, cw) == ITEM_ID_DRILL | inv(INV_ITEM_ID, cw) == ITEM_ID_LANCE | inv(INV_ITEM_ID, cw) == ITEM_ID_GOUTEN ) {
										weap = sdata(SKILL_WEAPON_POLEARM, cc)
										efid = SKILL_SPACT_PENETRATION
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_SOLAR_CANE ) {
										weap = sdata(SKILL_WEAPON_STAVE, cc)
										efid = SKILL_SPACT_PENETRATION
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_ENGOKU ) {
										weap = sdata(SKILL_WEAPON_STAVE, cc)
										efid = SKILL_SPACT_FLASH_OF_SWIFTNESS
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_CLAYMORE | inv(INV_ITEM_ID, cw) == ITEM_ID_DRAGON_SLAYER | inv(INV_ITEM_ID, cw) == ITEM_ID_CLAYMORE2 | inv(INV_ITEM_ID, cw) == ITEM_ID_KINDNESS_BLADE | inv(INV_ITEM_ID, cw) == ITEM_ID_FLAME_EDGE | inv(INV_ITEM_ID, cw) == ITEM_ID_GRANDEL ) {
										weap = sdata(SKILL_WEAPON_LONGSWORD, cc)
										efid = SKILL_SPACT_BISECTION
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_HAND_AXE | inv(INV_ITEM_ID, cw) == ITEM_ID_BATTLE_AXE | inv(INV_ITEM_ID, cw) == ITEM_ID_BARDISH | inv(INV_ITEM_ID, cw) == ITEM_ID_AXE_OF_DESTRUCTION | inv(INV_ITEM_ID, cw) == ITEM_ID_NEGATIVE_EDGE | inv(INV_ITEM_ID, cw) == ITEM_ID_GOD_BREAKER | inv(INV_ITEM_ID, cw) == ITEM_ID_GRAVITY_AXE | inv(INV_ITEM_ID, cw) == ITEM_ID_GULIWELZEN | inv(INV_ITEM_ID, cw) == ITEM_ID_TOMAHAWK | inv(INV_ITEM_ID, cw) == ITEM_ID_CHAINSAW | inv(INV_ITEM_ID, cw) == ITEM_ID_DGT_101 ) {
										weap = sdata(SKILL_WEAPON_AXE, cc)
										efid = SKILL_SPACT_BISECTION
										gosub *effect
									}
									if ( iequiploc(cw) == EQUIP_SLOT_SHOOT | inv(INV_ITEM_ID, cw) == ITEM_ID_CLUB | inv(INV_ITEM_ID, cw) == ITEM_ID_HAMMER | inv(INV_ITEM_ID, cw) == ITEM_ID_BLOOD_MOON | inv(INV_ITEM_ID, cw) == ITEM_ID_GAIA_HAMMER | inv(INV_ITEM_ID, cw) == ITEM_ID_BUSTER_BOOK | inv(INV_ITEM_ID, cw) == ITEM_ID_NAIL_STRADIVARIUS | inv(INV_ITEM_ID, cw) == ITEM_ID_SOCKS | inv(INV_ITEM_ID, cw) == ITEM_ID_LUCKY_ALMONDS | inv(INV_ITEM_ID, cw) == ITEM_ID_ZUGAIKURAI | inv(INV_ITEM_ID, cw) == ITEM_ID_GRAVITAIL | inv(INV_ITEM_ID, cw) == ITEM_ID_WAR_HAMMER | inv(INV_ITEM_ID, cw) == ITEM_ID_STAR_HAMMER | inv(INV_ITEM_ID, cw) == ITEM_ID_NAZUNAS_SOX ) {
										weap = sdata(SKILL_WEAPON_BLUNT, cc)
										efid = SKILL_SPACT_PULVERIZATION
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_STAFF | inv(INV_ITEM_ID, cw) == ITEM_ID_LONG_STAFF | inv(INV_ITEM_ID, cw) == ITEM_ID_STAFF_OF_INSANITY | inv(INV_ITEM_ID, cw) == ITEM_ID_ELEMENTAL_STAFF | inv(INV_ITEM_ID, cw) == ITEM_ID_VITAL_FLAYER | inv(INV_ITEM_ID, cw) == ITEM_ID_ZWIEBEL | inv(INV_ITEM_ID, cw) == ITEM_ID_DRAKE_ROD | inv(INV_ITEM_ID, cw) == ITEM_ID_VICE_STAFF | inv(INV_ITEM_ID, cw) == ITEM_ID_WHIP | inv(INV_ITEM_ID, cw) == ITEM_ID_IVY_SPINE | inv(INV_ITEM_ID, cw) == ITEM_ID_BLOODY_TEARS | inv(INV_ITEM_ID, cw) == ITEM_ID_BLOOD_ROD | inv(INV_ITEM_ID, cw) == ITEM_ID_SHAKUJO | inv(INV_ITEM_ID, cw) == ITEM_ID_NUNCHAKU | inv(INV_ITEM_ID, cw) == ITEM_ID_POWER_TRIANGLE ) {
										weap = sdata(SKILL_WEAPON_STAVE, cc)
										efid = SKILL_SPACT_DANCE_OF_BLOW
										gosub *effect
									}
									if ( inv(INV_ITEM_ID, cw) == ITEM_ID_ASTRAL_SICKLE | inv(INV_ITEM_ID, cw) == ITEM_ID_BEAST_SICKLE | inv(INV_ITEM_ID, cw) == ITEM_ID_FRISIAS_TAIL | inv(INV_ITEM_ID, cw) == ITEM_ID_SCYTHE | inv(INV_ITEM_ID, cw) == ITEM_ID_KUMIROMI_SCYTHE | inv(INV_ITEM_ID, cw) == ITEM_ID_SICKLE | inv(INV_ITEM_ID, cw) == ITEM_ID_SCYTHE_OF_THE_VOID | inv(INV_ITEM_ID, cw) == ITEM_ID_CHAINSICKLE | inv(INV_ITEM_ID, cw) == ITEM_ID_SASANQUA_SICKLE | inv(INV_ITEM_ID, cw) == ITEM_ID_NECROMANTIS | inv(INV_ITEM_ID, cw) == ITEM_ID_SCISSORS | inv(INV_ITEM_ID, cw) == ITEM_ID_BONE_SCYTHE | inv(INV_ITEM_ID, cw) == ITEM_ID_NUMENIUS ) {
										weap = sdata(SKILL_WEAPON_SCYTHE, cc)
										efid = SKILL_SPACT_MANA_SLASH
										gosub *effect
									}
									weap = 0
								}
							}
						}
					}
				}
			}
		}
	}
	if ( cdata(CDATA_ID, cc) == CREATURE_ID_RAGNAROCK ) {
		if ( rnd(66) == 0 ) {
			evadd EVENT_RAGNAROK, cc
		}
	}
	if ( cdata(CDATA_ID, cc) == CREATURE_ID_SINAHA ) {
		if ( rnd(66) == 0 ) {
			if ( findbuff(cc, BUFF_LUCK) == (-1) ) {
				addbuff tc, BUFF_UNLUCKY, 6666, 6666
				snd SOUNDLIST_CURSE2
			}
		}
	}
	if ( adata(ADATA_WAKEUP_NEFIA, gdata(GDATA_AREA)) == WAKEUP_NEFIA_TIME ) {
		if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
			if ( rnd(50) == 0 ) {
				txtef COLOR_SKY_BLUE
				txt lang(name(cc) + "以外の時が止まった。", name(cc) + " stop" + _s(cc) + " time.")
				gdata(GDATA_TIME_STOP_TIME) = 3
			}
		}
	}
	return

*act_attackSub
	if ( gdata(GDATA_TEMPORARY_FLAGS2) >= 100 ) {
		return
	}
	if ( gdata(GDATA_TEMPORARY_FLAGS3) >= 100 ) {
		return
	}
	repeat RANGE_INV_ITEM_ENCHANT
		cw = attackitem
		if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw) == 0 ) {
			break
		}
		enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, cw)
		if ( enc == ENCHANT_ABSORB_STAMINA ) {
			p = rnd(inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw) / 50 + 1) + 1
			if ( cdata(CDATA_SP, tc) > 0 ) {
				healsp cc, rnd(2) + 1
			}
			if ( tc == CHARA_PLAYER ) {
				dmgsp tc, p / 2
			}
			if ( tc != CHARA_PLAYER ) {
				dmgspt tc, p / 2
			}
			dmgsp tc, p / 2
			refreshspeed tc
			continue
		}
		if ( enc == ENCHANT_ABSORB_MP ) {
			p = (rnd(inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw) / 100 + 1) + 20) * limit(orgdmg / 500, 1, 50) - cdata(CDATA_PV, tc)
			if ( p <= 0 ) {
				p = 1
			}
			healmp cc, p / 5 + 1
			if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
				continue
			}
			dmgmp tc, p
			continue
		}
		if ( enc == ENCHANT_RAGNAROK ) {
			if ( rnd(66) == 0 ) {
				evadd EVENT_RAGNAROK, cc
			}
			continue
		}
		if ( enc == ENCHANT_TIME_STOP ) {
			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
				if ( rnd(25) == 0 ) {
					snd SOUNDLIST_CHEST1
					animeload ANIMATION_UNISON_IMPACT4, cc
					txtef COLOR_SKY_BLUE
					txt lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
					gdata(GDATA_TIME_STOP_TIME) = limit(inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw) / 100 + 1 + 1, 2, 6)
					await
					snd SOUNDLIST_CHEST1
				}
				continue
			}
		}
		if ( enc == ENCHANT_BANE_DRAGON ) {
			s = refchara(cdata(CDATA_ID, tc), DBSPEC_CHARA_FILTER, 1)
			if ( instr(s, 0, "/dragon/") != (-1) ) {
				gdata(GDATA_DMG_TYPE) = 1
				dmghp tc, orgdmg / 30 * (rnd(20) + inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw)) / 50 + 1, cc
				subdmg = 0
			}
			continue
		}
		if ( enc == ENCHANT_BANE_GOD ) {
			s = refchara(cdata(CDATA_ID, tc), DBSPEC_CHARA_FILTER, 1)
			if ( instr(s, 0, "/god/") != (-1) ) {
				gdata(GDATA_DMG_TYPE) = 1
				dmghp tc, orgdmg / 30 * (rnd(20) + inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw)) / 50 + 1, cc
				subdmg = 0
			}
			continue
		}
		if ( enc == ENCHANT_BANE_UNDEAD ) {
			s = refchara(cdata(CDATA_ID, tc), DBSPEC_CHARA_FILTER, 1)
			if ( instr(s, 0, "/undead/") != (-1) ) {
				gdata(GDATA_DMG_TYPE) = 1
				dmghp tc, orgdmg / 30 * (rnd(20) + inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw)) / 50 + 1, cc
				subdmg = 0
			}
			continue
		}
		if ( enc == ENCHANT_BANE_FLYING ) {
			if ( cbit(CHARA_BIT_FLOAT, tc) == 1 ) {
				gdata(GDATA_DMG_TYPE) = 1
				dmghp tc, orgdmg / 120 * (rnd(10) + inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw)) / 50 + 1, cc
				subdmg = 0
			}
			continue
		}
		i = enc / EXT_ENCHANTMENT
		if ( i != 0 ) {
			enc = enc \ EXT_ENCHANTMENT
			if ( i == ENCHANT_ELEMENTAL_DMG ) {
				if ( orgdmg <= 1 ) {
					continue
				}
				ele = enc
				if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
					continue
					ele = SKILL_NONE
				}
				gdata(GDATA_DMG_TYPE) = 1
				dmghp tc, orgdmg / 10 * (rnd(100) + inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw)) / 100 + 1, cc, ele, inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw) / 2 + 100
				subdmg = 0
				continue
			}
			if ( i == ENCHANT_PROC ) {
				if ( cdata(CDATA_EXIST, tc) != CHAR_STATE_ALIVE ) {
					continue
				}
				if ( enc >= MAX_ENCHANT_PROC ) {
					continue
				}
				tcbk = tc
				p = encprocref(1, enc)
				if ( p == TARGET_TYPE_SELF | p == TARGET_TYPE_SELF_ONLY ) {
					tc = cc
				}
				p = encprocref(5, enc)
				enc = encprocref(0, enc)
				if ( enc == SKILL_SPACT_GRENADE ) {
					if ( inv(INV_ITEM_ID, cw) == ITEM_ID_NOVA_GRENADE | inv(INV_ITEM_ID, cw) == ITEM_ID_GRENADE ) {
						if ( attackskill != SKILL_WEAPON_BLUNT ) {
							p = 90
						}
					}
				}
				tlocx = cdata(CDATA_X, tc)
				tlocy = cdata(CDATA_Y, tc)
				if ( rnd(100) < p ) {
					gdata(GDATA_ACTIVATE_PROC) = 100
					efid = enc
					efp = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, cw) + sdata(attackskill, cc) * 10
					gosub *effect
				}
				gdata(GDATA_ACTIVATE_PROC) = 0
				tc = tcbk
				continue
			}
			continue
		}
	loop
	if ( ammoproc == ENCHANT_AMMO_TIME_STOP ) {
		snd SOUNDLIST_CHEST1
		animeload ANIMATION_UNISON_IMPACT4, cc
		txtef COLOR_SKY_BLUE
		txt lang(name(cc) + "は時を止めた。", name(cc) + " stop" + _s(cc) + " time.")
		gdata(GDATA_TIME_STOP_TIME) = 4
		await
		snd SOUNDLIST_CHEST1
	}
	if ( ammoproc == ENCHANT_AMMO_MAGIC ) {
		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
			gdata(GDATA_DMG_TYPE) = 1
			dmghp tc, orgdmg, cc, rnd(MAX_SKILL_RESIST - STARTING_SKILL_RESIST) + STARTING_SKILL_RESIST, sdata(attackskill, cc) * 10 + 100
			subdmg = 0
		}
	}
	if ( ammoproc == ENCHANT_AMMO_EXPLOSIVE ) {
		tlocx = ammox
		tlocy = ammoy
		tcbk = tc
		efid = SKILL_SPELL_MAGIC_STORM
		efp = sdata(attackskill, cc) * 8 + 10
		gosub *effect
		tc = tcbk
	}
	ele = SKILL_NONE
	return

*act_search
	msgdup++
	txt lang("周囲を注意深く調べた。", "You search the surroundings carefully.")
	if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
		inv_getheader -1
		p = 9999
		repeat invrange, invhead
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}
			if ( inv(INV_ITEM_PROPERTY, cnt) != PROP_SPECIAL ) {
				continue
			}
			if ( inv(INV_ITEM_ID, cnt) != ITEM_ID_SUMMONING_CRYSTAL ) {
				continue
			}
			if ( p > dist(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)) ) {
				p = dist(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER))
			}
		loop
		if ( p != 9999 ) {
			repeat
				if ( p <= 3 ) {
					txt lang("辺りの空気は息苦しいほどの緊張に包まれている。", "The air around you is filled with strained silence.")
				}
				if ( p <= 9 ) {
					txt lang("微かだが、あなたの心臓はトクンと脈打った。", "Your heart starts beating in your chest.")
					break
				}
				if ( p <= 16 ) {
					txt lang("まだだ、まだ遠い…", "Still, still lying far ahead.")
					break
				}
				txt lang("あなたは青い水晶の存在を感じた。", "You sense a blue crystal lying somewhere in this area.")
				break
			loop
		}
	}
	repeat 11
		y = cdata(CDATA_Y, cc) + cnt - 5
		if ( y < 0 | y >= mdata(MDATA_HEIGHT) ) {
			continue
		}
		repeat 11
			x = cdata(CDATA_X, cc) + cnt - 5
			if ( x < 0 | x >= mdata(MDATA_WIDTH) ) {
				continue
			}
			if ( map(x, y, 6) != 0 ) {
				cell_featread x, y
				refx = x
				refy = y
				if ( abs(cdata(CDATA_Y, cc) - y) <= 1 & abs(cdata(CDATA_X, cc) - x) <= 1 ) {
					if ( feat(1) == CELL_FEATURE_TRAP ) {
						if ( feat(0) == 0 ) {
							gosub *calcSearch
							if ( stat == 1 ) {
								gosub *revealTrap
								txt lang("罠を発見した。", "You discover a trap.")
							}
						}
					}
					if ( feat(1) == CELL_FEATURE_HIDDEN_PATH ) {
						gosub *calcSearch
						if ( stat == 1 ) {
							gosub *revealHiddenPath
							txt lang("隠れた通路を発見した。", "You discover a hidden path.")
						}
					}
				}
				if ( feat(1) == CELL_FEATURE_SMALL_MEDAL ) {
					if ( gdata(GDATA_AREA) != AREA_SHOW_HOUSE ) {
						if ( cdata(CDATA_X, cc) == x & cdata(CDATA_Y, cc) == y ) {
							snd SOUNDLIST_DING2
							txt lang("なんと小さなメダルを見つけた！", "You find a small coin!")
							map(x, y, 6) = 0
							flt
							itemcreate -1, ITEM_ID_SMALL_MEDAL, x, y, 0
						}
						else {
							txtmore
							if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), x, y) > 2 ) {
								txt lang("この辺りには何かがありそうな予感がする…", "You sense something.")
							}
							else {
								txt lang("あなたは何かが輝くのを目にした。", "You see something shine.")
							}
						}
					}
				}
			}
		loop
	loop
	cell_featread cdata(CDATA_X, cc), cdata(CDATA_Y, cc)
	if ( feat(1) == CELL_FEATURE_TRAP ) {
		if ( feat(0) == tile_trap ) {
			movx = cdata(CDATA_X, cc)
			movy = cdata(CDATA_Y, cc)
			gosub *disarmTrap
		}
	}
	if ( feat(1) >= CELL_FEATURE_SAMPLING_SPOT_DETECTION & feat(1) <= CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
		rowactre = 1, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_DETECTION ) {
			gosub *search
		}
		if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_MINING ) {
			gosub *dig
		}
		if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_FISHING ) {
			gosub *fishing
		}
		if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GENE_ENGINEER ) {
			gosub *search
		}
		if ( feat(1) == CELL_FEATURE_SAMPLING_SPOT_GARDENING ) {
			gosub *plant
		}
	}
	goto *turn_end

*revealTrap
	cell_featset refx, refy, tile_trap, -1, -1
	return

*revealHiddenPath
	map(refx, refy, 0) = tile_tunnel
	cell_featset refx, refy, 0, 0
	return

*act_dig
	if ( cdata(CDATA_SP, cc) < 0 ) {
		txt lang("疲れ過ぎて無理だ。", "You are too exhausted to do that.")
		gosub *screen_draw
		goto *pc_turn
	}
	rowactre = 0
	digx = tlocx
	digy = tlocy
	gosub *dig
	goto *turn_end

#deffunc dipcursed int dipcursed_item, int
	if ( refitem(inv(INV_ITEM_ID, dipcursed_item), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
		if ( inv(INV_ITEM_MATERIAL, dipcursed_item) == ITEM_MATERIAL_RAW ) {
			txt lang(itemname(dipcursed_item) + "は腐ってしまった…", "" + itemname(dipcursed_item) + " rots.")
			inv(INV_ITEM_ROT, dipcursed_item) = -1
			inv(INV_ITEM_PIC, dipcursed_item) = xy2pic(6, 10)
			cell_refresh inv(INV_ITEM_X, dipcursed_item), inv(INV_ITEM_Y, dipcursed_item)
			return
		}
		else {
			txt lang(itemname(dipcursed_item) + "に変化はない。", "" + itemname(dipcursed_item) + " remains unchanged.")
			return
		}
	}
	if ( refitem(inv(INV_ITEM_ID, dipcursed_item), DBSPEC_TYPE) < FILTER_ITEM_MIN ) {
		inv(INV_ITEM_LEVEL, dipcursed_item)--
		snd SOUNDLIST_CRACK
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			if ( inv(INV_ITEM_LEVEL, dipcursed_item) == (-10) ) {
				snd SOUNDLIST_CRACK2
				animeload 64, CHARA_PLAYER
			}
		}
		txt lang(itemname(dipcursed_item) + "は錆びてしまった…", "" + itemname(dipcursed_item) + " rusts.")
		if ( inv_getowner(dipcursed_item) != (-1) ) {
			r1 = inv_getowner(dipcursed_item)
			gosub *charaRefresh
		}
		if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
			if ( inv(INV_ITEM_LEVEL, dipcursed_item) < (-10) ) {
				snd SOUNDLIST_ATK_POISON
				txtef COLOR_RED
				txt lang(name(locvar_dipcursed_tc) + "の" + itemname(dipcursed_item) + "はドロドロに溶けてしまった。", name(locvar_dipcursed_tc) + your(locvar_dipcursed_tc) + " " + itemname(dipcursed_item, , 1) + " is melted.")
				inv(INV_ITEM_NUM, dipcursed_item)--
				cdata(inv(INV_ITEM_EQUIP, dipcursed_item), locvar_dipcursed_tc) = cdata(inv(INV_ITEM_EQUIP, dipcursed_item), locvar_dipcursed_tc) / 10000 * 10000
				inv(INV_ITEM_EQUIP, dipcursed_item) = 0
				r1 = inv_getowner(dipcursed_item)
				gosub *charaRefresh
			}
		}
		return
	}
	txt_nothinghappens
	return

*act_dip
	procid = (procid + 1) \ 4
	proclist(procid) = "proc_dip" + " ct:" + ct
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_BAIT ) {
		item_separate ci
		item_num cidip, -1
		snd SOUNDLIST_EQUIP1
		txt lang(itemname(cidip, 1) + "を" + itemname(ci) + "に装着した。", "You bait " + itemname(ci) + " with " + itemname(cidip, 1) + ".")
		if ( inv(INV_ITEM_FISHING_BAIT, ci) == inv(INV_ITEM_PARAM1, cidip) ) {
			inv(INV_ITEM_CHARGE, ci) += rnd(10) + 15
		}
		else {
			inv(INV_ITEM_CHARGE, ci) = rnd(10) + 15
			inv(INV_ITEM_FISHING_BAIT, ci) = inv(INV_ITEM_PARAM1, cidip)
		}
		goto *turn_end
	}
	snd SOUNDLIST_DRINK1
	if ( refitem(inv(INV_ITEM_ID, cidip), DBSPEC_TYPE) == FILTER_ITEM_POTION ) {
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE_MINOR) == FILTER_FURNITURE_WELL ) {
			item_separate ci
			item_num cidip, -1
			if ( inv(INV_ITEM_ID, cidip) != ITEM_ID_EMPTY_BOTTLE ) {
				txt lang(itemname(cidip, 1) + "を" + itemname(ci) + "に浸した。", "You dip " + itemname(ci) + " into " + itemname(cidip, 1) + ".")
				txtmore
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HOLY_WELL ) {
					txt lang("井戸は汚れた。", "The holy well is polluted.")
					goto *turn_end
				}
				if ( inv(INV_ITEM_PARAM3, ci) >= 20 ) {
					txt lang(itemname(ci) + "は完全に枯れている。", itemname(ci) + " is completely dry.")
					goto *turn_end
				}
				txt lang(itemname(ci) + "は一瞬輝いた。", itemname(ci) + " shines for a moment.")
				if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_HANDFUL_SNOW ) {
					txt lang("こんな量では… ", "Snow just melts.")
				}
				else {
					inv(INV_ITEM_PARAM1, ci) += rnd(3)
				}
				goto *turn_end
			}
			else {
				if ( inv(INV_ITEM_PARAM1, ci) < (-5) | inv(INV_ITEM_PARAM3, ci) >= 20 | (inv(INV_ITEM_ID, ci) == ITEM_ID_HOLY_WELL & gdata(GDATA_FLAG_HOLY_WELL) <= 0) ) {
					valn = itemname(ci)
					txt lang(valn + "は涸れている。", valn + " is dry.")
					txtmore
					txt lang("あっ！空き瓶を井戸に落としてしまった…", "Oops! You drop the empty bottle into the well...")
					goto *turn_end
				}
				if ( gdata(GDATA_FLAG_GAME_MODE) == GAMEMODE_ABNORMAL ) {
					if ( inv_sum(CHARA_PLAYER) > 20 ) {
						txt_invfull
						goto *turn_end
					}
				}
				if ( inv_getspace(CHARA_PLAYER) == 0 ) {
					txt lang("あっ！空き瓶を井戸に落としてしまった…", "Oops! You drop the empty bottle into the well...")
					goto *turn_end
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HOLY_WELL ) {
					gdata(GDATA_FLAG_HOLY_WELL)--
					flt
					itemcreate 0, ITEM_ID_BOTTLE_WATER, -1, -1, 0
					if ( stat != 0 ) {
						inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
					}
					if ( inv_getfreeid(CHARA_PLAYER) == (-1) ) {
						item_num cidip, 1
						txt_invfull2
						goto *turn_end
					}
				}
				else {
					inv(INV_ITEM_PARAM1, ci) -= 3
					flt 20
					flttypemajor = FILTER_ITEM_POTION
					itemcreate 0, ITEM_ID_DUMMY, -1, -1, 0
				}
				txt lang("空き瓶に水をすくった。", "You draw water from the well into the empty bottle.")
				txt lang(itemname(ci, 1) + "を手に入れた。", "You get " + itemname(ci, 1) + ".")
				item_stack CHARA_PLAYER, ci, 1
				goto *turn_end
			}
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_POISON ) {
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
			item_num cidip, -1
			item_separate ci
			txt lang(itemname(ci) + "に" + itemname(cidip, 1) + "を混入した！あなたはにやりと笑った。", "You made aphrodisiac food! You grin.")
			if ( inv(INV_ITEM_STATUS, cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			ibitmod ITEM_BIT_POISON_BLEND, ci, 1
			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_JUICE ) {
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_JUICE ) {
			item_num cidip, -1
			item_separate ci
			txt lang(itemname(ci) + "はミックスジュースになった！", "You made a mixed juice!")
			ibitmod ITEM_BIT_HERBED_IN, ci, 1
			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_BOTTLE_MILK ) {
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_JUICE | inv(INV_ITEM_ID, ci) == ITEM_ID_COFFEE ) {
			item_num cidip, -1
			item_separate ci
			txt lang(itemname(ci) + "に乳を混ぜた！", "You mixed milk.")
			ibitmod ITEM_BIT_ACIDPROOF, ci, 1
			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_LOVE_POTION ) {
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
			item_num cidip, -1
			item_separate ci
			txt lang(itemname(ci) + "に媚薬を混入した！あなたはうしろめたさを感じた…", "You made aphrodisiac food! You kind of feel guilty...")
			if ( inv(INV_ITEM_STATUS, cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			ibitmod ITEM_BIT_LOVE_BLEND, ci, 1
			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_BOTTLE_DIRTY_WATER | inv(INV_ITEM_ID, cidip) == ITEM_ID_VOMIT | inv(INV_ITEM_ID, cidip) == ITEM_ID_URINE ) {
		if ( inv(INV_ITEM_STATUS, ci) == 1 ) {
			if ( inv(INV_ITEM_STATUS, cidip) == 1 ) {
				in = inv(INV_ITEM_NUM, cidip)
			}
			else {
				in = 1
				item_separate ci
			}
			item_num cidip, -1
			txt lang(itemname(ci) + "は輝きを失った…", "You removed the shine from " + itemname(ci) + ".")
			inv(INV_ITEM_STATUS, ci) = 0
			r1 = cc
			gosub *charaRefresh
			if ( inv(INV_ITEM_STATUS, cidip) <= (-1) ) {
				dipcursed ci
			}
			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_BOTTLE_ANTISEPTIC ) {
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
			item_num cidip, -1
			item_separate ci
			txt lang(itemname(ci) + "に永久防腐剤を混ぜた。", "You add permanent food preservatives to " + itemname(ci))
			if ( inv(INV_ITEM_STATUS, cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			ibitmod ITEM_BIT_ANTISEPTIC, ci, 1

			/********** BLOODYSHADE CUSTOM - BEGINNING **********/

			item_stack -1, ci, 1

			/********** BLOODYSHADE CUSTOM - ENDING **********/

			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_BOTTLE_DYE ) {
		if ( inv(INV_ITEM_STATUS, cidip) == ITEM_STATUS_BLESSED ) {
			in = inv(INV_ITEM_NUM, cidip)
		}
		else {
			in = 1
			item_separate ci
		}
		item_num cidip, -1
		inv(INV_ITEM_COL, ci) = inv(INV_ITEM_COL, cidip)
		txt lang("あなたは" + itemname(ci) + "を染めた。", "You dye " + itemname(ci) + ".")
		if ( inv_getowner(ci) == (-1) ) {
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		}
		if ( inv(INV_ITEM_EQUIP, ci) != 0 ) {
			create_pcpic cc, 1
		}
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_ACIDPROOF_LIQUID ) {
		if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) != FILTER_ITEM_POTION ) {
			if ( inv(INV_ITEM_STATUS, cidip) == ITEM_STATUS_BLESSED ) {
				in = inv(INV_ITEM_NUM, cidip)
			}
			else {
				in = 1
				item_separate ci
			}
			txt lang(itemname(ci) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci) + ".")
			if ( inv(INV_ITEM_STATUS, cidip) <= ITEM_STATUS_CURSED ) {
				dipcursed ci
			}
			else {
				ibitmod ITEM_BIT_ACIDPROOF, ci, 1
				txt lang(itemname(ci) + "は酸から守られた。", itemname(ci) + " gain" + _s2(in) + " acidproof.")
			}
			item_num cidip, -1
			goto *turn_end
		}
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_FIREPROOF_LIQUID ) {
		if ( inv(INV_ITEM_STATUS, cidip) == ITEM_STATUS_BLESSED ) {
			in = inv(INV_ITEM_NUM, cidip)
		}
		else {
			in = 1
			item_separate ci
		}
		txt lang(itemname(ci, in) + "に" + itemname(cidip, 1) + "を塗りたくった。", "You put " + itemname(cidip, 1) + " on " + itemname(ci, in) + ".")
		if ( inv(INV_ITEM_STATUS, cidip) <= ITEM_STATUS_CURSED ) {
			dipcursed ci
		}
		else {
			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_FIREPROOF_BLANKET ) {
				txt lang("いいアイデアだ！しかし…", "A good idea! But...")
			}
			else {
				ibitmod ITEM_BIT_FIREPROOF, ci, 1
				txt lang(itemname(ci) + "は熱から守られた。", itemname(ci) + " gain" + _s2(in) + " fireproof.")
			}
		}
		item_num cidip, -1
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, cidip) == ITEM_ID_BOTTLE_WATER ) {
		item_num cidip, -1
		if ( inv(INV_ITEM_STATUS, cidip) == ITEM_STATUS_BLESSED ) {
			txtef COLOR_GREEN
			txt lang(itemname(ci) + "は銀色に輝いた。", itemname(ci) + " shine" + _s2(inv(INV_ITEM_NUM, ci)) + " silvery.")
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
			r1 = cc
			gosub *charaRefresh
			goto *turn_end
		}
		if ( inv(INV_ITEM_STATUS, cidip) <= ITEM_STATUS_CURSED ) {
			txtef COLOR_PURPLE
			txt lang(itemname(ci) + "は黒いオーラに包まれた。", itemname(ci) + " " + is2(inv(INV_ITEM_NUM, ci)) + " wrapped in a dark aura.")
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_CURSED
			r1 = cc
			gosub *charaRefresh
			goto *turn_end
		}
	}
	txt_nothinghappens
	goto *turn_end

*act_use
	procid = (procid + 1) \ 4
	proclist(procid) = "act_use" + " ct:" + ct
	screenupdate = -1
	gosub *screen_draw
	tc = cc
	tlocx = cdata(CDATA_X, cc)
	tlocy = cdata(CDATA_Y, cc)
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION & TweakData(50,1) == 1 ) {
		kakeru = 100
		goto *act_throw
	}
	if ( ibit(ITEM_BIT_PERIOD, ci) == 1 ) {
		if ( gdata(GDATA_FLAG_INSIDE_DEEP_SEA_CASTLE) == 100 ) {
			inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + inv(INV_ITEM_PARAM3, ci)
			inv(INV_ITEM_NEED_SLEEP, ci) = 1
			gdata(STARTING_GDATA_FLAG + 376) = 1
		}
		if ( gdata(STARTING_GDATA_FLAG + 376) == 0 ) {
			inv(INV_ITEM_NEED_SLEEP, ci) = 0
		}

		/********** ANNA CUSTOM - BEGINNING **********/ // Smart Use of Cooldown Items, will search inventory for others of the same item and use those if available.

		repeat 200, 0
			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
				continue
			}

			if ( inv(INV_ITEM_ID, cnt) == inv(INV_ITEM_ID, ci) ) {
				if ( inv(INV_ITEM_CHARGE, cnt) < gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 ) {	
					ci = cnt
					break
				}
			}
		loop

		/********** ANNA CUSTOM - ENDING **********/

		if ( gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 < inv(INV_ITEM_NEXT_PERIOD, ci) ) {
			txt lang("そのアイテムが次に使用できるのは" + cnvdate(inv(INV_ITEM_NEXT_PERIOD, ci), 1) + "だ。", "This item will be useable again at " + cnvdate(inv(INV_ITEM_NEXT_PERIOD, ci), 1) + ".")
			gosub *screen_draw
			goto *pc_turn
		}
		if ( inv(INV_ITEM_NEED_SLEEP, ci) != 0 ) {
			txt lang("そのアイテムが次に使用できるのは睡眠後だ。", "This item will be useable again after sleep.")
			gosub *screen_draw
			goto *pc_turn
		}
		item_separate ci
		inv(INV_ITEM_NEXT_PERIOD, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + inv(INV_ITEM_INTERVAL, ci)
	}
	if ( ibit(ITEM_BIT_CHARGE_ITEM, ci) == 1 ) {
		if ( inv(INV_ITEM_CHARGE, ci) <= 0 ) {
			txt lang("それはもう使えない。", "It's out of charge.")
			gosub *screen_draw
			goto *pc_turn
		}
		item_separate ci
		inv(INV_ITEM_CHARGE, ci)--
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE_MINOR) == FILTER_ITEM_SEED ) {
		goto *item_seed
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE_MINOR) == FILTER_ITEM_TOOL_BLEND ) {
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE | (gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179) ) {
			txt_cantusehere
			gosub *screen_draw
			goto *pc_turn
		}
		blendtool = ci
		goto *com_blend
	}
	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE_MINOR) == FILTER_FURNITURE_BED ) {
		if ( gdata(GDATA_SLEEP) < 15 ) {
			txt lang("まだ眠たくない。", "You don't feel sleepy yet.")
			gosub *screen_draw
			goto *pc_turn
		}
		gdata(GDATA_ROW_ACT) = ACTION_SLEEP
		gosub *generalAct
		goto *turn_end
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RED_TREASURE_MACHINE | inv(INV_ITEM_ID, ci) == ITEM_ID_BLUE_TREASURE_MACHINE ) {
		goto *com_gasha
	}
	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_PACHISURO_MACHINE | inv(INV_ITEM_ID, ci) == ITEM_ID_CASINO_TABLE | inv(INV_ITEM_ID, ci) == ITEM_ID_SLOT_MACHINE | inv(INV_ITEM_ID, ci) == ITEM_ID_DARTS_BOARD ) {
		atxid = 1
		gosub *com_txtadv
		goto *turn_end
	}
	if ( inv(INV_ITEM_EFFECT, ci) == EFFECT_CARPENTRY | inv(INV_ITEM_EFFECT, ci) == EFFECT_ALCHEMY | inv(INV_ITEM_EFFECT, ci) == EFFECT_JEWELER | inv(INV_ITEM_EFFECT, ci) == EFFECT_TAILOR ) {
		prodtype = inv(INV_ITEM_EFFECT, ci)
		snd SOUNDLIST_POP2
		invctrl = 0
		gosub *com_product
		goto *turn_end
	}
	if ( ibit(ITEM_BIT_ULTIMATE, ci) == 1 ) {
		if ( synccheck(tc, -1) ) {
			txtef COLOR_RED
			txt lang("エターナルフォース一本につき一度しか使えない。無差別全域攻撃魔法を発動する？", "Invoke an indiscriminate, map-wide magic attack? This can only be used once per Eternal Force weapon.")
		}
		promptYesNo
		if ( rtval == 0 ) {
			if ( gdata(GDATA_AREA) == AREA_PET_ARENA | mdata(MDATA_TYPE) == MAP_TYPE_WORLD | gdata(GDATA_AREA) == AREA_PYRAMID | gdata(GDATA_AREA) == AREA_JAIL ) {
				txt_nothinghappens
				goto *turn_end
			}
			snd SOUNDLIST_ATK_ICE
			txtef COLOR_BLUE
			txt lang("周囲の大気が一瞬にして氷結した！", "The surrounding air was frozen in a moment!")
			snd SOUNDLIST_ATK_ICE
			ibitmod ITEM_BIT_ULTIMATE, ci, 0
			snd SOUNDLIST_ATK_ICE
			snd SOUNDLIST_ATK_ICE
			snd SOUNDLIST_ATK_ICE
			repeat mdata(MDATA_HEIGHT)
				dy = cnt
				repeat mdata(MDATA_WIDTH)
					dx = cnt
					f = 0
					if ( map(dx, dy, 0) == 594 | map(dx, dy, 0) == 168 | map(dx, dy, 0) == 165 | map(dx, dy, 0) == 171 | map(dx, dy, 0) == 174 ) {
						map(dx, dy, 0) = 187
						f = 1
					}
					if ( map(dx, dy, 0) == 637 | map(dx, dy, 0) == 628 | map(dx, dy, 0) == 642 ) {
						map(dx, dy, 0) = 185
						f = 1
					}
					if ( map(dx, dy, 0) == 184 | map(dx, dy, 0) == 209 | map(dx, dy, 0) == 214 | map(dx, dy, 0) == 216 | map(dx, dy, 0) == 186 | map(dx, dy, 0) == 189 | map(dx, dy, 0) == 190 ) {
						map(dx, dy, 0) = 186
						f = 1
					}
					if ( map(dx, dy, 0) >= 396 & map(dx, dy, 0) <= 560 ) {
						map(dx, dy, 0) = 408
						f = 1
					}
					if ( map(dx, dy, 0) >= 560 & map(dx, dy, 0) <= 670 ) {
						map(dx, dy, 0) = 670
						f = 1
					}
					if ( map(dx, dy, 0) == 701 | map(dx, dy, 0) == 671 ) {
						f = 1
					}
					if ( f == 0 ) {
						map(dx, dy, 0) = 45
						if ( rnd(10) == 0 ) {
							map(dx, dy, 0) = 57
						}
						if ( rnd(8) == 0 ) {
							map(dx, dy, 0) = 56
						}
					}
					if ( map(dx, dy, 1) != 0 ) {
						tc = map(dx, dy, 1) - 1
						snd SOUNDLIST_ATK_ICE
						if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
							if ( tc != CHARA_PLAYER ) {
								if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
									tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
								}
								txt_guard
							}
						}
						dmg = 1000 + limit(sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) / 3, 1, 99999)
						addbuff tc, BUFF_DEATH_WORD, sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * 20, 2
						dmghp tc, dmg, cc, SKILL_RES_COLD, 1000
						snd SOUNDLIST_ATK_ICE
						snd SOUNDLIST_ATK_ICE
						if ( cdata(CDATA_REFLECT_MAGIC, tc) > 0 ) {
							if ( cc >= MAX_CHARA_FOLLOWER | tc >= MAX_CHARA_FOLLOWER ) {
								dmghp cc, limit(dmg * cdata(CDATA_REFLECT_MAGIC, tc) / 200 + 1, 1, cdata(CDATA_MAX_HP, cc) / 10), tc, SKILL_RES_FIRE, 1000
								if ( synccheck(tc, -1) ) {
									txtef COLOR_PURPLE
									txt lang(name(tc) + "は魔法の一部を反射した。", name(tc) + " reflected part of the magic.")
								}
							}
						}
					}
				loop
			loop
			p = 1
			repeat p
				repeat mdata(MDATA_HEIGHT)
					y = cnt
					repeat mdata(MDATA_WIDTH)
						x = cnt
						p = dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), x, y)
						map(x, y, 2) = map(x, y, 0)
					loop
				loop
			loop
			goto *turn_end
		}
		else {
			goto *pc_turn
		}
	}
	if ( ibit(ITEM_BIT_ALIVE, ci) ) {
		if ( inv(INV_ITEM_GROWTH, ci) >= 15 ) {
			txt lang("この武器は成長しきっている。", "The weapon can not grow any more.")
			goto *pc_turn
		}
		if ( inv(INV_ITEM_EXP, ci) < calcexpalive(inv(INV_ITEM_GROWTH, ci)) ) {
			txt lang("この武器はまだ血を吸い足りない。", "The weapon needs more blood.")
		}
		else {
			txtnew
			txt lang(itemname(ci) + "は十分に血を吸い成長できる！", itemname(ci) + " sucked enough blood and ready to grow!")
			if ( inv(INV_ITEM_PARAM1, ci) >= 10 ) {
				txt lang("しかし、なんだか様子がおかしい…", "But you sense something weird.")
			}
			txt lang("それは…", "It...")
			reftype = refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE)
			listmax = 0
			taisei = inv(INV_ITEM_DICE2, ci) + inv(INV_ITEM_LEVEL, ci) + gdata(GDATA_MONTH)
			list(0, listmax) = rtval, rtval(1)
			list(0, listmax) = -1
			listmax++
			s = lang("ボーナス+4を獲得する", "Enchantment Bonus + 4")
			promptAdd s
			if ( taisei \ 11 == 0 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("火炎耐性***を獲得する", "Add Fire Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 1 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("冷気耐性***を獲得する", "Add Cold Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 2 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("電撃耐性***を獲得する", "Add Lightning Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 3 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("暗黒耐性***を獲得する", "Add Darkness Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 4 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("幻惑耐性***を獲得する", "Add Mind Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 5 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("毒耐性***を獲得する", "Add Poison Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 6 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("地獄耐性***を獲得する", "Add Nether Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 7 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("音耐性***を獲得する", "Add Sound Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 8 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("神経耐性***を獲得する", "Add Nerve Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 9 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("混沌耐性***を獲得する", "Add Chaos Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 10 ) {
				list(0, listmax) = -2
				listmax++
				s = lang("魔法耐性**を獲得する", "Add Magic Resistance")
				promptAdd s
			}
			if ( taisei \ 11 == 0 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("火炎属性追加ダメージ***を獲得する", "Add Fire Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 1 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("冷気属性追加ダメージ***を獲得する", "Add Cold Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 2 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("電撃属性追加ダメージ***を獲得する", "Add Lightning Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 3 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("暗黒属性追加ダメージ***を獲得する", "Add Darkness Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 4 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("幻惑属性追加ダメージ***を獲得する", "Add Mind Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 5 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("毒属性追加ダメージ***を獲得する", "Add Poison Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 6 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("地獄属性追加ダメージ***を獲得する", "Add Nether Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 7 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("音属性追加ダメージ***を獲得する", "Add Sound Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 8 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("神経属性追加ダメージ***を獲得する", "Add Nerve Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 9 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("混沌属性追加ダメージ***を獲得する", "Add Chaos Damage")
				promptAdd s
			}
			if ( taisei \ 11 == 10 ) {
				list(0, listmax) = -3
				listmax++
				s = lang("魔法属性追加ダメージ***を獲得する", "Add Magic Damage")
				promptAdd s
			}
			if ( taisei \ 10 == 0 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("筋力11上昇を獲得する", "Increase STR by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 1 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("耐久11上昇を獲得する", "Increase CON by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 2 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("器用11上昇を獲得する", "Increase DEX by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 3 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("感覚11上昇を獲得する", "Increase PER by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 4 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("習得11上昇を獲得する", "Increase LER by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 5 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("意志11上昇を獲得する", "Increase WIL by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 6 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("魔力11上昇を獲得する", "Increase MAG by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 7 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("魅力11上昇を獲得する", "Increase CHR by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 8 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("速度11上昇を獲得する", "Increase SPD by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 9 ) {
				list(0, listmax) = -4
				listmax++
				s = lang("運勢11上昇を獲得する", "Increase LUCK by 11")
				promptAdd s
			}
			if ( taisei \ 10 == 0 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("心眼スキル上昇***を獲得する", "Add Eye of Mind Skill")
				promptAdd s
			}
			if ( taisei \ 10 == 1 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("詠唱スキル上昇***を獲得する", "Add Casting Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 2 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("二刀流スキル上昇***を獲得する", "Add Dual Wield Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 3 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("両手持ちスキル上昇***を獲得する", "Add Two Hand Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 4 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("戦術スキル上昇***を獲得する", "Add Tactics Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 5 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("射撃スキル上昇***を獲得する", "Add Marksman Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 6 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("治癒スキル上昇***を獲得する", "Add Healing Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 7 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("瞑想スキル上昇***を獲得する", "Add Meditation Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 8 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("魔道具スキル上昇***を獲得する", "Add Magic Device Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 10 == 9 ) {
				list(0, listmax) = -5
				listmax++
				s = lang("魔力制御スキル上昇***を獲得する", "Add Magic Control Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 0 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("盾スキル上昇***を獲得する", "Add Shield Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 1 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("回避スキル上昇***を獲得する", "Add Evasion Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 2 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("罠の知識スキル上昇***を獲得する", "Add Disarm Trap Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 3 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("重装備スキル上昇***を獲得する", "Add Heavy Armor Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 4 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("中装備スキル上昇***を獲得する", "Add Medium Armor Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 5 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("軽装備スキル上昇***を獲得する", "Add Light Armor Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 6 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("隠密スキル上昇***を獲得する", "Add Stealth Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 7 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("見切りスキル上昇***を獲得する", "Add Greater Evasion Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 9 == 8 ) {
				list(0, listmax) = -9
				listmax++
				s = lang("魔力の限界スキル上昇***を獲得する", "Add Magic Capacity Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 0 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("採掘スキル上昇***を獲得する", "Add Mining Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 1 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("工作スキル上昇***を獲得する", "Add Carpentry Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 2 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("裁縫スキル上昇***を獲得する", "Add Tailoring Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 3 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("宝石細工スキル上昇***を獲得する", "Add Jeweler Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 4 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("栽培スキル上昇***を獲得する", "Add Gardening Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 5 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("料理スキル上昇***を獲得する", "Add Cooking Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 6 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("解剖学スキル上昇***を獲得する", "Add Anatomy Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 7 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("釣りスキル上昇***を獲得する", "Add Fishing Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 8 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("錬金術スキル上昇***を獲得する", "Add Alchemy Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 9 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("鍵開けスキル上昇***を獲得する", "Add Lock Picking Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 10 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("探知スキル上昇***を獲得する", "Add Detection Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 11 ) {
				list(0, listmax) = -8
				listmax++
				s = lang("自然鑑定スキル上昇***を獲得する", "Add Sense Quality Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 0 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("重量挙げスキル上昇***を獲得する", "Add Weight Lifting Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 1 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("窃盗スキル上昇***を獲得する", "Add Pickpocket Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 2 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("着衣水泳スキル上昇***を獲得する", "Add Swimming Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 3 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("読書スキル上昇***を獲得する", "Add Literacy Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 4 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("生化学スキル上昇***を獲得する", "Add Gene Engineer Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 5 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("暗記スキル上昇***を獲得する", "Add Memorization Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 6 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("信仰スキル上昇***を獲得する", "Add Faith Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 7 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("交渉スキル上昇***を獲得する", "Add Negotiation Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 8 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("投資スキル上昇***を獲得する", "Add Investing Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 9 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("演奏スキル上昇***を獲得する", "Add Performer Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 10 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("乗馬スキル上昇***を獲得する", "Add Riding Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 12 == 11 ) {
				list(0, listmax) = -6
				listmax++
				s = lang("旅歩きスキル上昇***を獲得する", "Add Traveling Skill Bonus")
				promptAdd s
			}
			if ( taisei \ 7 == 0 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("対神**を獲得する", "Add Damage against Gods")
				promptAdd s
			}
			if ( taisei \ 7 == 1 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("対不死者***を獲得する", "Add Damage against Undead")
				promptAdd s
			}
			if ( taisei \ 7 == 2 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("対竜***を獲得する", "Add Damage against Dragons")
				promptAdd s
			}
			if ( taisei \ 7 == 3 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("クリティカル上昇***を獲得する", "Add Critical Hit Chance")
				promptAdd s
			}
			if ( taisei \ 7 == 4 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("魔法威力上昇**を獲得する", "Add Enhance Spells")
				promptAdd s
			}
			if ( taisei \ 7 == 5 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("放射威力上昇***を獲得する", "Add Breath Skill")
				promptAdd s
			}
			if ( taisei \ 7 == 6 ) {
				list(0, listmax) = -7
				listmax++
				s = lang("完全貫通発生**を獲得する", "Add Piercing Attack Chance")
				promptAdd s
			}
			val = promptx, prompty, 400, 1
			gosub *prompt_key
			txtnew
			if ( rtval == (-1) ) {
				txt lang(itemname(ci) + "は不満そうに震えた。", itemname(ci) + " vibrates as if it is displeased.")
				taiseip = 0
				taisei = 0
			}
			else {
				if ( list(0, rtval) == (-1) ) {
					inv(INV_ITEM_LEVEL, ci) += 4
				}
				if ( list(0, rtval) == (-2) ) {
					taiseip = taisei \ 11
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_FIRE, 200, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_COLD, 200, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_LIGHTNING, 200, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_DARKNESS, 200, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_MIND, 200, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_POISON, 200, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_NETHER, 200, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_SOUND, 200, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_NERVE, 200, 0, 1
					}
					if ( taiseip == 9 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_CHAOS, 200, 0, 1
					}
					if ( taiseip == 10 ) {
						encadd ci, ENCHANT_RESISTANCE * EXT_ENCHANTMENT + SKILL_RES_MAGIC, 100, 0, 1
					}
				}
				if ( list(0, rtval) == (-3) ) {
					taiseip = taisei \ 11
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_FIRE, 200, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_COLD, 200, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_LIGHTNING, 200, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_DARKNESS, 200, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_MIND, 200, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_POISON, 200, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_NETHER, 200, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_SOUND, 200, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_NERVE, 200, 0, 1
					}
					if ( taiseip == 9 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_CHAOS, 200, 0, 1
					}
					if ( taiseip == 10 ) {
						encadd ci, ENCHANT_ELEMENTAL_DMG * EXT_ENCHANTMENT + SKILL_RES_MAGIC, 200, 0, 1
					}
				}
				if ( list(0, rtval) == (-4) ) {
					taiseip = taisei \ 10
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_STR, 500, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_CON, 500, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_DEX, 500, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_PER, 500, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_LER, 500, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_WIL, 500, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_MAG, 500, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_CHA, 500, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_SPD, 500, 0, 1
					}
					if ( taiseip == 9 ) {
						encadd ci, ENCHANT_ATTRIBUTE * EXT_ENCHANTMENT + SKILL_ATTR_LUC, 500, 0, 1
					}
				}
				if ( list(0, rtval) == (-5) ) {
					taiseip = taisei \ 10
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_EYE_OF_MIND, 450, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_CASTING, 450, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_DUAL_WIELD, 450, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_TWO_HAND, 450, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_TACTICS, 450, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MARKSMAN, 450, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_HEALING, 450, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MEDITATION, 450, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MAGIC_DEVICE, 450, 0, 1
					}
					if ( taiseip == 9 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_CONTROL_MAGIC, 450, 0, 1
					}
				}
				if ( list(0, rtval) == (-6) ) {
					taiseip = taisei \ 12
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_WEIGHT_LIFTING, 450, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_ACTIVE_PICKPOCKET, 450, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_SWIMMING, 450, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_LITERACY, 450, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_GENE_ENGINEER, 450, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MEMORIZATION, 450, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_FAITH, 450, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_NEGOTIATION, 450, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_INVESTING, 450, 0, 1
					}
					if ( taiseip == 9 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_PERFORMER, 450, 0, 1
					}
					if ( taiseip == 10 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_ACTIVE_RIDING, 450, 0, 1
					}
					if ( taiseip == 11 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_TRAVELING, 450, 0, 1
					}
				}
				if ( list(0, rtval) == (-9) ) {
					taiseip = taisei \ 9
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_SHIELD, 450, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_EVASION, 450, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_DISARM_TRAP, 450, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_HEAVY_ARMOR, 450, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MEDIUM_ARMOR, 450, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_LIGHT_ARMOR, 450, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_STEALTH, 450, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_GREATER_EVASION, 450, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MAGIC_CAPACITY, 450, 0, 1
					}
				}
				if ( list(0, rtval) == (-8) ) {
					taiseip = taisei \ 12
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_MINING, 450, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_CARPENTRY, 450, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_TAILORING, 450, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_JEWELER, 450, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_GARDENING, 450, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_COOKING, 450, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_ANATOMY, 450, 0, 1
					}
					if ( taiseip == 7 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_FISHING, 450, 0, 1
					}
					if ( taiseip == 8 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_ALCHEMY, 450, 0, 1
					}
					if ( taiseip == 9 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_LOCK_PICKING, 450, 0, 1
					}
					if ( taiseip == 10 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_DETECTION, 450, 0, 1
					}
					if ( taiseip == 11 ) {
						encadd ci, ENCHANT_SKILL * EXT_ENCHANTMENT + SKILL_NORMAL_SENSE_QUALITY, 450, 0, 1
					}
				}
				if ( list(0, rtval) == (-7) ) {
					taiseip = taisei \ 7
					if ( taiseip == 0 ) {
						encadd ci, ENCHANT_BANE_GOD, 80, 0, 1
					}
					if ( taiseip == 1 ) {
						encadd ci, ENCHANT_BANE_UNDEAD, 130, 0, 1
					}
					if ( taiseip == 2 ) {
						encadd ci, ENCHANT_BANE_DRAGON, 130, 0, 1
					}
					if ( taiseip == 3 ) {
						encadd ci, ENCHANT_CRIT_CHANCE, 130, 0, 1, 0, 1
					}
					if ( taiseip == 4 ) {
						encadd ci, ENCHANT_ENHANCE_SPELL, 80, 0, 1, 0, 1
					}
					if ( taiseip == 5 ) {
						encadd ci, ENCHANT_ENHANCE_BREATH, 130, 0, 1, 0, 1
					}
					if ( taiseip == 6 ) {
						encadd ci, ENCHANT_PIERCING_CHANCE, 80, 0, 1, 0, 1
					}
				}
				txtef COLOR_GREEN
				txt lang(itemname(ci) + "は嬉しげに震えた。", itemname(ci) + " vibrates as if it is pleased.")
				randomize inv(INV_ITEM_SUB_NAME, ci)
				exrand_randomize inv(INV_ITEM_SUB_NAME, ci)
				if ( inv(INV_ITEM_PARAM1, ci) >= 10 ) {
					txt lang("その力は次第に脅威になっている。", "Its power is becoming a threat.")
					encadd ci, ENCHANT_SUCK_BLOOD, 50
					if ( stat == 0 ) {
						inv(STARTING_INV_ITEM_ENCHANT + (15 - 1) * 2, ci) = 0
						txt lang(itemname(ci) + "はエンチャントを消した。", itemname(ci) + " removes an enchantment.")
						encadd ci, ENCHANT_SUCK_BLOOD, 50
						if ( stat == 0 ) {
							inv(STARTING_INV_ITEM_ENCHANT + (15 - 2) * 2, ci) = 0
							txt lang(itemname(ci) + "はさらにエンチャントを消した。", itemname(ci) + " removes an enchantment.")
						}
					}
				}
				inv(INV_ITEM_EXP, ci) = 0
				inv(INV_ITEM_GROWTH, ci)++
			}
		}
		taiseip = 0
		taisei = 0
		r1 = cc
		gosub *charaRefresh
		gosub *screen_draw
		goto *pc_turn
	}
	_switch_val = inv(INV_ITEM_EFFECT, ci)
	if ( _switch_val == EFFECT_MINE | _switch_sw ) {
		_switch_sw = 0
		x = cdata(CDATA_X, cc)
		y = cdata(CDATA_Y, cc)
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txt_cantusehere
			gosub *screen_draw
			goto *pc_turn
		}
		if ( map(x, y, 6) != 0 ) {
			txt lang("ここには置けない。", "You can't place it here.")
			goto *pc_turn
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		cell_featset x, y, 0, CELL_FEATURE_TRAP, CELL_SUB_FEATURE_TRAP_MINE, cc
		txt lang("地雷を設置した。", "You set up the mine.")
		snd SOUNDLIST_BUILD1
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_CHAIR | _switch_sw ) {
		_switch_sw = 0
		if ( inv_getowner(ci) != (-1) ) {
			txt lang("床に置かないと使えない。", "You need to put it on the ground.")
			gosub *screen_draw
			goto *pc_turn
		}
		txt lang("あなたは" + itemname(ci, 1) + "に座った。", "You sit on " + itemname(ci, 1) + ".")
		promptAdd lang("くつろぐ", "Relax."), "null", 0
		if ( inv(INV_ITEM_PARAM1, ci) != 1 ) {
			promptAdd lang("マイチェアにする", "It's my chair."), "null", 1
		}
		if ( inv(INV_ITEM_PARAM1, ci) != 2 ) {
			promptAdd lang("お客用のチェアにする", "It's for my guest."), "null", 2
		}
		if ( inv(INV_ITEM_PARAM1, ci) != 0 ) {
			promptAdd lang("誰でも座っていい", "It's free to use."), "null", 3
		}
		val = promptx, prompty, 260, 1
		gosub *prompt_key
		if ( stat == 0 ) {
			goto *act_use_SWEND1
		}
		if ( rtval == 0 ) {
			txt lang("あなたは存分にくつろいだ。", "You relax as much as you like.")
			goto *act_use_SWEND1
		}
		if ( rtval == 1 ) {
			txt lang(itemname(ci, 1) + "はあなた専用の席になった！", itemname(ci, 1) + " is your seat now.")
			inv(INV_ITEM_PARAM1, ci) = 1
			goto *act_use_SWEND1
		}
		if ( rtval == 2 ) {
			txt lang(itemname(ci, 1) + "は訪問者の席になった！", itemname(ci, 1) + " is used by your guests now.")
			inv(INV_ITEM_PARAM1, ci) = 2
			goto *act_use_SWEND1
		}
		if ( rtval == 3 ) {
			txt lang(itemname(ci, 1) + "は誰でも座っていい席になった！", itemname(ci, 1) + " can be used by anyone.")
			inv(INV_ITEM_PARAM1, ci) = 0
			goto *act_use_SWEND1
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_HOUSE_BOARD | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) != MAP_TYPE_HOME ) {
			txt_cantusehere
			gosub *screen_draw
			goto *pc_turn
		}
		screenupdate = -1
		gosub *screen_draw
		goto *com_home
	}
	if ( _switch_val == EFFECT_MIRROR | _switch_sw ) {
		_switch_sw = 0
		txt_targetwho
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc < MAX_CHARA_FOLLOWER ) {
					screenupdate = -1
					gosub *screen_draw
					ccbk = cc
					cc = tc
					gosub *com_mirror
					cc = ccbk
					f = 1
				}
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		gosub *screen_draw
		goto *pc_turn
	}
	if ( _switch_val == EFFECT_FIXITY_ANCHOR | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		txt lang("誰に使用させる？", "Who should use it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( map(x, y, 1) > 0 ) {
			tc = map(x, y, 1) - 1
		}
		else {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			txtselecttc 2
			repeat 2
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 0
			gosub *prompt_key
			if ( rtval == 1 ) {
				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
			}
		}
		if ( tc >= MAX_CHARA_FOLLOWER ) {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		snd SOUNDLIST_AMMO
		await 200
		snd SOUNDLIST_AMMO
		await 200
		snd SOUNDLIST_AMMO
		await 200
		snd SOUNDLIST_AMMO
		await 200
		addbuff tc, BUFF_SHOOTING_MODE, 25, 25
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_ELEMENTS_EYES | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		txt lang("誰に使用させる？", "Who should use it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( map(x, y, 1) > 0 ) {
			tc = map(x, y, 1) - 1
		}
		else {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			txtselecttc 2
			repeat 2
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 0
			gosub *prompt_key
			if ( rtval == 1 ) {
				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
			}
		}
		snd SOUNDLIST_ENC
		txtef COLOR_PURPLE
		txt lang("《汝等ノ求メルエレメントヲ叫ベ》", "< Shout the attribute you want >")
		txtseteyes 12
		repeat 12
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 160, 0
		gosub *prompt_key
		if ( rtval == 0 ) {
			txtef COLOR_PURPLE
			txt lang("《ソウカ…》", "< Oh... >")
			cdata(CDATA_ELEMENTS_EYES_ELE, tc) = 0
			goto *act_use_SWEND1
		}
		cdata(CDATA_ELEMENTS_EYES_ELE, tc) = rtval
		cdata(CDATA_ATTRIBUTE_ELE, tc) = cdata(CDATA_ELEMENTS_EYES_ELE, tc) - 1
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 11 ) {
			txtef COLOR_PURPLE
			txt lang("《 Magic 》", "< Magic >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 1 ) {
			txtef COLOR_PURPLE
			txt lang("《 Fire 》", "< Fire >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 2 ) {
			txtef COLOR_PURPLE
			txt lang("《 Cold 》", "< Cold >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 3 ) {
			txtef COLOR_PURPLE
			txt lang("《 Lightning 》", "< Lightning >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 4 ) {
			txtef COLOR_PURPLE
			txt lang("《 Darkness 》", "< Darkness >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 5 ) {
			txtef COLOR_PURPLE
			txt lang("《 Mind 》", "< Mind >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 6 ) {
			txtef COLOR_PURPLE
			txt lang("《 Poison 》", "< Poison >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 7 ) {
			txtef COLOR_PURPLE
			txt lang("《 Nether 》", "< Nether >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 8 ) {
			txtef COLOR_PURPLE
			txt lang("《 Sound 》", "< Sound >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 9 ) {
			txtef COLOR_PURPLE
			txt lang("《 Nerve 》", "< Nerve >")
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 10 ) {
			txtef COLOR_PURPLE
			txt lang("《 Chaos 》", "< Chaos >")
		}
		snd SOUNDLIST_SONIC
		txt lang(name(tc) + "の属性が変わった。", name(tc) + " changed " + his(tc, 1) + " elemental affinity.")
		snd SOUNDLIST_SONIC
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 11 ) {
			animeload ANIMATION_HEAL_FAST, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 1 ) {
			animeload ANIMATION_GENE, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 2 ) {
			animeload ANIMATION_HOLY, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 3 ) {
			animeload ANIMATION_SPORE, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 4 ) {
			animeload ANIMATION_RAGNA, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 5 ) {
			animeload ANIMATION_THUNDERCLAP, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 6 ) {
			animeload 27, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 7 ) {
			animeload ANIMATION_METEOR, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 8 ) {
			animeload ANIMATION_MP_BREATH, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 9 ) {
			animeload ANIMATION_GIGA, tc
		}
		if ( cdata(CDATA_ELEMENTS_EYES_ELE, tc) == 10 ) {
			animeload ANIMATION_NUCLEAR, tc
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_PIPE | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		txt lang("誰に使わせる？", "Who should use it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( map(x, y, 1) > 0 ) {
			tc = map(x, y, 1) - 1
		}
		else {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			txtselecttc 2
			repeat 2
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 0
			gosub *prompt_key
			if ( rtval == 1 ) {
				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
			}
		}
		if ( tc != CHARA_PLAYER & cdata(CDATA_DRUG_DEPENDENCE, tc) < 100 & cdata(CDATA_MASTER_SERVANT, tc) < 200 ) {
			txt lang("「駄目。絶対」", cnvtalk("Stop the drug!"))
			snd SOUNDLIST_FAIL1
			goto *act_use_SWEND1
		}
		item_separate ci
		txt lang(name(tc) + "は" + itemname(ci) + "を咥えた。", name(cc) + " smoke" + _s(tc) + " " + itemname(ci) + ".")
		repeat MAX_BLESSINGS + MAX_HEXES
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == 0 ) {
				break
			}
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_MELANCHOLY ) {
				delbuff tc, cnt
				continue cnt
			}
		loop
		snd SOUNDLIST_FIRE1
		if ( cdata(CDATA_DRUG_DEPENDENCE, tc) <= 0 ) {
			txt lang(" *げほげほ* ", " *cough* ")
		}
		else {
			txt lang(" *スパー* ", " *puff* ")
		}
		cdata(CDATA_POWER_GAUGE, tc) += 100
		if ( cdata(CDATA_POWER_GAUGE, tc) > 100 ) {
			if ( cdata(CDATA_SHIFT_FORM, tc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, tc) <= 0 | tc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, tc) < FIX_QUALITY_MIRACLE | tc <= MAX_CHARA_FOLLOWER) ) {
				cdata(CDATA_POWER_GAUGE, tc) = 100
			}
		}
		if ( cdata(CDATA_POWER_GAUGE, tc) > 200 ) {
			cdata(CDATA_POWER_GAUGE, tc) = 200
		}
		cdata(CDATA_DRUG_DEPENDENCE, tc) += 30
		toba = limit(cdata(CDATA_DRUG_DEPENDENCE, tc) / 3, 1, 100)
		txt lang(name(tc) + "は麻薬に" + toba + "％依存している。", name(tc) + " " + is(tc) + " " + toba + "% addicted to drugs.")
		modkarma CHARA_PLAYER, -10
		if ( cdata(CDATA_DRUG_DEPENDENCE, tc) > 300 ) {
			cdata(CDATA_DRUG_DEPENDENCE, tc) = 300
		}
		if ( cdata(CDATA_DRUG_DEPENDENCE, tc) < 0 ) {
			cdata(CDATA_DRUG_DEPENDENCE, tc) = 0
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		gosub *calcBurdenPc
		toba = 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_TOBACCO4 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == EFFECT_TOBACCO1 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == EFFECT_TOBACCO2 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == EFFECT_TOBACCO3 | _switch_sw ) {
		_switch_sw = 0
		_switch_sw++
	}
	if ( _switch_val == EFFECT_TOBACCO | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		txt lang("誰に使わせる？", "Who should use it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( map(x, y, 1) > 0 ) {
			tc = map(x, y, 1) - 1
		}
		else {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			txtselecttc 2
			repeat 2
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 0
			gosub *prompt_key
			if ( rtval == 1 ) {
				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
			}
		}
		if ( tc >= MAX_CHARA_FOLLOWER ) {
			txt lang("「いらん」", cnvtalk("No way."))
			snd SOUNDLIST_FAIL1
			goto *act_use_SWEND1
		}
		item_separate ci
		txt lang(name(tc) + "は" + itemname(ci) + "を咥えた。", name(cc) + " smoke" + _s(tc) + " " + itemname(ci) + ".")
		repeat MAX_BLESSINGS + MAX_HEXES
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == 0 ) {
				break
			}
			if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_DISTRACTED ) {
				delbuff tc, cnt
				continue cnt
			}
		loop
		if ( inv(INV_ITEM_ID, ci) != ITEM_ID_TOBACCO ) {
			snd SOUNDLIST_FIRE1
			if ( cdata(CDATA_TOBACCO_DEPENDENCE, tc) <= 0 ) {
				txt lang(" *げほげほ* ", " *cough* ")
			}
			else {
				txt lang(" *スパー* ", " *puff* ")
			}
			addbuff tc, BUFF_CONCENTRATION, (10 + inv(INV_ITEM_LEVEL, ci)) * sorg(SKILL_ATTR_PER, tc) / 2, (10 + inv(INV_ITEM_LEVEL, ci)) * 20
			cdata(CDATA_TOBACCO_DEPENDENCE, tc) += 20
			toba = limit(cdata(CDATA_TOBACCO_DEPENDENCE, tc) / 2, 1, 100)
			txt lang(name(tc) + "はタバコに" + toba + "％依存している。", name(tc) + " " + is(tc) + " " + toba + "% addicted to tobacco.")
			if ( cdata(CDATA_HUNGER, tc) < 10000 ) {
				cdata(CDATA_HUNGER, tc) += 1000
			}
			if ( tc == CHARA_PLAYER ) {
				if ( gdata(GDATA_SLEEP) >= 0 ) {
					gdata(GDATA_SLEEP) -= 5
				}
				gdata(GDATA_FLAG_SMOKING_FREQUENCY)++
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CIGARETTE ) {
					skillexp SKILL_ATTR_PER, tc, 3000 + inv(INV_ITEM_LEVEL, ci) * 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HAMAKI ) {
					skillexp SKILL_ATTR_DEX, tc, 3000 + inv(INV_ITEM_LEVEL, ci) * 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TOBACCO_PIPE ) {
					skillexp SKILL_ATTR_LER, tc, 3000 + inv(INV_ITEM_LEVEL, ci) * 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_KISERU ) {
					skillexp SKILL_ATTR_CHA, tc, 3000 + inv(INV_ITEM_LEVEL, ci) * 200
				}
			}
			else {
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CIGARETTE ) {
					skillexp SKILL_ATTR_PER, tc, 15000 + inv(INV_ITEM_LEVEL, ci) * 1000
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_HAMAKI ) {
					skillexp SKILL_ATTR_DEX, tc, 15000 + inv(INV_ITEM_LEVEL, ci) * 1000
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_TOBACCO_PIPE ) {
					skillexp SKILL_ATTR_LER, tc, 15000 + inv(INV_ITEM_LEVEL, ci) * 1000
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_KISERU ) {
					skillexp SKILL_ATTR_CHA, tc, 15000 + inv(INV_ITEM_LEVEL, ci) * 1000
				}
			}
		}
		else {
			txt lang(" *むしゃむしゃ* ", " *chomp* ")
			snd SOUNDLIST_EAT1
			if ( inv(INV_ITEM_LEVEL, ci) > 10 ) {
				cdata(CDATA_TOBACCO_DEPENDENCE, tc) -= inv(INV_ITEM_LEVEL, ci) - 10
			}
		}
		if ( cdata(CDATA_TOBACCO_DEPENDENCE, tc) > 200 ) {
			cdata(CDATA_TOBACCO_DEPENDENCE, tc) = 200
		}
		if ( cdata(CDATA_TOBACCO_DEPENDENCE, tc) < 0 ) {
			cdata(CDATA_TOBACCO_DEPENDENCE, tc) = 0
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		gosub *calcBurdenPc
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CIGARETTE ) {
			flt
			itemcreate -1, ITEM_ID_SUIGARA, cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0
		}
		toba = 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_FIREWORK | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_BOLT1
		snd SOUNDLIST_SHOTS
		await 1000
		animeid = ANIMATION_FIREWORK
		gosub *anime
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_ATOMIC_LAUNCHER | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		gosub *findLocation
		if ( stat != 1 ) {
			if ( stat == 0 ) {
				txt_cantsee
				gosub *screen_draw
			}
			goto *pc_turn
		}
		if ( chipm(CHIPM_ATTRIB, map(tlocx, tlocy, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
			txt lang("そこには撃てない。", "The location is blocked.")
			gosub *screen_draw
			goto *pc_turn
		}
		animeid = ANIMATION_NUCLEAR
		gosub *anime
		inv(INV_ITEM_NUM, ci)--
		gosub *calcBurdenPc
		repeat 40
			if ( cnt == 14 ) {
				snd SOUNDLIST_ATK_FIRE
			}
			await cfg_animewait + 20
		loop
		gdata(GDATA_FLAG_NUCLEAR_EXPLOSIONS)++
		range = 6
		ele = SKILL_RES_CHAOS
		aniref = range
		animeid = ANIMATION_BALL_NUKE
		anix = tlocx
		aniy = tlocy
		gosub *anime
		gosub *screen_draw
		repeat range * 2 + 1
			dy = tlocy - range + cnt
			if ( dy < 0 | dy >= mdata(MDATA_HEIGHT) ) {
				continue
			}
			repeat range * 2 + 1
				dx = tlocx - range + cnt
				if ( dx < 0 | dx >= mdata(MDATA_WIDTH) ) {
					continue
				}
				if ( dist(tlocx, tlocy, dx, dy) > range ) {
					continue
				}
				f = 0
				if ( map(dx, dy, 0) != 701 & map(dx, dy, 0) != 671 ) {
					map(dx, dy, 0) = 37
				}
				if ( map(dx, dy, 1) != 0 ) {
					tc = map(dx, dy, 1) - 1
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					dmg = 1000 + (sdata(SKILL_NORMAL_CARPENTRY, CHARA_PLAYER) + 50) / 5 * limit(sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + 50, 50, 1000) + sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) / 40 * sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER)
					dmghp tc, dmg, cc
				}
				mapitem_fire dx, dy
			loop
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_PANZERFAUST_X | _switch_sw ) {
		_switch_sw = 0
		inv(INV_ITEM_CHARGE, ci)++
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		if ( cdata(CDATA_TARGET, cc) == 0 ) {
			gosub *findTarget
			if ( stat == 0 ) {
				goto *act_use_SWEND1
			}
		}
		tc = cdata(CDATA_TARGET, cc)
		if ( dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > 6 | fov_los(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) == 0 ) {
			if ( cc == CHARA_PLAYER ) {
				msgdup++
				txt lang("範囲外だ。", "It's out of range.")
			}
			goto *act_use_SWEND1
		}
		if ( cdata(CDATA_RELATION, tc) >= 0 ) {
			gosub *com_confirmAttack
			if ( stat == 0 ) {
				goto *act_use_SWEND1
			}
		}
		tlocx = cdata(CDATA_X, tc)
		tlocy = cdata(CDATA_Y, tc)
		inv(INV_ITEM_CHARGE, ci)--
		if ( inv(INV_ITEM_CHARGE, ci) < 0 ) {
			inv(INV_ITEM_CHARGE, ci) = 0
		}
		item_stack CHARA_PLAYER, ci, 1
		animeid = ANIMATION_NUCLEAR
		gosub *anime
		aniref = 0
		animeid = ANIMATION_BALL
		anix = cdata(CDATA_X, tc)
		aniy = cdata(CDATA_Y, tc)
		gosub *anime
		cdata(CDATA_PROT_PENALTY, tc) = 3
		dmg = rnd(50) + sdata(SKILL_ATTR_PER, CHARA_PLAYER) * 2 + sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) / 40 * sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER)
		if ( dmg < 0 ) {
			dmg = 5
		}
		dmghp tc, dmg, cc
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_M202_SPECIAL | _switch_sw ) {
		_switch_sw = 0
		inv(INV_ITEM_CHARGE, ci)++
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			goto *act_use_SWEND1
		}
		gosub *findLocation
		if ( stat != 1 ) {
			if ( stat == 0 ) {
				txt_cantsee
				gosub *screen_draw
			}
			goto *pc_turn
		}
		if ( chipm(CHIPM_ATTRIB, map(tlocx, tlocy, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
			txt lang("そこには撃てない。", "The location is blocked.")
			gosub *screen_draw
			goto *pc_turn
		}
		animeid = ANIMATION_NUCLEAR
		gosub *anime
		aniref = 1
		animeid = ANIMATION_BALL_NUKE
		anix = tlocx
		aniy = tlocy
		gosub *anime
		gosub *screen_draw
		inv(INV_ITEM_CHARGE, ci)--
		if ( inv(INV_ITEM_CHARGE, ci) < 0 ) {
			inv(INV_ITEM_CHARGE, ci) = 0
		}
		item_stack CHARA_PLAYER, ci, 1
		efp = limit(sdata(SKILL_RES_FIRE, CHARA_PLAYER) * 2, 1, 5000) + sqrt(sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) + 1) * sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) * 2 + sdata(SKILL_ATTR_CON, CHARA_PLAYER) * 10
		p = 4, 2 + efp / 50
		snd SOUNDLIST_ATK_FIRE
		repeat 800
			x = rnd(p) + tlocx - rnd(p)
			y = rnd(p) + tlocy - rnd(p)
			f = 1
			if ( x < 0 | y < 0 | x >= mdata(MDATA_WIDTH) | y >= mdata(MDATA_HEIGHT) ) {
				f = 0
			}
			else {
				if ( chipm(CHIPM_ATTRIB, map(x, y, 0)) & CHIPM_ATTRIB_CANT_PASS ) {
					f = 0
				}
			}
			if ( dist(tlocx, tlocy, x, y) >= p ) {
				f = 0
			}
			if ( f == 0 ) {
				continue cnt
			}
			tcbk = tc
			if ( map(x, y, 1) != 0 ) {
				tc = map(x, y, 1) - 1
				if ( cc != tc ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						if ( gdata(GDATA_RIDER) == cc ) {
							if ( tc == CHARA_PLAYER ) {
								continue
							}
						}
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
						}
					}
					cdata(CDATA_ENVIRONMENT_EFFECT, tc) = ENVIRONMENT_EFFECT_FIRE
				}
			}
			tc = tcbk
			addmef x, y, 5, 24, rnd(30) + 30, efp, cc
			mapitem_fire x, y
		loop
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_NONE ) {
				continue
			}
			if ( cdata(CDATA_ENVIRONMENT_EFFECT, cnt) == ENVIRONMENT_EFFECT_FIRE ) {
				txt lang(name(cnt) + "は炎に包まれた。", name(cnt) + " was surrounded by flames.")
				cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
				hostileaction cc, cnt
				dmghp cnt, rnd(efp / 10 + 1) + efp / 2 + 1, DAMAGE_FROM_FIRE, SKILL_RES_FIRE, efp
				addbuff cnt, BUFF_ELEMENT_SCAR, 500, 5
			}
			cdata(CDATA_ENVIRONMENT_EFFECT, cnt) = ENVIRONMENT_EFFECT_NONE
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_TWIG | _switch_sw ) {
		_switch_sw = 0
		txt lang("火を起こした。", "You light a fire.")
		snd SOUNDLIST_FIRE1
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		gosub *calcBurdenPc
		flt
		itemcreate -1, ITEM_ID_CAMPFIRE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_JUICE_MIXER | _switch_sw ) {
		_switch_sw = 0
		invsubroutine = 1
		invctrl = 0
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 0 ) {
			goto *act_use_SWEND1
		}
		snd SOUNDLIST_BOLT1
		item_separate ci
		inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_ID, ci)
		inv(INV_ITEM_PARAM2, ci) = 0
		inv(INV_ITEM_ID, ci) = ITEM_ID_JUICE
		inv(INV_ITEM_LEVEL, ci) = 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		inv(INV_ITEM_PIC, ci) = xy2pic(19, 30)
		inv(INV_ITEM_WEIGHT, ci) = 100
		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_SAND
		inv(INV_ITEM_PARAM3, ci) = 0
		txt lang(itemname(ci) + "を作った。", "You made " + itemname(ci) + ".")
		item_stack CHARA_PLAYER, ci, 1
		gosub *calcBurdenPc
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_COOKING | _switch_sw ) {
		_switch_sw = 0
		efid = SKILL_NORMAL_COOKING
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_FISHING | _switch_sw ) {
		_switch_sw = 0
		efid = SKILL_NORMAL_FISHING
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_PERFORM | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_ROW_ACT, cc) == ACTION_NONE ) {
			if ( synccheck(cc, -1) ) {
				txt lang(name(cc) + "は" + itemname(ci) + "の演奏をはじめた。", name(cc) + " start" + _s(cc) + " to play " + itemname(ci) + ".")

				/********** ANNA CUSTOM - BEGINNING **********/

				EnsembleStart = 0

				/********** ANNA CUSTOM - ENDING **********/

			}
		}
		efid = SKILL_NORMAL_PERFORMER
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SNOW | _switch_sw ) {
		_switch_sw = 0
		if ( cc == CHARA_PLAYER ) {
			if ( inv(INV_ITEM_NUM, ci) < 5 ) {
				txt lang("雪が足りない…", "You need more snow.")
				gosub *screen_draw
				goto *pc_turn
			}
			removeitem ci, 5
		}
		flt
		itemcreate -1, ITEM_ID_SNOW_MAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		if ( synccheck(cc, -1) ) {
			snd SOUNDLIST_SNOW
			txt lang(name(cc) + "は雪だるまを作った！", name(cc) + " make" + _s(cc) + " a snow man!")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_TORCH | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_FIRE1
		if ( gdata(GDATA_LIGHT_SOURCE) == 0 ) {
			gdata(GDATA_LIGHT_SOURCE) = 1
			txt lang("松明を灯した。", "You light up the torch.")
		}
		else {
			gdata(GDATA_LIGHT_SOURCE) = 0
			txt lang("松明を消した。", "You put out the fire.")
		}
		r1 = CHARA_PLAYER
		gosub *charaRefresh
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_TRAIN | _switch_sw ) {
		_switch_sw = 0
		gosub *com_train
		if ( stat == 1 ) {
			goto *turn_end
		}
		else {
			gosub *screen_draw
			goto *pc_turn
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_STETHOSCOPE | _switch_sw ) {
		_switch_sw = 0
		txt lang("何に聴診器を当てる？", "Auscultate who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		if ( stat == 0 ) {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( map(x, y, 1) > 0 ) {
			tc = map(x, y, 1) - 1
		}
		else {
			txt_impossible
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			txtselecttc 2
			repeat 2
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 0
			gosub *prompt_key
			if ( rtval == 1 ) {
				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
			}
		}
		if ( tc == CHARA_PLAYER ) {
			txt lang(" *ドクン ドクン* ", "You blush.")
			gdata(GDATA_SCOPE) = 0
			goto *turn_end
		}
		if ( tc > CHARA_PLAYER & tc < MAX_CHARA_FOLLOWER ) {
			if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
				gdata(GDATA_SCOPE) = 0
				if ( cbit(CHARA_BIT_STETHOSCOPE, tc) == 1 ) {
					cbitmod CHARA_BIT_STETHOSCOPE, tc, 0
					txt lang(name(tc) + "から聴診器を外した。", "You no longer watch on " + his(tc) + " health.")
					goto *turn_end
				}
				txt lang("あなたは" + name(tc) + "に聴診器を当てた。", "You start to keep an eye on " + his(tc) + " health.")
				if ( cdata(CDATA_SEX, tc) == 1 ) {
					txt lang("" + name(tc) + "は顔を赤らめた。", name(tc) + " blush" + _s(tc, 1) + ".")
					txtmore
					txtef COLOR_BLUE
					txt lang("「キャー」", cnvtalk("Pervert!"))
				}
				cbitmod CHARA_BIT_STETHOSCOPE, tc, 1
				goto *turn_end
			}
		}
		txt_impossible
		gosub *screen_draw
		goto *pc_turn
	}
	if ( _switch_val == EFFECT_LEASH | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰を紐で結ぶ？", "Leash who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc == CHARA_PLAYER ) {
					txt lang("あなたは自分を紐でくくってみた…", "You leash yourself...")
				}
				else {
					if ( cbit(CHARA_BIT_LEASHED, tc) == 0 ) {
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							if ( rnd(5) == 0 ) {
								txt lang(name(tc) + "が激しく抵抗したため紐は切れた。", "The leash is cut as " + name(tc) + " resists.")
								inv(INV_ITEM_NUM, ci)--
								cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
								gosub *calcBurdenPc
								goto *act_use_SWEND1
							}
						}
						cbitmod CHARA_BIT_LEASHED, tc, 1
						txt lang("あなたは" + name(tc) + "を紐でくくりつけた。", "You leash " + name(tc) + ".")
						txtef COLOR_SKY_BLUE
						txt lang(name(tc) + "は呻き声を洩らした。「アン…♪」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("Pervert!"))
					}
					else {
						cbitmod CHARA_BIT_LEASHED, tc, 0
						txt lang("あなたは" + name(tc) + "にくくりつけた紐をほどいた。", "You unleash " + name(tc) + ".")
						txtef COLOR_SKY_BLUE
						txt lang(name(tc) + "は呻き声を洩らした。「はぁはぁ…」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("D-don't sto... N-nothing!"))
					}
				}
				animeload ANIMATION_FIZZLE, tc
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SANDBAG | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			txt lang("このエリアでは使えない。", "You can't use it in this area.")
			gosub *screen_draw
			goto *pc_turn
		}
		txt lang("誰を吊るす？", "Hang who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txt lang("タッグは吊るせない。", "Can't be hung while in a tag-team.")
					goto *pc_turn
				}
				if ( cdata(CDATA_HP, tc) >= cdata(CDATA_MAX_HP, tc) / 5 ) {
					txt lang("もっと弱らせないと吊るせない。", "The target needs to be weakened.")
					goto *pc_turn
				}
				if ( tc != CHARA_PLAYER ) {
					if ( tc < MAX_CHARA_FOLLOWER ) {
						txt lang("仲間を吊るすなんてとんでもない！", "Hanging your ally is a brutal idea!")
						goto *pc_turn
					}
				}
				if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
					txt lang("それは既に吊るされている。", "It's already hanged up.")
					goto *pc_turn
				}
				if ( tc == CHARA_PLAYER ) {
					txt lang("あなたは自分を吊るそうと思ったがやめた…", "You try to hang yourself but rethink...")
				}
				else {
					snd SOUNDLIST_BUILD1
					cbitmod CHARA_BIT_SANDBAG, tc, 1
					txt lang("あなたは" + name(tc) + "を吊るした。", "You hang " + name(tc) + " up.")
					txt lang(name(tc) + "は呻き声を洩らした。「アン…♪」", name(tc) + " gasp" + _s(tc) + ", " + cnvtalk("Pervert!"))
					animeload ANIMATION_FIZZLE, tc
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					gosub *calcBurdenPc
				}
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SOUL_SPINDLE | _switch_sw ) {
		_switch_sw = 0
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc == CHARA_PLAYER ) {
					txt_impossible
					goto *pc_turn
				}
				if ( inv(INV_ITEM_PARAM1, ci) == 0 ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						txt_impossible
						goto *act_use_SWEND1
					}
					if ( cdata(CDATA_IMPRESSION, tc) < 200 ) {
						txt lang(name(tc) + "はやんわりと断った。", name(tc) + " gently refuses.")
						goto *act_use_SWEND1
					}
					txt lang(name(tc) + "とあなたの間に、運命の糸が結ばれた。", "A thread of fate was tied between " + name(tc) + " and you.")
					snd SOUNDLIST_OFFER2
					inv(INV_ITEM_NUM, ci)--
					itemcreate -1, ITEM_ID_SOUL_SPINDLE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
					if ( stat ) {
						inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
						inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
					}
					inv(INV_ITEM_PARAM1, ci) = 100 + rnd(10000) + rnd(500) + rnd(2000)
					inv(INV_ITEM_PARAM2, ci) = 10000 + rnd(10000) + rnd(4000) + rnd(5000)
					cdata(CDATA_SPINDLE_COMBINATION_A, tc) = inv(INV_ITEM_PARAM1, ci)
					cdata(CDATA_SPINDLE_COMBINATION_B, tc) = inv(INV_ITEM_PARAM2, ci)
					if ( gdata(GDATA_SPINDLE_COMBINATION) == 0 ) {
						gdata(GDATA_SPINDLE_COMBINATION) = inv(INV_ITEM_PARAM2, ci) + inv(INV_ITEM_PARAM1, ci) + rnd(10)
					}
					inv(INV_ITEM_PARAM3, ci) = gdata(GDATA_SPINDLE_COMBINATION)
					goto *act_use_SWEND1
				}
				if ( inv(INV_ITEM_PARAM1, ci) != 0 ) {
					if ( gdata(GDATA_AREA) != AREA_SHOW_HOUSE ) {
						txt lang("それはもうショウルームでしか使えない。", "You can only use it in the showroom.")
						goto *act_use_SWEND1
					}
					if ( cdata(CDATA_SPINDLE_COMBINATION_A, tc) != inv(INV_ITEM_PARAM1, ci) | cdata(CDATA_SPINDLE_COMBINATION_B, tc) != inv(INV_ITEM_PARAM2, ci) ) {
						txt lang("組み合わせが違うようだ。", "The combination seems to be different.")
						goto *act_use_SWEND1
					}
					if ( inv(INV_ITEM_PARAM3, ci) == gdata(GDATA_SPINDLE_COMBINATION) ) {
						txt lang("まだ再会の時ではない。", "It is not the time of the reunion yet.")
						goto *act_use_SWEND1
					}
					f = get_freeally()
					if ( f == 0 ) {
						txt lang("仲間の最大数に達しているため、仲間にできない。", "Your party is already full. You can't invite someone anymore.")
						goto *act_use_SWEND1
					}
					inv(INV_ITEM_NUM, ci)--
					txt lang("全てを越えて、運命の糸が再び二人を結びつける…！", "Beyond all, red thread linking the two people again...")
					msg_halt
					rincana = 100
					rc = tc
					gosub *add_ally
					rincana = 0
					music = MUSICLIST_MCWEDDING
					gosub *music_play
					txtef COLOR_GREEN
					txt lang("魂の再会はここに成された。", "Reunion of the soul has been made.")
				}
			}
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SEASONING | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰に使う？", "Use on whom?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_RELATION, tc) == 10 | tc == CHARA_PLAYER ) {
					txt lang("…さすがにやめておこう。", "...You changed your mind.")
					goto *act_use_SWEND1
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BOTTLE_SOY_SAUCE ) {
					snd SOUNDLIST_WATER2
					await 30
					snd SOUNDLIST_WATER2
					await 30
					snd SOUNDLIST_WATER2
					await 30
					snd SOUNDLIST_WATER2
					txtef COLOR_YELLOW
					txt lang("下ごしらえとして" + name(tc) + "に頭から醤油をかけた。「やめろ」", "You sprinkle the soy sauce to head of " + name(tc) + " as mise en place, " + cnvtalk("Stop..."))
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BOTTLE_PEPPER ) {
					snd SOUNDLIST_GET1
					await 400
					snd SOUNDLIST_GET1
					txtef COLOR_YELLOW
					txt lang("下ごしらえとして" + name(tc) + "にコショウをふりかけた。「は…はっくしょん！」", "You sprinkle the pepper to " + name(tc) + " as mise en place, " + cnvtalk("Achoo!"))
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SACK_SUGAR ) {
					snd SOUNDLIST_BUSH1
					txtef COLOR_YELLOW
					txt lang("下ごしらえとして" + name(tc) + "に砂糖をぶちまけた。「甘っ！！」", "You dusted the sugar to " + name(tc) + " as mise en place, " + cnvtalk("Sweet!"))
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BOTTLE_SALT ) {
					snd SOUNDLIST_GET2
					await 400
					snd SOUNDLIST_GET2
					txtef COLOR_YELLOW
					txt lang("下ごしらえとして" + name(tc) + "に塩をすり込んだ。…" + name(tc) + "はわけがわからないといった顔をしている。", "You rubbed into him the salt as mise en place..." + name(tc) + " is stumped.")
				}
				if ( cdata(CDATA_BRUSH_LEVEL, tc) <= 3 ) {
					cdata(CDATA_BRUSH_LEVEL, tc)++
				}
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				f = 1
				if ( cdatan(CDATAN_RACE, tc) == "snail" ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_RED
						txtmore
						txt lang("こうかはてきめんだ！", "..." + name(tc) + " start" + _s(tc) + " to melt.")
					}
					if ( cdata(CDATA_HP, tc) > 10 ) {
						dmghp tc, cdata(CDATA_HP, tc) - rnd(10), DAMAGE_FROM_ACID
					}
					else {
						dmghp tc, rnd(20000), DAMAGE_FROM_ACID
					}
				}
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_FIRST_AID | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰を治療する？", "Who will be treated?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				txtef COLOR_BLUE
				txt lang("キットを使い" + name(cc) + "は応急手当を行った。", name(cc) + " used the first aid kit.")
				animeid = ANIMATION_HEAL
				gosub *anime
				healhp tc, (sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + sdata(SKILL_ATTR_DEX, cc)) / 4 * (sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + sdata(SKILL_ATTR_DEX, cc)) / 10 + 10
				if ( cdata(CDATA_CONDITION_POISON, tc) != 0 ) {
					cdata(CDATA_CONDITION_POISON, tc) = cdata(CDATA_CONDITION_POISON, tc) / 8 + 1
				}
				if ( cdata(CDATA_CONDITION_BLIND, tc) != 0 ) {
					cdata(CDATA_CONDITION_BLIND, tc) = cdata(CDATA_CONDITION_BLIND, tc) / 8 + 1
				}
				if ( cdata(CDATA_CONDITION_PARALYZE, tc) != 0 ) {
					cdata(CDATA_CONDITION_PARALYZE, tc) = cdata(CDATA_CONDITION_PARALYZE, tc) / 8 + 1
				}
				if ( cdata(CDATA_CONDITION_DRUNK, tc) != 0 ) {
					cdata(CDATA_CONDITION_DRUNK, tc) = cdata(CDATA_CONDITION_DRUNK, tc) / 8 + 1
				}
				if ( cdata(CDATA_CONDITION_BLEED, tc) != 0 ) {
					cdata(CDATA_CONDITION_BLEED, tc) = cdata(CDATA_CONDITION_BLEED, tc) / 8 + 1
				}
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_AMMO_BOX | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰に使用させる？", "Who should use it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					txt_impossible
					goto *act_use_SWEND1
				}
				cibk = ci
				cost = 0
				inv_getheader tc
				repeat invrange, invhead
					if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
						continue
					}
					if ( refitem(inv(INV_ITEM_ID, cnt), DBSPEC_TYPE) != FILTER_AMMO ) {
						continue
					}
					ci = cnt
					repeat RANGE_INV_ITEM_ENCHANT
						if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
							break
						}
						enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci)
						i = enc / EXT_ENCHANTMENT
						if ( i != 0 ) {
							enc = enc \ EXT_ENCHANTMENT
							if ( i == ENCHANT_AMMO ) {
								i = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, ci) \ EXT_ENCHANTMENT_AMMO, inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, ci) / EXT_ENCHANTMENT_AMMO
								if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) \ EXT_ENCHANTMENT == ENCHANT_AMMO_TIME_STOP ) {
									continue
								}
								cost += (i(1) - i) * (50 + enc * enc * 10)
								inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, ci) = i(1) * EXT_ENCHANTMENT_AMMO + i(1)
							}
						}
					loop
				loop
				f = 1
				if ( cost == 0 ) {
					txt lang("補充できる矢弾がない。", "There is no ammo needing replenishment.")
					goto *act_use_SWEND1
				}
				animeload ANIMATION_HEAL_FAST, tc
				snd SOUNDLIST_AMMO
				txtef COLOR_GREEN
				txt lang("矢弾を補充した！", "Ammo was supplied!")
				inv(INV_ITEM_NUM, cibk)--
				cell_refresh inv(INV_ITEM_X, cibk), inv(INV_ITEM_Y, cibk)
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SHIFT_CORE | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰に使用させる？", "Who should use it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc >= MAX_CHARA_FOLLOWER ) {
					txt_impossible
					goto *act_use_SWEND1
				}
				if ( cdata(CDATA_POWER_GAUGE, tc) < 100 ) {
					txt_impossible
					goto *act_use_SWEND1
				}
				if ( cdata(CDATA_SHIFT_FORM, tc) > SHIFT_FORM_NONE ) {
					repeat MAX_BLESSINGS + MAX_HEXES
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == 0 ) {
							break
						}
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_FORM_SHIFT_ALPHA ) {
							delbuff tc, cnt
							continue cnt
						}
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_FORM_SHIFT_BETA ) {
							delbuff tc, cnt
							continue cnt
						}
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_FORM_SHIFT_GAMMA ) {
							delbuff tc, cnt
							continue cnt
						}
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_FORM_SHIFT_DELTA ) {
							delbuff tc, cnt
							continue cnt
						}
						if ( cdata(STARTING_CDATA_BUFF + cnt * ARRAY_CDATA_BUFF, tc) == BUFF_FORM_SHIFT_OMEGA ) {
							delbuff tc, cnt
							continue cnt
						}
					loop
					r1 = tc
					gosub *charaRefresh
				}
				if ( cdata(CDATA_SHIFT_FORM, tc) == SHIFT_FORM_NONE ) {
					hikae = cdatan(CDATAN_NAME, tc)
					cdatan(CDATAN_NAME, tc) = cdatan(CDATAN_FORM_SHIFT_NAME, tc)
					cdatan(CDATAN_FORM_SHIFT_NAME, tc) = hikae
					if ( cdatan(CDATAN_NAME, tc) == "" ) {
						cdatan(CDATAN_NAME, tc) = cdatan(CDATAN_FORM_SHIFT_NAME, tc) + lang("／アルター", "-altered")
					}
					hikae = cdata(CDATA_PORTRAIT, tc)
					cdata(CDATA_PORTRAIT, tc) = cdata(CDATA_FORM_SHIFT_PORTRAIT, tc)
					cdata(CDATA_FORM_SHIFT_PORTRAIT, tc) = hikae
					hikae = cdata(CDATA_FACE, tc)
					cdata(CDATA_FACE, tc) = cdata(CDATA_FORM_SHIFT_FACE, tc)
					cdata(CDATA_FORM_SHIFT_FACE, tc) = hikae
					hikae = pcc(PCC_HAIR, tc)
					pcc(PCC_HAIR, tc) = cdata(CDATA_FORM_SHIFT_PCC_HAIR, tc)
					cdata(CDATA_FORM_SHIFT_PCC_HAIR, tc) = hikae
					hikae = pcc(PCC_SUB_HAIR, tc)
					pcc(PCC_SUB_HAIR, tc) = cdata(CDATA_FORM_SHIFT_PCC_SUB_HAIR, tc)
					cdata(CDATA_FORM_SHIFT_PCC_SUB_HAIR, tc) = hikae
					hikae = pcc(PCC_BODY, tc)
					pcc(PCC_BODY, tc) = cdata(CDATA_FORM_SHIFT_PCC_BODY, tc)
					cdata(CDATA_FORM_SHIFT_PCC_BODY, tc) = hikae
					hikae = pcc(PCC_CLOTH, tc)
					pcc(PCC_CLOTH, tc) = cdata(CDATA_FORM_SHIFT_PCC_CLOTH, tc)
					cdata(CDATA_FORM_SHIFT_PCC_CLOTH, tc) = hikae
					hikae = pcc(PCC_PANTS, tc)
					pcc(PCC_PANTS, tc) = cdata(CDATA_FORM_SHIFT_PCC_PANTS, tc)
					cdata(CDATA_FORM_SHIFT_PCC_PANTS, tc) = hikae
					hikae = pcc(PCC_ETC1, tc)
					pcc(PCC_ETC1, tc) = cdata(CDATA_FORM_SHIFT_PCC_ETC1, tc)
					cdata(CDATA_FORM_SHIFT_PCC_ETC1, tc) = hikae
					hikae = pcc(PCC_ETC2, tc)
					pcc(PCC_ETC2, tc) = cdata(CDATA_FORM_SHIFT_PCC_ETC2, tc)
					cdata(CDATA_FORM_SHIFT_PCC_ETC2, tc) = hikae
					hikae = pcc(PCC_ETC3, tc)
					pcc(PCC_ETC3, tc) = cdata(CDATA_FORM_SHIFT_PCC_ETC3, tc)
					cdata(CDATA_FORM_SHIFT_PCC_ETC3, tc) = hikae
					hikae = pcc(PCC_EYE, tc)
					pcc(PCC_EYE, tc) = cdata(CDATA_FORM_SHIFT_PCC_EYE, tc)
					cdata(CDATA_FORM_SHIFT_PCC_EYE, tc) = hikae
					hikae = pcc(PCC_RIDE, tc)
					pcc(PCC_RIDE, tc) = cdata(CDATA_FORM_SHIFT_PCC_RIDE, tc)
					cdata(CDATA_FORM_SHIFT_PCC_RIDE, tc) = hikae
					if ( pcc(PCC_BODY, tc) == 0 ) {
						pcc(PCC_BODY, tc) = 1
					}
					hikae = cdata(CDATA_PIC, tc)
					cdata(CDATA_PIC, tc) = cdata(CDATA_FORM_SHIFT_PIC, tc)
					cdata(CDATA_FORM_SHIFT_PIC, tc) = hikae
					if ( cdata(CDATA_PIC, tc) == xy2pic(0, 0) ) {
						cdata(CDATA_PIC, tc) = xy2pic(1, 0)
					}
				}
				if ( cbit(CHARA_BIT_PCC, tc) == 1 ) {
					gsel 4
					pos 0, 0
					picload exedir + "graphic\\face1" + devfile + ".bmp", 1
					gsel 0
					ccbk = cc
					cc = tc
					gosub *com_portrait
					cc = ccbk
				}
				else {
					ccbk = cc
					cc = tc
					gosub *com_shape_change
					cc = ccbk
				}
				if ( tc == CHARA_PLAYER ) {
					gdata(GDATA_TEMPORARY_FLAGS) = 7777
				}
				customtalk tc, DBMODE_FLAVOR_SHIFT
				gosub *convert_word
				if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
					txt lang("「変身！」", cnvtalk("Transform!")), lang("「フォームアップ！」", cnvtalk("Form Up!")), lang("「ドレスアップ！」", cnvtalk("Dress Up!")), lang("「トランスフォーム！」", cnvtalk("Transform!"))
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_ALPHA_SHIFT_CORE ) {
					addbuff tc, BUFF_FORM_SHIFT_ALPHA, 200, 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BETA_SHIFT_CORE ) {
					addbuff tc, BUFF_FORM_SHIFT_BETA, 200, 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GAMMA_SHIFT_CORE ) {
					addbuff tc, BUFF_FORM_SHIFT_GAMMA, 200, 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_DELTA_SHIFT_CORE ) {
					addbuff tc, BUFF_FORM_SHIFT_DELTA, 200, 200
				}
				if ( inv(INV_ITEM_ID, ci) == ITEM_ID_OMEGA_SHIFT_CORE ) {
					addbuff tc, BUFF_FORM_SHIFT_OMEGA, 150, 150
				}
				if ( tc == CHARA_PLAYER ) {
					gdata(GDATA_TEMPORARY_FLAGS) = 0
				}
				animeid = ANIMATION_GENE
				anic = tc
				gosub *anime
				cdata(CDATA_POWER_GAUGE, tc) -= 100
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_UNDEAD_FUSION | _switch_sw ) {
		_switch_sw = 0
		if ( cdata(CDATA_POWER_GAUGE, CHARA_PLAYER) < 25 ) {
			txt_nothinghappens
			goto *act_use_SWEND1
		}
		txtsetnecrom 5
		repeat 5
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 300, 0
		gosub *prompt_key
		if ( rtval == 4 ) {
			goto *pc_turn
		}
		dead1 = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			if ( tc < MAX_CHARA_FOLLOWER ) {
				continue
			}
			if ( cbit(CHARA_BIT_NECRO, tc) != 1 ) {
				continue
			}
			if ( rtval == 0 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_KING ) {
					dead1 = -2
				}
			}
			if ( rtval == 1 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_QUEEN ) {
					dead1 = -2
				}
			}
			if ( rtval == 2 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JACK ) {
					dead1 = -2
				}
			}
			if ( rtval == 3 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JOKER ) {
					dead1 = -2
				}
			}
		loop
		if ( dead1 == (-2) ) {
			txt lang("それは1体しか使役できない。", "You can not control more than one.")
			goto *act_use_SWEND1
		}
		dead1 = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( tc < MAX_CHARA_FOLLOWER ) {
				continue
			}
			if ( cbit(CHARA_BIT_NECRO, tc) != 1 ) {
				continue
			}
			if ( rtval == 0 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE ) {
					dead1 = tc
				}
			}
			if ( rtval == 1 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAT_ZOMBIE ) {
					dead1 = tc
				}
			}
			if ( rtval == 2 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_WARRIOR ) {
					dead1 = tc
				}
			}
			if ( rtval == 3 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_LICH ) {
					dead1 = tc
				}
			}
		loop
		if ( dead1 == (-1) ) {
			txt lang("視界内に素材が存在しない。", "You look around and find nothing.")
			goto *act_use_SWEND1
		}
		dead2 = -1
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( tc < MAX_CHARA_FOLLOWER ) {
				continue
			}
			if ( cbit(CHARA_BIT_NECRO, tc) != 1 ) {
				continue
			}
			if ( rtval == 0 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_DRAGON_ZOMBIE ) {
					dead2 = tc
				}
			}
			if ( rtval == 1 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_MUMMY ) {
					dead2 = tc
				}
			}
			if ( rtval == 2 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON ) {
					dead2 = tc
				}
			}
			if ( rtval == 3 ) {
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_NECRO_DOLL ) {
					dead2 = tc
				}
			}
		loop
		if ( dead2 == (-1) ) {
			txt lang("視界内に素材が存在しない。", "You look around and find nothing.")
			goto *act_use_SWEND1
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_CAT_ZOMBIE ) {
			necrop = 2
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_ZOMBIE ) {
			necrop = 3
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_MUMMY ) {
			necrop = 4
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_SKELETON_WARRIOR ) {
			necrop = 5
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_LICH ) {
			necrop = 6
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_NECRO_DOLL ) {
			necrop = 7
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_DRAGON_ZOMBIE ) {
			necrop = 8
		}
		if ( cdata(CDATA_ID, dead1) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON ) {
			necrop = 9
		}
		necrop3 = cdata(CDATA_CHARA_PIC, dead1)
		flt
		itemcreate -1, ITEM_ID_COFFIN_OF_NECROMANCY, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		inv(INV_ITEM_PARAM1, ci) = necrop
		inv(INV_ITEM_PARAM2, ci) = cdata(CDATA_FORM_SHIFT_PIC, dead1)
		inv(INV_ITEM_WEIGHT, ci) += necrop * 1000
		inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + inv(INV_ITEM_PARAM3, ci) * 24
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		inv(INV_ITEM_KNOWN, ci) = ITEM_KNOWN_NECRO
		inv(INV_ITEM_CHARA_PIC, ci) = necrop3
		chara_vanquish dead1
		gosub *screen_draw
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_CAT_ZOMBIE ) {
			necrop = 2
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_ZOMBIE ) {
			necrop = 3
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_MUMMY ) {
			necrop = 4
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_SKELETON_WARRIOR ) {
			necrop = 5
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_LICH ) {
			necrop = 6
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_NECRO_DOLL ) {
			necrop = 7
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_DRAGON_ZOMBIE ) {
			necrop = 8
		}
		if ( cdata(CDATA_ID, dead2) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON ) {
			necrop = 9
		}
		necrop3 = cdata(CDATA_CHARA_PIC, dead2)
		flt
		itemcreate -1, ITEM_ID_COFFIN_OF_NECROMANCY, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		inv(INV_ITEM_PARAM1, ci) = necrop
		inv(INV_ITEM_PARAM2, ci) = cdata(CDATA_FORM_SHIFT_PIC, dead2)
		inv(INV_ITEM_WEIGHT, ci) += necrop * 1000
		inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + inv(INV_ITEM_PARAM3, ci) * 24
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		inv(INV_ITEM_KNOWN, ci) = ITEM_KNOWN_NECRO
		inv(INV_ITEM_CHARA_PIC, ci) = necrop3
		chara_vanquish dead2
		gosub *screen_draw
		txtef COLOR_RED
		txt lang(" *死者融合*　", " *Necro Fusion* ")
		if ( rtval == 0 ) {
			p = 878
		}
		if ( rtval == 1 ) {
			p = 877
		}
		if ( rtval == 2 ) {
			p = 876
		}
		if ( rtval == 3 ) {
			p = 875
		}
		necrolv = sdata(SKILL_NORMAL_ANATOMY, CHARA_PLAYER) + sdata(SKILL_NORMAL_ALCHEMY, CHARA_PLAYER)
		if ( necrolv > gdata(GDATA_DEEPEST_LEVEL) * 3 / 2 ) {
			necrolv = gdata(GDATA_DEEPEST_LEVEL) * 3 / 2
		}
		flt
		initlv = necrolv
		novoidlv = 1
		fixlv = FIX_QUALITY_GOOD
		characreate -1, p, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		cdata(CDATA_RELATION, rc) = 10
		cdata(CDATA_RELATION_ORG, rc) = 10
		cbitmod CHARA_BIT_NECRO, rc, 1
		cdatan(CDATAN_NAME, rc) += " Lv" + cdata(CDATA_LEVEL, rc)
		snd SOUNDLIST_CURSE3
		animeid = ANIMATION_GENE
		anic = 0
		gosub *anime
		cdata(CDATA_POWER_GAUGE, CHARA_PLAYER) -= 25
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_TAMERS_WHIP | _switch_sw ) {
		_switch_sw = 0
		txt_targetwho
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc == CHARA_PLAYER ) {
					txt_impossible
					goto *pc_turn
				}
				if ( cdata(CDATA_RELATION, tc) == (-3) ) {
					txt lang("敵対していて調教どころではない。", "You can not train the enemy.")
					goto *pc_turn
				}
				if ( cdata(CDATA_ID, tc) == CREATURE_ID_JURE | cdata(CDATA_ID, tc) == CREATURE_ID_BLESSED_JURE ) {
					repeat MAX_CHARA_TOTAL
						if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
							continue
						}
						if ( cdata(CDATA_ID, cnt) == CREATURE_ID_ROVID ) {
							snd SOUNDLIST_AMMO
							txt lang(cdatan(CDATAN_NAME, cnt) + "「叩きたいのなら私を叩きなさい！」", cdatan(CDATAN_NAME, cnt) + " says: " + cnvtalk("If you want to hit someone, hit me instead!"))
							goto *act_use_SWEND1
						}
					loop
				}
				txtsettamer 6
				repeat 6
					promptAdd s(cnt), key_select(cnt)
				loop
				val = promptx, prompty, 300, 0
				gosub *prompt_key
				if ( rtval == 5 ) {
					goto *pc_turn
				}
				if ( cdata(CDATA_MASTER_SERVANT2, tc) == 0 ) {
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_CUPID_OF_DEATH | cdata(CDATA_ID, tc) == CREATURE_ID_CUPID_OF_LOVE | cdata(CDATA_ID, tc) == CREATURE_ID_DOG | cdata(CDATA_ID, tc) == CREATURE_ID_DEMON ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = -5
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAMOUFLAGED_IMP | cdata(CDATA_ID, tc) == CREATURE_ID_M_GIRL ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = -10
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_ANGEL | cdata(CDATA_ID, tc) == CREATURE_ID_SERAPH | cdata(CDATA_ID, tc) == CREATURE_ID_DOMINION ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = 5
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_ARASIEL | cdata(CDATA_ID, tc) == CREATURE_ID_LULWY | cdata(CDATA_ID, tc) == CREATURE_ID_DEVASTATE_LULWY | cdata(CDATA_ID, tc) == CREATURE_ID_WHITE_YOUNG_LADY ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = 10
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_NERES_THE_AMNESIAC ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = 7
					}
				}
				if ( rtval == 4 ) {
					if ( cbit(CHARA_BIT_SANDBAG, tc) ) {
						txt_impossible
						goto *act_use_SWEND1
					}
					cdata(CDATA_MASTER_SERVANT2, tc) += 1
					if ( cdata(CDATA_MASTER_SERVANT2, tc) == 0 ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = 1
					}
					if ( cdata(CDATA_MASTER_SERVANT2, tc) >= 10 ) {
						cdata(CDATA_MASTER_SERVANT2, tc) = 10
					}
					if ( map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4) != 0 ) {
						cell_itemlist cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
						f = 0
						repeat listmax
							p = list(0, cnt)
							if ( inv(INV_ITEM_ID, p) == ITEM_ID_WOODEN_HORSE ) {
								txtef COLOR_RED
								txt name(CHARA_PLAYER) + lang("に三角木馬が食い込んだ！", " is impaled by the triangular wooden horse!")
								if ( cdata(CDATA_MASTER_SERVANT2, tc) < 10 ) {
									cdata(CDATA_MASTER_SERVANT2, tc) += 1
								}
								if ( cdata(CDATA_MASTER_SERVANT2, tc) == 0 ) {
									cdata(CDATA_MASTER_SERVANT2, tc) = 1
								}
								break
							}
						loop
					}
					if ( cdata(CDATA_MASTER_SERVANT2, tc) <= (-5) ) {
						if ( jp ) {
							txtef COLOR_SKY_BLUE
							txt name(tc) + "はなんだか残念そうだ…。", "「ぶってもらいたいのは" + _ore(3) + "なのに…」", "「あの…次は" + _ore(3) + "にも" + _tanomu(3) + "」"
						}
					}
					if ( cdata(CDATA_MASTER_SERVANT2, tc) > (-5) & cdata(CDATA_MASTER_SERVANT2, tc) < 5 ) {
						customtalk tc, DBMODE_FLAVOR_INSULT2
						gosub *convert_word
						if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
							if ( jp ) {
								txtef COLOR_RED
								txt name(tc) + "は戸惑いながら鞭であなたを軽く叩いた。", "「なんだかちょっとゾクゾクする…」", "「こ、これでいいの" + _kana(3) + "」", "「痛そうだからちょっと加減する" + _na(3) + "」"
							}
						}
					}
					if ( cdata(CDATA_MASTER_SERVANT2, tc) >= 5 & cdata(CDATA_MASTER_SERVANT2, tc) < 10 ) {
						customtalk tc, DBMODE_FLAVOR_INSULT2
						gosub *convert_word
						if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
							if ( jp ) {
								txtef COLOR_RED
								txt name(tc) + "はうっすらと嗜虐的な笑みを浮かべた。", "「ヘンタイにはこれでも足りない" + _nda(1) + "」", "「さぁ、" + _ore(3) + "への服従を示してもら" + _u(3) + "」", "「まだご褒美が足りない" + _noka(3) + "？」"
							}
						}
					}
					if ( cdata(CDATA_MASTER_SERVANT2, tc) == 10 ) {
						customtalk tc, DBMODE_FLAVOR_INSULT2
						gosub *convert_word
						if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
							if ( jp ) {
								txtef COLOR_RED
								txt name(tc) + "は無言であなたに鞭を浴びせた。", name(tc) + "は無表情で機械的に鞭を振り下ろした。", "「" + _kimi(3) + "の親は可哀想" + _da(3) + "」", "「そうやって、いつまでうずくまってるの" + _kana(3) + "？」"
							}
						}
					}
					animeload ANIMATION_STARS, CHARA_PLAYER
					snd SOUNDLIST_PUNISH1
					snd SOUNDLIST_ARROW1
					f = 1
				}
				if ( rtval == 2 ) {
					cdata(CDATA_TONE, tc) = cdata(CDATA_TONE, tc) + 1
					if ( cdata(CDATA_TONE_SEX, tc) == 1 ) {
						if ( cdata(CDATA_TONE, tc) >= 7 ) {
							cdata(CDATA_TONE, tc) = 0
							cdata(CDATA_TONE_SEX, tc) = 2
						}
					}
					else {
						if ( cdata(CDATA_TONE, tc) >= 7 ) {
							cdata(CDATA_TONE, tc) = 0
							cdata(CDATA_TONE_SEX, tc) = 1
						}
					}
					txtef COLOR_YELLOW
					txt lang("「わ、わかった" + _yo(3) + "！" + _ore(3) + "はこういう喋り方でどう" + _kana(3) + "？」", cnvtalk("I-I get it! How about I talk like this?"))
					f = 1
				}
				if ( rtval < 2 | rtval == 3 ) {
					if ( tc < MAX_CHARA_FOLLOWER ) {
						if ( cdata(CDATA_ROW_ACT, tc) == ACTION_EAT ) {
							if ( cdata(CDATA_ACTION_PERIOD, tc) > 0 ) {
								cdata(CDATA_ROW_ACT, tc) = ACTION_NONE, 0
								txtmore
								gosub *cell_info
							}
						}
					}
					if ( rtval == 3 ) {
						hostileaction CHARA_PLAYER, tc
					}
					if ( rtval == 0 ) {
						if ( cdata(CDATA_TAMER_WHIP_EAT, tc) == 1 ) {
							cdata(CDATA_TAMER_WHIP_EAT, tc) = 0
						}
						else {
							cdata(CDATA_TAMER_WHIP_EAT, tc) = 1
						}
					}
					if ( rtval == 1 ) {
						if ( cdata(CDATA_TAMER_WHIP_PICKUP, tc) == 1 ) {
							cdata(CDATA_TAMER_WHIP_PICKUP, tc) = 0
						}
						else {
							cdata(CDATA_TAMER_WHIP_PICKUP, tc) = 1
						}
					}
					if ( rtval == 0 & cdata(CDATA_TAMER_WHIP_EAT, tc) == 1 | (rtval == 1 & cdata(CDATA_TAMER_WHIP_PICKUP, tc) != 0) | rtval == 3 ) {
						txt lang("あなたは鞭を振り下ろした。", "You whip " + name(tc) + ".")
						animeload ANIMATION_STARS, tc
						snd SOUNDLIST_PUNISH1
						snd SOUNDLIST_ARROW1
						cdata(CDATA_MASTER_SERVANT2, tc) -= 1
						if ( cdata(CDATA_MASTER_SERVANT2, tc) == 0 ) {
							cdata(CDATA_MASTER_SERVANT2, tc) = -1
						}
						if ( cdata(CDATA_MASTER_SERVANT2, tc) <= (-10) ) {
							cdata(CDATA_MASTER_SERVANT2, tc) = -10
						}
						if ( map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 4) != 0 ) {
							cell_itemlist cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
							f = 0
							repeat listmax
								p = list(0, cnt)
								if ( inv(INV_ITEM_ID, p) == ITEM_ID_WOODEN_HORSE ) {
									txtef COLOR_RED
									txt name(tc) + lang("に三角木馬が食い込んだ！", " is impaled by the triangular wooden horse!")
									cdata(CDATA_MASTER_SERVANT2, tc) -= 1
									if ( cdata(CDATA_MASTER_SERVANT2, tc) == 0 ) {
										cdata(CDATA_MASTER_SERVANT2, tc) = -1
									}
									if ( cdata(CDATA_MASTER_SERVANT2, tc) <= (-10) ) {
										cdata(CDATA_MASTER_SERVANT2, tc) = -10
									}
									break
								}
							loop
						}
						if ( cdata(CDATA_MASTER_SERVANT2, tc) >= 5 ) {
							customtalk tc, DBMODE_FLAVOR_INSULT
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								if ( jp ) {
									txtef COLOR_RED
									txt name(tc) + "は反抗的にあなたをにらみつけた。", name(tc) + "は信じられないといった表情で呆然としている…。", "「ッ！" + _ore(3) + "にこんなことをして、どうなるかわかってるの" + _kana(3) + "！」", "「あぐっ！？…ふん、この程度" + _ka(3) + "？」"
								}
							}
						}
						if ( cdata(CDATA_MASTER_SERVANT2, tc) > (-5) & cdata(CDATA_MASTER_SERVANT2, tc) < 5 ) {
							customtalk tc, DBMODE_FLAVOR_DISCIPLINE
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								if ( jp ) {
									txtef COLOR_SKY_BLUE
									txt name(tc) + "は涙を浮かべて痛みに耐えた。", name(tc) + "は痛みと恐怖でがくがくと震えている…。", "「" + name(CHARA_PLAYER) + "、怖い" + _yo(3) + "…」", "「何か悪いことした" + _kana(3) + "？」"
								}
							}
						}
						if ( cdata(CDATA_MASTER_SERVANT2, tc) <= (-5) & cdata(CDATA_MASTER_SERVANT2, tc) > (-10) ) {
							customtalk tc, DBMODE_FLAVOR_DISCIPLINE2
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								if ( jp ) {
									txtef COLOR_SKY_BLUE
									txt name(tc) + "は泣きながらも微かに笑みを浮かべた。", name(tc) + "は我慢することの快感に戸惑っている。", "「なんだか、身体が熱い…」", "「あ…！」"
								}
							}
						}
						if ( cdata(CDATA_MASTER_SERVANT2, tc) == (-10) ) {
							customtalk tc, DBMODE_FLAVOR_DISCIPLINE2
							gosub *convert_word
							if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
								if ( jp ) {
									txtef COLOR_SKY_BLUE
									txt name(tc) + "はだらしない表情を浮かべている。", name(tc) + "はあなたの与える痛みに溺れている…。", "「まだ…満足してない" + _yo(3) + "？」", "「あひっ♪」"
								}
							}
							if ( spact(SKILL_SPACT_BLAME_PAIN - STARTING_SKILL_SPACT) == 0 ) {
								spact(SKILL_SPACT_BLAME_PAIN - STARTING_SKILL_SPACT) = 1
								txtmore
								txtef COLOR_YELLOW
								txt lang("あなたは「" + skillname(SKILL_SPACT_BLAME_PAIN) + "」の能力を得た。", "You have learned a new ability, " + skillname(SKILL_SPACT_BLAME_PAIN) + ".")
							}
						}
					}
					else {
						customtalk tc, DBMODE_FLAVOR_DISCIPLINE_OFF
						gosub *convert_word
						if ( gdata(GDATA_CUSTOM_TALK) == 100 ) {
							txtef COLOR_SKY_BLUE
							txt lang(name(tc) + "はホッと胸をなでおろした。", name(tc) + " gasp" + _s(tc) + " \"Don't stop!\"")
						}
					}
					f = 1
				}
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_COFFIN | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_ARENA | mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txt_nothinghappens
			goto *act_use_SWEND1
		}
		np = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) == 10 ) {
				np++
			}
		loop
		if ( np > 15 ) {
			txt lang("これ以上は同時に使役できない。", "You can not control more than 15 monsters.")
			goto *act_use_SWEND1
		}
		p = CREATURE_ID_CAT_ZOMBIE
		if ( inv(INV_ITEM_PARAM1, ci) == 3 ) {
			p = CREATURE_ID_ZOMBIE
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 4 ) {
			p = CREATURE_ID_MUMMY
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 5 ) {
			p = CREATURE_ID_SKELETON_WARRIOR
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 6 ) {
			p = CREATURE_ID_LICH
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 7 ) {
			p = CREATURE_ID_NECRO_DOLL
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 8 ) {
			p = CREATURE_ID_DRAGON_ZOMBIE
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 9 ) {
			p = CREATURE_ID_DEAD_EYES_BLOOD_DRAGON
		}
		necrolv = (sdata(SKILL_NORMAL_ANATOMY, CHARA_PLAYER) + sdata(SKILL_NORMAL_ALCHEMY, CHARA_PLAYER)) * (inv(INV_ITEM_PARAM1, ci) + 5) / 14
		if ( necrolv > gdata(GDATA_DEEPEST_LEVEL) * 3 / 2 ) {
			necrolv = gdata(GDATA_DEEPEST_LEVEL) * 3 / 2
		}
		if ( inv(INV_ITEM_PARAM2, ci) != 0 ) {
			necrolv += 5
		}
		necrop3 = 0
		if ( inv(INV_ITEM_CHARA_PIC, ci) == xy2pic(1, 0) ) {
			necrop3 = 1
		}
		necrop2 = inv(INV_ITEM_PARAM2, ci)
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		flt
		initlv = necrolv
		novoidlv = 1
		fixlv = FIX_QUALITY_GOOD
		characreate -1, p, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
		cdata(CDATA_RELATION, rc) = 10
		cdata(CDATA_RELATION_ORG, rc) = 10
		cbitmod CHARA_BIT_NECRO, rc, 1
		cdata(CDATA_FORM_SHIFT_PIC, rc) = necrop2
		cdatan(CDATAN_NAME, rc) += " Lv" + cdata(CDATA_LEVEL, rc)
		if ( necrop3 == 0 ) {
			if ( necrop2 >= 1800 ) {
				cdata(CDATA_PIC, rc) = necrop2
			}
			if ( necrop2 >= 12000 & necrop2 < 18000 ) {
				cdata(CDATA_PIC, rc) = necrop2 - 12000
			}
		}
		else {
			if ( necrop2 >= 2800 ) {
				cdata(CDATA_PIC, rc) = necrop2
				cdata(CDATA_CHARA_PIC, rc) = xy2pic(1, 0)
			}
			if ( necrop2 > 13000 & necrop2 < 19000 ) {
				cdata(CDATA_PIC, rc) = necrop2 - 13000
				cdata(CDATA_CHARA_PIC, rc) = xy2pic(1, 0)
			}
		}
		necrop2 = 0
		snd SOUNDLIST_CURSE3
		txt lang("闇と共に棺からアンデッドが這いずり出てきた。", "An undead monster creeps out from the coffin.")
		if ( spact(SKILL_SPACT_NECRO_FORCE - STARTING_SKILL_SPACT) == 0 ) {
			spact(SKILL_SPACT_NECRO_FORCE - STARTING_SKILL_SPACT) = 1
			txtmore
			txtef COLOR_YELLOW
			txt lang("あなたは「" + skillname(SKILL_SPACT_NECRO_FORCE) + "」の能力を得た。", "You have learned a new ability, " + skillname(SKILL_SPACT_NECRO_FORCE) + ".")
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_DD_CEMETERY_KEY | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txtnew
			txt_globalarea
			goto *act_use_SWEND1
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_POTION_RACK ) {
			inv(INV_ITEM_CHARGE, ci) = 10
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BREAD_DISPLAY ) {
			inv(INV_ITEM_CHARGE, ci) = 11
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_LARGE_BOOKSHELF | inv(INV_ITEM_ID, ci) == ITEM_ID_OLD_BOOKSHELF | inv(INV_ITEM_ID, ci) == ITEM_ID_CRAFT_BOOK_SHELF | inv(INV_ITEM_ID, ci) == ITEM_ID_BOOKSHELF ) {
			inv(INV_ITEM_CHARGE, ci) = 12
		}
		goto *act_open
	}
	if ( _switch_val == EFFECT_GROUND_BAIT | _switch_sw ) {
		_switch_sw = 0
		txt lang("どこに餌を撒く？", "Where do you sprinkle the bait?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( chipm(CHIPM_ROLE, map(x, y, 0)) != MAP_CHIP_ROLE_WATER ) {
				txt lang("水に撒こう。", "Let's sprinkle it on water.")
				goto *act_use_SWEND1
			}
			inv(INV_ITEM_NUM, ci)--
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			snd SOUNDLIST_BUSH1
			if ( mapfoodtypefind(x, y, 6) != (-1) ) {
				ci = mapfoodtypefind(x, y, 6)
				item_separatefish ci
				if ( stat != (-1) ) {
					kaiwa = rnd(3)
					if ( kaiwa == 0 ) {
						txt lang(itemname(ci) + "は餌をのんびり食べている…。", itemname(ci) + " is leisurely eating the bait...")
					}
					if ( kaiwa == 1 ) {
						txt lang(itemname(ci) + "は餌を食べるのに夢中だ。", itemname(ci) + " is entranced in eating bait.")
					}
					if ( kaiwa == 2 ) {
						txt lang(itemname(ci) + "は餌を一口で飲み込んだ！", itemname(ci) + " swallowed the bait whole!")
					}
					if ( inv(INV_ITEM_LEVEL, ci) < 15 ) {
						inv(INV_ITEM_LEVEL, ci)++
					}
					await 500
					snd SOUNDLIST_WATER2
				}
			}
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_ENCOUNTER_CANCELLER | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_CARD1
		txt lang(itemname(ci) + "を周囲に散布した。", "You scatter" + _s(cc) + " " + itemname(ci) + " around.")
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		gdata(STARTING_GDATA_FLAG + 375) = 100
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_XMAS_CAKE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_COMPLETE1
		animeload 66, cc
		txt lang(name(cc) + "はケーキを取り出した。", name(cc) + " take" + _s(cc) + " the cake out of the box.")
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		repeat MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, cnt) > 60 ) {
				cdata(CDATA_CONDITION_DIM, cnt) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, cnt) = 0
			cdata(CDATA_CONDITION_SUFFOCATION, cnt) = 0
			cdata(CDATA_CONDITION_PARALYZE, cnt) = 0
			cc = cnt
			if ( cnt != CHARA_PLAYER ) {
				tc = CHARA_PLAYER
				efid = SKILL_SPACT_SHADOW_STEP
				gosub *effect
			}
			if ( cdata(CDATA_IN_TAGTEAM, cc) != 1 ) {
				gosub *eat_meal_xmas_cake
			}
			if ( cdata(CDATA_IN_TAGTEAM, cc) == (-1) ) {
				cc = cdata(CDATA_TAGTEAM_PARTNER, cc)
				gosub *eat_meal_xmas_cake
			}
		loop
		cc = CHARA_PLAYER
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_PICNIC_BASKET | _switch_sw ) {
		_switch_sw = 0
		gdata(GDATA_FLAG_PICNIC_MULTIPLIER) = inv(INV_ITEM_LEVEL, ci)
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		txt lang(name(cc) + "はバスケット内の料理を広げた。", name(cc) + " take" + _s(cc) + " food out from the basket.")
		flt
		itemcreate -1, ITEM_ID_LARGE_EMPTY_BASKET, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		repeat MAX_CHARA_FOLLOWER
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_DIM, cnt) > 60 ) {
				cdata(CDATA_CONDITION_DIM, cnt) = 59
			}
			cdata(CDATA_CONDITION_SLEEP, cnt) = 0
			cdata(CDATA_CONDITION_SUFFOCATION, cnt) = 0
			cdata(CDATA_CONDITION_PARALYZE, cnt) = 0
			cc = cnt
			if ( cnt != CHARA_PLAYER ) {
				tc = CHARA_PLAYER
				efid = SKILL_SPACT_SHADOW_STEP
				gosub *effect
			}
			if ( cdata(CDATA_IN_TAGTEAM, cc) != 1 ) {
				gosub *eat_meal
			}
			if ( cdata(CDATA_IN_TAGTEAM, cc) == (-1) ) {
				cc = cdata(CDATA_TAGTEAM_PARTNER, cc)
				gosub *eat_meal
			}
		loop
		cc = CHARA_PLAYER
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_ASTRAL_LIGHT_PEN | _switch_sw ) {
		_switch_sw = 0
		txt_targetwho
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cbit(CHARA_BIT_NECRO, tc) == 1 ) {
					undlv = 150
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_KING ) {
						undlv = 150
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_QUEEN ) {
						undlv = 140
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JACK ) {
						undlv = 130
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JOKER ) {
						undlv = 120
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON ) {
						undlv = 107
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_DRAGON_ZOMBIE ) {
						undlv = 65
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_NECRO_DOLL ) {
						undlv = 40
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_LICH ) {
						undlv = 20
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_WARRIOR ) {
						undlv = 12
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_MUMMY ) {
						undlv = 14
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE ) {
						undlv = 8
					}
					if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAT_ZOMBIE ) {
						undlv = 4
					}
					if ( cdata(CDATA_LEVEL, CHARA_PLAYER) < undlv / 2 ) {
						txt lang("レベルが足りない。", "Your level is insufficient.")
						goto *pc_turn
					}
				}
				else {
					if ( cdata(CDATA_LEVEL, CHARA_PLAYER) < cdata(CDATA_LEVEL, tc) / 2 ) {
						txt lang("レベルが足りない。", "Your level is insufficient.")
						goto *pc_turn
					}
				}
				if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
					txt_cantusehere
					goto *pc_turn
				}
				if ( tc < MAX_CHARA_FOLLOWER | (cbit(CHARA_BIT_LIVESTOCK, tc) == 1 & (gdata(GDATA_AREA) == AREA_DOJO | adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_DISCARDED_RANCH)) ) {
					txt lang("その相手には使えない。", "You can't use it on that opponent.")
					goto *pc_turn
				}
				if ( cdata(CDATA_QUALITY, tc) < FIX_QUALITY_MIRACLE & cdata(CDATA_ROLE, tc) == ROLE_NONE & cbit(CHARA_BIT_NECRO, tc) == 0 ) {
					txt lang("その相手には使えない。", "You can't use it on that opponent.")
					goto *pc_turn
				}
				if ( cdata(CDATA_IMPRESSION, tc) < 200 ) {
					txt lang(name(tc) + "に拒絶された。", name(tc) + " was rejected.")
					goto *pc_turn
				}
				astink = limit(cdata(CDATA_LEVEL, tc) / 10, 1, 200)
				if ( cbit(CHARA_BIT_NECRO, tc) == 1 ) {
					astink = limit(undlv / 10, 1, 200)
				}
				if ( mat(36) < astink ) {
					txt lang("魔法のインクが足りない。" + astink + "個は必要だ。", "You do not have enough Magic Ink. You need " + astink + ".")
					goto *pc_turn
				}
				txtef COLOR_RED
				txt lang("発動には魔法のインクを" + astink + "個消費する。効果を発動する？", "It will cost you " + astink + " Magic Ink. Activate the effect?")
				promptYesNo
				if ( rtval == 0 ) {
					matdelmain 36, astink
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					txt lang(name(tc) + "の存在が分裂した！", name(tc) + " split" + _s(tc) + "!")
					animeid = ANIMATION_GENE
					anic = 0
					gosub *anime
					p = cdata(CDATA_ID, tc)
					flt
					novoidlv = 1
					characreate -1, p, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
					cdata(CDATA_SEX, rc) = cdata(CDATA_SEX, tc)
					cdata(CDATA_PIC, rc) = cdata(CDATA_PIC, tc)
					cdata(CDATA_CHARA_PIC, rc) = cdata(CDATA_CHARA_PIC, tc)
					cdata(CDATA_PORTRAIT, rc) = cdata(CDATA_PORTRAIT, tc)
					cdata(CDATA_QUALITY, rc) = cdata(CDATA_QUALITY, tc)
					cdatan(CDATAN_NAME, rc) = "" + name(tc)
					cdata(CDATA_IMPRESSION, rc) = cdata(CDATA_IMPRESSION, tc)
					cdata(CDATA_HEIGHT, rc) = cdata(CDATA_HEIGHT, tc)
					cdata(CDATA_WEIGHT, rc) = cdata(CDATA_WEIGHT, tc)
					cdata(CDATA_AGE, rc) = cdata(CDATA_AGE, tc)
					cdata(CDATA_GOD, rc) = cdata(CDATA_GOD, tc)
					evold = lang(" Lv", " Lv") + int(cdata(CDATA_LEVEL, tc))
					if ( strmid(cdatan(CDATAN_NAME, rc), -1, strlen(evold)) == evold ) {
						cdatan(CDATAN_NAME, rc) = strmid(cdatan(CDATAN_NAME, rc), 0, strlen(cdatan(CDATAN_NAME, rc)) - strlen(evold))
					}
					wishally = 100
					gosub *add_ally
					f = 1
				}
				else {
					goto *pc_turn
				}
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_STONE_MASK | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰に被らせる？", "Put on who?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc != CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						txt_impossible
						goto *pc_turn
					}
				}
				txt lang("新しい種族は？", "What's the new race?")
				val = (windoww - 220) / 2 + inf_screenx, winposy(90), 12, 1, 0
				inputlog = ""
				input_mode = 0
				gosub *prompt_word
				if ( inputlog == "" ) {
					txt lang("やっぱりやめた。", "You changed your mind.")
					goto *act_use_SWEND1
				}
				else {
					cdatan(CDATAN_CUSTOM_RACE, tc) = "" + inputlog
					txt lang(cdatan(CDATAN_NAME, tc) + "は「" + cdatan(CDATAN_CUSTOM_RACE, tc) + "」に生まれ変わった。", "Race of " + cdatan(CDATAN_NAME, tc) + " change to <" + cdatan(CDATAN_CUSTOM_RACE, tc) + ">.")
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					animeload ANIMATION_FIZZLE, tc
					f = 1
				}
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_CRAFT_REPAIR_KIT | _switch_sw ) {
		_switch_sw = 0
		cibk = ci
		invsubroutine = 1
		invctrl = 23, 15
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			saiseiseimode = 0
			if ( inv(INV_ITEM_ATTACK, ci) == 0 & inv(INV_ITEM_DAMAGE, ci) == 0 & inv(INV_ITEM_DV, ci) == 0 & inv(INV_ITEM_PV, ci) == 0 & inv(INV_ITEM_DICE2, ci) == 0 ) {
				txt_nothinghappens
				goto *act_use_SWEND1
			}
			oldcol = inv(INV_ITEM_COL, ci)
			oldweight = inv(INV_ITEM_WEIGHT, ci)
			saiseiseimode = 100
			s = itemname(ci, 1, 1)
			fixmaterial = inv(INV_ITEM_MATERIAL, ci)
			gosub *remake_material
			inv(INV_ITEM_WEIGHT, ci) = oldweight
			inv(INV_ITEM_COL, ci) = oldcol
			saiseiseimode = 0
			snd SOUNDLIST_BUILD1
			await 600
			snd SOUNDLIST_BUILD1
			await 600
			snd SOUNDLIST_DING3
			txt lang(name(cc) + "の" + s + "は" + itemname(ci, 1) + "に変化した。", name(cc) + your(cc) + " " + s + " transforms into " + itemname(ci, 1) + ".")
			ci = cibk
			inv(INV_ITEM_NUM, ci)--
			if ( ci >= RANGE_INV2 ) {
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			}
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_WONDER_BODY_FORMER | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_FLAG_CAN_USE_WONDER_BODY_FORMER) != 140 ) {
			txt_nothinghappens
			goto *pc_turn
		}
		txt lang("誰に使う？", "Use on whom?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc != CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						txt_impossible
						goto *pc_turn
					}
				}
				txt lang("獲得する部位は？", "What body part do you want to acquire?")
				txtplusbody 10
				repeat 10
					promptAdd s(cnt), key_select(cnt)
				loop
				val = promptx, prompty, 200, 0
				gosub *prompt_key
				if ( rtval == 0 ) {
					goto *pc_turn
				}
				r1 = tc
				repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
					if ( cdata(cnt, r1) != 0 ) {
						continue
					}
					if ( rtval == 1 ) {
						cdata(cnt, r1) = EQUIP_SLOT_HEAD * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_HEAD) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_HEAD) + "!")
							break
						}
					}
					if ( rtval == 2 ) {
						cdata(cnt, r1) = EQUIP_SLOT_NECK * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_NECK) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_NECK) + "!")
							break
						}
					}
					if ( rtval == 3 ) {
						cdata(cnt, r1) = EQUIP_SLOT_BACK * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_BACK) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_BACK) + "!")
							break
						}
					}
					if ( rtval == 4 ) {
						cdata(cnt, r1) = EQUIP_SLOT_BODY * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_BODY) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_BODY) + "!")
							break
						}
					}
					if ( rtval == 5 ) {
						cdata(cnt, r1) = EQUIP_SLOT_HAND * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_HAND) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_HAND) + "!")
							break
						}
					}
					if ( rtval == 6 ) {
						cdata(cnt, r1) = EQUIP_SLOT_RING * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_RING) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_RING) + "!")
							break
						}
					}
					if ( rtval == 7 ) {
						cdata(cnt, r1) = EQUIP_SLOT_ARM * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_ARM) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_ARM) + "!")
							break
						}
					}
					if ( rtval == 8 ) {
						cdata(cnt, r1) = EQUIP_SLOT_WAIST * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_WAIST) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_WAIST) + "!")
							break
						}
					}
					if ( rtval == 9 ) {
						cdata(cnt, r1) = EQUIP_SLOT_LEG * EXT_EQUIP_SLOTS
						if ( cm ) {
							break
						}
						else {
							txt lang(name(r1) + "は新たな" + bodyn(EQUIP_SLOT_LEG) + "を獲得した！", name(r1) + " grow" + _s(r1) + " a new " + bodyn(EQUIP_SLOT_LEG) + "!")
							break
						}
					}
					break
				loop
				gosub *calcBodyFix
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				animeload ANIMATION_FIZZLE, tc
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_CLEANING_DOLL | _switch_sw ) {
		_switch_sw = 0
		f = get_freeally()
		if ( f == 0 ) {
			txt_nothinghappens
			goto *act_use_SWEND1
		}
		if ( cc != CHARA_PLAYER & cc < MAX_CHARA_FOLLOWER ) {
			txt_nothinghappens
			goto *act_use_SWEND1
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CLEANING_DOLL ) {
			txt lang("機械音とともに人形が動き出した。どうやらロボットだったらしい。", "The doll began to move with a mechanical sound. It looks like it was a robot.")
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SMALL_STONE_GOLEM | inv(INV_ITEM_ID, ci) == ITEM_ID_SMALL_WOODEN_GOLEM ) {
			cdata(CDATA_MP, CHARA_PLAYER) = (cdata(CDATA_MP, CHARA_PLAYER) + 1) * 8 / 10
			txt lang("ゴーレムが起動した。", "The golem is activated.")
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BISQUE_DOLL ) {
			cdata(CDATA_MP, CHARA_PLAYER) = (cdata(CDATA_MP, CHARA_PLAYER) + 1) * 8 / 10
			txt lang("人形が動き出した。", "The doll began to move.")
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CLEANING_DOLL ) {
			flt
			novoidlv = 1
			fixlv = FIX_QUALITY_GOOD
			characreate MAX_CHARA_NC, CREATURE_ID_PRO_JET, -3, 0
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SMALL_STONE_GOLEM ) {
			flt
			novoidlv = 1
			fixlv = FIX_QUALITY_GOOD
			characreate MAX_CHARA_NC, CREATURE_ID_SMALL_STONE_GOLEM, -3, 0
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SMALL_WOODEN_GOLEM ) {
			flt
			novoidlv = 1
			fixlv = FIX_QUALITY_GOOD
			characreate MAX_CHARA_NC, CREATURE_ID_SMALL_WOODEN_GOLEM, -3, 0
		}
		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BISQUE_DOLL ) {
			flt
			novoidlv = 1
			fixlv = FIX_QUALITY_GOOD
			characreate MAX_CHARA_NC, CREATURE_ID_BISQUE_DOLL, -3, 0
		}
		rc = MAX_CHARA_NC
		gosub *add_ally
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_INSIGHT_LENS | _switch_sw ) {
		_switch_sw = 0
		txt_targetwho
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( tc == CHARA_PLAYER & cc == CHARA_PLAYER | cc == gdata(GDATA_RIDER) ) {
					if ( gdata(GDATA_RIDER) != 0 ) {
						tc = gdata(GDATA_RIDER)
					}
				}
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				snd SOUNDLIST_ENC
				animeload ANIMATION_CHAOS_CHILD, cc
				csctrl = 4
				snd SOUNDLIST_POP2
				cc = tc
				gosub *com_charainfo
				cc = CHARA_PLAYER
			}
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_NINE_GOD_SIGN | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_PRAY1
		txtef COLOR_GREEN
		txt lang(godname(cdata(CDATA_GOD, CHARA_PLAYER)) + "への信仰の深さ：" + cdata(CDATA_PIETY, CHARA_PLAYER) + "/" + sdata(SKILL_NORMAL_FAITH, CHARA_PLAYER) * 100 + "、祈りチャージ：" + limit((cdata(CDATA_PRAY, CHARA_PLAYER) + 1) / 10, 0, 100) + "％ ", "Piety: " + cdata(CDATA_PIETY, CHARA_PLAYER) + "/" + sdata(SKILL_NORMAL_FAITH, CHARA_PLAYER) * 100 + " Pray Charge: " + limit((cdata(CDATA_PRAY, CHARA_PLAYER) + 1) / 10, 0, 100) + "%")
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_CHOCO_KIT | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_MONTH) != 2 | gdata(GDATA_FLAG_CHOCOLATE_KIT_LIMIT) >= 10 ) {
			txt lang("次の2月を待とう。", "You have to wait until next February.")
			goto *act_use_SWEND1
		}
		if ( rnd(8) == 0 ) {
			music = MUSICLIST_MCBOSS3
			gosub *music_play
		}
		else {
			music = MUSICLIST_MCARENA
			gosub *music_play
		}
		txtef COLOR_GREEN
		txt lang("おいしいチョコレートを作ろう！まずはどうしようか。", "Let's make some delicious chocolate! What shall we do first?")
		txtsetchocoword 3
		repeat 3
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 310, 0
		gosub *prompt_key
		if ( rtval == 0 ) {
			snd SOUNDLIST_ATK_FIRE
		}
		if ( rtval == 1 ) {
			snd SOUNDLIST_EAT1
			txtef COLOR_YELLOW
			txt lang("それなりにおいしかった。", "It was delicious by itself.")
			inv(INV_ITEM_NUM, ci)--
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			cdata(CDATA_HUNGER, CHARA_PLAYER) += 750
			gosub *music_play
			goto *act_use_SWEND1
		}
		if ( rtval == 2 ) {
			txtef COLOR_RED
			txt lang("考えただけでも面倒なので作るのをやめた。", "I gave up making it since just thinking about it was troublesome.")
			gosub *music_play
			goto *act_use_SWEND1
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		dbg_skipevent = 1
		gdata(GDATA_HOUR)++
		gosub *advance_hour
		dbg_skipevent = 0
		txtef COLOR_GREEN
		txt lang("チョコレートを刻んで、テンパリングしながら湯煎で溶かした！次はどうしようか。", "I've stirred the chocolate in hot water until it melted! What should we do next?")
		snd SOUNDLIST_ATK_POISON
		txtsetchocoword2 3
		repeat 3
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 310, 0
		gosub *prompt_key
		if ( rtval == 1 ) {
			snd SOUNDLIST_DRINK1
			txtef COLOR_RED
			txt lang("あつつ！", "It is too hot!")
			txtef COLOR_YELLOW
			txt lang("…甘くておいしい！", "...It was sweet and delicious.")
			cdata(CDATA_HUNGER, CHARA_PLAYER) += 750
			dmghp CHARA_PLAYER, cdata(CDATA_MAX_HP, CHARA_PLAYER) / 10, DAMAGE_FROM_CHOCO
			gosub *music_play
			goto *act_use_SWEND1
		}
		if ( rtval == 2 ) {
			snd SOUNDLIST_WEB
			txtef COLOR_RED
			txt lang("あつつ！", "It is too hot!")
			snd SOUNDLIST_WEB
			txtef COLOR_YELLOW
			txt lang("あなたは全身チョコまみれになった。", "Your body was completely covered with chocolate.")
			snd SOUNDLIST_WEB
			dmghp CHARA_PLAYER, cdata(CDATA_MAX_HP, CHARA_PLAYER) / 10, DAMAGE_FROM_CHOCO
			gdata(GDATA_FLAG_CHOCOLATE_KIT_YOURSELF) = 1
			gosub *music_play
			goto *act_use_SWEND1
		}
		txtef COLOR_GREEN
		txt lang("チョコレートを型に流し込んだ！固まるまでに最後の仕上げをしよう。", "Pour the chocolate into the mold! Let's make the finishing touches until it hardens.")
		txtsetchocoword3 6
		repeat 6
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 310, 0
		gosub *prompt_key
		if ( rtval == 0 ) {
			snd SOUNDLIST_ATK_MIND
			animeload ANIMATION_GOLDENSTORM, CHARA_PLAYER
			chop = 4
		}
		if ( rtval == 1 ) {
			snd SOUNDLIST_CURSE3
			animeload ANIMATION_CRUSH, CHARA_PLAYER
			chop = 2
		}
		if ( rtval == 2 ) {
			chop = 5
		}
		if ( rtval == 3 ) {
			txtef COLOR_YELLOW
			txt lang("巨大なトリュフチョコレートができた！", "I made a gigantic chocolate truffle!")
			snd SOUNDLIST_COMPLETE1
			flt
			novoidlv = 1
			fixlv = FIX_QUALITY_GOOD
			characreate -1, CREATURE_ID_TRUFFE_CHOCOLATE_WISP, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
			gosub *music_play
			goto *act_use_SWEND1
		}
		if ( rtval == 4 ) {
			snd SOUNDLIST_CURSE3
			animeload ANIMATION_GOLDENSTORM, CHARA_PLAYER
			chop = 3
		}
		if ( rtval == 5 ) {
			snd SOUNDLIST_EAT1
			txtef COLOR_YELLOW
			txt lang("まだ柔らかいけどおいしい！", "It's still soft but delicious nevertheless.")
			cdata(CDATA_HUNGER, CHARA_PLAYER) += 750
			gosub *music_play
			goto *act_use_SWEND1
		}
		dbg_skipevent = 1
		gdata(GDATA_MIN) += 10
		gosub *advance_hour
		dbg_skipevent = 0
		txtef COLOR_YELLOW
		txt lang("手作りチョコができた！", "The handmade chocolate is done!")
		snd SOUNDLIST_COMPLETE1
		itemcreate -1, ITEM_ID_HANDMADE_CHOCOLATE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		if ( stat ) {
			inv(INV_ITEM_SUB_NAME, ci) = CREATURE_ID_BUG
			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
			inv(INV_ITEM_PARAM3, ci) = chop
		}
		gdata(GDATA_FLAG_CHOCOLATE_KIT_LIMIT)++
		gosub *music_play
		chop = 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_STARDUST | _switch_sw ) {
		_switch_sw = 0
		if ( cc != CHARA_PLAYER ) {
			txt_nothinghappens
			goto *act_use_SWEND1
		}
		cibk = ci
		invsubroutine = 1
		invctrl = 23, 16
		snd SOUNDLIST_INV
		gosub *com_inventory
		if ( stat == 1 ) {
			if ( inv(INV_ITEM_LEVEL, ci) < 15 ) {
				snd SOUNDLIST_DING2
				txt lang(itemname(ci) + "は青い光に包まれた。", itemname(ci) + " " + is2(inv(INV_ITEM_NUM, ci)) + " surrounded by a blue aura.")
				inv(INV_ITEM_LEVEL, ci)++
			}
			else {
				txt lang(itemname(ci) + "は抵抗した。", itemname(ci) + " resist" + _s2(inv(INV_ITEM_NUM, ci)) + ".")
			}
			ci = cibk
			inv(INV_ITEM_NUM, ci)--
			if ( ci >= RANGE_INV2 ) {
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			}
			r1 = cc
			gosub *charaRefresh
		}
		else {
			obvious = 0
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_BIO_PRINTER | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_PURPLE
		txt lang("「スキャン及び採取の対象を選択して下さい」", "Please select a target for scanning.")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc == CHARA_PLAYER ) {
					txt_impossible
					snd SOUNDLIST_FAIL1
					goto *act_use_SWEND1
				}
				animeload ANIMATION_FIZZLE, tc
				txtef COLOR_PURPLE
				txt lang("「対象を複製しています…」", "Duplicating objects...")
				hostileaction CHARA_PLAYER, tc
				animeload ANIMATION_FIZZLE, CHARA_PLAYER
				inv(INV_ITEM_NUM, ci)--
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				txtef COLOR_PURPLE
				txt lang("「ネットワークに接続されていません。内部構成を中止しました」", "Not connected to the network. Internal configuration has been canceled.")
				txt_questitem
				hostileaction CHARA_PLAYER, tc
				flt
				itemcreate -1, ITEM_ID_FIGURINE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
				inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, tc) \ COLOR_TINT_MULT + cdata(CDATA_CHARA_PIC, tc) * COLOR_TINT_MULT
				inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
				cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
				flt
				itemcreate -1, ITEM_ID_CORPSE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
				inv(INV_ITEM_AMUR_CAGE, ci) = 1
				remain_make ci, tc
				f = 1
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_BUSINESS_CARD | _switch_sw ) {
		_switch_sw = 0
		txt lang("誰に書かせる？", "Who will write it?")
		gosub *screen_draw
		val = 0
		gosub *prompt_direction
		f = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
				if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
					txtselecttc 2
					repeat 2
						promptAdd s(cnt), key_select(cnt)
					loop
					val = promptx, prompty, 200, 0
					gosub *prompt_key
					if ( rtval == 1 ) {
						tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
					}
				}
				if ( tc != CHARA_PLAYER ) {
					if ( tc >= MAX_CHARA_FOLLOWER ) {
						txt_impossible
						goto *pc_turn
					}
				}
				txt lang("新しい職業は？", "What's the new class?")
				val = (windoww - 220) / 2 + inf_screenx, winposy(90), 12, 1, 0
				inputlog = ""
				input_mode = 0
				gosub *prompt_word
				if ( inputlog == "" ) {
					txt lang("やっぱりやめた。", "You changed your mind.")
					goto *act_use_SWEND1
				}
				else {
					if ( inputlog == "戦士" | inputlog == "warrior" ) {
						cdatan(CDATAN_CLASS, tc) = "warrior"
					}
					if ( inputlog == "遺跡荒らし" | inputlog == "thief" ) {
						cdatan(CDATAN_CLASS, tc) = "thief"
					}
					if ( inputlog == "魔法使い" | inputlog == "wizard" ) {
						cdatan(CDATAN_CLASS, tc) = "wizard"
					}
					if ( inputlog == "農民" | inputlog == "farmer" ) {
						cdatan(CDATAN_CLASS, tc) = "farmer"
					}
					if ( inputlog == "プレデター" | inputlog == "predator" ) {
						cdatan(CDATAN_CLASS, tc) = "predator"
					}
					if ( inputlog == "狩人" | inputlog == "archer" ) {
						cdatan(CDATAN_CLASS, tc) = "archer"
					}
					if ( inputlog == "魔法戦士" | inputlog == "warmage" ) {
						cdatan(CDATAN_CLASS, tc) = "warmage"
					}
					if ( inputlog == "観光客" | inputlog == "tourist" ) {
						cdatan(CDATAN_CLASS, tc) = "tourist"
					}
					if ( inputlog == "ピアニスト" | inputlog == "pianist" ) {
						cdatan(CDATAN_CLASS, tc) = "pianist"
					}
					if ( inputlog == "機工兵" | inputlog == "gunner" ) {
						cdatan(CDATAN_CLASS, tc) = "gunner"
					}
					if ( inputlog == "プリースト" | inputlog == "priest" ) {
						cdatan(CDATAN_CLASS, tc) = "priest"
					}
					if ( inputlog == "クレイモア" | inputlog == "claymore" ) {
						cdatan(CDATAN_CLASS, tc) = "claymore"
					}
					cdatan(CDATAN_FAKE_CLASS, tc) = "" + inputlog
					txt lang(cdatan(CDATAN_NAME, tc) + "は「" + cdatan(CDATAN_FAKE_CLASS, tc) + "」の職についた。", "Class of " + cdatan(CDATAN_NAME, tc) + " change to <" + cdatan(CDATAN_FAKE_CLASS, tc) + ">.")
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					animeload ANIMATION_FIZZLE, tc
					f = 1
				}
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_JUKE_BOX | _switch_sw ) {
		_switch_sw = 0
		txt lang("どの曲を再生しよう？", "Which music will you play.")
		gosub *com_jukebox
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_MUSIC_DISC | _switch_sw ) {
		_switch_sw = 0
		txt lang(itemname(ci, 1) + "再生した。", "You play " + itemname(ci, 1) + ".")
		music = inv(INV_ITEM_PARAM1, ci) + STARTING_MUSICLIST + 1
		if ( music >= MUSICLIST_MAX - 1 ) {
			music = MUSICLIST_MAX - 2
		}
		mdata(MDATA_MUSIC) = music
		gosub *music_play
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_PLAYBACK_DISC | _switch_sw ) {
		_switch_sw = 0
		screenupdate = -1
		gosub *screen_draw
		goto *com_story
	}
	if ( _switch_val == EFFECT_SHELTER | _switch_sw ) {
		_switch_sw = 0
		if ( inv(INV_ITEM_PROPERTY, ci) != PROP_CONSTRUCT ) {
			if ( mdata(MDATA_CAN_SAVE) == 0 | gdata(GDATA_AREA) == AREA_QUEST | gdata(GDATA_AREA) == AREA_SHELTER ) {
				if ( gdata(GDATA_AREA) == AREA_WILDERNESS ) {
					txt lang("ワールドマップで建設するべきだ。", "You can only build it in the world map.")
				}
				else {
					txt lang("ここには建てられない。", "You can't build it here.")
				}
				gosub *screen_draw
				goto *pc_turn
			}
			gdata(GDATA_ROW_ACT) = ACTION_CONSTRUCT
			gosub *generalAct
			goto *turn_end
		}
		if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANDOM_DUNGEON ) {
			if ( gdata(GDATA_LEVEL) == adata(ADATA_MAX_LEVEL, gdata(GDATA_AREA)) ) {
				if ( adata(ADATA_BOSS, gdata(GDATA_AREA)) != (-1) ) {
					txt lang("クエストを放棄してシェルターに避難する？", "Really give up the quest and evacuate to the shelter?")
					promptYesNo
					if ( rtval != 0 ) {
						gosub *screen_draw
						goto *pc_turn
					}
				}
			}
		}
		gdata(GDATA_ROW_ACT) = ACTION_OPEN_HATCH
		gosub *generalAct
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_KITTY_BANK | _switch_sw ) {
		_switch_sw = 0
		if ( moneybox(inv(INV_ITEM_PARAM2, ci)) > cdata(CDATA_GOLD, CHARA_PLAYER) ) {
			txt lang("金貨が足りない…", "You count your coins and sigh...")
			gosub *screen_draw
			goto *pc_turn
		}
		if ( inv(INV_ITEM_PARAM1, ci) >= 1000000000 ) {
			txt lang("貯金箱は一杯だ。", "The money box is full.")
			gosub *screen_draw
			goto *pc_turn
		}
		item_separate ci
		snd SOUNDLIST_PAYGOLD1
		cdata(CDATA_GOLD, CHARA_PLAYER) -= moneybox(inv(INV_ITEM_PARAM2, ci))
		inv(INV_ITEM_PARAM1, ci) += moneybox(inv(INV_ITEM_PARAM2, ci))
		inv(INV_ITEM_WEIGHT, ci) += 100
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_INCOGNITO | _switch_sw ) {
		_switch_sw = 0
		efid = SKILL_SPELL_INCOGNITO
		efp = 400
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_YACATECTS_BANK | _switch_sw ) {
		_switch_sw = 0
		if ( inv(INV_ITEM_PARAM1, ci) < 0 ) {
			cibk = ci
			kane = 210000000
			inv(INV_ITEM_PARAM1, ci) = 0
			txt lang("「計算間違えとったみたいやわ…ゴメンな」", cnvtalk("Looks like I made a mistake in my calculations. Sorry..."))
			snd SOUNDLIST_PAYGOLD1
			flt
			itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), kane
			txt_questitem
			kane = 0
			inv(INV_ITEM_CHARGE, cibk) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12
			ci = cibk
		}
		txt lang("[ 現在の預金額：" + inv(INV_ITEM_PARAM1, ci) + "gold ]", "[ Current balance: " + inv(INV_ITEM_PARAM1, ci) + " gold ]")
		txtsetybank 6
		repeat 6
			promptAdd s(cnt), key_select(cnt)
		loop

		/********** ORIGINAL - BEGINNING **********

		val = promptx, prompty, 220, 0

		 ********** ORIGINAL - ENDING **********/

		/********** BLOODYSHADE CUSTOM - BEGINNING **********/ // increase the size of yacatect's bank window

		val = promptx, prompty, 220 + ( en * 40 ), 0

		/********** BLOODYSHADE CUSTOM - ENDING **********/

		gosub *prompt_key
		if ( rtval == 0 ) {
			inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12
			txt lang("「ウチウチ詐欺には気をつけんといかんよ！」", cnvtalk("Please pay attention to fraud when transferring money!"))
			goto *pc_turn
		}
		if ( rtval == 1 ) {
			inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12
			if ( inv(INV_ITEM_PARAM1, ci) == 0 ) {
				inv(INV_ITEM_PARAM1, ci) = 0
				txt lang("「これぞ金を産むガチョウ…って空っぽやんか！」", cnvtalk("This is the goose that gives birth to go...ld... What? Empty!?"))
			}
			if ( inv(INV_ITEM_PARAM1, ci) > 0 ) {
				kane = inv(INV_ITEM_PARAM1, ci)
				inv(INV_ITEM_PARAM1, ci) = 0
				txt lang("「よいしょ…なかなか貯まっとるみたいやな」", cnvtalk("Nice... My savings are piling up inside here!"))
				snd SOUNDLIST_PAYGOLD1
				flt
				itemcreate -1, ITEM_ID_GOLD_PIECE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), kane
				txt_questitem
				kane = 0
			}
			goto *act_use_SWEND1
		}
		if ( rtval > 1 ) {
			if ( rtval == 2 ) {
				ybank = 100000
			}
			if ( rtval == 3 ) {
				ybank = 1000000
			}
			if ( rtval == 4 ) {
				ybank = 10000000
			}
			if ( rtval == 5 ) {
				ybank = 100000000
			}
			if ( ybank > cdata(CDATA_GOLD, CHARA_PLAYER) ) {
				txt lang("金貨が足りない…", "You count your coins and sigh...")
				ybank = 0
				inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12
				gosub *screen_draw
				goto *pc_turn
			}
			if ( inv(INV_ITEM_PARAM1, ci) >= 1000000000 ) {
				txt lang("貯金箱は一杯だ。", "The piggy bank is full.")
				ybank = 0
				inv(INV_ITEM_CHARGE, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12
				gosub *screen_draw
				goto *pc_turn
			}
			kaiwa = rnd(4)
			if ( kaiwa == 0 ) {
				txt lang("「よっしゃ！ウチが責任もって増やしたるっ！」", cnvtalk("OK! OK! I'll increase your coins with responsibility!"))
			}
			if ( kaiwa == 1 ) {
				txt lang("「金貨をーもっと用意できんかー？…ふふっ」", cnvtalk("Mm, can you prepare more coins?"))
			}
			if ( kaiwa == 2 ) {
				txt lang("「ガチョウがチョウ喜ぶで！…あかん、無表情や…」", cnvtalk("Yeah! The goose is pleased!"))
			}
			if ( kaiwa == 3 ) {
				txt lang("「ウチにかかれば、マネーの運用も思いのままねー！…なんや苦しいな」", cnvtalk("Operating money is easy if you leave it to me!"))
			}
			snd SOUNDLIST_PAYGOLD1
			cdata(CDATA_GOLD, CHARA_PLAYER) -= ybank
			item_separate ci
			if ( ybank > 0 ) {
				inv(INV_ITEM_PARAM1, ci) = (inv(INV_ITEM_PARAM1, ci) + ybank) / 10 * 11
			}
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_4DIM_MIRROR | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txt_cantusehere
			gosub *screen_draw
			goto *pc_turn
		}
		gdata(GDATA_TEMPORARY_FLAGS3) = 104
		efid = SKILL_SPELL_4DIM_POCKET
		efp = 650
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SUMMONING_CRYSTAL | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) != AREA_SHOW_HOUSE ) {
			txt lang("それは鈍く輝いた。", "It glows dully.")
			goto *act_use_SWEND1
		}
		if ( inv(INV_ITEM_PROPERTY, ci) != PROP_SPECIAL ) {
			txt lang("水晶には領域の記憶が宿っていない。この場所の所有者が配置した水晶を探す必要がある。", "The crystal isn't filled with the memory of this place. You need to find ones placed by the owner of this area.")
			goto *act_use_SWEND1
		}
		allyctrl = 0
		gosub *com_userNpc
		if ( stat != 1 ) {
			goto *act_use_SWEND1
		}
		snd SOUNDLIST_ENC
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_RUNE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_ENC
		if ( mdata(MDATA_TYPE) != MAP_TYPE_TOWN & mdata(MDATA_TYPE) != MAP_TYPE_VILLAGE ) {
			txt lang("それは街でしか使えない。", "You can only use it in a town.")
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
			snd SOUNDLIST_FAIL1
			txt lang("今は決闘中だ！", "You can not run away from the duel!")
			goto *act_use_SWEND1
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		txt lang("突然、あなたの目の前に異次元へのゲートが現れた。", "Suddenly, a strange gate opens.")
		comctrl = 2
		gosub *com_import
		if ( stat == 1 ) {
			goto *extract_map
		}
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_GAROK_HAMMER | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			goto *act_use_SWEND1
		}
		txt lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd SOUNDLIST_BUILD1
		efid = EFFECT_GAROK_HAMMER
		efp = 100
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_MATERIAL_KIT | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
			goto *act_use_SWEND1
		}
		txt lang(itemname(ci, 1) + "を振った。", "You swing " + itemname(ci, 1) + ".")
		snd SOUNDLIST_BUILD1
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		fixmaterial = inv(INV_ITEM_MATERIAL, ci)
		efid = EFFECT_MATERIAL_KIT
		efp = 500
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_UNICORN_HORN | _switch_sw ) {
		_switch_sw = 0
		txt lang(itemname(ci, 1) + "を使った。", "You hold " + itemname(ci, 1) + " up high.")
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		efid = SKILL_SPACT_RAIN_OF_SANITY
		efp = 500
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_OPATOS_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		gdata(GDATA_FLAG_RENEW_DUNGEON) = 1
		snd SOUNDLIST_PRAY1
		gdata(GDATA_FLAG_STATUE_OPATOS) = 1
		txtef COLOR_YELLOW
		txt lang("オパートス「フハハハ！間もなく、この地に変動が起こるであろう！」", "Opatos: \"Muwahahaha! I shall shake the land for you!\"")
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_JURE_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		txtef COLOR_YELLOW
		txt lang("ジュア「べ、別にあんたのためにするんじゃないからね。バカっ！」", "Jure: \"I-I'm not doing this for you! Silly!\"")
		efid = SKILL_SPACT_RAIN_OF_SANITY
		efp = 5000
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_KUMIROMI_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		txtef COLOR_YELLOW
		txt lang("クミロミ「種…出ちゃう…」", "Kumiromi: \"Seeds... Spring forth...\"")
		snd SOUNDLIST_WEB
		flt
		itemcreate -1, ITEM_ID_UNKNOWN_SEED, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		if ( gdata(GDATA_DAY) == 9 | gdata(GDATA_DAY) == 19 | gdata(GDATA_DAY) == 29 | gdata(GDATA_DAY) == 3 | gdata(GDATA_DAY) == 13 | gdata(GDATA_DAY) == 23 | gdata(GDATA_DAY) == 30 | gdata(GDATA_DAY) == 6 | gdata(GDATA_DAY) == 16 | gdata(GDATA_DAY) == 26 ) {
			flt
			itemcreate -1, ITEM_ID_HERB_SEED, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		}
		else {
			flt
			itemcreate -1, ITEM_ID_FRUIT_SEED, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		}
		if ( gdata(GDATA_DAY) == 9 | gdata(GDATA_DAY) == 19 | gdata(GDATA_DAY) == 29 | gdata(GDATA_DAY) == 3 | gdata(GDATA_DAY) == 13 | gdata(GDATA_DAY) == 23 | gdata(GDATA_DAY) == 30 ) {
			flt
			itemcreate -1, ITEM_ID_ARTIFACT_SEED, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		}
		else {
			flt
			itemcreate -1, ITEM_ID_VEGETABLE_SEED, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0
		}
		txtef COLOR_SKY_BLUE
		txtmore
		txt lang("像のスカートの中から何かが転がり落ちてきた。", "The statue generated a seed.")
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_MANI_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		txt lang("マニ「さぁ、お前のスーパーモードを見せてみろ！」", "Mani: \"Show me your super mode!\"")
		addbuff tc, BUFF_BOOST, 120, 30
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_EHEKATL_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		txt lang("エヘカトル「呼んだ？呼んだ？」", "Ehekatl: \"Did you call me? call me?\"")
		addbuff tc, BUFF_LUCK, 77, 2500
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_YACATECT_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		txtef COLOR_YELLOW
		txt lang("ヤカテクト「ほな、今日のお小遣い！1gpも無駄にしたらあかんよ？」", "Yacatect: \"Here, today's allowance! Don't waste even 1gp, okay?\"")
		efp = 100
		animeload ANIMATION_BLOOD, tc
		repeat 3
			snd SOUNDLIST_PRAY1
			flt calcobjlv(efp / 10), calcfixlv(FIX_QUALITY_GREAT)
			dbid = ITEM_ID_GOLD_PIECE
			p = 5000 + rnd(5000)
			if ( cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT ) {
				if ( cdata(CDATA_PIETY, CHARA_PLAYER) != 0 ) {
					p += cdata(CDATA_PIETY, CHARA_PLAYER) / 10
				}
			}
			if ( cnt == 2 ) {
				if ( gdata(GDATA_DAY) == 8 | gdata(GDATA_DAY) == 10 ) {
					dbid = ITEM_ID_PLATINUM_COIN
					p = 1
				}
				if ( gdata(GDATA_DAY) * gdata(GDATA_MONTH) == 90 ) {
					dbid = ITEM_ID_SMALL_MEDAL
					p = 1
				}
			}
			nostack = 1
			itemcreate -1, dbid, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), p
			txt lang(itemname(ci) + "が降ってきた！", itemname(ci) + " fall" + _s2(inv(INV_ITEM_NUM, ci)) + " down!")
			await 100
			redraw 1
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_ITZPALT_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		txtef COLOR_YELLOW
		txt lang("イツパロトル「炎よ冷気よ、そして雷よ。我が命に応え、今こそ属性を遮る壁となれ」", "Itzpalt: \"Oh fire; Oh cold air; Oh thunder. Hear my call and form an attribute barrier.\"")
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
				else {
					if ( cdata(CDATA_RELATION, cc) != cdata(CDATA_RELATION, tc) ) {
						continue
					}
				}
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			addbuff tc, BUFF_ATTRIBUTE_SHIELD, 2400, 100
			animeload ANIMATION_BLOOD, tc
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_LULWY_STATUE | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		snd SOUNDLIST_PRAY1
		txtef COLOR_YELLOW
		if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
			txt lang("ルルウィ「あさはかね。エーテルの風を止めてあげるとでも思ったの？」", "Lulwy: \"Listen my little slave. Did you really think I would turn a hand in this filthy wind for you?\"")
			goto *act_use_SWEND1
		}
		p = gdata(GDATA_WEATHER)
		repeat
			if ( rnd(10) == 0 ) {
				gdata(GDATA_WEATHER) = WEATHER_CLEAR
			}
			if ( rnd(10) == 0 ) {
				gdata(GDATA_WEATHER) = WEATHER_RAIN
			}
			if ( rnd(15) == 0 ) {
				gdata(GDATA_WEATHER) = WEATHER_HARD_RAIN
			}
			if ( rnd(20) == 0 ) {
				gdata(GDATA_WEATHER) = WEATHER_SNOW
			}
			if ( gdata(GDATA_WEATHER) != p ) {
				break
			}
		loop
		txt lang("ルルウィ「あらあら、定命の分際でそんなおねだりするの？ウフフ…今回は特別よ」", "Lulwy: \"Ah, you ask too much for a mortal. Still, it is hard to refuse a call from such a pretty slave as you...\"")
		txtmore
		txt lang("天候が変わった。", "The weather changes.")
		envonly = 1
		gosub *music_play
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_YACATECT_GEMSTONE | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 1 ) {
			snd SOUNDLIST_DING3
			txt lang("「あのなぁ…今月分はもうやったやろ？」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 2 ) {
			snd SOUNDLIST_DING3
			txt lang("「こら。来月まで辛抱せんかい」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 3 ) {
			snd SOUNDLIST_DING3
			txt lang("「せやから！今月のお小遣いはあれで終いやって！」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 4 ) {
			snd SOUNDLIST_DING3
			txt lang("「…そないにせがまれてもウチも困るんやけど」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 5 ) {
			snd SOUNDLIST_DING3
			txt lang("「隣の信者くんを見てみ？あのお小遣いでちゃあんと我慢してるやろ？」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 6 ) {
			snd SOUNDLIST_DING3
			txt lang("「また…。もしかしてツッコミ待ちなん？」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 7 ) {
			snd SOUNDLIST_DING3
			txt lang("「ま、まさか記憶喪失しとるんとちゃうやろな…あかん、心配なってきたわ」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 8 ) {
			snd SOUNDLIST_DING3
			txt lang("「…心配すんのもアホらしゅうなってきたわ」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 9 ) {
			snd SOUNDLIST_DING3
			txt lang("「うっさいわボケ…」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 10 ) {
			txt lang("「だああああああっ！！！ええ加減に！！ええ加減にせんかいアホーーー！！！…はぁはぁ」", cnvtalk("You'll have to wait until next month!!!"))
			efid = SKILL_SPACT_PUNISHMENT
			efp = 2000
			tc = CHARA_PLAYER
			gosub *effect
			snd SOUNDLIST_PUNISH1
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) == 11 ) {
			snd SOUNDLIST_DING3
			txt lang("「…前はちとやりすぎてもうたわ、勘忍な。せやけどこれは月イチなんよ、わかってや」", cnvtalk("You'll have to wait until next month."))
			gdata(GDATA_YACTECT_GEMSTONE_MSG)++
			goto *act_use_SWEND1
		}
		if ( gdata(GDATA_YACTECT_GEMSTONE_MSG) > 11 ) {
			txtef COLOR_PURPLE
			txt lang("空からものすごい勢いでプラチナ硬貨が地面に叩きつけられ粉微塵になった。", "Platinum coins from fall the sky into the ground with tremendous force, turning into dust.")
			snd SOUNDLIST_CRUSH1
			goto *act_use_SWEND1
		}
		snd SOUNDLIST_DING3
		flt
		itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), limit(sdata(SKILL_NORMAL_FAITH, CHARA_PLAYER) / 6, 10, 25)
		txt_questitem
		gdata(GDATA_YACTECT_GEMSTONE_MSG) = 1
		txt lang("「ほれほれ、今月のお小遣いやでー！…無駄使いしたら許さへんよ」", cnvtalk("Here you go, this month's allowance! ...I won't forgive you if you waste it."))
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_HEART_OF_TWILIGHT | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
			txt lang("ワールドマップで使うべきだ。", "You can only use it in the world map.")
			goto *act_use_SWEND1
		}
		txtsetnefia 6
		repeat 6
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 180, 0
		gosub *prompt_key
		nefia = rtval
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_DISTANT_ATK, CHARA_PLAYER
		repeat MAX_AREA_COUNT - STARTING_RANDOM_AREA, STARTING_RANDOM_AREA
			if ( adata(ADATA_ID, cnt) != AREA_RANDOM_DUNGEON ) {
				continue
			}
			if ( adata(ADATA_DEEPEST, cnt) != 0 ) {
				continue
			}
			if ( dist(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), adata(ADATA_X, cnt), adata(ADATA_Y, cnt)) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			adata(ADATA_MIN_LEVEL, cnt) = adata(ADATA_MIN_LEVEL, cnt) * (nefia * 2 + 5) / 10
			if ( adata(ADATA_MIN_LEVEL, cnt) < 1 ) {
				adata(ADATA_MIN_LEVEL, cnt) = 1
			}
			if ( adata(ADATA_MIN_LEVEL, cnt) > 6666 ) {
				adata(ADATA_MIN_LEVEL, cnt) = 6666
			}
			adata(ADATA_MAX_LEVEL, cnt) = adata(ADATA_MIN_LEVEL, cnt) + 3
			txtef COLOR_BLUE
			txt lang(mapname(cnt) + "は震えた。", mapname(cnt) + " vibrated.")
		loop
		nefia = 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_WAKEUP_NEFIA | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) != MAP_TYPE_WORLD ) {
			txt lang("ワールドマップで使うべきだ。", "You can only use it in the world map.")
			goto *act_use_SWEND1
		}
		snd SOUNDLIST_OFFER2
		animeload ANIMATION_DISTANT_ATK, CHARA_PLAYER
		repeat MAX_AREA_COUNT - STARTING_RANDOM_AREA, STARTING_RANDOM_AREA
			if ( adata(ADATA_ID, cnt) != AREA_RANDOM_DUNGEON ) {
				continue
			}
			if ( adata(ADATA_DEEPEST, cnt) != 0 ) {
				continue
			}
			if ( adata(ADATA_WAKEUP_NEFIA, cnt) != WAKEUP_NEFIA_NONE ) {
				continue
			}
			if ( dist(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), adata(ADATA_X, cnt), adata(ADATA_Y, cnt)) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			txtef COLOR_RED
			txt lang(mapname(cnt) + "は活性化した！", mapname(cnt) + " was activated.")
			adata(ADATA_WAKEUP_NEFIA, cnt) = WAKEUP_NEFIA_NORMAL
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_DOG_WHISTLE | _switch_sw ) {
		_switch_sw = 0
		if ( cdatan(CDATAN_RACE, CHARA_PLAYER) == "doggod" | cdatan(CDATAN_RACE, CHARA_PLAYER) == "dog" | cdatan(CDATAN_CUSTOM_RACE, CHARA_PLAYER) == "犬" | cdatan(CDATAN_CUSTOM_RACE, CHARA_PLAYER) == "犬の神" ) {
			snd SOUNDLIST_WHISTLE
			txtef COLOR_SKY_BLUE
			txt lang(" *ピーーーー* ", " *Peeeeeeeeeep* ")
		}
		else {
			txt lang("何も聞こえない。", "You don't hear anything.")
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cnt == CHARA_PLAYER ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( cdatan(CDATAN_RACE, tc) == "doggod" | cdatan(CDATAN_RACE, tc) == "dog" | cdatan(CDATAN_CUSTOM_RACE, tc) == "犬" | cdatan(CDATAN_CUSTOM_RACE, tc) == "犬の神" | cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_DOG_SISTER | cdata(CDATA_ID, tc) == CREATURE_ID_FOX_BROTHER ) {
				if ( rnd(2) == 0 ) {
					cdata(CDATA_EMO_ICON, tc) = 21 + 100
				}
			}
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_TAKTSTOCK | _switch_sw ) {
		_switch_sw = 0
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cdata(CDATA_RELATION, cnt) != 10 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_BRAINWASH, cnt) > 0 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_BLIND, cnt) > 0 ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), dx, dy) == 0 ) {
				continue
			}
			cc = cnt
			gosub *findTarget
			if ( stat == 0 ) {
				continue
			}
			if ( cc != CHARA_PLAYER ) {
				if ( cdata(CDATA_TARGET, cc) != 0 ) {
					if ( cdata(CDATA_RELATION, cdata(CDATA_TARGET, cc)) >= (-1) ) {
						continue
					}
					if ( cbit(CHARA_BIT_SANDBAG, cdata(CDATA_TARGET, cc)) ) {
						continue
					}
					cdata(CDATA_POWER_GAUGE, cc) += 5
					if ( cdata(CDATA_POWER_GAUGE, cc) > 100 ) {
						if ( cdata(CDATA_SHIFT_FORM, cc) <= SHIFT_FORM_NONE & (cdata(CDATA_EVOLUTION_STAGE, cc) <= 0 | cc == CHARA_PLAYER) & (cdata(CDATA_QUALITY, cc) < FIX_QUALITY_MIRACLE | cc < MAX_CHARA_FOLLOWER) ) {
							cdata(CDATA_POWER_GAUGE, cc) = 100
						}
					}
					if ( cdata(CDATA_POWER_GAUGE, cc) > 200 ) {
						cdata(CDATA_POWER_GAUGE, cc) = 200
					}
				}
			}
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_COMMAND_FLAG | _switch_sw ) {
		_switch_sw = 0
		if ( synccheck(cc, -1) ) {
			txt lang("仲間にどんな指示を出そうか。", "Which instruction do you give to your allies?")
		}
		txtsettactical 11
		repeat 11
			promptAdd s(cnt), key_select(cnt)
		loop
		val = promptx, prompty, 220, 0
		gosub *prompt_key
		if ( rtval == 0 ) {
			goto *pc_turn
		}
		if ( rtval == 1 ) {
			tact = DIRECTIVE_MODE_OFFENSIVE
		}
		if ( rtval == 2 ) {
			tact = DIRECTIVE_MODE_DEFENSIVE
		}
		if ( rtval == 3 ) {
			tact = DIRECTIVE_MODE_INTERCEPT
		}
		if ( rtval == 4 ) {
			tact = DIRECTIVE_MODE_TALKING
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( cc == cnt ) {
				continue
			}
			if ( cc < MAX_CHARA_FOLLOWER ) {
				if ( cnt >= MAX_CHARA_FOLLOWER ) {
					continue
				}
			}
			if ( cdata(CDATA_RELATION, cnt) != 10 ) {
				continue
			}
			if ( cdata(CDATA_CONDITION_BRAINWASH, cnt) > 0 ) {
				continue
			}
			tc = cnt
			dx = cdata(CDATA_X, tc)
			dy = cdata(CDATA_Y, tc)
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
				continue
			}
			if ( rtval <= 4 ) {
				cdata(CDATA_DIRECTIVE_MODE, tc) = tact
				if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_OFFENSIVE ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_RED
						txt lang(name(tc) + "は突撃の態勢に入った！", name(tc) + " switched to offensive mode!")
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_DEFENSIVE ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_BLUE
						txt lang(name(tc) + "は防御の態勢に入った！", name(tc) + " switched to defensive mode!")
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_INTERCEPT ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_YELLOW
						txt lang(name(tc) + "は迎撃の態勢に入った！", name(tc) + " switched to intercept mode!")
					}
				}
				if ( cdata(CDATA_DIRECTIVE_MODE, tc) == DIRECTIVE_MODE_TALKING ) {
					if ( synccheck(tc, -1) ) {
						txtef COLOR_GREEN
						txt lang(name(tc) + "は交渉の態勢に入った！", name(tc) + " switched to talking mode!")
					}
				}
			}
			if ( rtval >= 5 ) {
				f = 0
				repeat MAX_EQUIP_SLOT_TOTAL
					body = CDATA_STARTING_EQUIP_SLOTS + cnt
					if ( cdata(body, tc) \ EXT_EQUIP_SLOTS == 0 ) {
						continue
					}
					if ( cdata(body, tc) / EXT_EQUIP_SLOTS == EQUIP_SLOT_AMMO ) {
						ci = cdata(body, tc) \ EXT_EQUIP_SLOTS - 1
						f = 1
						break
					}
				loop
				if ( f == 0 ) {
					txt lang(name(tc) + "は矢弾を装備していない。", name(tc) + " " + have(tc) + " no ammo equipped.")
					continue
				}
				if ( rtval == 5 ) {
					inv(INV_ITEM_AMMO, ci) = -1
					s = lang("通常弾", "Normal"), lang("無限", "Unlimited")
					snd SOUNDLIST_AMMO
					txtef COLOR_GREEN
					txt lang(cdatan(CDATAN_NAME, tc) + "は" + s + "に切り替えた。", "Current Ammo Type")
				}
				else {
					if ( rtval == 6 ) {
						amp = ENCHANT_AMMO_BURST
					}
					if ( rtval == 7 ) {
						amp = ENCHANT_AMMO_MAGIC
					}
					if ( rtval == 8 ) {
						amp = ENCHANT_AMMO_PIERCING
					}
					if ( rtval == 9 ) {
						amp = ENCHANT_AMMO_EXPLOSIVE
					}
					if ( rtval == 10 ) {
						amp = ENCHANT_AMMO_RAPID
					}
					change = 0
					repeat RANGE_INV_ITEM_ENCHANT
						if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) == 0 ) {
							break
						}
						enc = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci)
						i = enc / EXT_ENCHANTMENT
						if ( i != 0 ) {
							enc = enc \ EXT_ENCHANTMENT
							if ( i == ENCHANT_AMMO ) {
								if ( inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, ci) \ EXT_ENCHANTMENT == amp ) {
									inv(INV_ITEM_AMMO, ci) = cnt
									change = 1
									break
								}
							}
						}
					loop
					if ( change == 0 ) {
						txt lang(cdatan(CDATAN_NAME, tc) + "の矢弾はその切替に対応していない。", itemname(ci) + " isn't capable of that ammo.")
						continue
					}
					snd SOUNDLIST_AMMO
					change = 0
					i = inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ci) * 2 + 1, ci) \ EXT_ENCHANTMENT_AMMO, inv(STARTING_INV_ITEM_ENCHANT + inv(INV_ITEM_AMMO, ci) * 2 + 1, ci) / EXT_ENCHANTMENT_AMMO
					s = ammoname(amp), "" + i + "/" + i(1)
					s = s + ":" + s(1)
					txtef COLOR_GREEN
					txt lang(cdatan(CDATAN_NAME, tc) + "は" + s + "に切り替えた。", "Current Ammo Type")
				}
			}
		loop
		goto *pc_turn
	}
	if ( _switch_val == EFFECT_SATELLITE_SHOOTER | _switch_sw ) {
		_switch_sw = 0
		txtef COLOR_BLUE
		txt lang("衛星軌道上から荷電粒子砲が発射された！", "Destruction rains from the heavens!")
		gdata(GDATA_TEMPORARY_FLAGS3) = 777
		animeid = ANIMATION_HOLY
		animode = 0
		gosub *anime
		gdata(GDATA_TEMPORARY_FLAGS3) = 0
		repeat mdata(MDATA_HEIGHT)
			dy = cnt
			repeat mdata(MDATA_WIDTH)
				dx = cnt
				if ( map(dx, dy, 1) != 0 ) {
					tc = map(dx, dy, 1) - 1
					if ( tc == CHARA_PLAYER ) {
						continue
					}
					if ( cdata(CDATA_RELATION, tc) != (-3) ) {
						continue
					}
					if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
						if ( tc != CHARA_PLAYER ) {
							if ( rnd(cdata(CDATA_HP, tc) + 1) < rnd(cdata(CDATA_HP, cdata(CDATA_TAGTEAM_PARTNER, tc)) + 1) ) {
								tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
							}
							txt_guard
						}
					}
					map(dx, dy, 0) = 12
					dmg = 300 + sdata(SKILL_ATTR_PER, CHARA_PLAYER) / 40 * limit(sdata(SKILL_ATTR_PER, CHARA_PLAYER), 1, 1000) + sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER) / 40 * sdata(SKILL_NORMAL_MARKSMAN, CHARA_PLAYER)
					if ( synccheck(tc, -1) ) {
						txtmore
						if ( tc >= MAX_CHARA_FOLLOWER ) {
							gdata(GDATA_DMG_TYPE) = 2
							txt3rd = 1
							txt lang("荷電粒子は" + name(tc) + "に命中し", "The laser hits " + name(tc) + " and")
						}
						else {
							txt lang("荷電粒子は" + name(tc) + "に命中した。", "The laser hits " + name(tc) + ".")
						}
					}
					dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
				}
			loop
		loop
		gvolley = 0
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_NUKE | _switch_sw ) {
		_switch_sw = 0
		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
			txt_cantusehere
			gosub *screen_draw
			goto *pc_turn
		}
		if ( cdata(CDATA_X, CHARA_PLAYER) != 33 | cdata(CDATA_Y, CHARA_PLAYER) != 16 ) {
			if ( gdata(GDATA_FLAG_SUB_NUKE) == 1 ) {
				txt lang("ここはクエストの目標位置ではない。本当にここに設置する？", "This location is not your quest goal. Really place it here?")
				promptYesNo
				if ( rtval != 0 ) {
					gosub *screen_draw
					goto *pc_turn
				}
			}
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		txt lang("原子爆弾を設置した。逃げろォー！", "You set up the nuke... now run!!")
		snd SOUNDLIST_BUILD1
		addmef cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 7, 632, 10, 100, cc
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_CREATOR_STATUE | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) != AREA_SHOW_HOUSE | usermapid == 0 ) {
			txt lang("それはこの場所ではみすぼらしく見える。", "It looks so dumb here.")
			goto *act_use_SWEND1
		}
		txt lang("この石像を見つめていると、何かを投げつけたくなってうずうずしてきた！", "Watching this strange statue makes you want to throw something at it!")
		gosub *browser
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SECRET_TREASURE | _switch_sw ) {
		_switch_sw = 0
		trait(inv(INV_ITEM_PARAM1, ci)) = 1
		if ( inv(INV_ITEM_PARAM1, ci) == 169 ) {
			trait(TRAIT_OTHER_WICKED) = 0
		}
		if ( inv(INV_ITEM_PARAM1, ci) == 162 ) {
			trait(TRAIT_OTHER_SAINT) = 0
		}
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		txt lang("あなたは新たなフィートを獲得した！", "You gain a new feat.")
		animeload ANIMATION_BLOOD, CHARA_PLAYER
		r1 = cc
		gosub *charaRefresh
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_EVOLUTION_ITEM | _switch_sw ) {
		_switch_sw = 0
		val = 0
		gosub *prompt_direction
		f = 0
		evmode = 0
		if ( stat != 0 ) {
			if ( map(x, y, 1) > 0 ) {
				tc = map(x, y, 1) - 1
			}
		}
		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
			txtselecttc 2
			repeat 2
				promptAdd s(cnt), key_select(cnt)
			loop
			val = promptx, prompty, 200, 0
			gosub *prompt_key
			if ( rtval == 1 ) {
				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOUNGER_CAT_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 1
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOUNGER_CAT_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 2
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LAME_HORSE | cdata(CDATA_ID, tc) == CREATURE_ID_WILD_HORSE | cdata(CDATA_ID, tc) == CREATURE_ID_NOYEL_HORSE | cdata(CDATA_ID, tc) == CREATURE_ID_YOWYN_HORSE | cdata(CDATA_ID, tc) == CREATURE_ID_THOROUGHBRED ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 3
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GIRAFFE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 4
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_DOG | cdata(CDATA_ID, tc) == CREATURE_ID_HOUND ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 5
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAT | cdata(CDATA_ID, tc) == CREATURE_ID_SILVER_CAT | cdata(CDATA_ID, tc) == CREATURE_ID_STRAY_CAT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 6
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_MACHINE_INFANTRY | cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_ELITE_MACHINE_INFANTRY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 7
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR | cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_MAGICIAN | cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_BOXER | cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_KING ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 8
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR | cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_MAGICIAN | cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_BOXER | cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_KING ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 9
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_COBRA | cdata(CDATA_ID, tc) == CREATURE_ID_KING_COBRA ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 10
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GOOSE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 11
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_CAT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 0 ) {
							evmode = 12
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
						evmode = 12
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 13
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 13
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CUTE_FAIRY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 0 ) {
							evmode = 14
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
						evmode = 14
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 15
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 15
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ANDROID ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 0 ) {
							evmode = 16
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
						evmode = 16
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 17
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 17
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_ANGEL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 18
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_EXILE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 0 ) {
							evmode = 19
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
						evmode = 19
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 20
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 20
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GOLDEN_KNIGHT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 21
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_DEFENDER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 22
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_PUTIT | cdata(CDATA_ID, tc) == CREATURE_ID_RED_PUTIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 23
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BROWN_BEAR | cdata(CDATA_ID, tc) == CREATURE_ID_GRIZZLY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 24
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MILITARY_PUTIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 25
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_DOG | cdata(CDATA_ID, tc) == CREATURE_ID_HOUND ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 26
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_DOG | cdata(CDATA_ID, tc) == CREATURE_ID_HOUND ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 27
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAT | cdata(CDATA_ID, tc) == CREATURE_ID_SILVER_CAT | cdata(CDATA_ID, tc) == CREATURE_ID_STRAY_CAT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 28
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CARBUNCLE | cdata(CDATA_ID, tc) == CREATURE_ID_LION ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 29
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 30
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 31
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOUNGER_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 32
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOUNGER_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 33
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_DRAGON_CHILD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 34
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_DRAGON_CHILD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 35
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BEETLE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 36
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_KABUTO ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 37
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_DRAGON_ZOMBIE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 38
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LICH | cdata(CDATA_ID, tc) == CREATURE_ID_MASTER_LICH | cdata(CDATA_ID, tc) == CREATURE_ID_DEMI_LICH ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 39
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_WARRIOR | cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_BERSERKER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 40
				}
			}
		}
		if ( cdata(CDATA_ID, tc) >= CREATURE_ID_PAWN & cdata(CDATA_ID, tc) <= CREATURE_ID_KING ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 41
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_CENTIPEDE | cdata(CDATA_ID, tc) == CREATURE_ID_CENTIPEDE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 42
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MAN_EATER_FLOWER | cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_FLOWER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 43
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GOKIBURI | cdata(CDATA_ID, tc) == CREATURE_ID_MURDER_COCKROACH ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 44
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIVING_ARMOR | cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_MASS ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 45
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_DOG_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 46
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_OLDER_DOG_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 47
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BROWN_BEAR | cdata(CDATA_ID, tc) == CREATURE_ID_GRIZZLY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 48
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LITTLE_GIRL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 49
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOUNG_LADY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 50
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOUNG_LADY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 51
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LITTLE_GIRL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 52
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_COMBAT_PLANE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 53
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_XEREN_AUTO_TANK ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 54
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GRYFFON_CHILD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 55
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_INFECTED_YERLES_SOLDIER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 56
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_PUDDING_SPIRIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 57
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WAR_SPIRIT | cdata(CDATA_ID, tc) == CREATURE_ID_MAGIC_SPIRIT | cdata(CDATA_ID, tc) == CREATURE_ID_GUN_SPIRIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 58
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MEDUSA | cdata(CDATA_ID, tc) == CREATURE_ID_EURYALE | cdata(CDATA_ID, tc) == CREATURE_ID_STHENO ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 59
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIZARD_MAN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 60
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GIANT_SQUIRREL | cdata(CDATA_ID, tc) == CREATURE_ID_KILLER_SQUIRREL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 61
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CYCLOPS | cdata(CDATA_ID, tc) == CREATURE_ID_TITAN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 62
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LESSER_PHANTOM ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 63
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LITTLE_SISTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 64
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ELECTRIC_SHEEP ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 65
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WILD_SHEEP ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 66
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CUPID_OF_LOVE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 67
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_APPRENTICE_ANGEL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 68
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LITTLE_GIRL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 69
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BOMB_ROCK ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 70
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YEEK | cdata(CDATA_ID, tc) == CREATURE_ID_YEEK_WARRIOR | cdata(CDATA_ID, tc) == CREATURE_ID_YEEK_ARCHER | cdata(CDATA_ID, tc) == CREATURE_ID_MASTER_YEEK | cdata(CDATA_ID, tc) == CREATURE_ID_KAMIKAZE_YEEK ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 71
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_RAT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 72
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SLIME | cdata(CDATA_ID, tc) == CREATURE_ID_ACID_SLIME ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 0 ) {
							evmode = 74
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
						evmode = 74
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 73
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 73
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ALIEN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 75
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 75
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_WARRIOR | cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_BERSERKER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 76
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHICKEN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 77
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_MACHINE_INFANTRY | cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_ELITE_MACHINE_INFANTRY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 78
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_KOBOLD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 79
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLADE | cdata(CDATA_ID, tc) == CREATURE_ID_BLADE_ALPHA ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 80
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ELECTRIC_CLOUD | cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_CLOUD | cdata(CDATA_ID, tc) == CREATURE_ID_WISP ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 81
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FOX_BROTHER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 82
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FOX_BROTHER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 83
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_HERMIT_CRAB ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 84
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MILITARY_PUTIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 85
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GWEN_THE_INNOCENT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 86
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WARRIOR_OF_ELEA ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 87
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WIZARD_OF_ELEA ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 88
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_RAT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 89
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GRUDGE | cdata(CDATA_ID, tc) == CREATURE_ID_HUNGRY_DEMON ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 90
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WASP | cdata(CDATA_ID, tc) == CREATURE_ID_RED_WASP | cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_HORNET ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 91
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 91
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MUSHROOM | cdata(CDATA_ID, tc) == CREATURE_ID_SPORE_MUSHROOM | cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_MUSHROOM ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 92
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 92
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_COBRA | cdata(CDATA_ID, tc) == CREATURE_ID_KING_COBRA ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 93
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 93
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WYVERN | cdata(CDATA_ID, tc) == CREATURE_ID_VALIANT_WYVERN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 94
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_CRAB ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 95
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_JUERE_INFANTRY | cdata(CDATA_ID, tc) == CREATURE_ID_JUERE_SWORDMAN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 96
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CUB ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 97
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_HAMSTER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 98
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_DRAGON_CHILD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 2 ) {
					evmode = 99
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LESSER_PHANTOM ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 100
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BROWN_BEAR | cdata(CDATA_ID, tc) == CREATURE_ID_GRIZZLY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) >= 1 ) {
					if ( cdata(CDATA_EVOLUTION_STAGE, tc) < 3 ) {
						evmode = 101
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WOODEN_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_STONE_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_SMALL_WOODEN_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_SMALL_STONE_GOLEM ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 102
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WOODEN_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_STONE_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_SMALL_WOODEN_GOLEM | cdata(CDATA_ID, tc) == CREATURE_ID_SMALL_STONE_GOLEM ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 103
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPIDER | cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_WIDOW | cdata(CDATA_ID, tc) == CREATURE_ID_PARALYZER | cdata(CDATA_ID, tc) == CREATURE_ID_TARANTULA | cdata(CDATA_ID, tc) == CREATURE_ID_BLOOD_SPIDER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 104
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_TYRANNOSAURUS ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 105
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_TYRANNOSAURUS ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 106
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPIDER | cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_WIDOW | cdata(CDATA_ID, tc) == CREATURE_ID_PARALYZER | cdata(CDATA_ID, tc) == CREATURE_ID_TARANTULA | cdata(CDATA_ID, tc) == CREATURE_ID_BLOOD_SPIDER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 107
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SCORPION | cdata(CDATA_ID, tc) == CREATURE_ID_KING_SCORPION ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 108
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SCORPION | cdata(CDATA_ID, tc) == CREATURE_ID_KING_SCORPION ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 109
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WANDERING_PENGUIN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 110
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE_GIRL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 111
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE_GIRL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 112
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE_GIRL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 113
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SNAIL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 114
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_SNAIL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 115
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ELECTRIC_CLOUD | cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_CLOUD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 116
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WISP ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 117
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MOAI ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 118
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE | cdata(CDATA_ID, tc) == CREATURE_ID_EXECUTIONER | cdata(CDATA_ID, tc) == CREATURE_ID_LICH | cdata(CDATA_ID, tc) == CREATURE_ID_LESSER_MUMMY | cdata(CDATA_ID, tc) == CREATURE_ID_MUMMY | cdata(CDATA_ID, tc) == CREATURE_ID_GREATER_MUMMY | cdata(CDATA_ID, tc) == CREATURE_ID_ANCIENT_COFFIN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 119
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_KENTAURS ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 120
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CATTLE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 121
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHILD_BOAR ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 122
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHILD_BOAR ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 123
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WILD_RABBIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 124
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_WILD_RABBIT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
						if ( cdata(CDATA_SEX, tc) == 1 ) {
							evmode = 125
						}
					}
					if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
						evmode = 125
					}
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GHOST ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 126
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_NYMPH ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 127
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FLYING_FROG | cdata(CDATA_ID, tc) == CREATURE_ID_POISON_ARROW_FROG ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 128
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_AMBYSTOMA ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 129
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FAIRY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 130
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIZARD_MAN | cdata(CDATA_ID, tc) == CREATURE_ID_LIZARD_MAGE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 131
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_HARPY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 132
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_HARPY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 133
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_HALLOWEEN_NIGHTMARE | cdata(CDATA_ID, tc) == CREATURE_ID_PUMPKIN | cdata(CDATA_ID, tc) == CREATURE_ID_PUPPY | cdata(CDATA_ID, tc) == CREATURE_ID_GREATER_PUMPKIN ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 134
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_MANDRAKE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 135
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_IMP | cdata(CDATA_ID, tc) == CREATURE_ID_NETHER_IMP | cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_IMP ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 136
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_GUNFISH ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 137
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_HERMIT_CRAB ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 138
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LARGE_BIKE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MACHINE ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 139
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_ENT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 140
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ICE_ENT ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 141
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_SEED ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 142
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_SEED ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 143
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_CATERPILLAR_SNIPER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_GOD ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 144
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLUE_BUBBLE | cdata(CDATA_ID, tc) == CREATURE_ID_BUBBLE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 145
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_PUPPET ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 146
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_THIEF | cdata(CDATA_ID, tc) == CREATURE_ID_ROBBER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 147
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_NURSE ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 148
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_FALLEN_SOLDIER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 149
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIVING_ARMOR | cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_MASS ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 150
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LITTLE_BOY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_EVOLUTION ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 151
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_LITTLE_BOY ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
					evmode = 152
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BUTLER ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_MAGIC ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 153
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_BISQUE_DOLL ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 154
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_KOBOLD ) {
			if ( inv(INV_ITEM_PARAM1, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 155
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_ORC | cdata(CDATA_ID, tc) == CREATURE_ID_ORC_WARRIOR ) {
			if ( inv(INV_ITEM_GOD, ci) == EVITEM_HEART_KING ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 156
				}
			}
		}
		if ( cdata(CDATA_ID, tc) == CREATURE_ID_PORC ) {
			if ( inv(INV_ITEM_GOD, ci) == EVITEM_HEART_ANOTHER ) {
				if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 0 ) {
					evmode = 157
				}
			}
		}
		if ( tc > CHARA_PLAYER & tc < MAX_CHARA_FOLLOWER ) {
			if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
				f = 1
				if ( evmode > 0 ) {
					if ( cdata(CDATA_IMPRESSION, tc) < 150 ) {
						txt lang(cdatan(CDATAN_NAME, tc) + "は進化を拒絶した。", "You will need to deepen the friendship.")
						evmode = 0
						goto *turn_end
					}
					txt lang("おや？" + cdatan(CDATAN_NAME, tc) + "の様子が…！？", "Oh? " + cdatan(CDATAN_NAME, tc) + " form is...!?")
					if ( synccheck(tc, -1) ) {
						txtef COLOR_RED
						txt lang(cdatan(CDATAN_NAME, tc) + "の変化を見守る？", "Watch " + cdatan(CDATAN_NAME, tc) + "'s change?")
					}
					promptYesNo
					if ( rtval == 0 ) {
						animeid = ANIMATION_GENE
						anic = tc
						gosub *anime
					}
					else {
						txt lang("あなたが声をかけると" + cdatan(CDATAN_NAME, tc) + "の変化は止まった…。", "Why? " + cdatan(CDATAN_NAME, tc) + "'s change stopped.")
						evmode = 0
						goto *turn_end
					}
					if ( evmode == 1 ) {
						evname = lang("猫の王女", "Cat Princess")
						evold = lang("妹猫", "younger cat sister")
						cdata(CDATA_PIC, tc) = xy2pic(8, 17)
						skillmod SKILL_ATTR_LIFE, tc, 50000
						skillmod SKILL_ATTR_SPD, tc, 10000
					}
					if ( evmode == 2 ) {
						evname = lang("妹猫の神", "Catsister God")
						evold = lang("妹猫", "younger cat sister")
						cdata(CDATA_PIC, tc) = xy2pic(18, 10)
						skillmod SKILL_ATTR_SPD, tc, 100000
					}
					if ( evmode == 3 ) {
						evname = lang("ユニコーン", "Unicorn")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LAME_HORSE ) {
							evold = lang("駄馬", "lame horse")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_WILD_HORSE ) {
							evold = lang("野生馬", "wild horse")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_NOYEL_HORSE ) {
							evold = lang("ノイエル馬", "Noyel horse")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_YOWYN_HORSE ) {
							evold = lang("ヨウィン馬", "Yowyn horse")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_THOROUGHBRED ) {
							evold = lang("サラブレッド", "wild horse")
						}
						cdata(CDATA_PIC, tc) = xy2pic(23, 13)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 20000
						cbitmod CHARA_BIT_FLOAT, tc, 1
					}
					if ( evmode == 4 ) {
						evname = lang("麒麟", "Kirin")
						evold = lang("キリンさん", "giraffe")
						cdata(CDATA_PIC, tc) = xy2pic(29, 13)
						skillmod SKILL_ATTR_SPD, tc, 35000
						skillmod SKILL_ATTR_STR, tc, 25000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 20000
					}
					if ( evmode == 5 ) {
						evname = lang("シヴァ犬", "Siva Inu")
						evold = lang("シルバーファング", "Silver Fang")
						cdata(CDATA_PIC, tc) = xy2pic(28, 9) + COLOR_PINK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 50000
					}
					if ( evmode == 6 ) {
						evname = lang("白虎", "White Tiger")
						evold = lang("ネコマタ", "Nekomata")
						cdata(CDATA_PIC, tc) = xy2pic(19, 14)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 5000
						skillmod SKILL_ATTR_PER, tc, 5000
						skillmod SKILL_ATTR_WIL, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 200
						cdata(CDATA_WEIGHT, tc) += rnd(50) + 150
					}
					if ( evmode == 7 ) {
						evname = lang("新型武装兵", "Yerles latest outfit soldier")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_MACHINE_INFANTRY ) {
							evold = lang("イェルス機械兵", "Yerles machine infantry")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_YERLES_ELITE_MACHINE_INFANTRY ) {
							evold = lang("イェルスエリート機械兵", "Yerles elite machine infantry")
						}
						cdata(CDATA_PIC, tc) = xy2pic(11, 13)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 10000
						cbitmod CHARA_BIT_FLOAT, tc, 1
					}
					if ( evmode == 8 ) {
						evname = lang("ミノタウロスの王者", "Minotaur Champion")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR ) {
							evold = lang("ミノタウロス", "minotaur")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_MAGICIAN ) {
							evold = lang("ミノタウロスの術士", "minotaur magician")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_BOXER ) {
							evold = lang("ミノタウロスの闘士", "minotaur boxer")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MINOTAUR_KING ) {
							evold = lang("ミノタウロスの戦士", "minotaur king")
						}
						cdata(CDATA_PIC, tc) = xy2pic(2, 12) + COLOR_PINK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 30000
						skillmod SKILL_ATTR_WIL, tc, 10000
						cbitmod CHARA_BIT_TEMPER, tc, 1
					}
					if ( evmode == 9 ) {
						evname = lang("アルデバラン", "Aldebaran")
						evold = lang("ミノタウロスの王者", "Minotaur Champion")
						cdata(CDATA_PIC, tc) = xy2pic(29, 19) + COLOR_YELLOW * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 50000
					}
					if ( evmode == 10 ) {
						evname = lang("ククルカン", "Kukulkan")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_COBRA ) {
							evold = lang("コブラ", "cobra")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KING_COBRA ) {
							evold = lang("キングコブラ", "king cobra")
						}
						cdata(CDATA_PIC, tc) = xy2pic(27, 15)
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 20000
						cbitmod CHARA_BIT_FLOAT, tc, 1
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 11 ) {
						evname = lang("キンナリー", "Golden Goose")
						evold = lang("白金ガチョウ", "goose")
						cdata(CDATA_PIC, tc) = xy2pic(5, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 10000
					}
					if ( evmode == 12 ) {
						evname = lang("大黒猫", "Big Black Cat")
						evold = lang("黒猫", "black cat")
						cdata(CDATA_PIC, tc) = xy2pic(26, 15)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 200
						cdata(CDATA_WEIGHT, tc) += rnd(50) + 150
					}
					if ( evmode == 13 ) {
						evname = lang("黒猫娘", "Black Catsister")
						evold = lang("黒猫", "black cat")
						cdata(CDATA_PIC, tc) = xy2pic(6, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 20000
						cdata(CDATA_HEIGHT, tc) = rnd(50) + 120
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 30
					}
					if ( evmode == 14 ) {
						evname = lang("デスサイズ", "Deathscythe")
						evold = lang("妖精さん", "cute fairy")
						cdata(CDATA_PIC, tc) = xy2pic(28, 15)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 20000
						cdata(CDATA_HEIGHT, tc) = rnd(50) + 120
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 30
					}
					if ( evmode == 15 ) {
						evname = lang("ドリュアス", "Dryas")
						evold = lang("妖精さん", "cute fairy")
						cdata(CDATA_PIC, tc) = xy2pic(13, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_CON, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 20000
						cdata(CDATA_HEIGHT, tc) = rnd(50) + 120
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 30
					}
					if ( evmode == 16 ) {
						evname = lang("ガンレイザー", "Gun Laser")
						evold = lang("アンドロイド", "android")
						cdata(CDATA_PIC, tc) = xy2pic(30, 15)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_PER, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 200
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 300
					}
					if ( evmode == 17 ) {
						evname = lang("ガングリフ", "Gun Glyph")
						evold = lang("アンドロイド", "android")
						cdata(CDATA_PIC, tc) = xy2pic(31, 15)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_PER, tc, 25000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 50
					}
					if ( evmode == 18 ) {
						evname = lang("黒熾天使", "Black Seraph")
						evold = lang("黒天使", "black angel")
						cdata(CDATA_PIC, tc) = xy2pic(10, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_PER, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 30000
						skillmod SKILL_ATTR_WIL, tc, 10000
					}
					if ( evmode == 19 ) {
						evname = lang("暗黒魔竜", "Dark Demon Dragon")
						evold = lang("追放者", "exile")
						cdata(CDATA_PIC, tc) = xy2pic(32, 15)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_CON, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 20000
						skillmod SKILL_NORMAL_CONTROL_MAGIC, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 20 ) {
						evname = lang("永久追放者", "Permanent Exile")
						evold = lang("追放者", "exile")
						cdata(CDATA_PIC, tc) = xy2pic(8, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 30000
						skillmod SKILL_NORMAL_CONTROL_MAGIC, tc, 10000
					}
					if ( evmode == 21 ) {
						evname = lang("黄金聖騎士", "Golden Holy Knight")
						evold = lang("黄金の騎士", "golden knight")
						cdata(CDATA_PIC, tc) = xy2pic(9, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_STR, tc, 40000
						skillmod SKILL_ATTR_CON, tc, 10000
					}
					if ( evmode == 22 ) {
						evname = lang("絶対防衛者", "Absolute Defender")
						evold = lang("防衛者", "defender")
						cdata(CDATA_PIC, tc) = xy2pic(4, 16)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_CON, tc, 40000
						skillmod SKILL_ATTR_MAG, tc, 10000
					}
					if ( evmode == 23 ) {
						evname = lang("ロイヤルプチ", "Royal Putit")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_PUTIT ) {
							evold = lang("プチ", "putit")
							cdata(CDATA_PIC, tc) = xy2pic(21, 16)
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_RED_PUTIT ) {
							evold = lang("ベスプチ", "red putit")
							cdata(CDATA_PIC, tc) = xy2pic(21, 16) + COLOR_RED * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_CHA, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 50
					}
					if ( evmode == 24 ) {
						evname = lang("鬼熊", "Demon Bear")
						cdata(CDATA_PIC, tc) = xy2pic(23, 16)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BROWN_BEAR ) {
							evold = lang("ブラウンベア", "brown bear")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GRIZZLY ) {
							evold = lang("グリズリー", "grizzly")
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 30000
					}
					if ( evmode == 25 ) {
						evname = lang("プチコマンド", "Putit Commando")
						evold = lang("軍用プチ", "military putit")
						cdata(CDATA_PIC, tc) = xy2pic(2, 9) + COLOR_RED * COLOR_TINT_MULT
						skillmod SKILL_ATTR_PER, tc, 50000
					}
					if ( evmode == 26 ) {
						evname = lang("狼王", "Wolf Lord")
						cdata(CDATA_PIC, tc) = xy2pic(15, 16)
						evold = lang("シルバーファング", "Silver Fang")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 30000
						cdata(CDATA_EVOLUTION_STAGE, tc) = 10
						cbitmod CHARA_BIT_TEMPER, tc, 1
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 50
					}
					if ( evmode == 27 ) {
						evname = lang("シルバーファング", "Silver Fang")
						cdata(CDATA_PIC, tc) = xy2pic(29, 7)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_DOG ) {
							evold = lang("犬", "dog")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_HOUND ) {
							evold = lang("猟犬", "hound")
						}
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
					}
					if ( evmode == 28 ) {
						evname = lang("ネコマタ", "Nekomata")
						cdata(CDATA_PIC, tc) = xy2pic(28, 7)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CAT ) {
							evold = lang("猫", "cat")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SILVER_CAT ) {
							evold = lang("シルバーキャット", "silver cat")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_STRAY_CAT ) {
							evold = lang("迷子の子猫", "stray cat")
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 10000
					}
					if ( evmode == 29 ) {
						evname = lang("マンティコア", "Manticore")
						cdata(CDATA_PIC, tc) = xy2pic(6, 11)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CARBUNCLE ) {
							evold = lang("カーバンクル", "carbuncle")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LION ) {
							evold = lang("ライオン", "lion")
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 10000
						cbitmod CHARA_BIT_FLOAT, tc, 1
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 50
					}
					if ( evmode == 30 ) {
						evname = lang("夏姉", "Summer Older Sister")
						evold = lang("姉", "older sister")
						cdata(CDATA_PIC, tc) = xy2pic(24, 15)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CHA, tc, 40000
					}
					if ( evmode == 31 ) {
						evname = lang("ちび姉", "Small Older Sister")
						evold = lang("姉", "older sister")
						cdata(CDATA_PIC, tc) = xy2pic(25, 16)
						skillmod SKILL_ATTR_SPD, tc, 20000
						cdata(CDATA_EVOLUTION_STAGE, tc) = 10
						cbitmod CHARA_BIT_TEMPER, tc, 1
						cdata(CDATA_HEIGHT, tc) = rnd(30) + 100
						cdata(CDATA_WEIGHT, tc) = rnd(5) + 25
					}
					if ( evmode == 32 ) {
						evname = lang("妹猫？", "Sister cat?")
						evold = lang("妹", "younger sister")
						cdata(CDATA_PIC, tc) = xy2pic(10, 9)
						skillmod SKILL_ATTR_SPD, tc, 50000
					}
					if ( evmode == 33 ) {
						evname = lang("病妹", "Yandere Sister")
						evold = lang("妹", "younger sister")
						cdata(CDATA_PIC, tc) = xy2pic(6, 17)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 10000
						cdata(CDATA_EVOLUTION_STAGE, tc) = 10
						cbitmod CHARA_BIT_TEMPER, tc, 1
					}
					if ( evmode == 34 ) {
						evname = lang("火炎竜の成体", "Adult Dragon Flame")
						evold = lang("火炎竜の幼体", "fire dragon child")
						cdata(CDATA_PIC, tc) = xy2pic(8, 10)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_CON, tc, 10000
						cbitmod CHARA_BIT_FLOAT, tc, 1
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 35 ) {
						evname = lang("火炎機竜", "Machine Dragon Flame")
						evold = lang("火炎竜の成体", "Adult Dragon Flame")
						cdata(CDATA_PIC, tc) = xy2pic(27, 13)
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(500) + 500
					}
					if ( evmode == 36 ) {
						evname = lang("カブテリオン", "Kabuterion")
						evold = lang("かぶと虫", "beetle")
						cdata(CDATA_PIC, tc) = xy2pic(2, 17)
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 70000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 37 ) {
						evname = lang("ハイパービートル", "Hyper Beetle ")
						evold = lang("ヘブンズビートル", "kabuto")
						skillmod SKILL_ATTR_SPD, tc, 40000
					}
					if ( evmode == 38 ) {
						evname = lang("ブラックドラゴン", "Black Dragon")
						evold = lang("ドラゴンゾンビ", "dragon zombie")
						cdata(CDATA_PIC, tc) = xy2pic(12, 10)
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 10000
					}
					if ( evmode == 39 ) {
						evname = lang("オルガシズル", "Orugashizuru")
						cdata(CDATA_PIC, tc) = xy2pic(9, 10) + COLOR_BLUE * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LICH ) {
							evold = lang("リッチ", "lich")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MASTER_LICH ) {
							evold = lang("マスターリッチ", "master lich")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_DEMI_LICH ) {
							evold = lang("デミリッチ", "demi lich")
						}
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_MAG, tc, 40000
					}
					if ( evmode == 40 ) {
						evname = lang("スカルビースト", "Skull Beast")
						cdata(CDATA_PIC, tc) = xy2pic(19, 13)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_WARRIOR ) {
							evold = lang("骸骨戦士", "skeleton warrior")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SKELETON_BERSERKER ) {
							evold = lang("骸骨狂戦士", "skeleton berserker")
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 30000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 50
					}
					if ( evmode == 41 ) {
						evname = lang("＜チェックメイター＞", "<Checkmate>")
						cdata(CDATA_PIC, tc) = xy2pic(0, 17)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_PAWN ) {
							evold = lang("＜ポーン＞", "<Pawn>")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ROOK ) {
							evold = lang("＜ルーク＞", "<Rook>")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BISHOP ) {
							evold = lang("＜ビショップ＞", "<Bishop>")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KNIGHT ) {
							evold = lang("＜ナイト＞", "<Knight>")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_QUEEN ) {
							evold = lang("＜クィーン＞", "<Queen>")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KING ) {
							evold = lang("＜キング＞", "<King>")
						}
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 42 ) {
						evname = lang("黄金龍虫", "Golden Dragon Centipede")
						cdata(CDATA_PIC, tc) = xy2pic(1, 17) + COLOR_YELLOW * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_FIRE_CENTIPEDE ) {
							evold = lang("火炎ムカデ", "fire centipede")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CENTIPEDE ) {
							evold = lang("ムカデ", "centipede")
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 30000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 43 ) {
						evname = lang("ファングプラント", "Fang Plant")
						cdata(CDATA_PIC, tc) = xy2pic(4, 17) + COLOR_BLACK * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MAN_EATER_FLOWER ) {
							evold = lang("人食い花", "man eater flower")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_FLOWER ) {
							evold = lang("カオスフラワー", "chaos flower")
						}
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 44 ) {
						evname = lang("セセラギ", "King Cockroach")
						cdata(CDATA_PIC, tc) = xy2pic(19, 16) + COLOR_BLACK * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GOKIBURI ) {
							evold = lang("茶色い悪魔", "gokiburi")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MURDER_COCKROACH ) {
							evold = lang("殺人ゴキブリ", "murder cockroach")
						}
						skillmod SKILL_ATTR_SPD, tc, 40000
						skillmod SKILL_ATTR_DEX, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(50) + 50
					}
					if ( evmode == 45 ) {
						evname = lang("デュラハン", "Durahan")
						cdata(CDATA_PIC, tc) = xy2pic(11, 10) + COLOR_BLACK * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIVING_ARMOR ) {
							evold = lang("リビングアーマー", "living armor")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_MASS ) {
							evold = lang("鉄塊", "steel mass")
						}
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 20000
					}
					if ( evmode == 46 ) {
						evname = lang("姉狼", "Wolf Sister")
						evold = lang("姉犬", "older dog sister")
						cdata(CDATA_PIC, tc) = xy2pic(26, 26)
						skillmod SKILL_ATTR_LIFE, tc, 30000
						skillmod SKILL_ATTR_SPD, tc, 10000
					}
					if ( evmode == 47 ) {
						evname = lang("アネビス", "Anubis")
						evold = lang("姉狼", "Wolf Sister")
						cdata(CDATA_PIC, tc) = xy2pic(11, 17)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_PER, tc, 10000
						cbitmod CHARA_BIT_FLOAT, tc, 1
					}
					if ( evmode == 48 ) {
						evname = lang("ナヌーク", "Nanook")
						cdata(CDATA_PIC, tc) = xy2pic(7, 17)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BROWN_BEAR ) {
							evold = lang("ブラウンベア", "brown bear")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GRIZZLY ) {
							evold = lang("グリズリー", "grizzly")
						}
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 40000
						skillmod SKILL_ATTR_LIFE, tc, 30000
						resistmod tc, SKILL_RES_COLD, 50 * 10
						cdata(CDATA_EVOLUTION_STAGE, tc)++
					}
					if ( evmode == 49 ) {
						evname = lang("幼女", "Littler Girl")
						evold = lang("少女", "little girl")
						cdata(CDATA_PIC, tc) = xy2pic(12, 17)
						skillmod SKILL_ATTR_CHA, tc, 10000
						cdata(CDATA_HEIGHT, tc) = rnd(30) + 100
						cdata(CDATA_WEIGHT, tc) = rnd(5) + 25
					}
					if ( evmode == 50 ) {
						evname = lang("吸血嬢", "Miss Vampire")
						evold = lang("白お嬢様", "White Princess")
						cdata(CDATA_PIC, tc) = xy2pic(13, 17)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 20000
						cbitmod CHARA_BIT_CURE_BLEEDING, tc, 1
					}
					if ( evmode == 51 ) {
						evname = lang("白お嬢様", "White Princess")
						evold = lang("嬢", "young lady")
						cdata(CDATA_PIC, tc) = xy2pic(27, 2)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 20000
					}
					if ( evmode == 52 ) {
						evname = lang("魔女", "Witch")
						evold = lang("幼女", "Littler Girl")
						cdata(CDATA_PIC, tc) = xy2pic(14, 17)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 40000
						skillmod SKILL_NORMAL_CASTING, tc, 20000
					}
					if ( evmode == 53 ) {
						evname = lang("量産型メルガスト", "Melugast typeM")
						evold = lang("イェルス自律型飛行ユニット", "Yerles combat plane")
						cdata(CDATA_PIC, tc) = xy2pic(19, 17)
						skillmod SKILL_ATTR_SPD, tc, 50000
						skillmod SKILL_ATTR_PER, tc, 40000
					}
					if ( evmode == 54 ) {
						evname = lang("ゼイレン人型戦車", "Xeren humanoid tank")
						evold = lang("ゼイレン自動軽戦車", "Xeren auto tank")
						cdata(CDATA_PIC, tc) = xy2pic(19, 10) + COLOR_SKY_BLUE * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_PER, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(20) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(100) + 150
					}
					if ( evmode == 55 ) {
						evname = lang("グリフォン", "Griffon")
						evold = lang("仔グリフォン", "gryffon child")
						cdata(CDATA_PIC, tc) = xy2pic(10, 17)
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 20000
						cbitmod CHARA_BIT_FLOAT, tc, 1
						cdata(CDATA_HEIGHT, tc) += rnd(100) + 500
						cdata(CDATA_WEIGHT, tc) += rnd(100) + 500
					}
					if ( evmode == 56 ) {
						evname = lang("メシェーラ・ソルダード", "Meshera Soldado")
						evold = lang("同化兵", "infected yerles soldier")
						cdata(CDATA_PIC, tc) = xy2pic(31, 13) + COLOR_BLACK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_PER, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(100) + 200
						cdata(CDATA_WEIGHT, tc) += rnd(100) + 200
						txtef COLOR_PURPLE
						txt lang("「ぎゃああアアアアアッ！」", cnvtalk("Gyaaaaaaa!"))
					}
					if ( evmode == 57 ) {
						evname = lang("コーヒープリンの精霊", "Spirit of the Coffee Pudding")
						evold = lang("プリンの精霊", "pudding spirit")
						cdata(CDATA_PIC, tc) = xy2pic(5, 14) + COLOR_BLACK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						resistmod tc, SKILL_RES_MAGIC, 50 * 10
					}
					if ( evmode == 58 ) {
						evname = lang("ハイスピリット", "High Spirit")
						evold = lang("スピリット", "spirit")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_WAR_SPIRIT ) {
							if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
								if ( cdata(CDATA_SEX, tc) == 0 ) {
									cdata(CDATA_PIC, tc) = xy2pic(6, 9) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
								}
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
								cdata(CDATA_PIC, tc) = xy2pic(6, 9) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
								if ( cdata(CDATA_SEX, tc) == 1 ) {
									cdata(CDATA_PIC, tc) = xy2pic(7, 9) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
								}
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
								cdata(CDATA_PIC, tc) = xy2pic(7, 9) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
							}
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MAGIC_SPIRIT ) {
							if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
								if ( cdata(CDATA_SEX, tc) == 0 ) {
									cdata(CDATA_PIC, tc) = xy2pic(8, 9) + COLOR_LIGHT_PURPLE * COLOR_TINT_MULT
								}
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
								cdata(CDATA_PIC, tc) = xy2pic(8, 9) + COLOR_LIGHT_PURPLE * COLOR_TINT_MULT
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
								if ( cdata(CDATA_SEX, tc) == 1 ) {
									cdata(CDATA_PIC, tc) = xy2pic(9, 9) + COLOR_LIGHT_PURPLE * COLOR_TINT_MULT
								}
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
								cdata(CDATA_PIC, tc) = xy2pic(9, 9) + COLOR_LIGHT_PURPLE * COLOR_TINT_MULT
							}
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GUN_SPIRIT ) {
							if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
								if ( cdata(CDATA_SEX, tc) == 0 ) {
									cdata(CDATA_PIC, tc) = xy2pic(30, 2) + COLOR_LIGHT_RED * COLOR_TINT_MULT
								}
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
								cdata(CDATA_PIC, tc) = xy2pic(30, 2) + COLOR_LIGHT_RED * COLOR_TINT_MULT
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
								if ( cdata(CDATA_SEX, tc) == 1 ) {
									cdata(CDATA_PIC, tc) = xy2pic(31, 2) + COLOR_LIGHT_RED * COLOR_TINT_MULT
								}
							}
							if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
								cdata(CDATA_PIC, tc) = xy2pic(31, 2) + COLOR_LIGHT_RED * COLOR_TINT_MULT
							}
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						resistmod tc, SKILL_RES_MAGIC, 50 * 10
					}
					if ( evmode == 59 ) {
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MEDUSA ) {
							evname = lang("メデューサ・アンカースド", "Uncursed Medusa")
							evold = lang("メデューサ", "medusa")
							cdata(CDATA_PIC, tc) = xy2pic(5, 18)
							skillmod SKILL_ATTR_SPD, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_EURYALE ) {
							evname = lang("エウリュアレ・アンカースド", "Uncursed Euryale")
							evold = lang("エウリュアレ", "euryale")
							cdata(CDATA_PIC, tc) = xy2pic(5, 18) + COLOR_YELLOW * COLOR_TINT_MULT
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_STHENO ) {
							evname = lang("ステンノ・アンカースド", "Uncursed Stheno")
							evold = lang("ステンノ", "stheno")
							cdata(CDATA_PIC, tc) = xy2pic(5, 18) + COLOR_LIGHT_RED * COLOR_TINT_MULT
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						skillmod SKILL_ATTR_CHA, tc, 30000
					}
					if ( evmode == 60 ) {
						evname = lang("撃龍人", "Fierce Dragonewt")
						evold = lang("リザードマン", "lizard man")
						cdata(CDATA_PIC, tc) = xy2pic(27, 17) + COLOR_GREEN * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_PER, tc, 20000
					}
					if ( evmode == 61 ) {
						evname = lang("ラタトスク", "Ratatosk")
						cdata(CDATA_PIC, tc) = xy2pic(6, 6) + COLOR_BLACK * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GIANT_SQUIRREL ) {
							evold = lang("巨大リス", "giant squirrel")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KILLER_SQUIRREL ) {
							evold = lang("殺人リス", "killer squirrel")
						}
						skillmod SKILL_ATTR_SPD, tc, 30000
					}
					if ( evmode == 62 ) {
						evname = lang("凍気の巨人", "Frozen Giant")
						cdata(CDATA_PIC, tc) = xy2pic(21, 10) + COLOR_BLUE * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CYCLOPS ) {
							evold = lang("サイクロプス", "cyclops")
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_TITAN ) {
							evold = lang("タイタン", "titan")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						skillmod SKILL_ATTR_CON, tc, 30000
					}
					if ( evmode == 63 ) {
						evname = lang("黒ファントム", "Black Phantom")
						evold = lang("レッサーファントム", "lesser phantom")
						cdata(CDATA_PIC, tc) = xy2pic(28, 6) + COLOR_BLACK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 10000
					}
					if ( evmode == 64 ) {
						evname = lang("『ビッグシスター』", "<Big Sister>")
						evold = lang("『リトルシスター』", "<Little Sister>")
						cdata(CDATA_PIC, tc) = xy2pic(18, 9)
						skillmod SKILL_ATTR_SPD, tc, 60000
						cdata(CDATA_HEIGHT, tc) = rnd(30) + 140
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 40
					}
					if ( evmode == 65 ) {
						evname = lang("電気竜", "Electric Drake")
						evold = lang("電気羊", "electric sheep")
						cdata(CDATA_PIC, tc) = xy2pic(2, 7) + COLOR_YELLOW * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 30000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 66 ) {
						evname = lang("バフォメット", "Baphomet")
						evold = lang("羊", "wild sheep")
						cdata(CDATA_PIC, tc) = xy2pic(30, 17)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 50
					}
					if ( evmode == 67 ) {
						evname = lang("ロードキューピッド", "Lord Cupid")
						evold = lang("恋のキューピッド", "cupid of love")
						cdata(CDATA_PIC, tc) = xy2pic(5, 26)
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_PER, tc, 30000
					}
					if ( evmode == 68 ) {
						evname = lang("はぐれ天使", "Angel Sstray")
						evold = lang("見習い天使", "apprentice angel")
						cdata(CDATA_PIC, tc) = xy2pic(4, 26) + COLOR_BROWN * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) = rnd(30) + 140
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 30
					}
					if ( evmode == 69 ) {
						evname = lang("戦乙女", "Valkyrie")
						evold = lang("少女", "little girl")
						cdata(CDATA_PIC, tc) = xy2pic(15, 18)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 10000
						cdata(CDATA_EVOLUTION_STAGE, tc) += 2
					}
					if ( evmode == 70 ) {
						evname = lang("爆弾黒水晶", "Black Crystal Bomb")
						evold = lang("爆弾岩", "bomb rock")
						cdata(CDATA_PIC, tc) = xy2pic(29, 15) + COLOR_BLACK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 40000
					}
					if ( evmode == 71 ) {
						evname = lang("イークインペリアル", "Imperial Yeek")
						cdata(CDATA_PIC, tc) = xy2pic(18, 11) + COLOR_YELLOW * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_YEEK ) {
							evold = lang("イーク", "yeek")
							skillmod SKILL_ATTR_LIFE, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_YEEK_WARRIOR ) {
							evold = lang("イークの戦士", "yeek warrior")
							skillmod SKILL_ATTR_STR, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_YEEK_ARCHER ) {
							evold = lang("イークの射手", "yeek archer")
							skillmod SKILL_ATTR_PER, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MASTER_YEEK ) {
							evold = lang("マスター・イーク", "master yeek")
							skillmod SKILL_ATTR_MAG, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KAMIKAZE_YEEK ) {
							evold = lang("カミカゼ・イーク", "kamikaze yeek")
							skillmod SKILL_ATTR_CON, tc, 30000
						}
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_DEX, tc, 10000
					}
					if ( evmode == 72 ) {
						evname = lang("エレクトリカルマウス", "Electrical Mouse")
						cdata(CDATA_PIC, tc) = xy2pic(24, 7) + COLOR_YELLOW * COLOR_TINT_MULT
						evold = lang("ネズミ", "rat")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 30000
						cdata(CDATA_EVOLUTION_STAGE, tc)++
					}
					if ( evmode == 73 ) {
						evname = lang("スライムノイド", "Slimeoid")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SLIME ) {
							evold = lang("スライム", "slime")
							skillmod SKILL_ATTR_SPD, tc, 20000
							cdata(CDATA_PIC, tc) = xy2pic(17, 18) + COLOR_BLUE * COLOR_TINT_MULT
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ACID_SLIME ) {
							evold = lang("弱酸性スライム", "acid slime")
							skillmod SKILL_ATTR_SPD, tc, 10000
							cdata(CDATA_PIC, tc) = xy2pic(17, 18) + COLOR_GREEN * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_WIL, tc, 30000
						skillmod SKILL_ATTR_LER, tc, 10000
						cdata(CDATA_HEIGHT, tc) = rnd(30) + 140
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 20
					}
					if ( evmode == 74 ) {
						evname = lang("スライムローパー", "Slime Roper")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SLIME ) {
							evold = lang("スライム", "slime")
							skillmod SKILL_ATTR_SPD, tc, 20000
							cdata(CDATA_PIC, tc) = xy2pic(19, 18) + COLOR_BLUE * COLOR_TINT_MULT
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ACID_SLIME ) {
							evold = lang("弱酸性スライム", "acid slime")
							skillmod SKILL_ATTR_SPD, tc, 10000
							cdata(CDATA_PIC, tc) = xy2pic(19, 18) + COLOR_GREEN * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_DEX, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) = rnd(30) + 160
						cdata(CDATA_WEIGHT, tc) = rnd(20) + 20
					}
					if ( evmode == 75 ) {
						evname = lang("女王エイリアン", "Alien Queen")
						evold = lang("エイリアン", "alien")
						skillmod SKILL_ATTR_SPD, tc, 10000
						cdata(CDATA_PIC, tc) = xy2pic(16, 19) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
						cdata(CDATA_ELEMENT, tc) += 200
						skillmod SKILL_ATTR_STR, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 20000
					}
					if ( evmode == 76 ) {
						evname = lang("逝眼の白骨龍", "Dragon Skeleton of Death Eye")
						cdata(CDATA_PIC, tc) = xy2pic(20, 13)
						evold = lang("スカルビースト", "Skull Beast")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 40000
						skillmod SKILL_ATTR_DEX, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 77 ) {
						evname = lang("究極ひよこ", "Ultimate Chick")
						cdata(CDATA_PIC, tc) = xy2pic(20, 18)
						evold = lang("鶏", "chicken")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 10000
						skillmod SKILL_ATTR_CHA, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(5) + 5
						cdata(CDATA_WEIGHT, tc) = 0
					}
					if ( evmode == 78 ) {
						evname = lang("装甲機兵", "Yerles Cyborg Soldier")
						evold = lang("新型武装兵", "Yerles latest outfit soldier")
						cdata(CDATA_PIC, tc) = xy2pic(5, 17)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_PER, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_LER, tc, 10000
					}
					if ( evmode == 79 ) {

						/********** ORIGINAL - BEGINNING **********

						evname = lang("コボルト", "EV")
						evold = lang("トゥーンコボルト", "aaaaaaa")

						 ********** ORIGINAL - ENDING **********/

						/********** BLOODYSHADE CUSTOM - BEGINNING **********/

						evname = lang("トゥーンコボルト", "Toon Kobold")
						evold = lang("コボルト", "kobold")

						/********** BLOODYSHADE CUSTOM - ENDING **********/

						cdata(CDATA_PIC, tc) = xy2pic(20, 10)
						skillmod SKILL_ATTR_SPD, tc, 15000
						skillmod SKILL_ATTR_CON, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_LIFE, tc, 10000
					}
					if ( evmode == 80 ) {
						evname = lang("デンジャラスブレイド", "Dangerous Blade")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLADE ) {
							evold = lang("ブレイド", "blade")
							cdata(CDATA_PIC, tc) = xy2pic(24, 18)
							cdata(CDATA_ELEMENT, tc) += 300
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLADE_ALPHA ) {
							evold = lang("ブレイドβ", "blade alpha")
							cdata(CDATA_PIC, tc) = xy2pic(24, 18) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
							cdata(CDATA_ELEMENT, tc) += 250
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLADE_OMEGA ) {
							evold = lang("ブレイドΩ", "blade omega")
							cdata(CDATA_PIC, tc) = xy2pic(24, 18) + COLOR_RED * COLOR_TINT_MULT
							cdata(CDATA_ELEMENT, tc) += 200
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 30000
					}
					if ( evmode == 81 ) {
						evname = lang("ダークソウル", "Dark Soul")
						cdata(CDATA_PIC, tc) = xy2pic(8, 8) + COLOR_BLACK * COLOR_TINT_MULT
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ELECTRIC_CLOUD ) {
							evold = lang("放電雲", "electric cloud")
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_CLOUD ) {
							evold = lang("混沌の塊", "chaos cloud")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_WISP ) {
							evold = lang("ウィスプ", "wisp")
							skillmod SKILL_ATTR_SPD, tc, 30000
						}
						skillmod SKILL_ATTR_MAG, tc, 30000
						resistmod tc, SKILL_RES_DARKNESS, 50 * 10
					}
					if ( evmode == 82 ) {
						evname = lang("弟火狐", "Fire Fox Brother")
						evold = lang("弟狐", "fox brother")
						cdata(CDATA_PIC, tc) = xy2pic(27, 18)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						cdata(CDATA_EVOLUTION_STAGE, tc) += 2
						resistmod tc, SKILL_RES_FIRE, 50 * 10
					}
					if ( evmode == 83 ) {
						evname = lang("弟九尾", "Nine-tailed Fox Brother")
						evold = lang("弟狐", "fox brother")
						cdata(CDATA_PIC, tc) = xy2pic(23, 18)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 25000
						skillmod SKILL_ATTR_LIFE, tc, 30000
					}
					if ( evmode == 84 ) {
						evname = lang("ヤドナシ", "Homeless Crab")
						cdata(CDATA_PIC, tc) = xy2pic(11, 19) + COLOR_RED * COLOR_TINT_MULT
						evold = lang("やどかり", "hermit crab")
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 30000
						cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(5000) + 5000
					}
					if ( evmode == 85 ) {
						evname = lang("機甲軍用プチ", "Putit Tank")
						evold = lang("プチコマンド", "Putit Commando")
						cdata(CDATA_PIC, tc) = xy2pic(0, 22)
						skillmod SKILL_ATTR_LIFE, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
					}
					if ( evmode == 86 ) {
						evname = lang("無邪気な戦士", "The Innocent Warrior")
						evold = lang("無邪気な少女", "the innocent girl")
						cdata(CDATA_PIC, tc) = xy2pic(18, 15)
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_CON, tc, 10000
					}
					if ( evmode == 87 ) {
						evname = lang("翻弄するエレアの戦士", "Merciful Warrior of Elea")
						evold = lang("エレアの戦士", "warrior of Elea")
						if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
							if ( cdata(CDATA_SEX, tc) == 0 ) {
								cdata(CDATA_PIC, tc) = xy2pic(4, 19)
							}
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
							cdata(CDATA_PIC, tc) = xy2pic(4, 19)
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
							if ( cdata(CDATA_SEX, tc) == 1 ) {
								cdata(CDATA_PIC, tc) = xy2pic(3, 22)
							}
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
							cdata(CDATA_PIC, tc) = xy2pic(3, 22)
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
					}
					if ( evmode == 88 ) {
						evname = lang("エレアの魔法学者", "Magus of Elea")
						evold = lang("エレアの魔術士", "wizard of Elea")
						if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
							if ( cdata(CDATA_SEX, tc) == 0 ) {
								cdata(CDATA_PIC, tc) = xy2pic(6, 19)
							}
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
							cdata(CDATA_PIC, tc) = xy2pic(6, 19)
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
							if ( cdata(CDATA_SEX, tc) == 1 ) {
								cdata(CDATA_PIC, tc) = xy2pic(2, 22)
							}
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
							cdata(CDATA_PIC, tc) = xy2pic(2, 22)
						}
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 40000
					}
					if ( evmode == 89 ) {
						evname = lang("火鼠", "Fire Rat")
						cdata(CDATA_PIC, tc) = xy2pic(7, 22)
						evold = lang("ネズミ", "rat")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						resistmod tc, SKILL_RES_FIRE, 50 * 10
					}
					if ( evmode == 90 ) {
						evname = lang("ハロウィン・ナイトヘッド", "Halloween Night Head")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GRUDGE ) {
							evold = lang("怨念", "grudge")
							cdata(CDATA_PIC, tc) = xy2pic(6, 22) + COLOR_RED * COLOR_TINT_MULT
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_HUNGRY_DEMON ) {
							evold = lang("餓鬼", "hungry demon")
							cdata(CDATA_PIC, tc) = xy2pic(6, 22) + COLOR_GREEN * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_CON, tc, 30000
					}
					if ( evmode == 91 ) {
						evname = lang("ソウルビー", "Soulbee")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_WASP ) {
							evold = lang("ワスプ", "wasp")
							skillmod SKILL_ATTR_SPD, tc, 20000
							cdata(CDATA_PIC, tc) = xy2pic(10, 22)
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_RED_WASP ) {
							evold = lang("レッドワスプ", "red wasp")
							skillmod SKILL_ATTR_SPD, tc, 15000
							cdata(CDATA_PIC, tc) = xy2pic(10, 22) + COLOR_RED * COLOR_TINT_MULT
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_HORNET ) {
							evold = lang("ブラックホーネット", "black hornet")
							cdata(CDATA_PIC, tc) = xy2pic(10, 22) + COLOR_BLACK * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
						resistmod tc, SKILL_RES_MAGIC, 50 * 10
					}
					if ( evmode == 92 ) {
						evname = lang("マッシュルーマン", "Mushrooman")
						cdata(CDATA_PIC, tc) = xy2pic(11, 22)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MUSHROOM ) {
							evold = lang("きのこ", "mushroom")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPORE_MUSHROOM ) {
							evold = lang("胞子きのこ", "spore mushroom")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_MUSHROOM ) {
							evold = lang("混沌きのこ", "chaos mushroom")
						}
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 20000
					}
					if ( evmode == 93 ) {
						evname = lang("ラミア", "Lamia")
						cdata(CDATA_PIC, tc) = xy2pic(12, 22)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_COBRA ) {
							evold = lang("コブラ", "cobra")
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KING_COBRA ) {
							evold = lang("キングコブラ", "king cobra")
						}
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 30000
					}
					if ( evmode == 94 ) {
						evname = lang("スプレッド・ワイバーン", "Spread Wyvern")
						cdata(CDATA_PIC, tc) = xy2pic(13, 19)
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_WYVERN ) {
							evold = lang("ワイバーン", "wyvern")
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_VALIANT_WYVERN ) {
							evold = lang("バリアント・ワイバーン", "valiant wyvern")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
					}
					if ( evmode == 95 ) {
						evname = lang("決闘蟹", "Duel Crab")
						cdata(CDATA_PIC, tc) = xy2pic(6, 7) + COLOR_BLUE * COLOR_TINT_MULT
						evold = lang("火蟹", "fire crab")
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 50000
					}
					if ( evmode == 96 ) {
						evname = lang("ジューア魔鎧戦士", "Juere Magical Warrior")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_JUERE_INFANTRY ) {
							evold = lang("ジューア歩兵", "juere infantry")
							cdata(CDATA_PIC, tc) = xy2pic(14, 22)
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_JUERE_SWORDMAN ) {
							evold = lang("ジューア剣闘士", "juere swordman")
							cdata(CDATA_PIC, tc) = xy2pic(14, 22) + COLOR_BLUE * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
					}
					if ( evmode == 97 ) {
						evname = lang("カブ=トライズ", "Cub Toraizu")
						cdata(CDATA_PIC, tc) = xy2pic(15, 22)
						evold = lang("カブ", "cub")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(20) + 50
						cdata(CDATA_WEIGHT, tc) += rnd(50) + 150
					}
					if ( evmode == 98 ) {
						evname = lang("モーニングスター", "Morningstar")
						evold = lang("ハムスター", "hamster")
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_WEAPON_BLUNT, tc, 20000
					}
					if ( evmode == 99 ) {
						evname = lang("華炎輝竜", "Blazing Flower Dragon")
						evold = lang("火炎機竜", "Machine Dragon Flame")
						cdata(CDATA_PIC, tc) = xy2pic(18, 17)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 50
					}
					if ( evmode == 100 ) {
						evname = lang("ダークネス", "Darkness")
						evold = lang("黒ファントム", "Black Phantom")
						cdata(CDATA_PIC, tc) = xy2pic(21, 19) + COLOR_BLACK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
					}
					if ( evmode == 101 ) {
						evname = lang("ベアーガ", "Bearga")
						if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 1 ) {
							evold = lang("鬼熊", "Demon Bear")
							skillmod SKILL_NORMAL_TACTICS, tc, 10000
							cdata(CDATA_PIC, tc) = xy2pic(19, 23) + COLOR_RED2 * COLOR_TINT_MULT
						}
						if ( cdata(CDATA_EVOLUTION_STAGE, tc) == 2 ) {
							evold = lang("ナヌーク", "Nanook")
							cdata(CDATA_PIC, tc) = xy2pic(19, 23)
						}
						cdata(CDATA_EVOLUTION_STAGE, tc) = 3
						skillmod SKILL_ATTR_SPD, tc, 5000
						skillmod SKILL_ATTR_STR, tc, 20000
						resistmod tc, SKILL_RES_MAGIC, 50 * 10
					}
					if ( evmode == 102 ) {
						evname = lang("キャッスルゴーレム", "Castle Golem")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SMALL_WOODEN_GOLEM ) {
							evold = lang("ちびウッドゴーレム", "small wooden golem")
							cdata(CDATA_PIC, tc) = xy2pic(24, 19) + COLOR_BROWN * COLOR_TINT_MULT
							cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
							cdata(CDATA_WEIGHT, tc) += rnd(5000) + 15000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SMALL_STONE_GOLEM ) {
							evold = lang("ちびストーンゴーレム", "small stone golem")
							cdata(CDATA_PIC, tc) = xy2pic(24, 19)
							cdata(CDATA_HEIGHT, tc) += rnd(500) + 1000
							cdata(CDATA_WEIGHT, tc) += rnd(5000) + 15000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_WOODEN_GOLEM ) {
							evold = lang("ウッドゴーレム", "wooden golem")
							cdata(CDATA_PIC, tc) = xy2pic(24, 19) + COLOR_BROWN * COLOR_TINT_MULT
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_STONE_GOLEM ) {
							evold = lang("ストーンゴーレム", "stone golem")
							cdata(CDATA_PIC, tc) = xy2pic(24, 19)
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_GOLEM ) {
							evold = lang("スティールゴーレム", "steel golem")
							cdata(CDATA_PIC, tc) = xy2pic(24, 19) + COLOR_BLACK * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_SPD, tc, 5000
						skillmod SKILL_ATTR_CON, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 10000
					}
					if ( evmode == 103 ) {
						evname = lang("究極キャッスルゴーレム", "Ultimate Castle Golem")
						evold = lang("キャッスルゴーレム", "Castle Golem")
						cdata(CDATA_PIC, tc) = xy2pic(24, 19) + COLOR_BLUE * COLOR_TINT_MULT
						cdata(CDATA_HEIGHT, tc) += rnd(100) + 500
						cdata(CDATA_WEIGHT, tc) += rnd(2000) + 10000
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 10000
					}
					if ( evmode == 104 ) {
						evname = lang("灼銅大蜘蛛", "Giant Burning Spider")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SPIDER ) {
							evold = lang("まだら蜘蛛", "spider")
							skillmod SKILL_ATTR_SPD, tc, 35000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLACK_WIDOW ) {
							evold = lang("ブラックウィドウ", "black widow")
							skillmod SKILL_ATTR_SPD, tc, 25000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_PARALYZER ) {
							evold = lang("パラライザー", "paralyzer")
							skillmod SKILL_ATTR_SPD, tc, 15000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_TARANTULA ) {
							evold = lang("タランチュラ", "tarantula")
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLOOD_SPIDER ) {
							evold = lang("吸血蜘蛛", "blood spider")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						cdata(CDATA_PIC, tc) = xy2pic(28, 23) + COLOR_PINK * COLOR_TINT_MULT
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 200
						cdata(CDATA_WEIGHT, tc) += rnd(30) + 100
						skillmod SKILL_ATTR_CON, tc, 20000
					}
					if ( evmode == 105 ) {
						evname = lang("赤の守護獣", "Red Guardian Beast")
						evold = lang("ティラノサウルス", "Tyrannosaurus")
						cdata(CDATA_PIC, tc) = xy2pic(25, 19) + COLOR_RED * COLOR_TINT_MULT
						cdata(CDATA_HEIGHT, tc) += rnd(100) + 500
						cdata(CDATA_WEIGHT, tc) += rnd(2000) + 10000
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 30000
						resistmod tc, SKILL_RES_FIRE, 50 * 10
					}
					if ( evmode == 106 ) {
						evname = lang("暗黒ティラノ", "Dark Tyranno")
						evold = lang("ティラノサウルス", "Tyrannosaurus")
						cdata(CDATA_PIC, tc) = xy2pic(26, 11) + COLOR_BLACK * COLOR_TINT_MULT
						cdata(CDATA_HEIGHT, tc) += rnd(100) + 500
						cdata(CDATA_WEIGHT, tc) += rnd(2000) + 10000
						skillmod SKILL_ATTR_SPD, tc, 40000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
						resistmod tc, SKILL_RES_DARKNESS, 50 * 10
					}
					if ( evmode == 107 ) {
						evname = lang("灼銅のアラクニーダ", "Burning Arachnid")
						evold = lang("灼銅大蜘蛛", "Giant Burning Spider")
						cdata(CDATA_PIC, tc) = xy2pic(31, 23) + COLOR_PINK * COLOR_TINT_MULT
						skillmod SKILL_ATTR_CHA, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 30000
					}
					if ( evmode == 108 ) {
						evname = lang("凄銅大蠍", "Giant Dreadful Scorpion")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_SCORPION ) {
							evold = lang("サソリ", "scorpion")
							skillmod SKILL_ATTR_SPD, tc, 35000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_KING_SCORPION ) {
							evold = lang("ダイオウサソリ", "king scorpion")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						cdata(CDATA_PIC, tc) = xy2pic(2, 19) + COLOR_LIGHT_GREEN * COLOR_TINT_MULT
						skillmod SKILL_ATTR_STR, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 200
						cdata(CDATA_WEIGHT, tc) += rnd(30) + 100
					}
					if ( evmode == 109 ) {
						evname = lang("凄銅のアラクニーダ", "Dreadful Arachnid")
						evold = lang("凄銅大蠍", "Giant Dreadful Scorpion")
						cdata(CDATA_PIC, tc) = xy2pic(31, 23) + COLOR_SKY_BLUE * COLOR_TINT_MULT
						skillmod SKILL_ATTR_CHA, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 30000
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
					}
					if ( evmode == 110 ) {
						evname = lang("大王ペンギン", "Great King Penguin")
						evold = lang("放浪ペンギン", "wandering penguin")
						cdata(CDATA_PIC, tc) = xy2pic(8, 25)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 10000
					}
					if ( evmode == 111 ) {
						evname = lang("ステーシー", "Stacy")
						evold = lang("ゾンビ少女", "zombie girl")
						cdata(CDATA_PIC, tc) = xy2pic(10, 25) + COLOR_FRESH * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 15000
						skillmod SKILL_ATTR_LIFE, tc, 15000
					}
					if ( evmode == 112 ) {
						evname = lang("ロマネスク", "Romanesque")
						evold = lang("ゾンビ少女", "zombie girl")
						cdata(CDATA_PIC, tc) = xy2pic(10, 25)
						cdata(CDATA_EVOLUTION_STAGE, tc)++
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
					}
					if ( evmode == 113 ) {
						evname = lang("タナトス", "Thanatos")
						evold = lang("ゾンビ少女", "zombie girl")
						cdata(CDATA_PIC, tc) = xy2pic(10, 25) + COLOR_PINK * COLOR_TINT_MULT
						cdata(CDATA_EVOLUTION_STAGE, tc) += 2
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 25000
					}
					if ( evmode == 114 ) {
						evname = lang("なめくじ", "Slug")
						evold = lang("かたつむり", "snail")
						cdata(CDATA_PIC, tc) = xy2pic(12, 25) + COLOR_BROWN * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 5000
					}
					if ( evmode == 115 ) {
						evname = lang("メタルスラッグ", "Metalslug")
						evold = lang("なめくじ", "slug")
						cdata(CDATA_PIC, tc) = xy2pic(13, 25)
						skillmod SKILL_ATTR_SPD, tc, 5000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_PER, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 80
						cbitmod CHARA_BIT_ARMOUR, tc, 1
					}
					if ( evmode == 116 ) {
						evname = lang("混沌の雷雲龍", "Chaos Stormcloud Dragon")
						evold = lang("ダークソウル", "Dark Soul")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ELECTRIC_CLOUD ) {
							resistmod tc, SKILL_RES_CHAOS, 50 * 10
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_CLOUD ) {
							resistmod tc, SKILL_RES_LIGHTNING, 50 * 10
						}
						skillmod SKILL_ATTR_SPD, tc, 25000
						skillmod SKILL_ATTR_MAG, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(27, 19) + COLOR_BLACK * COLOR_TINT_MULT
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 300
						cdata(CDATA_WEIGHT, tc) += rnd(10) + 5
					}
					if ( evmode == 117 ) {
						evname = lang("ウィルオーガ", "Will-Ogre")
						evold = lang("ダークソウル", "Dark Soul")
						skillmod SKILL_ATTR_SPD, tc, 15000
						skillmod SKILL_ATTR_MAG, tc, 30000
						cdata(CDATA_PIC, tc) = xy2pic(18, 25) + COLOR_BLUE * COLOR_TINT_MULT
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 50
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 20
					}
					if ( evmode == 118 ) {
						evname = lang("クロスモアイ", "Cross Moai")
						evold = lang("モアイ", "moai")
						skillmod SKILL_ATTR_SPD, tc, 15000
						skillmod SKILL_ATTR_CON, tc, 15000
						skillmod SKILL_ATTR_PER, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(16, 25)
						cdata(CDATA_HEIGHT, tc) += rnd(100) + 500
						cdata(CDATA_WEIGHT, tc) += rnd(200) + 2000
					}
					if ( evmode == 119 ) {
						evname = lang("ネクロキマイラ", "Necro Chimera")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ZOMBIE ) {
							evold = lang("ゾンビ", "zombie")
							skillmod SKILL_ATTR_STR, tc, 25000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_EXECUTIONER ) {
							evold = lang("死刑執行人", "executioner")
							skillmod SKILL_ATTR_MAG, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LICH ) {
							evold = lang("リッチ", "lich")
							skillmod SKILL_ATTR_MAG, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LESSER_MUMMY ) {
							evold = lang("レッサーマミー", "lesser mummy")
							skillmod SKILL_ATTR_WIL, tc, 25000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_MUMMY ) {
							evold = lang("マミー", "mummy")
							skillmod SKILL_ATTR_WIL, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GREATER_MUMMY ) {
							evold = lang("グレイターマミー", "greater mummy")
							skillmod SKILL_ATTR_WIL, tc, 15000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ANCIENT_COFFIN ) {
							evold = lang("古代の棺", "ancient coffin")
							skillmod SKILL_ATTR_DEX, tc, 20000
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(15, 25)
					}
					if ( evmode == 120 ) {
						evname = lang("疾風の銀騎", "Silver Kentaurs")
						evold = lang("ケンタウロス", "kentaurs")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(21, 25)
						cdata(CDATA_WEIGHT, tc) += 10
					}
					if ( evmode == 121 ) {
						evname = lang("暴牛神", "Divine Cattle")
						evold = lang("牛", "cattle")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						cdata(CDATA_PIC, tc) = xy2pic(23, 25) + COLOR_BLACK * COLOR_TINT_MULT
					}
					if ( evmode == 122 ) {
						evname = lang("イノブタ", "Pig Boar")
						evold = lang("うりぼう", "child boar")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						cdata(CDATA_PIC, tc) = xy2pic(22, 25) + COLOR_DARK_GRAY * COLOR_TINT_MULT
					}
					if ( evmode == 123 ) {
						evname = lang("ビッグピッグ", "Big Pig")
						evold = lang("イノブタ", "pig boar")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 15000
						skillmod SKILL_ATTR_DEX, tc, 15000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						cdata(CDATA_PIC, tc) = xy2pic(22, 25)
					}
					if ( evmode == 124 ) {
						evname = lang("真紅眼の白兎", "Red-eyes W. Rabbit")
						evold = lang("野うさぎ", "rabbit")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(27, 25)
					}
					if ( evmode == 125 ) {
						evname = lang("シルバニー", "Sylbunny")
						evold = lang("野うさぎ", "rabbit")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_CHA, tc, 10000
						cdata(CDATA_PIC, tc) = xy2pic(32, 23)
						cdata(CDATA_EVOLUTION_STAGE, tc)++
					}
					if ( evmode == 126 ) {
						evname = lang("亡霊姫", "Ghost Princess")
						evold = lang("亡霊", "ghost")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_CHA, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(0, 25)
					}
					if ( evmode == 127 ) {
						evname = lang("ローレライ", "Loreley")
						evold = lang("ニンフ", "nymph")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_CHA, tc, 10000
						skillmod SKILL_ATTR_MAG, tc, 30000
						cdata(CDATA_PIC, tc) = xy2pic(0, 25) + COLOR_YELLOW * COLOR_TINT_MULT
					}
					if ( evmode == 128 ) {
						evname = lang("フロッグンローラー", "Frognrolla")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_FLYING_FROG ) {
							evold = lang("飛び蛙", "flying frog")
							skillmod SKILL_ATTR_SPD, tc, 35000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_POISON_ARROW_FROG ) {
							evold = lang("毒矢蛙", "poison arrow frog")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						cdata(CDATA_PIC, tc) = xy2pic(1, 26)
						skillmod SKILL_ATTR_PER, tc, 20000
						skillmod SKILL_ATTR_CHA, tc, 20000
					}
					if ( evmode == 129 ) {
						evname = lang("メガサラマンダー", "Salamander")
						evold = lang("メルカサラマンダー", "ambystoma")
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_LIFE, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 30000
						cdata(CDATA_PIC, tc) = xy2pic(2, 26)
						cdata(CDATA_HEIGHT, tc) += rnd(50) + 300
						cdata(CDATA_WEIGHT, tc) += rnd(20) + 200
					}
					if ( evmode == 130 ) {
						evname = lang("マグナ・フェアリ", "Magna Fairy")
						evold = lang("妖精", "fairy")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_LIFE, tc, 30000
						skillmod SKILL_ATTR_MAG, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(9, 26)
					}
					if ( evmode == 131 ) {
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIZARD_MAN ) {
							evname = lang("リザードマジェスティ", "Lizard Majesty")
							evold = lang("リザードマン", "lizard man")
							skillmod SKILL_ATTR_SPD, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIZARD_MAGE ) {
							evname = lang("リザードマジェスティ", "Lizard Majesty")
							evold = lang("リザードメイジ", "lizard mage")
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(11, 26) + COLOR_YELLOW2 * COLOR_TINT_MULT
					}
					if ( evmode == 132 ) {
						evname = lang("フレアチック", "Flare Chick")
						evold = lang("ハーピー", "harpy")
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) = rnd(20) + 110
						cdata(CDATA_WEIGHT, tc) = rnd(10) + 20
						cdata(CDATA_PIC, tc) = xy2pic(14, 26)
					}
					if ( evmode == 133 ) {
						evname = lang("フェニキシアン", "Phoenixian")
						evold = lang("フレアチック", "flare chick")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_LIFE, tc, 25000
						skillmod SKILL_ATTR_STR, tc, 20000
						cdata(CDATA_HEIGHT, tc) = rnd(40) + 130
						cdata(CDATA_WEIGHT, tc) = rnd(10) + 35
						resistmod tc, SKILL_RES_FIRE, 50 * 10
						cdata(CDATA_PIC, tc) = xy2pic(13, 26)
					}
					if ( evmode == 134 ) {
						evname = lang("ジャック王", "Jack-King")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_PUPPY ) {
							evold = lang("パピー", "puppy")
							cdata(CDATA_PIC, tc) = xy2pic(5, 27) + COLOR_YELLOW * COLOR_TINT_MULT
							skillmod SKILL_ATTR_SPD, tc, 35000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_PUMPKIN ) {
							evold = lang("パンプキン", "pumpkin")
							cdata(CDATA_PIC, tc) = xy2pic(5, 27)
							skillmod SKILL_ATTR_SPD, tc, 30000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_GREATER_PUMPKIN ) {
							evold = lang("南瓜の怪物", "greater pumpkin")
							cdata(CDATA_PIC, tc) = xy2pic(5, 27) + COLOR_BLUE * COLOR_TINT_MULT
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_HALLOWEEN_NIGHTMARE ) {
							evold = lang("ハロウィンナイトメア", "halloween nightmare")
							cdata(CDATA_PIC, tc) = xy2pic(5, 27) + COLOR_RED * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_LIFE, tc, 30000
						skillmod SKILL_ATTR_CON, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 20000
						cdata(CDATA_HEIGHT, tc) += rnd(20) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(50) + 150
					}
					if ( evmode == 135 ) {
						evname = lang("ソードマンドレイク", "Swordmandrake")
						evold = lang("マンドレイク", "mandrake")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_MANA, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(3, 27) + COLOR_PURPLE * COLOR_TINT_MULT
					}
					if ( evmode == 136 ) {
						evname = lang("グレートインプ", "Great Imp")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_IMP ) {
							evold = lang("インプ", "imp")
							skillmod SKILL_ATTR_SPD, tc, 35000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_NETHER_IMP ) {
							evold = lang("冥界の使い", "nether imp")
							skillmod SKILL_ATTR_SPD, tc, 25000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_CHAOS_IMP ) {
							evold = lang("カオスインプ", "chaos imp")
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						cdata(CDATA_PIC, tc) = xy2pic(14, 6) + COLOR_YELLOW * COLOR_TINT_MULT
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 20000
					}
					if ( evmode == 137 ) {
						evname = lang("スペースマンボウガン", "Zap Gunfish")
						evold = lang("マンボウガン", "gunfish")
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_PER, tc, 30000
						skillmod SKILL_ATTR_DEX, tc, 20000
						cdata(CDATA_PIC, tc) = xy2pic(11, 27) + COLOR_SKY_BLUE * COLOR_TINT_MULT
					}
					if ( evmode == 138 ) {
						evname = lang("マイホーマー", "Landlord Crab")
						evold = lang("ヤドナシ", "homeless crab")
						cdata(CDATA_PIC, tc) = xy2pic(25, 7) + COLOR_YELLOW2 * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 20000
						cbitmod CHARA_BIT_ARMOUR, tc, 1
					}
					if ( evmode == 139 ) {
						evname = lang("マシンストーム", "Machine Storm")
						evold = lang("大型バイク", "large bike")
						cdata(CDATA_PIC, tc) = xy2pic(32, 26) + COLOR_GREEN * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 75000
					}
					if ( evmode == 140 ) {
						evname = lang("紅葉竜樹", "Maple Dragon Tree")
						evold = lang("火炎樹", "fire ent")
						cdata(CDATA_PIC, tc) = xy2pic(4, 28) + COLOR_RED * COLOR_TINT_MULT
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_CON, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 10000
						cbitmod CHARA_BIT_FLOAT, tc, 1
					}
					if ( evmode == 141 ) {
						evname = lang("雪葉竜樹", "Snow Dragon Tree")
						evold = lang("氷結樹", "ice ent")
						cdata(CDATA_PIC, tc) = xy2pic(4, 28)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_DEX, tc, 10000
						skillmod SKILL_ATTR_PER, tc, 10000
						cbitmod CHARA_BIT_FLOAT, tc, 1
					}
					if ( evmode == 142 ) {
						evname = lang("カオス・スプラウト", "Chaos Sprout")
						evold = lang("カオス・シード", "chaos seed")
						if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
							if ( cdata(CDATA_SEX, tc) == 0 ) {
								cdata(CDATA_PIC, tc) = xy2pic(22, 15)
							}
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == lang("男性", "male") | cdatan(CDATAN_NEWSEX, tc) == lang("自称男性", "trans-male") | cdatan(CDATAN_NEWSEX, tc) == lang("なし", "none") ) {
							cdata(CDATA_PIC, tc) = xy2pic(22, 15)
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == "" ) {
							if ( cdata(CDATA_SEX, tc) == 1 ) {
								cdata(CDATA_PIC, tc) = xy2pic(23, 15)
							}
						}
						if ( cdatan(CDATAN_NEWSEX, tc) == lang("女性", "female") | cdatan(CDATAN_NEWSEX, tc) == lang("自称女性", "trans-female") | cdatan(CDATAN_NEWSEX, tc) == lang("両性具有", "hermaphrodite") ) {
							cdata(CDATA_PIC, tc) = xy2pic(23, 15)
						}
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_CON, tc, 10000
						cdata(CDATA_HEIGHT, tc) += rnd(20) + 100
						cdata(CDATA_WEIGHT, tc) += rnd(10) + 30
					}
					if ( evmode == 143 ) {
						evname = lang("カオス・プラント", "Chaos Plant")
						evold = lang("カオス・スプラウト", "chaos sprout")
						cdata(CDATA_PIC, tc) = xy2pic(6, 28)
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_DEX, tc, 15000
						skillmod SKILL_ATTR_CON, tc, 15000
						cdata(CDATA_HEIGHT, tc) += rnd(200) + 1000
						cdata(CDATA_WEIGHT, tc) += rnd(1000) + 5000
					}
					if ( evmode == 144 ) {
						evname = lang("天虫", "God Moth")
						evold = lang("芋虫スナイパー", "caterpillar sniper")
						cdata(CDATA_PIC, tc) = xy2pic(14, 30)
						skillmod SKILL_ATTR_LIFE, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 30000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_DEX, tc, 15000
						cdata(CDATA_HEIGHT, tc) += 5
					}
					if ( evmode == 145 ) {
						evname = lang("ボブルバブル", "Bobble Bubble")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BLUE_BUBBLE ) {
							evold = lang("ブルーバブル", "blue bubble")
							cdata(CDATA_PIC, tc) = xy2pic(6, 10) + COLOR_BLUE * COLOR_TINT_MULT
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_BUBBLE ) {
							evold = lang("バブル", "bubble")
							cdata(CDATA_PIC, tc) = xy2pic(6, 10)
							skillmod SKILL_ATTR_SPD, tc, 20000
						}
						skillmod SKILL_ATTR_LIFE, tc, 20000
						skillmod SKILL_NORMAL_CASTING, tc, 10000
						skillmod SKILL_NORMAL_CONTROL_MAGIC, tc, 10000
						cdata(CDATA_HEIGHT, tc) = rnd(20) + 140
						cdata(CDATA_WEIGHT, tc) = rnd(10) + 40
					}
					if ( evmode == 146 ) {
						evname = lang("魔闘人形", "Battle Puppet")
						evold = lang("パペット", "puppet")
						cdata(CDATA_PIC, tc) = xy2pic(13, 28)
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_CON, tc, 15000
					}
					if ( evmode == 147 ) {
						evname = lang("義賊", "Gizoku")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_THIEF ) {
							evold = lang("見習い盗賊", "thief")
							cdata(CDATA_PIC, tc) = xy2pic(5, 10)
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_ROBBER ) {
							evold = lang("強盗", "robber")
							cdata(CDATA_PIC, tc) = xy2pic(5, 10) + COLOR_RED * COLOR_TINT_MULT
							skillmod SKILL_ATTR_SPD, tc, 15000
						}
						skillmod SKILL_ATTR_DEX, tc, 20000
						skillmod SKILL_ATTR_WIL, tc, 10000
						skillmod SKILL_ACTIVE_PICKPOCKET, tc, 10000
					}
					if ( evmode == 148 ) {
						evname = lang("白衣のレッドクロス", "Red Cross")
						evold = lang("白衣のナース", "nurse")
						cdata(CDATA_PIC, tc) = xy2pic(24, 4)
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_WIL, tc, 15000
						skillmod SKILL_ATTR_MAG, tc, 15000
					}
					if ( evmode == 149 ) {
						evname = lang("不屈の闘将", "Indomitable General")
						evold = lang("敗残兵", "fallen soldier")
						cdata(CDATA_PIC, tc) = xy2pic(13, 29)
						skillmod SKILL_ATTR_LIFE, tc, 25000
						skillmod SKILL_ATTR_SPD, tc, 15000
						skillmod SKILL_ATTR_WIL, tc, 20000
					}
					if ( evmode == 150 ) {
						evname = lang("ロードアーマー", "Lord Armor")
						evold = lang("デュラハン", "durahan")
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_LIVING_ARMOR ) {
							cdata(CDATA_PIC, tc) = xy2pic(18, 28)
						}
						if ( cdata(CDATA_ID, tc) == CREATURE_ID_STEEL_MASS ) {
							cdata(CDATA_PIC, tc) = xy2pic(18, 28) + COLOR_LIGHT_BLUE * COLOR_TINT_MULT
						}
						skillmod SKILL_ATTR_LIFE, tc, 50000
						skillmod SKILL_ATTR_SPD, tc, 10000
					}
					if ( evmode == 151 ) {
						evname = lang("少年スカウト", "scout boy")
						evold = lang("少年", "little boy")
						cdata(CDATA_PIC, tc) = xy2pic(7, 33)
						skillmod SKILL_ATTR_SPD, tc, 10000
						skillmod SKILL_ATTR_CON, tc, 10000
						skillmod SKILL_NORMAL_COOKING, tc, 10000
						skillmod SKILL_NORMAL_CARPENTRY, tc, 10000
					}
					if ( evmode == 152 ) {
						evname = lang("闘拳男士", "battle boy")
						evold = lang("少年スカウト", "boy scout")
						cdata(CDATA_PIC, tc) = xy2pic(8, 33)
						skillmod SKILL_ATTR_SPD, tc, 15000
						skillmod SKILL_ATTR_STR, tc, 15000
						skillmod SKILL_ATTR_DEX, tc, 15000
					}
					if ( evmode == 153 ) {
						evname = lang("執事羊", "sheep butler")
						evold = lang("執事", "butler")
						cdata(CDATA_PIC, tc) = xy2pic(9, 33)
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ATTR_MAG, tc, 20000
					}
					if ( evmode == 154 ) {
						evname = lang("ビスクドールズ", "bisque dolls")
						evold = lang("ビスクドール", "bisque doll")
						cdata(CDATA_PIC, tc) = xy2pic(10, 33)
						skillmod SKILL_ATTR_MAG, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 20000
					}
					if ( evmode == 155 ) {
						evname = lang("オーボルト", "king kobold")
						evold = lang("コボルト", "kobold")
						cdata(CDATA_PIC, tc) = xy2pic(27, 28)
						skillmod SKILL_ATTR_LIFE, tc, 10000
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 30000
					}
					if ( evmode == 156 ) {
						evname = lang("王躯", "king orc")
						if ( cdata(CDATA_ID, tc) == 17 ) {
							evold = lang("オーク", "orc")
							cdata(CDATA_PIC, tc) = 953 + 17 * 1000
							skillmod SKILL_ATTR_SPD, tc, 15000
						}
						if ( cdata(CDATA_ID, tc) == 20 ) {
							evold = lang("オークの戦士", "orc warrior")
							cdata(CDATA_PIC, tc) = 953
							skillmod SKILL_ATTR_SPD, tc, 10000
						}
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_LIFE, tc, 30000
						cdata(CDATA_HEIGHT, tc) += rnd(20) + 50
						cdata(CDATA_WEIGHT, tc) += rnd(10) + 40
					}
					if ( evmode == 157 ) {
						evname = lang("バーニングポーク", "burning pork")
						evold = lang("ポーク", "porc")
						cdata(CDATA_PIC, tc) = 847
						skillmod SKILL_ATTR_STR, tc, 20000
						skillmod SKILL_ATTR_SPD, tc, 20000
						skillmod SKILL_ACTIVE_RIDING, tc, 10000
					}
					if ( synccheck(tc, -1) ) {
						txtef COLOR_GREEN
						txt lang("おめでとう！" + cdatan(CDATAN_NAME, tc) + "は" + evname + "に進化した！", "Congratulations! Your friend has evolved!")
					}
					cdata(CDATA_HP, tc) = cdata(CDATA_MAX_HP, tc)
					if ( strmid(cdatan(CDATAN_NAME, tc), 0, strlen(evold)) == evold ) {
						cdatan(CDATAN_NAME, tc) = evname + strmid(cdatan(CDATAN_NAME, tc), strlen(evold), strlen(cdatan(CDATAN_NAME, tc)) - strlen(evold))
					}
					inv(INV_ITEM_NUM, ci)--
					cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
					cdata(CDATA_EVOLUTION_STAGE, tc) += 1
					evmode = 0
					goto *turn_end
				}
				txt lang("組み合わせが違うようだ。", "Doesn't seem to be a valid combination.")
				evmode = 0
				goto *turn_end
			}
		}
		if ( f == 0 ) {
			txt_impossible
		}
		txt lang("仲間にしか使えない。", "You can only use it on an ally.")
		evmode = 0
		goto *turn_end
	}
	if ( _switch_val == EFFECT_OBJET_OF_HEART | _switch_sw ) {
		_switch_sw = 0
		txt_activateitem
		efid = inv(INV_ITEM_PARAM1, ci)
		efp = inv(INV_ITEM_PARAM2, ci)
		tc = cc
		efstatus = 0
		gosub *effect
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SECRET_EXP_KUMIROMI | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_NEW_FEAT) > cdata(CDATA_LEVEL, CHARA_PLAYER) ) {
			txt lang("クミロミの声がした。「ダメ…経験…足りない…」", "Kumiromi talks to you, " + cnvtalk("No... you aren't... experienced enough... for this..."))
			gosub *screen_draw
			goto *pc_turn
		}
		snd SOUNDLIST_PRAY1
		gdata(GDATA_NEW_FEAT) += 10
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		gdata(GDATA_TRAIT_POINT)++
		txt lang("「…よく…経験をつんだね…酬いてあげる…」", cnvtalk("...You have acquired enough... experience... I shall reward you..."))
		txtef COLOR_YELLOW
		txt lang("クミロミはあなたを祝福した。あなたは新たなフィートを取得できるようになった！", "Kumiromi blesses you. You can obtain one more feat now!")
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SECRET_EXP_LOMIAS | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_CURSE1
		txtef COLOR_PURPLE
		txt lang("何だか嫌な予感がする…", "You have a bad feeling about this...")
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_ROPE | _switch_sw ) {
		_switch_sw = 0
		txtnew
		txt lang("本当に首を吊る？", "Really hang yourself?")
		promptYesNo
		if ( rtval != 0 ) {
			goto *turn_end
		}
		dmghp CHARA_PLAYER, 99999, DAMAGE_FROM_HANGING
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_SEPPUKU | _switch_sw ) {
		_switch_sw = 0
		txtnew
		txt lang("本当に腹を切る？", "Really commit seppuku?")
		promptYesNo
		if ( rtval != 0 ) {
			goto *turn_end
		}
		txtef COLOR_RED2
		txt lang("あなたはこの場をおさめるために腹を切った！", "You cut your belly as an apology!")
		snd SOUNDLIST_STAB
		cdata(CDATA_HP, CHARA_PLAYER) = cdata(CDATA_HP, CHARA_PLAYER) / 8
		dmgcon CHARA_PLAYER, CONDITION_BLEED, 1000
		if ( gdata(GDATA_FLAG_DUEL_TARGET) > 0 ) {
			gdata(GDATA_FLAG_DUEL_TARGET) = 0
			txt lang("＊決闘終了＊", "*Duel-Over!*")
		}
		repeat MAX_CHARA_TOTAL
			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
				continue
			}
			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) > sdataref(SKILL_DATAREF_TG_RANGE, SKILL_SPACT_CHEER) \ EXT_SDATAREF + 1 ) {
				continue
			}
			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, cnt), cdata(CDATA_Y, cnt)) == 0 ) {
				continue
			}
			cdata(CDATA_AI_AGGRO, cnt) = 0
			cdata(CDATA_TARGET, cc) = 0
			if ( cdata(CDATA_RELATION_ORG, cnt) >= (-2) ) {
				if ( cdata(CDATA_RELATION, cnt) <= (-2) ) {
					cdata(CDATA_RELATION, cnt) = cdata(CDATA_RELATION_ORG, cnt)
				}
			}
			if ( cdata(CDATA_CONDITION_SEPPUKU, cnt) > 0 ) {
				snd SOUNDLIST_ATKSWORD
				txtef COLOR_RED
				txt lang("「介錯つかまつる！」 *ブシュッ* ", "*Kaisyaku*")
				txt lang(name(cnt) + "は" + name(CHARA_PLAYER) + "の首をちょんぎった。", name(cnt) + " cut" + _s(cnt) + " " + name(CHARA_PLAYER) + your(CHARA_PLAYER) + " head.")
				cdata(CDATA_HP, CHARA_PLAYER) = 1
				cdata(CDATA_MP, CHARA_PLAYER) = 0
				dmghp CHARA_PLAYER, cdata(CDATA_MAX_HP, CHARA_PLAYER), cnt, SKILL_SPACT_DECAPITATION
				break
			}
			if ( cnt != CHARA_PLAYER ) {
				cdata(CDATA_CONDITION_SEPPUKU, cnt) = 15 + rnd(36)
			}
			if ( cnt < MAX_CHARA_FOLLOWER ) {
				continue
			}
			if ( rnd(2) == 0 ) {
				continue
			}
			txt lang("「ナイスハラキリ！」", cnvtalk("Nice harakiri!")), lang("「気が変わらないうちに早く行け」", cnvtalk("Leave before my mind changes!")), lang("「なんて無茶を…」", cnvtalk("Oh...!")), lang("「見事な切腹よ」", cnvtalk("It's a splendid seppuku!"))
		loop
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_MONSTER_BALL | _switch_sw ) {
		_switch_sw = 0
		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE | (gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 179) ) {
			txt_cantusehere
			goto *act_use_SWEND1
		}
		if ( inv(INV_ITEM_SUB_NAME, ci) == CREATURE_ID_BUG ) {
			txt lang("モンスターボールは空っぽだ。", "This ball is empty.")
			goto *act_use_SWEND1
		}
		if ( get_freeally() == 0 ) {
			txt lang("仲間はこれ以上増やせない。", "Your party is full.")
			goto *act_use_SWEND1
		}
		txt lang(itemname(ci, 1) + "を使用した。", "You activate " + itemname(ci, 1) + ".")
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		flt
		novoidlv = 1
		fixlv = FIX_QUALITY_GOOD
		characreate MAX_CHARA_NC, inv(INV_ITEM_SUB_NAME, ci), -3, 0
		rc = MAX_CHARA_NC
		gosub *add_ally
		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_FERTILIZER | _switch_sw ) {
		_switch_sw = 0
		x = cdata(CDATA_X, cc)
		y = cdata(CDATA_Y, cc)
		cell_featread x, y
		if ( chipm(CHIPM_ROLE, map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0)) != MAP_CHIP_ROLE_CROP ) {
			txt lang("畑以外には施肥できない。", "You can not fertilize non-field tiles.")
			goto *act_use_SWEND1
		}
		if ( feat != tile_plant + 1 ) {
			txt lang("それは成長途中の作物にしか使えない。", "This can only be used for growing crops.")
			goto *act_use_SWEND1
		}
		if ( feat == tile_plant + 2 ) {
			txt lang("この作物は既に成長しきっている。", "The plant is already fully grown.")
			goto *act_use_SWEND1
		}
		if ( feat == tile_plant + 1 ) {
			inv(INV_ITEM_NUM, ci)--
			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
			feat = tile_plant + 6
			txt lang("作物がみるみる成長していく！", "The plant grows.")
		}
		cell_featset x, y, feat, feat(1), feat(2), feat(3)
		animeload ANIMATION_FIZZLE, CHARA_PLAYER
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_KUMIROMI_GEMSTONE | _switch_sw ) {
		_switch_sw = 0
		x = cdata(CDATA_X, cc)
		y = cdata(CDATA_Y, cc)
		cell_featread x, y
		if ( feat(1) != CELL_FEATURE_PLANTED_SEED ) {
			txt lang("それは種を植えた場所で使わなければならない。", "You don't see any plant on the ground.")
			goto *act_use_SWEND1
		}
		if ( feat == tile_plant + 2 ) {
			txt lang("この作物は既に成長しきっている。", "The plant is already fully grown.")
			goto *act_use_SWEND1
		}
		if ( feat == tile_plant + 3 ) {
			feat = tile_plant + 1
			gosub *item_seedNextGrowth
			txt lang("枯れた植物に生命が宿った。", "The plant revives.")
		}
		else {
			feat++
			txt lang("植物は成長した。", "The plant grows.")
		}
		cell_featset x, y, feat, feat(1), feat(2), feat(3)
		animeload ANIMATION_FIZZLE, CHARA_PLAYER
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_GENE_MERGE | _switch_sw ) {
		_switch_sw = 0
		txtnew
		txt lang("まずは素体となる仲間を選ぶ必要がある。", "First off, you need to choose the ally who will be the prime body.")
		txtmore
		rc = CHARA_PLAYER
		allyctrl = 5
		gosub *com_ally
		if ( stat == (-1) ) {
			goto *turn_end
		}
		rc = stat
		txtnew
		txt lang("能力を取り出す仲間を選ぶ必要がある。この仲間は合成後、永久に失われる。", "Now choose an ally to extract the ability from. This ally will be permanently lost after the synthesis.")
		txtmore
		allyctrl = 5

		/********** ORIGINAL - BEGINNING **********

		gosub *com_ally

		 ********** ORIGINAL - ENDING **********/

		/********** ANNA CUSTOM - BEGINNING **********/

		PAllyFilter = 1
		gosub *com_ally
		PAllyFilter = 0

		/********** ANNA CUSTOM - ENDING **********/

		if ( stat == (-1) ) {
			goto *turn_end
		}
		tc = stat
		if ( cdata(CDATA_PRECIOUS_ALLY, tc) != 0 ) {
			snd SOUNDLIST_FAIL1
			txt lang(cdatan(CDATAN_NAME, tc) + "はあなたの大事な仲間だ。", cdatan(CDATAN_NAME, tc) + " is a precious ally.")
			goto *turn_end
		}
		gosub *screen_draw
		txtnew
		txt lang("本当に" + cdatan(CDATAN_NAME, rc) + "に" + cdatan(CDATAN_NAME, tc) + "の能力を組み込む？", "Really add " + cdatan(CDATAN_NAME, tc) + "'s gene to " + cdatan(CDATAN_NAME, rc) + "?")
		promptYesNo
		if ( rtval != 0 ) {
			goto *turn_end
		}
		txtnew
		txtef COLOR_YELLOW
		txt lang("" + cdatan(CDATAN_NAME, rc) + "は" + cdatan(CDATAN_NAME, tc) + "の能力を受けついだ！", "" + cdatan(CDATAN_NAME, rc) + " has inherited " + cdatan(CDATAN_NAME, tc) + "'s gene!")
		animeid = ANIMATION_GENE
		anic = rc
		gosub *anime
		gosub *gene_body
		if ( stat != (-1) ) {
			cdata(stat, rc) = rtval * 10000
			txtef COLOR_GREEN
			txt lang(cdatan(CDATAN_NAME, rc) + "は新しい" + bodyn(rtval) + "を得た！", cdatan(CDATAN_NAME, rc) + " gains new " + bodyn(rtval) + "!")
			r1 = rc
			gosub *calcBodyFix
		}
		gosub *gene_skill
		if ( stat != 0 ) {
			repeat 2
				if ( rtval(cnt) == (-1) ) {
					break
				}
				skillgain rc, rtval(cnt), 1
				txtef COLOR_GREEN
				txt lang(cdatan(CDATAN_NAME, rc) + "は" + skillname(rtval(cnt)) + "の技術を覚えた！", cdatan(CDATAN_NAME, rc) + " learns " + skillname(rtval(cnt)) + " skill!")
			loop
		}
		if ( cdata(CDATA_LEVEL, tc) > cdata(CDATA_LEVEL, rc) ) {
			if ( cdata(CDATA_ID, tc) != CREATURE_ID_USER ) {
				lv = (cdata(CDATA_LEVEL, tc) - cdata(CDATA_LEVEL, rc)) / 2 + 1
				repeat lv
					r1 = rc
					r2 = 1
					gosub *calcLevelUp
				loop
				txtef COLOR_GREEN
				txt lang(cdatan(CDATAN_NAME, rc) + "はレベル" + cdata(CDATA_LEVEL, rc) + "になった！", cdatan(CDATAN_NAME, rc) + " is now level " + cdata(CDATA_LEVEL, rc) + "!")
				listmax = 0
				repeat (STARTING_SKILL_ATTR + MAX_SKILL_ATTR_BASIC) - STARTING_SKILL_ATTR, STARTING_SKILL_ATTR
					list(0, listmax) = cnt, sorg(cnt, tc)
					listmax++
				loop
				gosub *sort_list
				repeat 3
					p = listmax - cnt - 1
					i = list(0, p)
					if ( list(1, p) > sorg(i, rc) ) {
						p = (list(1, p) - sorg(i, rc)) * 500
						p = limit(p * 10 / limit(lv, 2, 10), 1000, 10000)
						skillmod i, rc, p
						txtmore
					}
				loop
			}
		}
		cdata(CDATA_AREA, tc) = AREA_NONE

		/********** ANNA CUSTOM - BEGINNING **********/

		AllyID = tc
		gosub *DeleteAIInfo

		/********** ANNA CUSTOM - ENDING **********/

		chara_vanquish tc
		skillexp SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER, 1200
		randomize
		screenupdate = -1
		gosub *screen_draw
		cc = rc
		csctrl = 4
		snd SOUNDLIST_POP2
		gosub *com_charainfo
		cc = CHARA_PLAYER
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_IRON_MAIDEN | _switch_sw ) {
		_switch_sw = 0
		txt lang("あなたはアイアンメイデンの中に入った。", "You enter the iron maiden.")
		txtmore
		txtef COLOR_SKY_BLUE
		txt lang("「わくわく♪」", cnvtalk("Interesting!"))
		txtmore
		txt lang("突然誰かが蓋を閉めた。", "Suddenly, someone closes the door.")
		txtmore
		txtef COLOR_SKY_BLUE
		txt lang("「ニヤリ」", "*Grin*")
		dmghp CHARA_PLAYER, 9999, DAMAGE_FROM_MAIDEN
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_GUILLOTINE | _switch_sw ) {
		_switch_sw = 0
		txt lang("あなたはギロチンに首をつっこんでみた。", "You set your head on the guillotine.")
		txtmore
		txtef COLOR_SKY_BLUE
		txt lang("「わくわく♪」", cnvtalk("Interesting!"))
		txtmore
		txt lang("突然誰かがギロチンの刃を落とした。", "Suddenly, someone activates the guillotine.")
		txtmore
		txtef COLOR_SKY_BLUE
		txt lang("「ニヤリ」", "*Grin*")
		dmghp CHARA_PLAYER, 9999, DAMAGE_FROM_GUILLOTINE
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_WHISTLE | _switch_sw ) {
		_switch_sw = 0
		snd SOUNDLIST_WHISTLE
		txtef COLOR_SKY_BLUE
		txt lang(" *ピーーーー* ", " *Peeeeeeeeeep* ")
		make_sound cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 10, 1, 1, cc
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_DECK | _switch_sw ) {
		_switch_sw = 0
		tcgdeck
		gosub *map_prepareTile
		gosub *screen_refreshFull
		txtnew
		txt lang("デッキをしまった。", "You put away the deck.")
		goto *act_use_SWEND1
	}
	if ( _switch_val == EFFECT_CARD | _switch_sw ) {
		_switch_sw = 0
		inv_find ITEM_ID_DECK, CHARA_PLAYER
		if ( stat == (-1) ) {
			txt lang("デッキを所持していない。", "You don't have a deck.")
			gosub *screen_draw
			goto *pc_turn
		}
		snd SOUNDLIST_CARD1
		inv(INV_ITEM_NUM, ci)--
		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
		txt lang(itemname(ci, 1) + "をデッキに加えた。", "You add " + itemname(ci, 1) + " to your deck.")
		card(0, inv(INV_ITEM_SUB_NAME, ci))++
		goto *act_use_SWEND1
	}
*act_use_SWEND1
	gosub *calcBurdenPc
	goto *turn_end

*gene_skill
	if ( cdata(CDATA_ID, tc) == CREATURE_ID_USER ) {
		return 0
	}
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) ) {
		return 0
	}
	randomize cdata(CDATA_ID, tc)
	dbmax = 0
	repeat 100
		rtval = rnd(MAX_SKILL_NORMAL - STARTING_SKILL_NORMAL) + STARTING_SKILL_NORMAL
		if ( sdata(rtval, rc) == 0 ) {
			if ( sdata(rtval, tc) > 0 ) {
				dblist(0, dbmax) = rtval
				dbmax++
			}
		}
	loop
	repeat 10
		rtval = rnd(MAX_SKILL_ACTIVE - STARTING_SKILL_ACTIVE) + STARTING_SKILL_ACTIVE
		if ( sdata(rtval, rc) == 0 ) {
			if ( sdata(rtval, tc) > 0 ) {
				dblist(0, dbmax) = rtval
				dbmax++
			}
		}
	loop
	rtval = dblist(0, 0), -1
	if ( dbmax >= 2 ) {
		if ( rnd(3) == 0 ) {
			repeat dbmax - 1, 1
				if ( dblist(0, cnt) != rtval ) {
					rtval(1) = dblist(0, cnt)
					break
				}
			loop
		}
	}
	randomize
	return dbmax

*gene_body
	dbmax = 0
	s(1) = refchara(cdata(CDATA_ID, tc), DBSPEC_CHARA_FILTER, 1)
	if ( instr(s(1), 0, "/man/") != (-1) ) {
		return -1
	}
	if ( cdata(CDATA_ID, tc) == CREATURE_ID_USER ) {
		return -1
	}
	if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) | cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) | cbit(CHARA_BIT_ALTERED_LIMBS, tc) ) {
		return -1
	}
	rtval(1) = -1
	repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
		if ( cdata(cnt, rc) == 0 ) {
			rtval(1) = cnt
		}
	loop
	if ( rtval(1) == (-1) ) {
		return -1
	}
	repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
		f = cdata(cnt, tc) / EXT_EQUIP_SLOTS
		if ( f == 11 | f == 10 | f == 4 ) {
			continue
		}
		if ( f != 0 ) {
			dblist(0, dbmax) = f
			dbmax++
		}
	loop
	if ( dbmax == 0 ) {
		return -1
	}
	randomize cdata(CDATA_ID, tc)
	repeat 3
		rtval = dblist(0, rnd(dbmax))
		f = 0
		repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
			if ( cdata(cnt, rc) == 0 ) {
				continue
			}
			if ( cdata(cnt, rc) / EXT_EQUIP_SLOTS == rtval ) {
				f = 1
			}
		loop
		if ( f ) {
			break
		}
	loop
	if ( f == 0 ) {
		randomize
		return rtval(1)
	}
	dim dblist, 2, MAX_DB
	repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
		dblist(0, cdata(cnt, tc) / EXT_EQUIP_SLOTS)++
	loop
	repeat 25
		rtval = rnd(15) + 1
		f = 0
		repeat MAX_EQUIP_SLOT_TOTAL, CDATA_STARTING_EQUIP_SLOTS
			if ( cdata(cnt, rc) / EXT_EQUIP_SLOTS == rtval ) {
				f++
			}
		loop
		if ( f < dblist(0, rtval) ) {
			f = -1
			break
		}
	loop
	randomize
	if ( f == (-1) ) {
		return rtval(1)
	}
	else {
		return -1
	}

*item_seed
	screenupdate = -1
	gosub *screen_draw
	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD | mdata(MDATA_TYPE) == MAP_TYPE_TOWN | mdata(MDATA_TYPE) == MAP_TYPE_VILLAGE ) {
		txt lang("この場所には埋められない。", "You can't plant it here.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 6) != 0 ) {
		txt lang("この場所には埋められない。", "You can't plant it here.")
		gosub *screen_draw
		goto *pc_turn
	}
	if ( chipm(CHIPM_ROLE, map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0)) == MAP_CHIP_ROLE_CROP ) {
		val = 1
	}
	else {
		val = 0
	}
	feat = tile_plant, CELL_FEATURE_PLANTED_SEED, inv(INV_ITEM_MATERIAL, ci)
	gosub *item_seedNextGrowth
	if ( val ) {
		s = lang("畑に" + itemname(ci, 1) + "を埋めた。", "You plant " + itemname(ci, 1) + " in the field.")
	}
	else {
		s = lang("" + itemname(ci, 1) + "を埋めた。", "You plant " + itemname(ci, 1) + ".")
	}
	s += ""
	txt s
	snd SOUNDLIST_BUSH1
	removeitem ci, 1
	cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tile_plant, CELL_FEATURE_PLANTED_SEED, inv(INV_ITEM_MATERIAL, ci), feat(3)
	goto *turn_end

*item_seedGrowth
	if ( feat == tile_plant + 6 ) {
		return
	}
	feat(3)--
	if ( feat(3) \ 50 == 0 ) {
		if ( feat(3) >= 50 ) {
			feat = tile_plant + 3
		}
		else {
			feat++
			gosub *item_seedNextGrowth
		}
	}
	return

*item_seedNextGrowth
	if ( feat == tile_plant + 6 ) {
		return
	}
	feat(3) = 4 + rnd(4 + 1)
	p = 10
	if ( feat(2) == CELL_SUB_FEATURE_SEED_GEM ) {
		p = 15
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_MAGIC ) {
		p = 25
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_HERB ) {
		p = 30
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_STRANGE ) {
		p = 25
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
		p = 40
	}
	if ( val == 0 ) {
		p = p * 3 / 2
	}
	if ( val == 1 ) {
		p = p * 1 / 2
	}
	if ( feat == tile_plant ) {
		if ( gdata(GDATA_WEATHER) < WEATHER_RAIN ) {
			p = p * 2
		}
	}
	if ( sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) < rnd(p + 1) | rnd(20) == 0 ) {
		feat(3) += 50
	}
	return

*item_seedRegrowth
	p = 15
	if ( feat(2) == CELL_SUB_FEATURE_SEED_GEM ) {
		p = 25
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_MAGIC ) {
		p = 30
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_HERB ) {
		p = 40
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_STRANGE ) {
		p = 35
	}
	if ( val == 0 ) {
		p = p * 4
	}
	if ( val == 1 ) {
		p = p * 1 / 2
	}
	if ( gdata(GDATA_WEATHER) < WEATHER_RAIN ) {
		p = p * 4 / 3
	}
	saibai = 0
	item_find ITEM_ID_SCISSORS_OF_KUMIROMI, 3, 1
	if ( stat != (-1) ) {
		if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
			saibai = 100
		}
	}
	if ( sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) < rnd(p + 1) | rnd(200) < p - saibai | feat(2) == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
		map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 6) = 0
		return
	}
	saibai = 0
	feat = tile_plant
	gosub *item_seedNextGrowth
	cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), feat, feat(1), feat(2), feat(3)
	txtef COLOR_GREEN
	txt lang("新しい芽が息吹いている！", "A new plant grows!")
	return

*item_seedRegrowth_custom
	p = 15
	if ( feat(2) == CELL_SUB_FEATURE_SEED_GEM ) {
		p = 25
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_MAGIC ) {
		p = 30
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_HERB ) {
		p = 40
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_STRANGE ) {
		p = 35
	}
	if ( val == 0 ) {
		p = p * 4
	}
	if ( val == 1 ) {
		p = p * 1 / 2
	}
	if ( gdata(GDATA_WEATHER) < WEATHER_RAIN ) {
		p = p * 4 / 3
	}
	saibai = 0
	item_find ITEM_ID_SCISSORS_OF_KUMIROMI, 3, 1
	if ( stat != (-1) ) {
		if ( inv(INV_ITEM_NUM, stat) >= 1 ) {
			saibai = 100
		}
	}
	if ( sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) < rnd(p + 1) | rnd(200) < p - saibai | feat(2) == CELL_SUB_FEATURE_SEED_ARTIFACT ) {
		map(x, y, 6) = 0
		return
	}
	saibai = 0
	feat = tile_plant
	gosub *item_seedNextGrowth
	cell_featset x, y, feat, feat(1), feat(2), feat(3)
	return

*item_seedPick_custom
	skillexp SKILL_NORMAL_GARDENING, CHARA_PLAYER, 300
	gardenlv = 0
	flt (sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) + 1) / 2 + 15, 2
	dbid = 0
	if ( feat(2) == CELL_SUB_FEATURE_SEED_STRANGE ) {
		if ( rnd(6) == 0 ) {
			flttypemajor = fsetplantunknown(rnd(length(fsetplantunknowns)))
		}
		else {
			gardenlv = 10
			if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
				dbid = isetplantunknownh(rnd(length(isetplantunknownh)))
			}
			if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
				dbid = isetplantunknownn(rnd(length(isetplantunknownn)))
			}
			if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
				dbid = isetplantunknowna(rnd(length(isetplantunknowna)))
			}
			if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
				dbid = isetplantunknownf(rnd(length(isetplantunknownf)))
			}
		}
		if ( rnd(100) == 0 ) {
			dbid = ITEM_ID_POTION_CURE_CORRUPTION
			gardenlv = 0
		}
	}
	if ( gardenlv != 10 ) {
		if ( feat(2) == CELL_SUB_FEATURE_SEED_ARTIFACT | (feat(2) == CELL_SUB_FEATURE_SEED_STRANGE & rnd(50) == 0) ) {
			flttypemajor = fsetplantartifact(rnd(length(fsetplantartifact)))
			fixlv = FIX_QUALITY_MIRACLE
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		}
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_VEGETABLE ) {
		gardenlv = 10
		if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
			dbid = isetplantvegeh(rnd(length(isetplantvegeh)))
		}
		if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
			dbid = isetplantvegen(rnd(length(isetplantvegen)))
		}
		if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
			dbid = isetplantvegea(rnd(length(isetplantvegea)))
		}
		if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
			dbid = isetplantvegef(rnd(length(isetplantvegef)))
		}
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_FRUIT ) {
		gardenlv = 10
		if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
			dbid = isetplantfruith(rnd(length(isetplantfruith)))
		}
		if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
			dbid = isetplantfruitn(rnd(length(isetplantfruitn)))
		}
		if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
			dbid = isetplantfruita(rnd(length(isetplantfruita)))
		}
		if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
			dbid = isetplantfruitf(rnd(length(isetplantfruitf)))
		}
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_HERB ) {
		flttypeminor = FILTER_ITEM_FOOD_HERB
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_GEM ) {
		flttypeminor = FILTER_ORE_GEM
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_MAGIC ) {
		if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
			flttypeminor = FILTER_ITEM_ROD_HEALING
		}
		if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
			flttypeminor = FILTER_ITEM_ROD_DAMAGE
		}
		if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
			flttypeminor = FILTER_ITEM_ROD_UTILITY
		}
		if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
			flttypeminor = FILTER_ITEM_ROD_ENVIRONMENTAL
		}
	}
	if ( gardenlv != 0 ) {
		itemcreate -1, dbid, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		inv(INV_ITEM_LEVEL, ci) += limit(rnd((sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) + 1) / 12 + 2), 0, 10)
		if ( feat == tile_plant + 6 ) {
			inv(INV_ITEM_LEVEL, ci) += 5
		}
		gardenlv = 0
	}
	else {
		itemcreate -1, dbid, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
	}
	item_stack -1, ci, 1
	return

*item_seedPick
	skillexp SKILL_NORMAL_GARDENING, CHARA_PLAYER, 300
	gardenlv = 0
	snd SOUNDLIST_BUSH1
	flt (sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) + 1) / 2 + 15, 2
	dbid = 0
	if ( feat(2) == CELL_SUB_FEATURE_SEED_STRANGE ) {
		if ( rnd(6) == 0 ) {
			flttypemajor = fsetplantunknown(rnd(length(fsetplantunknowns)))
		}
		else {
			gardenlv = 10
			if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
				dbid = isetplantunknownh(rnd(length(isetplantunknownh)))
			}
			if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
				dbid = isetplantunknownn(rnd(length(isetplantunknownn)))
			}
			if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
				dbid = isetplantunknowna(rnd(length(isetplantunknowna)))
			}
			if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
				dbid = isetplantunknownf(rnd(length(isetplantunknownf)))
			}
		}
		if ( rnd(100) == 0 ) {
			dbid = ITEM_ID_POTION_CURE_CORRUPTION
			gardenlv = 0
		}
	}
	if ( gardenlv != 10 ) {
		if ( feat(2) == CELL_SUB_FEATURE_SEED_ARTIFACT | (feat(2) == CELL_SUB_FEATURE_SEED_STRANGE & rnd(50) == 0) ) {
			flttypemajor = fsetplantartifact(rnd(length(fsetplantartifact)))
			fixlv = FIX_QUALITY_MIRACLE
			autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
		}
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_VEGETABLE ) {
		gardenlv = 10
		if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
			dbid = isetplantvegeh(rnd(length(isetplantvegeh)))
		}
		if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
			dbid = isetplantvegen(rnd(length(isetplantvegen)))
		}
		if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
			dbid = isetplantvegea(rnd(length(isetplantvegea)))
		}
		if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
			dbid = isetplantvegef(rnd(length(isetplantvegef)))
		}
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_FRUIT ) {
		gardenlv = 10
		if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
			dbid = isetplantfruith(rnd(length(isetplantfruith)))
		}
		if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
			dbid = isetplantfruitn(rnd(length(isetplantfruitn)))
		}
		if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
			dbid = isetplantfruita(rnd(length(isetplantfruita)))
		}
		if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
			dbid = isetplantfruitf(rnd(length(isetplantfruitf)))
		}
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_HERB ) {
		flttypeminor = FILTER_ITEM_FOOD_HERB
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_GEM ) {
		flttypeminor = FILTER_ORE_GEM
	}
	if ( feat(2) == CELL_SUB_FEATURE_SEED_MAGIC ) {
		if ( gdata(GDATA_MONTH) >= 3 & gdata(GDATA_MONTH) <= 5 ) {
			flttypeminor = FILTER_ITEM_ROD_HEALING
		}
		if ( gdata(GDATA_MONTH) >= 6 & gdata(GDATA_MONTH) <= 8 ) {
			flttypeminor = FILTER_ITEM_ROD_DAMAGE
		}
		if ( gdata(GDATA_MONTH) >= 9 & gdata(GDATA_MONTH) <= 11 ) {
			flttypeminor = FILTER_ITEM_ROD_UTILITY
		}
		if ( gdata(GDATA_MONTH) == 12 | gdata(GDATA_MONTH) <= 2 ) {
			flttypeminor = FILTER_ITEM_ROD_ENVIRONMENTAL
		}
	}
	if ( gardenlv != 0 ) {
		itemcreate 0, dbid, -1, -1, 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
		inv(INV_ITEM_LEVEL, ci) += limit(rnd((sdata(SKILL_NORMAL_GARDENING, CHARA_PLAYER) + 1) / 12 + 2), 0, 10)
		if ( feat == tile_plant + 6 ) {
			inv(INV_ITEM_LEVEL, ci) += 5
		}
		gardenlv = 0
	}
	else {
		itemcreate 0, dbid, -1, -1, 0
		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
	}
	txt lang(itemname(ci, 1) + "を収穫した。", "You harvest " + itemname(ci, 1) + ".")
	item_stack CHARA_PLAYER, ci, 1
	return

*act_pickpocket
	gdata(GDATA_ROW_ACT) = ACTION_STEAL
	gosub *generalAct
	return

