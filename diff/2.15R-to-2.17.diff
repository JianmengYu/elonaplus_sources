diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/action.hsp ../2.17-borscht/action.hsp
--- ../2.15R-borscht/action.hsp	2023-05-12 09:08:03.252609300 +0800
+++ ../2.17-borscht/action.hsp	2023-05-12 09:05:56.518673900 +0800
@@ -14,35 +14,35 @@
 	if ( ibit(ITEM_BIT_NO_DROP, ci) ) {
 		snd SOUNDLIST_FAIL1
 		txt lang("それはあなたの大事なものだ。<調べる>メニューから解除できる。", "It's set as no-drop. You can reset it from the <examine> menu.")
 		goto *pc_turn
 	}
-	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION | inv(INV_ITEM_ID, ci) == ITEM_ID_TOMATO | inv(INV_ITEM_ID, ci) == ITEM_ID_BUTTER | inv(INV_ITEM_ID, ci) == ITEM_ID_YOGURT | inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO | inv(INV_ITEM_ID, ci) == ITEM_ID_DYING_CICADA ) {
-		if ( inv(INV_ITEM_ID, ci) != ITEM_ID_EMPTY_BOTTLE ) {
-			stc = -1
-			if ( map(tlocx, tlocy, MAP_CHARA_INDEX_PLUS_ONE) != 0 ) {
-				stc = map(tlocx, tlocy, MAP_CHARA_INDEX_PLUS_ONE) - 1
-				if ( cc == CHARA_PLAYER ) {
-					if ( cdata(CDATA_IN_TAGTEAM, stc) != 0 ) {
-						txtselecttc 2
-						repeat 2
-							promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
-							promptmax++
-						loop
-						val = promptx, prompty, 200, 1
-						gosub *prompt_key
-						if ( stat == 0 ) {
-							goto *pc_turn
-						}
-						if ( rtval == 1 ) {
-							stc = cdata(CDATA_TAGTEAM_PARTNER, stc)
-						}
-					}
+	stc = -1
+	if ( map(tlocx, tlocy, MAP_CHARA_INDEX_PLUS_ONE) != 0 ) {
+		stc = map(tlocx, tlocy, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_IN_TAGTEAM, stc) != 0 ) {
+				txtselecttc 2
+				repeat 2
+					promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+					promptmax++
+				loop
+				val = promptx, prompty, 200, 1
+				gosub *prompt_key
+				if ( stat == 0 ) {
+					goto *pc_turn
+				}
+				if ( rtval == 1 ) {
+					stc = cdata(CDATA_TAGTEAM_PARTNER, stc)
 				}
 			}
 		}
 	}
+	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE) == FILTER_ITEM_POTION | inv(INV_ITEM_ID, ci) == ITEM_ID_TOMATO | inv(INV_ITEM_ID, ci) == ITEM_ID_BUTTER | inv(INV_ITEM_ID, ci) == ITEM_ID_YOGURT | inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO | inv(INV_ITEM_ID, ci) == ITEM_ID_DYING_CICADA ) {
+		if ( inv(INV_ITEM_ID, ci) != ITEM_ID_EMPTY_BOTTLE ) {
+		}
+	}
 	if ( kakeru != 100 ) {
 		if ( synccheck(cc, -1) ) {
 			txt lang(name(cc) + "は" + itemname(ci, 1) + "を投げた。", name(cc) + " throw" + _s(cc) + " " + itemname(ci, 1) + ".")
 		}
 	}
@@ -221,19 +221,15 @@
 						inv(INV_ITEM_NUM, ci)--
 						cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
 						goto *turn_end
 					}
 					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_DYING_CICADA ) {
-						kaiwa = rnd(2)
+						txt lang("「死ぬなら…せめて前のめりで…！」", "The cicada is not dead yet!")
 						txtef COLOR_BLUE
-						txt lang(" *必殺セミファイナル！* ", "*cicada*")
-						if ( kaiwa == 0 ) {
-							txt lang("「ジジジジジジジジッッッ！！！！！」", "Ziiziziziiiii!!!!")
-						}
-						if ( kaiwa == 1 ) {
-							txt lang("「死ぬなら…前のめりで…！」", "Bzzzzzzzzzz!!!")
-						}
+						txt lang(" *必殺セミファイナル！* ", " *Semi Final*")
+						txtvalid = 0
+						txt lang("「ジジジジジジジジッッッ！！！！！」", " BziiziZiziiiii!!!!")
 						if ( cdata(CDATA_CONDITION_WINCE, tc) < 5 ) {
 							cdata(CDATA_CONDITION_WINCE, tc) = 5
 							if ( synccheck(tc, -1) ) {
 								txtmore
 								txtef COLOR_PURPLE
@@ -253,10 +249,12 @@
 						itemcreate -1, ITEM_ID_BAIT, cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0
 						inv(INV_ITEM_PARAM1, ci) = 4
 						inv(INV_ITEM_PIC, ci) = xy2pic(26, 11)
 						inv(INV_ITEM_VALUE, ci) = 4 * 4 * 500 + 200
 						cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+						dmg = (sdata(SKILL_ATTR_PER, cc) / 5 + 5) * ((sdata(SKILL_WEAPON_THROWING, CHARA_PLAYER) + 1) / 5 + 5) + rnd(sdata(SKILL_WEAPON_THROWING, cc) * 2 + 5) + (limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30
+						dmghp tc, dmg, (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */), SKILL_RES_SOUND, 1000
 						goto *turn_end
 					}
 					if ( inv(INV_ITEM_ID, ci) == ITEM_ID_NATTO ) {
 						if ( synccheck(tc, -1) ) {
 							txtef COLOR_BLUE
@@ -797,12 +795,17 @@
 			}
 			return 1
 		}
 	}
 	if ( cc == CHARA_PLAYER ) {
-		if ( inv(INV_ITEM_SHOP_SAMPLE, ci) == 100 ) {
-			inv(INV_ITEM_SHOP_SAMPLE, ci) = 0
+		if ( inv(INV_ITEM_ID, ci) != ITEM_ID_CORPSE ) {
+			if ( inv(INV_ITEM_SHOP_SAMPLE, ci) == 100 ) {
+				inv(INV_ITEM_SHOP_SAMPLE, ci) = 0
+			}
+		}
+		if ( ibit(ITEM_BIT_SHOP_SAMPLE, ci) == TRUE ) {
+			ibitmod ITEM_BIT_SHOP_SAMPLE, ci, FALSE
 		}
 		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
 			if ( inv_sum(CHARA_PLAYER) > 20 ) {
 				txt lang("これ以上持ち歩けない。", "Your inventory is full.")
 				return 0
@@ -1131,11 +1134,11 @@
 		txt lang(itemname(ti, in) + "を地面に置いた。", "You drop " + itemname(ti, in) + ".")
 	}
 	gosub *calcBurdenPc
 	if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_SHOP ) {
 		if ( chipm(CHIPM_ROLE, map(inv(INV_ITEM_X, ti), inv(INV_ITEM_Y, ti), MAP_TILE_ID)) == MAP_CHIP_ROLE_DISPLAY_SPACE ) {
-			inv(INV_ITEM_SHOP_SAMPLE, ti) = 100
+			ibitmod ITEM_BIT_SHOP_SAMPLE, ti, TRUE
 		}
 	}
 	if ( inv(INV_ITEM_ID, ti) == ITEM_ID_BOTTLE_WATER ) {
 		item_find FILTER_FURNITURE_ALTAR, ITEM_FIND_MODE_TYPE
 		if ( stat != (-1) ) {
@@ -6313,11 +6316,11 @@
 		}
 		blendtool = ci
 		goto *com_blend
 	}
 	if ( refitem(inv(INV_ITEM_ID, ci), DBSPEC_TYPE_MINOR) == FILTER_FURNITURE_BED ) {
-		if ( gdata(GDATA_SLEEP) < 15 ) {
+		if ( gdata(GDATA_SLEEP) < 13 ) {
 			if ( 0 == 0 ) {
 				txt lang("まだ眠たくない。", "You don't feel sleepy yet.")
 				gosub *screen_draw
 				goto *pc_turn
 			}
@@ -8040,10 +8043,18 @@
 				if ( gdata(GDATA_FLAG_GAME_MODE) != 5 ) {
 					txt lang("これ以上飲めない…。", "Your are too full to drink."), lang("膀胱がやぶける…", "You are too bloated to drink any more."), lang("まだ喉は渇いていない。", "Your stomach can't digest any more.")
 					goto *act_use_SWEND1
 				}
 			}
+			if ( cc == CHARA_PLAYER ) {
+				if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+				}
+			}
 			snd SOUNDLIST_DRINK1
 			item_separate ci
 			inv(INV_ITEM_PARAM2, ci)--
 			cdata(CDATA_THIRST, CHARA_PLAYER) += 2000
 			cdata(CDATA_HUNGER, CHARA_PLAYER) += 150
@@ -8439,11 +8450,11 @@
 		if ( cdata(CDATA_CONDITION_SLEEP, tc) > 0 | cdata(CDATA_CONDITION_DIM, tc) >= 60 | cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
 			teikou = teikou / 2
 		}
 		if ( tc != CHARA_PLAYER ) {
 			if ( teikou >= cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER)) ) {
-				txt lang(name(tc) + "は物凄い力で抵抗した。「注射は嫌い" + _da(3) + "！」", name(tc) + " resist" + _s(tc) + ".")
+				txt lang(name(tc) + "は物凄い力で抵抗した。「注射は嫌い" + _da(3) + "！」", name(tc) + " resist" + _s(tc) + " taking injections.")
 				hostileaction CHARA_PLAYER, tc
 				hostileaction CHARA_PLAYER, tc
 				gosub *screen_draw
 				goto *pc_turn
 			}
@@ -8595,10 +8606,244 @@
 		gosub *charaRefresh
 		gosub *calcBurdenPc
 		goto *act_use_SWEND1
 		_switch_sw++
 	}
+	if ( _switch_val == 144 | _switch_sw ) {
+		_switch_sw = 0
+		if ( gdata(GDATA_FLAG_ABYSS_POWER) < 5 ) {
+			txt lang("深淵魔力が5必要だ。[現在の深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "You need 5 abyss powers.[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
+			goto *act_use_SWEND1
+		}
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		if ( map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_FEATS_ON_TILE) != 0 ) {
+			txt lang("何もおきない… ", "Nothing happens...")
+			goto *act_use_SWEND1
+		}
+		snd SOUNDLIST_AMMO
+		gdata(GDATA_FLAG_ABYSS_POWER) -= 5
+		txt lang("深淵魔力を5消費して罠を仕掛けた。[残り深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "You set a trap by spending 5 abyss powers.[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
+		cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 0, CELL_FEATURE_TRAP, inv(INV_ITEM_PARAM1, ci) + 23, cc
+		cell_featset cdata(CDATA_X, cc), cdata(CDATA_Y, cc), tile_trap, -1, -1
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
+	if ( _switch_val == 145 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		txt lang("誰に使用する？", "Who is target?")
+		gosub *screen_draw
+		val = 0
+		gosub *prompt_direction
+		if ( stat == 0 ) {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) > 0 ) {
+			tc = map(x, y, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		}
+		else {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
+			txtselecttc 2
+			repeat 2
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 200, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				gosub *screen_draw
+				goto *pc_turn
+			}
+			if ( rtval == 1 ) {
+				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
+			}
+		}
+		cc = tc
+		if ( cdata(CDATA_AP_CURRENT, cc) > 2000 ) {
+			txt lang("" + name(cc) + "はこれ以上APを貯めておけない。", name(cc) + " can't store any more AP.")
+			goto *act_use_SWEND1
+		}
+		if ( cdata(CDATA_AP_CURRENT, cc) < 2000 ) {
+			init = 0
+			aspd = cdata(CDATA_INIT_SPEED, cc)
+			if ( inv(INV_ITEM_PARAM2, ci) + inv(INV_ITEM_PARAM3, ci) >= 1000 ) {
+				if ( inv(INV_ITEM_PARAM2, ci) + inv(INV_ITEM_AMUR_CAGE, ci) > cdata(CDATA_INIT_ATTR, cc) + cdata(CDATA_INIT_LIFEMANA, cc) + aspd + (cdata(CDATA_AP_TOTAL, cc) + 1) / 5 ) {
+					if ( inv(INV_ITEM_AMUR_CAGE, ci) > aspd * 5 ) {
+						cdata(CDATA_AP_CURRENT, cc) += 5
+						cdata(CDATA_AP_TOTAL, cc) += 5
+						if ( cc != CHARA_PLAYER ) {
+							cdata(CDATA_AP_CURRENT, cc) += 5
+							cdata(CDATA_AP_TOTAL, cc) += 5
+						}
+					}
+					if ( inv(INV_ITEM_AMUR_CAGE, ci) > aspd * 4 ) {
+						cdata(CDATA_AP_CURRENT, cc) += 10
+						cdata(CDATA_AP_TOTAL, cc) += 10
+						if ( cc != CHARA_PLAYER ) {
+							cdata(CDATA_AP_CURRENT, cc) += 10
+							cdata(CDATA_AP_TOTAL, cc) += 10
+						}
+					}
+					if ( inv(INV_ITEM_AMUR_CAGE, ci) > aspd * 3 ) {
+						cdata(CDATA_AP_CURRENT, cc) += 10
+						cdata(CDATA_AP_TOTAL, cc) += 10
+						if ( cc != CHARA_PLAYER ) {
+							cdata(CDATA_AP_CURRENT, cc) += 10
+							cdata(CDATA_AP_TOTAL, cc) += 10
+						}
+					}
+					if ( inv(INV_ITEM_AMUR_CAGE, ci) > aspd * 2 ) {
+						cdata(CDATA_AP_CURRENT, cc) += 10
+						cdata(CDATA_AP_TOTAL, cc) += 10
+						if ( cc != CHARA_PLAYER ) {
+							cdata(CDATA_AP_CURRENT, cc) += 10
+							cdata(CDATA_AP_TOTAL, cc) += 10
+						}
+					}
+					if ( inv(INV_ITEM_AMUR_CAGE, ci) > aspd ) {
+						init = 1
+						cdata(CDATA_AP_CURRENT, cc) += 5
+						cdata(CDATA_AP_TOTAL, cc) += 5
+						snd SOUNDLIST_ENC
+						animeload 36, cc
+						if ( cc != CHARA_PLAYER ) {
+							cdata(CDATA_AP_CURRENT, cc) += 5
+							cdata(CDATA_AP_TOTAL, cc) += 5
+						}
+					}
+					if ( cdata(CDATA_AP_CURRENT, cc) > 2000 ) {
+						cdata(CDATA_AP_TOTAL, cc) -= cdata(CDATA_AP_CURRENT, cc) - 2000
+						cdata(CDATA_AP_CURRENT, cc) = 2000
+					}
+					if ( cdata(CDATA_AP_TOTAL, cc) < 0 ) {
+						cdata(CDATA_AP_TOTAL, cc) = 2000
+					}
+				}
+			}
+			if ( init == 0 ) {
+				txt lang("" + name(cc) + "には何の経験にもならないようだ…。", name(cc) + " seems to get no AP from it...")
+				goto *act_use_SWEND1
+			}
+		}
+		inv(INV_ITEM_NUM, ci)--
+		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		gosub *calcBurdenPc
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
+	if ( _switch_val == 142 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		txt lang("誰に使用する？", "Who is target?")
+		gosub *screen_draw
+		val = 0
+		gosub *prompt_direction
+		if ( stat == 0 ) {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) > 0 ) {
+			tc = map(x, y, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		}
+		else {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
+			txtselecttc 2
+			repeat 2
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 200, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				gosub *screen_draw
+				goto *pc_turn
+			}
+			if ( rtval == 1 ) {
+				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
+			}
+		}
+		snd SOUNDLIST_OFFER2
+		txtef COLOR_GREEN
+		txt lang("" + name(tc) + "は魔力のめぐりが良くなった。", name(tc) + " improved magic circulation.")
+		healmp tc, cdata(CDATA_MAX_MP, tc) / 10 + 1
+		skillexp SKILL_ATTR_MAG, tc, inv(INV_ITEM_PARAM2, ci) * 3 + 50
+		inv(INV_ITEM_NUM, ci)--
+		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		r1 = tc
+		gosub *charaRefresh
+		gosub *calcBurdenPc
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
+	if ( _switch_val == 143 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		txt lang("誰に使用する？", "Who is target?")
+		gosub *screen_draw
+		val = 0
+		gosub *prompt_direction
+		if ( stat == 0 ) {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) > 0 ) {
+			tc = map(x, y, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		}
+		else {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
+			txtselecttc 2
+			repeat 2
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 200, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				gosub *screen_draw
+				goto *pc_turn
+			}
+			if ( rtval == 1 ) {
+				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
+			}
+		}
+		snd SOUNDLIST_ATK_FIRE
+		txtef COLOR_GREEN
+		txt lang("" + name(tc) + "は頑張れそうな気がしてきた。", name(tc) + " getting motivated.")
+		healsp tc, cdata(CDATA_MAX_SP, tc) / 10 + 1
+		skillexp SKILL_ATTR_CON, tc, inv(INV_ITEM_PARAM2, ci) * 3 + 50
+		inv(INV_ITEM_NUM, ci)--
+		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		r1 = tc
+		gosub *charaRefresh
+		gosub *calcBurdenPc
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
 	if ( _switch_val == effmemory2 | _switch_sw ) {
 		_switch_sw = 0
 		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
 			goto *act_use_SWEND1
 		}
@@ -9300,11 +9545,11 @@
 			}
 			snd SOUNDLIST_TM2_SWITCH001
 			gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) -= 4
 			txt lang(name(cc) + "はポーションの栓を込めた。[残り" + gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) + "個]", name(cc) + " put potion plugs.[Remaining plug " + gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) + "]")
 			inv(INV_ITEM_PARAM2, ci) = 4
-			if ( inv(INV_ITEM_PARAM3, ci) \ 100 != 4 ) {
+			if ( inv(INV_ITEM_PARAM3, ci) \ 100 != 4 & inv(INV_ITEM_AMUR_CAGE, ci) != 4 ) {
 				goto *act_use_SWEND1
 			}
 		}
 		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
 			goto *act_use_SWEND1
@@ -9338,11 +9583,11 @@
 		}
 		waitbk = cfg_animewait
 		if ( cfg_animewait > 0 ) {
 			cfg_animewait = 30
 		}
-		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 ) {
+		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 | inv(INV_ITEM_AMUR_CAGE, ci) == 3 & inv(INV_ITEM_PARAM2, ci) >= 2 ) {
 			if ( inv(INV_ITEM_LEVEL, ci) == 0 ) {
 				animeid = ANIMATION_POTION_PLUG_2
 				gosub *anime
 			}
 			if ( inv(INV_ITEM_LEVEL, ci) == 1 | inv(INV_ITEM_LEVEL, ci) == 2 ) {
@@ -9363,45 +9608,37 @@
 		if ( inv(INV_ITEM_LEVEL, ci) == 3 | inv(INV_ITEM_LEVEL, ci) == 4 ) {
 			animeid = ANIMATION_POTION_PLUG_5
 			gosub *anime
 		}
 		cfg_animewait = waitbk
-		inv(INV_ITEM_PARAM2, ci)--
-		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 ) {
-			inv(INV_ITEM_PARAM2, ci)--
-		}
 		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BATTLE_POTIOMAN ) {
 			cdata(CDATA_PROT_PENALTY, cc) -= 2
 		}
 		item_stack cc, ci, 1
 		kinhosei = 0
-		mahosei = 0
 		if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SUPER_POTIOMAN ) {
 			kinhosei = 1
 		}
-		if ( inv(INV_ITEM_LEVEL, ci) > 0 ) {
-			mahosei = inv(INV_ITEM_LEVEL, ci) * sdata(SKILL_ATTR_MAG, cc)
-		}
-		inv(INV_ITEM_LEVEL, ci) = 0
-		dmg = (sdata(SKILL_ATTR_STR, cc) * (3 + kinhosei) + mahosei) / 10 * ((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 5 + rnd((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 10 + 10)) + 5
-		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 5 ) {
-			dmg = (sdata(SKILL_ATTR_STR, cc) * (3 + kinhosei) + mahosei) / 10 * ((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 5 + (sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 10 + 10) + 5
+		dmg = (sdata(SKILL_ATTR_STR, cc) * (kinhosei + 5) / 25 + 5) * ((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_MAG, cc) * 4 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) * 3 / 4
+		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 5 | inv(INV_ITEM_AMUR_CAGE, ci) == 5 ) {
+			dmg = (sdata(SKILL_ATTR_STR, cc) * (kinhosei + 5) / 25 + 5) * ((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 5 + 5) + sdata(SKILL_ATTR_MAG, cc) * 4 + 5 + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) * 3 / 4
 		}
+		dmg = dmg / 3 * (inv(INV_ITEM_LEVEL, ci) + 3)
 		if ( dmg < 10 ) {
 			dmg = 10
 		}
-		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 2 ) {
+		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 2 | inv(INV_ITEM_AMUR_CAGE, ci) == 2 ) {
 			dmg = dmg * 11 / 10
 		}
-		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 ) {
+		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 | inv(INV_ITEM_AMUR_CAGE, ci) == 3 & inv(INV_ITEM_PARAM2, ci) >= 2 ) {
 			dmg = dmg * 9 / 5
 		}
 		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
-			dmghp tc, dmg, cc
+			dmghp tc, dmg, cc, SKILL_RESDMG_CRUSH, 1000
 		}
 		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
-			dmgmp tc, dmg / 10
+			dmgmp tc, dmg / 100 + 5
 		}
 		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
 			if ( inv(INV_ITEM_ID, ci) == ITEM_ID_CRUSH_POTIOMAN ) {
 				if ( inv(INV_ITEM_PARAM2, ci) == 0 ) {
 					tcbk = tc
@@ -9411,22 +9648,38 @@
 					tc = tcbk
 				}
 			}
 		}
 		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
-			if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 1 ) {
-				dmgcon tc, CONDITION_DIM, sdata(SKILL_ATTR_DEX, cc) / 10 + 50
+			if ( inv(INV_ITEM_SHOP_SAMPLE, ci) > 0 ) {
+				dmge = (sdata(SKILL_ATTR_STR, cc) * (kinhosei + 5) / 25 + 5) * ((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_MAG, cc) * 4 + 5 + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 8) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) * 3 / 8
+				if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 5 | inv(INV_ITEM_AMUR_CAGE, ci) == 5 ) {
+					dmge = (sdata(SKILL_ATTR_STR, cc) * (kinhosei + 5) / 25 + 5) * ((sdata(SKILL_NORMAL_MARKSMAN, cc) + 1) / 5 + 5) + sdata(SKILL_ATTR_MAG, cc) * 4 + 5 + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 2
+				}
+				dmge = dmge / 5 * (inv(INV_ITEM_LEVEL, ci) + 3)
+				if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 2 | inv(INV_ITEM_AMUR_CAGE, ci) == 2 ) {
+					dmge = dmge * 11 / 10
+				}
+				if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 | inv(INV_ITEM_AMUR_CAGE, ci) == 3 & inv(INV_ITEM_PARAM2, ci) >= 2 ) {
+					dmge = dmge * 9 / 5
+				}
+				dmghp tc, dmge, cc, inv(INV_ITEM_SHOP_SAMPLE, ci), 500 + limit(sdata(SKILL_ATTR_MAG, cc) * 2, 1, 4000)
+			}
+		}
+		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
+			if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 1 | inv(INV_ITEM_AMUR_CAGE, ci) == 1 ) {
+				dmgcon tc, CONDITION_DIM, 50 + limit(sdata(SKILL_ATTR_STR, cc) / 2, 1, 1000)
 				if ( cdata(CDATA_HP, tc) <= cdata(CDATA_MAX_HP, tc) / 10 ) {
 					attackskill = SKILL_WEAPON_FIREARM
 					efid = SKILL_SPACT_DECAPITATION2
 					gosub *effect
 				}
 			}
 		}
 		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
-			if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 6 ) {
-				dmgcon tc, CONDITION_CONFUSE, sdata(SKILL_ATTR_DEX, cc) / 5 + 100
+			if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 6 | inv(INV_ITEM_AMUR_CAGE, ci) == 6 ) {
+				dmgcon tc, CONDITION_CONFUSE, 50 + limit(sdata(SKILL_ATTR_DEX, cc) / 2, 1, 1000)
 				cdata(CDATA_EVASION_PENALTY, tc) += 1
 				if ( tc == CHARA_PLAYER ) {
 					dmgsp CHARA_PLAYER, limit(rnd(sdata(SKILL_ATTR_DEX, cc) / 50 + 1) + 5, 5, 30)
 				}
 				if ( tc != CHARA_PLAYER ) {
@@ -9437,10 +9690,64 @@
 		if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
 			skillexp SKILL_ATTR_STR, cc, 50
 			skillexp SKILL_ATTR_MAG, cc, 50
 			skillexp SKILL_NORMAL_MARKSMAN, cc, 50
 		}
+		inv(INV_ITEM_PARAM2, ci)--
+		if ( inv(INV_ITEM_PARAM3, ci) \ 100 == 3 | inv(INV_ITEM_AMUR_CAGE, ci) == 3 ) {
+			if ( inv(INV_ITEM_PARAM2, ci) > 0 ) {
+				inv(INV_ITEM_PARAM2, ci)--
+			}
+		}
+		inv(INV_ITEM_LEVEL, ci) = 0
+		powsel = 0
+		if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
+			if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
+				powsel = 100
+			}
+		}
+		if ( gdata(GDATA_FLAG_MAIN) >= 350 ) {
+			if ( cdata(CDATA_LEVEL, cc) >= 50 ) {
+				powsel = 100
+			}
+		}
+		if ( cc < MAX_CHARA_FOLLOWER | cdata(CDATA_ALLIED, cc) == 100 | cc == CHARA_PLAYER ) {
+			powsel = 100
+		}
+		if ( gdata(GDATA_FLAG_GAME_MODE) == 1 ) {
+			powsel = 100
+		}
+		if ( cc >= MAX_CHARA_FOLLOWER & cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT & cdata(CDATA_HP, cc) > cdata(CDATA_MAX_HP, cc) / 2 & cdata(CDATA_POWER_GAUGE, cc) < 200 ) {
+			if ( exgauge != 100 ) {
+				powsel = 0
+			}
+		}
+		if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
+			powsel = 0
+		}
+		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_TEMPORARY ) {
+			if ( cdata(CDATA_DIRECTIVE_MODE_ORG, cc) != 0 ) {
+				powsel = 0
+			}
+		}
+		if ( cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_DEFENSIVE | cdata(CDATA_DIRECTIVE_MODE, cc) == DIRECTIVE_MODE_INTERCEPT ) {
+			powsel = 0
+		}
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_EVOLUTION_STAGE, CHARA_PLAYER) == 0 ) {
+				powsel = 0
+			}
+		}
+		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
+			if ( powsel == 100 ) {
+				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
+					cipk = ci
+					efid = SKILL_SPACT_HYPER_PLUG_BURST
+					gosub *effect
+				}
+			}
+		}
 		goto *act_use_SWEND1
 		_switch_sw++
 	}
 	if ( _switch_val == 84 | _switch_sw ) {
 		_switch_sw = 0
@@ -12221,10 +12528,82 @@
 			obvious = 0
 		}
 		goto *act_use_SWEND1
 		_switch_sw++
 	}
+	if ( _switch_val == 138 | _switch_sw ) {
+		_switch_sw = 0
+		cibk = ci
+		txt lang("対象にするポーショマンは？", "Which potioman?")
+		invsubroutine = 1
+		invctrl = INVCTRL_MATERIAL_ENCHANT, 29
+		snd SOUNDLIST_INV
+		gosub *com_inventory
+		if ( stat == 1 ) {
+			item_separate ci
+			txtsetcustom 7
+			repeat 7
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 280, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				goto *act_use_SWEND1
+			}
+			if ( rtval == 0 ) {
+				goto *act_use_SWEND1
+			}
+			if ( rtval == inv(INV_ITEM_PARAM3, ci) \ 100 ) {
+				snd SOUNDLIST_FAIL1
+				txt lang("それは機能が被っている…。", "It has the same performance...")
+				goto *act_use_SWEND1
+			}
+			snd SOUNDLIST_AMMO
+			inv(INV_ITEM_AMUR_CAGE, ci) = rtval
+			txtef COLOR_YELLOW
+			txt lang("Ｘフレームチェンジ！", "X-Frame Change!")
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 1 ) {
+				txtef COLOR_YELLOW
+				txt lang("スピニングフット！", "Spinning Foot!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 2 ) {
+				txtef COLOR_YELLOW
+				txt lang("マイティアーム！", "Mighty Arm!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 3 ) {
+				txtef COLOR_YELLOW
+				txt lang("デュアルコア！", "Dual Core!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 4 ) {
+				txtef COLOR_YELLOW
+				txt lang("ラピッドサーバー！", "Rapid Server!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 5 ) {
+				txtef COLOR_YELLOW
+				txt lang("スナイプヘッド！", "Snipe Head!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 6 ) {
+				txtef COLOR_YELLOW
+				txt lang("デシーヴバレル！", "Deceive Barrel!")
+			}
+			inv(INV_ITEM_NUM, cibk)--
+			if ( cibk >= 5080 ) {
+				cell_refresh inv(INV_ITEM_X, cibk), inv(INV_ITEM_Y, cibk)
+			}
+			r1 = cc
+			gosub *charaRefresh
+			if ( spact(SKILL_SPACT_CUSTOM_CHANGE - STARTING_SKILL_SPACT) == 0 ) {
+				spact(SKILL_SPACT_CUSTOM_CHANGE - STARTING_SKILL_SPACT) = 1
+				txtmore
+				txtef COLOR_YELLOW
+				txt lang("あなたは「" + skillname(SKILL_SPACT_CUSTOM_CHANGE) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_CUSTOM_CHANGE) + ".")
+			}
+		}
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
 	if ( _switch_val == 136 | _switch_sw ) {
 		_switch_sw = 0
 		if ( cc != CHARA_PLAYER ) {
 			txt lang("何もおきない… ", "Nothing happens...")
 			goto *act_use_SWEND1
@@ -12238,83 +12617,83 @@
 			cibk2 = ci
 			snd SOUNDLIST_CRACK2
 			txt lang(itemname(ci) + "を小分けにして粘菌を使った。", itemname(ci) + " became vessels for slime mold.")
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 10 == 1 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 8
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 1
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 100 >= 10 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 20
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 2
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 1000 >= 100 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 15
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 3
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 10000 >= 1000 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 8
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 4
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 100000 >= 10000 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 20
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 5
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 1000000 >= 100000 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 20
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 6
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 10000000 >= 1000000 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 15
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 7
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 100000000 >= 10000000 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 15
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 8
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
 			item_identify ci, ITEM_KNOWN_FULL
 			if ( inv(INV_ITEM_SHOP_SAMPLE, cibk2) \ 1000000000 >= 100000000 ) {
 				flt
-				itemcreate -1, 1265, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				itemcreate -1, ITEM_ID_NECRO_PARTS, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 				inv(INV_ITEM_WEIGHT, ci) = inv(INV_ITEM_WEIGHT, cibk2) / 8
 				inv(INV_ITEM_SUB_NAME, ci) = inv(INV_ITEM_SUB_NAME, cibk2)
 				inv(INV_ITEM_SHOP_SAMPLE, ci) = 9
 				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			}
@@ -12572,10 +12951,225 @@
 			txt lang("それは無理だ。", "It's impossible.")
 		}
 		goto *act_use_SWEND1
 		_switch_sw++
 	}
+	if ( _switch_val == 139 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		txt lang("誰に注射する？", "Who is target?")
+		gosub *screen_draw
+		val = 0
+		gosub *prompt_direction
+		if ( stat == 0 ) {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) > 0 ) {
+			tc = map(x, y, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		}
+		else {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
+			txtselecttc 2
+			repeat 2
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 200, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				gosub *screen_draw
+				goto *pc_turn
+			}
+			if ( rtval == 1 ) {
+				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
+			}
+		}
+		if ( sorg(SKILL_RES_FIRE, tc) >= 300 | sorg(SKILL_RES_FIRE, tc) < 100 & (sorg(SKILL_RES_COLD, tc) >= 300 | sorg(SKILL_RES_COLD, tc) < 100) & (sorg(SKILL_RES_LIGHTNING, tc) >= 300 | sorg(SKILL_RES_LIGHTNING, tc) < 100) & (sorg(SKILL_RES_DARKNESS, tc) >= 300 | sorg(SKILL_RES_DARKNESS, tc) < 100) & (sorg(SKILL_RES_MIND, tc) >= 300 | sorg(SKILL_RES_MIND, tc) < 100) & (sorg(SKILL_RES_POISON, tc) >= 300 | sorg(SKILL_RES_POISON, tc) < 100) & (sorg(SKILL_RES_NETHER, tc) >= 300 | sorg(SKILL_RES_NETHER, tc) < 100) & (sorg(SKILL_RES_SOUND, tc) >= 300 | sorg(SKILL_RES_SOUND, tc) < 100) & (sorg(SKILL_RES_NERVE, tc) >= 300 | sorg(SKILL_RES_NERVE, tc) < 100) & (sorg(SKILL_RES_CHAOS, tc) >= 300 | sorg(SKILL_RES_CHAOS, tc) < 100) & (sorg(SKILL_RES_MAGIC, tc) >= 300 | sorg(SKILL_RES_MAGIC, tc) < 100) ) {
+			txt lang("これ以上は使っても効果がない。", "There is no effect even if used against opponents with Dvfix 200 or more...")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		teikou = sdata(SKILL_ATTR_STR, tc) + 50
+		if ( cdata(CDATA_CONDITION_SLEEP, tc) > 0 | cdata(CDATA_CONDITION_DIM, tc) >= 60 | cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
+			teikou = teikou / 2
+		}
+		if ( tc != CHARA_PLAYER ) {
+			if ( teikou >= cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER)) ) {
+				txt lang(name(tc) + "は物凄い力で抵抗した。「注射は嫌い" + _da(3) + "！」", name(tc) + " resist" + _s(tc) + " taking injections.")
+				hostileaction CHARA_PLAYER, tc
+				hostileaction CHARA_PLAYER, tc
+				gosub *screen_draw
+				goto *pc_turn
+			}
+		}
+		snd SOUNDLIST_SWING39
+		animeload 8, tc
+		txt lang(name(tc) + "「痛っ！」", name(tc) + " writhe" + _s(tc) + " in pain.")
+		resistmod tc, SKILL_RES_FIRE, 50
+		resistmod tc, SKILL_RES_COLD, 50
+		resistmod tc, SKILL_RES_LIGHTNING, 50
+		resistmod tc, SKILL_RES_DARKNESS, 50
+		resistmod tc, SKILL_RES_MIND, 50
+		resistmod tc, SKILL_RES_POISON, 50
+		resistmod tc, SKILL_RES_NETHER, 50
+		resistmod tc, SKILL_RES_SOUND, 50
+		resistmod tc, SKILL_RES_NERVE, 50
+		resistmod tc, SKILL_RES_CHAOS, 50
+		resistmod tc, SKILL_RES_MAGIC, 50
+		snd SOUNDLIST_DING3
+		inv(INV_ITEM_NUM, ci)--
+		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		gosub *calcBurdenPc
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
+	if ( _switch_val == 140 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		txt lang("誰に注射する？", "Who is target?")
+		gosub *screen_draw
+		val = 0
+		gosub *prompt_direction
+		if ( stat == 0 ) {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) > 0 ) {
+			tc = map(x, y, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		}
+		else {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
+			txtselecttc 2
+			repeat 2
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 200, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				gosub *screen_draw
+				goto *pc_turn
+			}
+			if ( rtval == 1 ) {
+				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
+			}
+		}
+		if ( cdata(CDATA_DV_FIX, tc) >= 200 ) {
+			txt lang("DV補正200以上には使っても効果がない。", "There is no effect even if used against opponents with Dvfix 200 or more...")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		teikou = sdata(SKILL_ATTR_STR, tc) + 50
+		if ( cdata(CDATA_CONDITION_SLEEP, tc) > 0 | cdata(CDATA_CONDITION_DIM, tc) >= 60 | cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
+			teikou = teikou / 2
+		}
+		if ( tc != CHARA_PLAYER ) {
+			if ( teikou >= cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER)) ) {
+				txt lang(name(tc) + "は物凄い力で抵抗した。「注射は嫌い" + _da(3) + "！」", name(tc) + " resist" + _s(tc) + " taking injections.")
+				hostileaction CHARA_PLAYER, tc
+				hostileaction CHARA_PLAYER, tc
+				gosub *screen_draw
+				goto *pc_turn
+			}
+		}
+		snd SOUNDLIST_SWING39
+		animeload 8, tc
+		txt lang(name(tc) + "「痛っ！」", name(tc) + " writhe" + _s(tc) + " in pain.")
+		cdata(CDATA_DV_FIX, tc) += 10
+		snd SOUNDLIST_DING3
+		txtef COLOR_GREEN
+		txt lang(name(tc) + "のDV補正が" + cdata(CDATA_DV_FIX, tc) + "に上がった。", "Dvfix of " + name(tc) + " increased to " + cdata(CDATA_DV_FIX, tc) + ".")
+		inv(INV_ITEM_NUM, ci)--
+		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		gosub *calcBurdenPc
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
+	if ( _switch_val == 141 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *act_use_SWEND1
+		}
+		txt lang("誰に注射する？", "Who is target?")
+		gosub *screen_draw
+		val = 0
+		gosub *prompt_direction
+		if ( stat == 0 ) {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( map(x, y, MAP_CHARA_INDEX_PLUS_ONE) > 0 ) {
+			tc = map(x, y, MAP_CHARA_INDEX_PLUS_ONE) - 1
+		}
+		else {
+			txt lang("それは無理だ。", "It's impossible.")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		if ( cdata(CDATA_IN_TAGTEAM, tc) != 0 ) {
+			txtselecttc 2
+			repeat 2
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 200, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				gosub *screen_draw
+				goto *pc_turn
+			}
+			if ( rtval == 1 ) {
+				tc = cdata(CDATA_TAGTEAM_PARTNER, tc)
+			}
+		}
+		if ( cdata(CDATA_PV_FIX, tc) >= 200 ) {
+			txt lang("PV補正200以上には使っても効果がない。", "There is no effect even if used against opponents with Pvfix 200 or more...")
+			gosub *screen_draw
+			goto *pc_turn
+		}
+		teikou = sdata(SKILL_ATTR_STR, tc) + 50
+		if ( cdata(CDATA_CONDITION_SLEEP, tc) > 0 | cdata(CDATA_CONDITION_DIM, tc) >= 60 | cdata(CDATA_HP, tc) < cdata(CDATA_MAX_HP, tc) / 8 ) {
+			teikou = teikou / 2
+		}
+		if ( tc != CHARA_PLAYER ) {
+			if ( teikou >= cdata(CDATA_IMPRESSION, tc) + cdata(CDATA_MASTER_SERVANT, tc) + rnd(sdata(SKILL_ATTR_DEX, CHARA_PLAYER)) ) {
+				txt lang(name(tc) + "は物凄い力で抵抗した。「注射は嫌い" + _da(3) + "！」", name(tc) + " resist" + _s(tc) + " taking injections.")
+				hostileaction CHARA_PLAYER, tc
+				hostileaction CHARA_PLAYER, tc
+				gosub *screen_draw
+				goto *pc_turn
+			}
+		}
+		snd SOUNDLIST_SWING39
+		animeload 8, tc
+		txt lang(name(tc) + "「痛っ！」", name(tc) + " writhe" + _s(tc) + " in pain.")
+		cdata(CDATA_PV_FIX, tc) += 10
+		snd SOUNDLIST_DING3
+		txtef COLOR_GREEN
+		txt lang(name(tc) + "のPV補正が" + cdata(CDATA_PV_FIX, tc) + "に上がった。", "Pvfix of " + name(tc) + " increased to " + cdata(CDATA_PV_FIX, tc) + ".")
+		inv(INV_ITEM_NUM, ci)--
+		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		gosub *calcBurdenPc
+		goto *act_use_SWEND1
+		_switch_sw++
+	}
 	if ( _switch_val == 95 | _switch_sw ) {
 		_switch_sw = 0
 		txtef COLOR_PURPLE
 		txt lang("「スキャン及び採取の対象を選択して下さい」", "Please select the target of scanning.")
 		gosub *screen_draw
@@ -13879,15 +14473,20 @@
 	if ( _switch_val == 103 | _switch_sw ) {
 		_switch_sw = 0
 		inv(INV_ITEM_NUM, ci)--
 		cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
 		snd SOUNDLIST_ATK_DARK
-		gdata(GDATA_FLAG_ABYSS_POWER) += 20
+		darkness = 20 * limit(inv(INV_ITEM_PARAM2, ci) + 1, 1, 30)
+		darkness2 = 10 * limit(inv(INV_ITEM_PARAM2, ci) + 1, 1, 30)
+		gdata(GDATA_FLAG_ABYSS_POWER) += darkness
+		gdata(GDATA_ABSORB_CHARGE) += darkness2
 		if ( gdata(GDATA_FLAG_ABYSS_POWER) > 100000 ) {
 			gdata(GDATA_FLAG_ABYSS_POWER) = 100000
 		}
-		txt lang("[深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
+		txt lang("深淵魔力を" + darkness + "獲得した[深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "You get " + darkness + " abyss powers.[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
+		txtvalid = 0
+		txt lang("充填用魔力を" + darkness2 + "獲得した(魔力の貯蓄：" + gdata(GDATA_ABSORB_CHARGE) + ")", "You get " + darkness2 + " recharge powers. (Total:" + gdata(GDATA_ABSORB_CHARGE) + ")")
 		goto *act_use_SWEND1
 		_switch_sw++
 	}
 	if ( _switch_val == 126 | _switch_sw ) {
 		_switch_sw = 0
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/adv.hsp ../2.17-borscht/adv.hsp
--- ../2.15R-borscht/adv.hsp	2023-05-12 09:08:03.283534600 +0800
+++ ../2.17-borscht/adv.hsp	2023-05-12 09:05:56.531719700 +0800
@@ -164,10 +164,11 @@
 	oc = stat
 	cdata(CDATA_RELATION, rc) = RELATION_ALLY
 	cdata(CDATA_RELATION_ORG, rc) = RELATION_ALLY
 	cdata(CDATA_ROLE, rc) = ROLE_NONE
 	cdata(CDATA_BRUSH_LEVEL, rc) = 0
+	cdata(CDATA_HIRE_DATE, rc) = 0
 	cbitmod CHARA_BIT_QUEST_TARGET, rc, FALSE
 	cbitmod CHARA_BIT_NO_TARGET, rc, FALSE
 	cbitmod CHARA_BIT_SANDBAG, rc, FALSE
 	cbitmod CHARA_BIT_SUMMONED, rc, FALSE
 	cbitmod CHARA_BIT_FESTIVAL, rc, FALSE
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/ai.hsp ../2.17-borscht/ai.hsp
--- ../2.15R-borscht/ai.hsp	2023-05-12 09:08:03.311452200 +0800
+++ ../2.17-borscht/ai.hsp	2023-05-12 09:05:56.554694600 +0800
@@ -929,10 +929,21 @@
 		if ( cdata(CDATA_CONDITION_BLIND, cc) != 0 ) {
 			if ( rnd(3) ) {
 				goto *ai_calmMove
 			}
 		}
+		if ( cc > MAX_CHARA_FOLLOWER & (cdata(CDATA_QUALITY, cc) > FIX_QUALITY_GREAT | cdata(CDATA_ID, cc) == CREATURE_ID_MEGA_MOLE | cdata(CDATA_ID, cc) == CREATURE_ID_TALPIDAE | cdata(CDATA_ID, cc) == CREATURE_ID_AILE_THE_ATTENDANT) ) {
+			if ( cdata(CDATA_HP, cc) <= cdata(CDATA_MAX_HP, cc) * 9 / 10 | cdata(CDATA_MP, cc) <= cdata(CDATA_MAX_MP, cc) * 9 / 10 | cdata(CDATA_SP, cc) <= cdata(CDATA_MAX_SP, cc) * 9 / 10 ) {
+				if ( dist(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 | fov_los(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), cdata(CDATA_X, cc), cdata(CDATA_Y, cc)) == 0 ) {
+					healsp cc, cdata(CDATA_MAX_SP, cc) / 50 + sqrt(sdata(SKILL_NORMAL_HEALING, cc)) + sqrt(sdata(SKILL_NORMAL_MEDITATION, cc))
+					healhp cc, cdata(CDATA_MAX_HP, cc) / 50 + sdata(SKILL_NORMAL_HEALING, cc) * sqrt(sdata(SKILL_NORMAL_HEALING, cc))
+					healmp cc, cdata(CDATA_MAX_MP, cc) / 50 + sdata(SKILL_NORMAL_MEDITATION, cc) * sqrt(sdata(SKILL_NORMAL_MEDITATION, cc))
+					txt lang(name(cc) + "は応急処置を行った。", name(cc) + " administered first aid.")
+					goto *turn_end
+				}
+			}
+		}
 		if ( distance != cdata(CDATA_AI_DISTANCE, cc) ) {
 			if ( rnd(100) < cdata(CDATA_AI_MOVE_FREQ, cc) ) {
 				goto *ai_followMove
 			}
 		}
@@ -3012,33 +3023,33 @@
 					act = SKILL_SPACT_EXTERMINATION_BREATH
 				}
 			}
 		}
 	}
-	if ( cdata(CDATA_ID, cc) == CREATURE_ID_HELRAUNE | cdata(CDATA_ID, cc) == 1071 ) {
+	if ( cdata(CDATA_ID, cc) == CREATURE_ID_HELRAUNE | cdata(CDATA_ID, cc) == CREATURE_ID_DAGANOTOSUS ) {
 		if ( cdata(CDATA_POWER_GAUGE, cc) < 80 ) {
 			if ( cdata(CDATA_POWER_GAUGE, cc) >= 25 ) {
 				if ( rnd(10) == 0 ) {
 					act = SKILL_SPACT_VENOTRATE
 				}
 			}
 		}
 	}
-	if ( cdata(CDATA_ID, cc) == 1070 | cdata(CDATA_ID, cc) == CREATURE_ID_OOTEGUCHI | cdata(CDATA_ID, cc) == CREATURE_ID_HEROYEEK | cdata(CDATA_ID, cc) == CREATURE_ID_MUSCLE_GOLEM | cdata(CDATA_ID, cc) == CREATURE_ID_SNAIL_THE_ANDROID_RIDER | cdata(CDATA_ID, cc) == CREATURE_ID_OPATOS | cdata(CDATA_ID, cc) == CREATURE_ID_MAGIC_HAWK_MOTH | cdata(CDATA_ID, cc) == CREATURE_ID_OXODE_THE_QUEEN_BEE ) {
+	if ( cdata(CDATA_ID, cc) == CREATURE_ID_MOSTMUSCYLLA | cdata(CDATA_ID, cc) == CREATURE_ID_OOTEGUCHI | cdata(CDATA_ID, cc) == CREATURE_ID_HEROYEEK | cdata(CDATA_ID, cc) == CREATURE_ID_MUSCLE_GOLEM | cdata(CDATA_ID, cc) == CREATURE_ID_SNAIL_THE_ANDROID_RIDER | cdata(CDATA_ID, cc) == CREATURE_ID_OPATOS | cdata(CDATA_ID, cc) == CREATURE_ID_MAGIC_HAWK_MOTH | cdata(CDATA_ID, cc) == CREATURE_ID_OXODE_THE_QUEEN_BEE ) {
 		if ( cdata(CDATA_POWER_GAUGE, cc) < 85 ) {
 			if ( cdata(CDATA_DRAIN_HP, cc) >= 15 ) {
 				if ( rnd(10) == 0 ) {
-					act = MAX_SKILL
+					act = SKILL_SPACT_POSING
 				}
 			}
 		}
 	}
-	if ( cdata(CDATA_ID, cc) == CREATURE_ID_NIGHTMARE_SHARK | cdata(CDATA_ID, cc) == CREATURE_ID_RAGING_SHARK | cdata(CDATA_ID, cc) == CREATURE_ID_CAPTAIN_SHARK | cdata(CDATA_ID, cc) == 1072 ) {
+	if ( cdata(CDATA_ID, cc) == CREATURE_ID_NIGHTMARE_SHARK | cdata(CDATA_ID, cc) == CREATURE_ID_RAGING_SHARK | cdata(CDATA_ID, cc) == CREATURE_ID_CAPTAIN_SHARK | cdata(CDATA_ID, cc) == CREATURE_ID_SP_CHAMPION ) {
 		if ( cdata(CDATA_POWER_GAUGE, cc) < 80 ) {
 			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), cdata(CDATA_X, tc), cdata(CDATA_Y, tc)) == 1 ) {
 				if ( rnd(6) == 0 ) {
-					act = 847
+					act = SKILL_SPACT_SHARK_TRADE
 				}
 			}
 		}
 	}
 	if ( cdata(CDATA_ID, cc) == CREATURE_ID_AJETALIO_THE_SEMINAR_LECTURER | cdata(CDATA_ID, cc) == CREATURE_ID_HELLSTLING | cdata(CDATA_ID, cc) == CREATURE_ID_ATLACH_NACHA ) {
@@ -3057,11 +3068,11 @@
 					act = SKILL_SPACT_ROCRUSHER
 				}
 			}
 		}
 	}
-	if ( cdata(CDATA_ID, cc) == CREATURE_ID_MAGIC_BEE | cdata(CDATA_ID, cc) == CREATURE_ID_EIGHTY_SHAKU ) {
+	if ( cdata(CDATA_ID, cc) == CREATURE_ID_MAGIC_BEE | cdata(CDATA_ID, cc) == CREATURE_ID_EIGHTY_SHAKU | cdata(CDATA_ID, cc) == CREATURE_ID_CHAOSHAPRINCESS_DIBWL ) {
 		if ( cdata(CDATA_CONDITION_ANGRY, cc) > 0 ) {
 			if ( rnd(3) == 0 ) {
 				act = SKILL_SPACT_FLAME_OF_RAGE
 			}
 		}
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/blend.hsp ../2.17-borscht/blend.hsp
--- ../2.15R-borscht/blend.hsp	2023-05-12 09:08:03.341372800 +0800
+++ ../2.17-borscht/blend.hsp	2023-05-12 09:05:56.578484200 +0800
@@ -875,11 +875,11 @@
 	rpid = STARTING_RPID + 39
 	rplistdef(length(rplistdef)) = 1 * EXT_RECIPES + rpid
 	rpdatan(rpid) = lang("魔剣転生", "makenn tensei")
 	rpdata(RPDATA_ITEM, rpid) = ITEM_ID_SKULL_SWORD, 20 + 1 * 10000
 	rpdata(RPDATA_SKILL + 0 * 2, rpid) = SKILL_NORMAL_ANATOMY, 2, SKILL_NORMAL_ALCHEMY, 6
-	rpdata(RPDATA_MAT + 0, rpid) = (50 /*!!!@[FILTER_RACE_KUSOSUGI @@@ ITEM_ID_BROKEN_SWORD]@!!! */), ITEM_ID_BONE_FRAGMENT
+	rpdata(RPDATA_MAT + 0, rpid) = (50 /*!!!@[FILTER_RACE_KUSOSUGI @@@ ITEM_ID_BROKEN_SWORD]@!!! */), (51 /*!!!@[FILTER_RACE_SEAMONSTER_DOLPHIN_SOLDIER @@@ ITEM_ID_BONE_FRAGMENT]@!!! */)
 	rpid = STARTING_RPID + 40
 	rplistdef(length(rplistdef)) = 1 * EXT_RECIPES + rpid
 	rpdatan(rpid) = lang("真・魔剣転生", "shin makenn tensei")
 	rpdata(RPDATA_ITEM, rpid) = ITEM_ID_VIOLENT_SKULL_SWORD, 30 + 1 * 10000
 	rpdata(RPDATA_SKILL + 0 * 2, rpid) = SKILL_NORMAL_ANATOMY, 30, SKILL_NORMAL_ALCHEMY, 45
@@ -1684,11 +1684,11 @@
 			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			item_identify ci, ITEM_KNOWN_FULL
 			txtef COLOR_GREEN
 			txt lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
 			flt
-			itemcreate -1, ITEM_ID_DEAD_FISH, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+			itemcreate -1, ITEM_ID_STRAW, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			item_identify ci, ITEM_KNOWN_FULL
 			txtef COLOR_GREEN
 			txt lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
 			flt
@@ -1964,34 +1964,77 @@
 			item_identify ci, ITEM_KNOWN_FULL
 			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			skillexp SKILL_NORMAL_ALCHEMY, CHARA_PLAYER, 600
 		}
 		if ( rpdata(RPDATA_ITEM, rpid) == ITEM_ID_CRIMSON_DARK_ORB ) {
+			item_stack CHARA_PLAYER, ci
 			necrop = rnd(5)
 			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 40 ) {
 				necrop = rnd(4)
 			}
 			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 30 ) {
 				necrop = rnd(3)
 			}
 			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 20 ) {
 				necrop = rnd(2)
 			}
-			item_stack CHARA_PLAYER, ci
 			flt
-			itemcreate -1, 1194 + rnd(3), cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+			itemcreate -1, ITEM_ID_JADE_DARK_ORB, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 			inv(INV_ITEM_PARAM1, ci) = necrop
+			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			item_identify ci, ITEM_KNOWN_FULL
+			txtef COLOR_GREEN
+			txt lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
+			necrop = rnd(5)
+			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 40 ) {
+				necrop = rnd(4)
+			}
+			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 30 ) {
+				necrop = rnd(3)
+			}
+			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 20 ) {
+				necrop = rnd(2)
+			}
+			flt
+			itemcreate -1, ITEM_ID_AZURE_DARK_ORB, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+			inv(INV_ITEM_PARAM1, ci) = necrop
 			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+			item_identify ci, ITEM_KNOWN_FULL
+			txtef COLOR_GREEN
+			txt lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
+			necrop = rnd(5)
+			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 40 ) {
+				necrop = rnd(4)
+			}
+			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 30 ) {
+				necrop = rnd(3)
+			}
+			if ( sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) < 20 ) {
+				necrop = rnd(2)
+			}
+			flt
+			itemcreate -1, ITEM_ID_CRIMSON_DARK_ORB, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+			inv(INV_ITEM_PARAM1, ci) = necrop
+			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+			item_identify ci, ITEM_KNOWN_FULL
+			txtef COLOR_GREEN
+			txt lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
+			flt
+			itemcreate -1, ITEM_ID_WHITE_DARK_ORB, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+			inv(INV_ITEM_PARAM1, ci) = rnd(6)
+			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+			item_identify ci, ITEM_KNOWN_FULL
+			txtef COLOR_GREEN
+			txt lang(itemname(ci, 1) + "の作成に成功した！", "You successfully create " + itemname(ci, 1) + "!")
 		}
 		if ( rpdata(RPDATA_ITEM, rpid) == ITEM_ID_MONSTER_BALL ) {
 			picp = (gdata(GDATA_DEEPEST_LEVEL) + 10) * 2 / 3
 			katis = limit(picp, 1, 200)
 			flt
 			itemcreate -1, ITEM_ID_MONSTER_BALL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
 			inv(INV_ITEM_PARAM2, ci) = picp
-			inv(INV_ITEM_VALUE, ci) = 2000 + katis * katis + katis * 100
+			inv(INV_ITEM_VALUE, ci) = 2000 + katis * katis + katis * 1060
 			inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 			item_identify ci, ITEM_KNOWN_FULL
 		}
 		if ( rpdata(RPDATA_ITEM, rpid) == ITEM_ID_LARGE_PICNIC_BASKET ) {
 			picp = inv(INV_ITEM_PARAM2, rpref(10 + 0 * 2)) + inv(INV_ITEM_PARAM2, rpref(10 + 1 * 2)) + inv(INV_ITEM_PARAM2, rpref(10 + 2 * 2)) + inv(INV_ITEM_PARAM2, rpref(10 + 3 * 2)) + inv(INV_ITEM_PARAM2, rpref(10 + 4 * 2)) + inv(INV_ITEM_PARAM2, rpref(10 + 5 * 2))
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/calculation.hsp ../2.17-borscht/calculation.hsp
--- ../2.15R-borscht/calculation.hsp	2023-05-12 09:08:03.373286900 +0800
+++ ../2.17-borscht/calculation.hsp	2023-05-12 09:05:56.594441600 +0800
@@ -218,10 +218,33 @@
 	if ( inv(INV_ITEM_ID, calcitemvalue_itemid) == ITEM_ID_MYSTERIOUS_FOSSIL ) {
 		if ( inv(INV_ITEM_PARAM2, calcitemvalue_itemid) > 0 ) {
 			locvar_calcitemvalue_value += inv(INV_ITEM_PARAM2, calcitemvalue_itemid) * 450
 		}
 	}
+	if ( inv(INV_ITEM_ID, calcitemvalue_itemid) == ITEM_ID_MEMORY_FRAGMENT ) {
+		if ( inv(INV_ITEM_PARAM2, calcitemvalue_itemid) > 0 ) {
+			locvar_calcitemvalue_value += inv(INV_ITEM_PARAM2, calcitemvalue_itemid) * 30
+		}
+	}
+	if ( inv(INV_ITEM_ID, calcitemvalue_itemid) == ITEM_ID_FIGHTING_DESTONE ) {
+		if ( inv(INV_ITEM_PARAM2, calcitemvalue_itemid) > 0 ) {
+			locvar_calcitemvalue_value += inv(INV_ITEM_PARAM2, calcitemvalue_itemid) * 30
+		}
+	}
+	if ( inv(INV_ITEM_ID, calcitemvalue_itemid) == ITEM_ID_MANA_DESTONE ) {
+		if ( inv(INV_ITEM_PARAM2, calcitemvalue_itemid) > 0 ) {
+			locvar_calcitemvalue_value += inv(INV_ITEM_PARAM2, calcitemvalue_itemid) * 60
+		}
+	}
+	if ( inv(INV_ITEM_ID, calcitemvalue_itemid) == ITEM_ID_DEVIL_FRAGMENT ) {
+		if ( inv(INV_ITEM_PARAM2, calcitemvalue_itemid) > 0 ) {
+			locvar_calcitemvalue_value *= limit(inv(INV_ITEM_PARAM2, calcitemvalue_itemid) + 1, 1, 30)
+		}
+	}
+	if ( inv(INV_ITEM_ID, calcitemvalue_itemid) == ITEM_ID_AWAKE_DESTONE ) {
+		locvar_calcitemvalue_value += (inv(INV_ITEM_PARAM2, calcitemvalue_itemid) + inv(INV_ITEM_PARAM3, calcitemvalue_itemid) + inv(INV_ITEM_AMUR_CAGE, calcitemvalue_itemid)) * 5
+	}
 	if ( inv(INV_ITEM_KNOWN, calcitemvalue_itemid) >= ITEM_KNOWN_FULL ) {
 		if ( inv(INV_ITEM_STATUS, calcitemvalue_itemid) == ITEM_STATUS_BLESSED ) {
 			locvar_calcitemvalue_value = locvar_calcitemvalue_value * 6 / 5
 		}
 		if ( inv(INV_ITEM_STATUS, calcitemvalue_itemid) == ITEM_STATUS_CURSED ) {
@@ -1093,10 +1116,16 @@
 		skillinit SKILL_NORMAL_CASTING, r1, 6
 	}
 	if ( cdata(CDATA_ID, r1) == CREATURE_ID_WANDERING_PENGUIN ) {
 		skillinit SKILL_NORMAL_SWIMMING, r1, 15
 	}
+	if ( cdata(CDATA_ID, r1) == CREATURE_ID_CHAOSHAPRINCESS_FSSSY ) {
+		skillinit SKILL_NORMAL_SWIMMING, r1, 10
+	}
+	if ( cdata(CDATA_ID, r1) == CREATURE_ID_ETHERIAN_PLUS ) {
+		skillinit SKILL_NORMAL_SWIMMING, r1, 5
+	}
 	if ( cdata(CDATA_ID, r1) == CREATURE_ID_NERES_THE_AMNESIAC ) {
 		skillinit SKILL_ATTR_STR, r1, 6
 	}
 	if ( cdata(CDATA_ID, r1) == CREATURE_ID_REGULUS_THE_ALTERED ) {
 		skillinit SKILL_ATTR_STR, r1, 3
@@ -1384,11 +1413,11 @@
 	}
 	spact(SKILL_SPACT_DRAIN_BLOOD - STARTING_SKILL_SPACT) = 1
 	spact(SKILL_SPACT_FIRE_BREATH - STARTING_SKILL_SPACT) = 1
 	spact(SKILL_SPACT_TOUCH_OF_WEAKNESS - STARTING_SKILL_SPACT) = 1
 	spact(SKILL_SPACT_PSYCHOANALYSIS - STARTING_SKILL_SPACT) = 1
-	repeat 848 - 600
+	repeat 852 - 600
 		spact(cnt + STARTING_SKILL_SPACT - STARTING_SKILL_SPACT) = 1
 	loop
 	skillinit SKILL_NORMAL_CASTING, r1, 6
 	skillinit SKILL_NORMAL_SHIELD, r1, 2
 	skillinit SKILL_WEAPON_FIREARM, r1, 2
@@ -1538,10 +1567,13 @@
 		return 1
 	}
 	return 0
 
 *calcTrap
+	if ( cc == CHARA_PLAYER | cdata(CDATA_RELATION, cc) == RELATION_ALLY & feat(FEAT_CELL_SUB_FEATURE_ID) > CELL_SUB_FEATURE_TRAP_QUEST_PITFALL2 ) {
+		return 1
+	}
 	if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_QUEST_MINE ) {
 		return 0
 	}
 	if ( cdata(CDATA_CONDITION_GRAVITY, cc) > 0 ) {
 		return 0
@@ -1732,11 +1764,11 @@
 		}
 		healhp r1, 1
 		healmp r1, 1
 	}
 	if ( cdata(CDATA_CONDITION_POISON, r1) > 0 ) {
-		dmghp r1, rnd(2 + sdata(SKILL_ATTR_CON, r1) / 10), DAMAGE_FROM_POISON
+		dmghp r1, cdata(CDATA_MAX_HP, r1) / 15 + 2, DAMAGE_FROM_POISON
 		healcon r1, CONDITION_POISON, 1
 		if ( cdata(CDATA_CONDITION_POISON, r1) > 0 ) {
 			cdata(CDATA_EMO_ICON, r1) = 8 + 100
 		}
 		regen = 0
@@ -1761,11 +1793,11 @@
 				txt lang(name(r1) + "は気道を確保した。「げほっげほっ！」", name(cc) + " released from suffocation.")
 			}
 			cdata(CDATA_CONDITION_SUFFOCATION, r1) = 0
 		}
 		else {
-			dmghp r1, rnd(50 + sdata(SKILL_ATTR_CON, r1)) + 50, DAMAGE_FROM_SUFFOCATION
+			dmghp r1, cdata(CDATA_MAX_HP, r1) / 15 + 2, DAMAGE_FROM_SUFFOCATION
 			regen = 0
 		}
 	}
 	if ( cdata(CDATA_CONDITION_GRAVITY, r1) > 0 ) {
 		cdata(CDATA_CONDITION_GRAVITY, r1)--
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/chara.hsp ../2.17-borscht/chara.hsp
--- ../2.15R-borscht/chara.hsp	2023-05-12 09:08:03.403206300 +0800
+++ ../2.17-borscht/chara.hsp	2023-05-12 09:05:56.623419300 +0800
@@ -133,10 +133,24 @@
 			txtmore
 			txtef COLOR_YELLOW
 			txt lang("あなたは「" + skillname(SKILL_SPACT_SPACE_RETENTION) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_SPACE_RETENTION) + ".")
 		}
 	}
+	if ( cdata(CDATA_LEVEL, CHARA_PLAYER) >= 20 ) {
+		if ( spact(SKILL_SPACT_LIMIT_POWER - STARTING_SKILL_SPACT) == 0 ) {
+			spact(SKILL_SPACT_LIMIT_POWER - STARTING_SKILL_SPACT) = 1
+			txtmore
+			txtef COLOR_YELLOW
+			txt lang("あなたは「" + skillname(SKILL_SPACT_LIMIT_POWER) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_LIMIT_POWER) + ".")
+		}
+		if ( spact(SKILL_SPACT_LIMITER_VANISH - STARTING_SKILL_SPACT) == 0 ) {
+			spact(SKILL_SPACT_LIMITER_VANISH - STARTING_SKILL_SPACT) = 1
+			txtmore
+			txtef COLOR_YELLOW
+			txt lang("あなたは「" + skillname(SKILL_SPACT_LIMITER_VANISH) + "」の能力を得た。", "You have learned new ability, " + skillname(SKILL_SPACT_LIMITER_VANISH) + ".")
+		}
+	}
 	if ( sorg(SKILL_ATTR_LER, CHARA_PLAYER) > 29 & trait(TRAIT_NORMAL_SPACT_CHEER) != 0 ) {
 		if ( spact(SKILL_SPACT_INDIVIDUAL_LEADING - STARTING_SKILL_SPACT) == 0 ) {
 			spact(SKILL_SPACT_INDIVIDUAL_LEADING - STARTING_SKILL_SPACT) = 1
 			txtmore
 			txtef COLOR_YELLOW
@@ -2304,23 +2318,23 @@
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_YERLESWOOD_TYPE_M | cdata(CDATA_ID, rc) == CREATURE_ID_MELUGAST_TYPEM ) {
 		cdata(CDATA_HEIGHT, rc) += 2700
 		cdata(CDATA_WEIGHT, rc) += 19000
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_MISHAGUZI | cdata(CDATA_ID, rc) == CREATURE_ID_EK_CHUAH | cdata(CDATA_ID, rc) == CREATURE_ID_HYPOMYCES | cdata(CDATA_ID, rc) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_SUPER_GRANDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_UNGOLIANT | cdata(CDATA_ID, rc) == CREATURE_ID_SUGAAR | cdata(CDATA_ID, rc) == CREATURE_ID_GIANT_EATER_FLOWER | cdata(CDATA_ID, rc) == CREATURE_ID_STAG_GOD | cdata(CDATA_ID, rc) == CREATURE_ID_DRAGON_CENTIPEDE | cdata(CDATA_ID, rc) == CREATURE_ID_GRANDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_ETHER_GENERATOR | cdata(CDATA_ID, rc) == CREATURE_ID_ELEMENT_DRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_FIVE_HEAD_GOD | cdata(CDATA_ID, rc) == CREATURE_ID_HEQET | cdata(CDATA_ID, rc) == CREATURE_ID_DRAGON_ZOMBIE | cdata(CDATA_ID, rc) == CREATURE_ID_GRAND_ENT | cdata(CDATA_ID, rc) == CREATURE_ID_ATLACH_NACHA | cdata(CDATA_ID, rc) == CREATURE_ID_ATLAS | cdata(CDATA_ID, rc) == CREATURE_ID_INDIGO_LOBSTER | cdata(CDATA_ID, rc) == CREATURE_ID_HELL_NEEDLE_HEDGEHOG | cdata(CDATA_ID, rc) == CREATURE_ID_QUEEN_GI_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_ALICE_THE_BIG_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_SAND_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_ROCK_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_JELLYFISH_KRAKEN | cdata(CDATA_ID, rc) == CREATURE_ID_LAZASYE_THE_DESTROY | cdata(CDATA_ID, rc) == CREATURE_ID_INQTUAL_THE_REVENGE | cdata(CDATA_ID, rc) == CREATURE_ID_ROATONIS_THE_INFECTIONS | cdata(CDATA_ID, rc) == CREATURE_ID_EGELVEIL_THE_BIND | cdata(CDATA_ID, rc) == CREATURE_ID_MOAI_CORE | cdata(CDATA_ID, rc) == CREATURE_ID_DHWTY | cdata(CDATA_ID, rc) == CREATURE_ID_BIND_DEVIL_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_SEPA | cdata(CDATA_ID, rc) == CREATURE_ID_TENTACLE_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_SAIMEF_THE_DOGGOD | cdata(CDATA_ID, rc) == CREATURE_ID_ESTORK_THE_DOGGOD | cdata(CDATA_ID, rc) == CREATURE_ID_ORCINUS_ORCA | cdata(CDATA_ID, rc) == CREATURE_ID_SHELL_KING_OF_VINDALE | cdata(CDATA_ID, rc) == CREATURE_ID_KING_WOODLOUSE | cdata(CDATA_ID, rc) == CREATURE_ID_ZOIBO | cdata(CDATA_ID, rc) == CREATURE_ID_BUILDION | cdata(CDATA_ID, rc) == CREATURE_ID_KONIGS_KATZE | cdata(CDATA_ID, rc) == CREATURE_ID_GANESA | cdata(CDATA_ID, rc) == CREATURE_ID_GASYADOKURO | cdata(CDATA_ID, rc) == CREATURE_ID_DRICERADOPS | cdata(CDATA_ID, rc) == CREATURE_ID_HINOCCHIO | cdata(CDATA_ID, rc) == CREATURE_ID_KUSOSUGI | cdata(CDATA_ID, rc) == 1071 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_MISHAGUZI | cdata(CDATA_ID, rc) == CREATURE_ID_EK_CHUAH | cdata(CDATA_ID, rc) == CREATURE_ID_HYPOMYCES | cdata(CDATA_ID, rc) == CREATURE_ID_DEAD_EYES_BLOOD_DRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_SUPER_GRANDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_UNGOLIANT | cdata(CDATA_ID, rc) == CREATURE_ID_SUGAAR | cdata(CDATA_ID, rc) == CREATURE_ID_GIANT_EATER_FLOWER | cdata(CDATA_ID, rc) == CREATURE_ID_STAG_GOD | cdata(CDATA_ID, rc) == CREATURE_ID_DRAGON_CENTIPEDE | cdata(CDATA_ID, rc) == CREATURE_ID_GRANDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_ETHER_GENERATOR | cdata(CDATA_ID, rc) == CREATURE_ID_ELEMENT_DRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_FIVE_HEAD_GOD | cdata(CDATA_ID, rc) == CREATURE_ID_HEQET | cdata(CDATA_ID, rc) == CREATURE_ID_DRAGON_ZOMBIE | cdata(CDATA_ID, rc) == CREATURE_ID_GRAND_ENT | cdata(CDATA_ID, rc) == CREATURE_ID_ATLACH_NACHA | cdata(CDATA_ID, rc) == CREATURE_ID_ATLAS | cdata(CDATA_ID, rc) == CREATURE_ID_INDIGO_LOBSTER | cdata(CDATA_ID, rc) == CREATURE_ID_HELL_NEEDLE_HEDGEHOG | cdata(CDATA_ID, rc) == CREATURE_ID_QUEEN_GI_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_ALICE_THE_BIG_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_SAND_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_ROCK_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_JELLYFISH_KRAKEN | cdata(CDATA_ID, rc) == CREATURE_ID_LAZASYE_THE_DESTROY | cdata(CDATA_ID, rc) == CREATURE_ID_INQTUAL_THE_REVENGE | cdata(CDATA_ID, rc) == CREATURE_ID_ROATONIS_THE_INFECTIONS | cdata(CDATA_ID, rc) == CREATURE_ID_EGELVEIL_THE_BIND | cdata(CDATA_ID, rc) == CREATURE_ID_MOAI_CORE | cdata(CDATA_ID, rc) == CREATURE_ID_DHWTY | cdata(CDATA_ID, rc) == CREATURE_ID_BIND_DEVIL_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_SEPA | cdata(CDATA_ID, rc) == CREATURE_ID_TENTACLE_WORM | cdata(CDATA_ID, rc) == CREATURE_ID_SAIMEF_THE_DOGGOD | cdata(CDATA_ID, rc) == CREATURE_ID_ESTORK_THE_DOGGOD | cdata(CDATA_ID, rc) == CREATURE_ID_ORCINUS_ORCA | cdata(CDATA_ID, rc) == CREATURE_ID_SHELL_KING_OF_VINDALE | cdata(CDATA_ID, rc) == CREATURE_ID_KING_WOODLOUSE | cdata(CDATA_ID, rc) == CREATURE_ID_ZOIBO | cdata(CDATA_ID, rc) == CREATURE_ID_BUILDION | cdata(CDATA_ID, rc) == CREATURE_ID_KONIGS_KATZE | cdata(CDATA_ID, rc) == CREATURE_ID_GANESA | cdata(CDATA_ID, rc) == CREATURE_ID_GASYADOKURO | cdata(CDATA_ID, rc) == CREATURE_ID_DRICERADOPS | cdata(CDATA_ID, rc) == CREATURE_ID_HINOCCHIO | cdata(CDATA_ID, rc) == CREATURE_ID_KUSOSUGI | cdata(CDATA_ID, rc) == CREATURE_ID_DAGANOTOSUS ) {
 		cdata(CDATA_HEIGHT, rc) += rnd(500) + 1000
 		cdata(CDATA_WEIGHT, rc) += rnd(5000) + 15000
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_TRICERATOPS ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(200) + 800
 		cdata(CDATA_WEIGHT, rc) = rnd(3000) + 6000
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_MAMMOTH | cdata(CDATA_ID, rc) == CREATURE_ID_KNIGHTCEROS | cdata(CDATA_ID, rc) == CREATURE_ID_ELECTRIC_HIPPOPOTAMUS | cdata(CDATA_ID, rc) == CREATURE_ID_KILLING_ANTEATER | cdata(CDATA_ID, rc) == CREATURE_ID_GRAVEED_THE_GRAVITY_VALLEY | cdata(CDATA_ID, rc) == CREATURE_ID_HOT_MUSHROOM_TEACHER | cdata(CDATA_ID, rc) == CREATURE_ID_JANKEN_KING | cdata(CDATA_ID, rc) == CREATURE_ID_MAG_COUNT | cdata(CDATA_ID, rc) == CREATURE_ID_E_MAG_DUKE | cdata(CDATA_ID, rc) == CREATURE_ID_GREEN_DARK_GUARDIAN | cdata(CDATA_ID, rc) == CREATURE_ID_BLUE_DARK_GUARDIAN | cdata(CDATA_ID, rc) == CREATURE_ID_CRIMSON_DARK_GUARDIAN | cdata(CDATA_ID, rc) == 1072 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_MAMMOTH | cdata(CDATA_ID, rc) == CREATURE_ID_KNIGHTCEROS | cdata(CDATA_ID, rc) == CREATURE_ID_ELECTRIC_HIPPOPOTAMUS | cdata(CDATA_ID, rc) == CREATURE_ID_KILLING_ANTEATER | cdata(CDATA_ID, rc) == CREATURE_ID_GRAVEED_THE_GRAVITY_VALLEY | cdata(CDATA_ID, rc) == CREATURE_ID_HOT_MUSHROOM_TEACHER | cdata(CDATA_ID, rc) == CREATURE_ID_JANKEN_KING | cdata(CDATA_ID, rc) == CREATURE_ID_MAG_COUNT | cdata(CDATA_ID, rc) == CREATURE_ID_E_MAG_DUKE | cdata(CDATA_ID, rc) == CREATURE_ID_GREEN_DARK_GUARDIAN | cdata(CDATA_ID, rc) == CREATURE_ID_BLUE_DARK_GUARDIAN | cdata(CDATA_ID, rc) == CREATURE_ID_CRIMSON_DARK_GUARDIAN | cdata(CDATA_ID, rc) == CREATURE_ID_SP_CHAMPION ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(80) + 450
 		cdata(CDATA_WEIGHT, rc) = rnd(5000) + 10000
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_GIRAFFE | cdata(CDATA_ID, rc) == CREATURE_ID_GI_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_SAMURAI_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_STEEL_ARMOR_SPIDER | cdata(CDATA_ID, rc) == CREATURE_ID_GOLD_ARMOR_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_MEIDA | cdata(CDATA_ID, rc) == CREATURE_ID_OYAUKAMUI | cdata(CDATA_ID, rc) == CREATURE_ID_HAM_TAIROU | cdata(CDATA_ID, rc) == CREATURE_ID_DISASTER | cdata(CDATA_ID, rc) == CREATURE_ID_BLACK_WING | cdata(CDATA_ID, rc) == CREATURE_ID_SEA_FALLEN_ANGEL | cdata(CDATA_ID, rc) == CREATURE_ID_ROPER | cdata(CDATA_ID, rc) == CREATURE_ID_BEILGENA_THE_ARTIFICIAL_DRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_UNIVERSE_INVADER | cdata(CDATA_ID, rc) == CREATURE_ID_HUNDRED_EYES | cdata(CDATA_ID, rc) == CREATURE_ID_KING_HOGWEEDER ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_GIRAFFE | cdata(CDATA_ID, rc) == CREATURE_ID_GI_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_SAMURAI_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_STEEL_ARMOR_SPIDER | cdata(CDATA_ID, rc) == CREATURE_ID_GOLD_ARMOR_ANT | cdata(CDATA_ID, rc) == CREATURE_ID_MEIDA | cdata(CDATA_ID, rc) == CREATURE_ID_OYAUKAMUI | cdata(CDATA_ID, rc) == CREATURE_ID_HAM_TAIROU | cdata(CDATA_ID, rc) == CREATURE_ID_DISASTER | cdata(CDATA_ID, rc) == CREATURE_ID_BLACK_WING | cdata(CDATA_ID, rc) == CREATURE_ID_SEA_FALLEN_ANGEL | cdata(CDATA_ID, rc) == CREATURE_ID_ROPER | cdata(CDATA_ID, rc) == CREATURE_ID_BEILGENA_THE_ARTIFICIAL_DRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_UNIVERSE_INVADER | cdata(CDATA_ID, rc) == CREATURE_ID_HUNDRED_EYES | cdata(CDATA_ID, rc) == CREATURE_ID_KING_HOGWEEDER | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_MEM | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_FWBS | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_FSSSY | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_CHRDH | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_VARGM | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_DIBWL | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_ZEHLS ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(100) + 400
 		cdata(CDATA_WEIGHT, rc) = rnd(300) + 700
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_CLOUDRAGON | cdata(CDATA_ID, rc) == CREATURE_ID_MOMOTUKA | cdata(CDATA_ID, rc) == CREATURE_ID_OXODE_THE_QUEEN_BEE ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(100) + 400
@@ -2336,19 +2350,19 @@
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SILVER_CAT | cdata(CDATA_ID, rc) == CREATURE_ID_STRAY_CAT | cdata(CDATA_ID, rc) == CREATURE_ID_BAMBOO_SPROUT | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOS_SEED | cdata(CDATA_ID, rc) == CREATURE_ID_KARATA_THE_SEMINAR_MASCOT | cdata(CDATA_ID, rc) == CREATURE_ID_NURSING_MOTH ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(10) + 20
 		cdata(CDATA_WEIGHT, rc) = rnd(2) + 1
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_LION | cdata(CDATA_ID, rc) == CREATURE_ID_CARBUNCLE | cdata(CDATA_ID, rc) == CREATURE_ID_MEGA_MOLE | cdata(CDATA_ID, rc) == CREATURE_ID_TALPIDAE | cdata(CDATA_ID, rc) == CREATURE_ID_SHINING_SILVER_WOLF | cdata(CDATA_ID, rc) == CREATURE_ID_BLAZE_LION | cdata(CDATA_ID, rc) == CREATURE_ID_CAPTAIN_SHARK | cdata(CDATA_ID, rc) == CREATURE_ID_RAGING_SHARK | cdata(CDATA_ID, rc) == CREATURE_ID_NIGHTMARE_SHARK | cdata(CDATA_ID, rc) == CREATURE_ID_LEGENDARY_WOLF | cdata(CDATA_ID, rc) == CREATURE_ID_DARK_RAIDER | cdata(CDATA_ID, rc) == CREATURE_ID_SEIASHIN | cdata(CDATA_ID, rc) == CREATURE_ID_SALAMANDER | cdata(CDATA_ID, rc) == CREATURE_ID_NUOU | cdata(CDATA_ID, rc) == CREATURE_ID_SIVA_THE_DESTRUCTION | cdata(CDATA_ID, rc) == CREATURE_ID_NAGAREW_THE_OBLIVION_BEAST | cdata(CDATA_ID, rc) == CREATURE_ID_LION2 | cdata(CDATA_ID, rc) == CREATURE_ID_FALLEN_BIRD | cdata(CDATA_ID, rc) == CREATURE_ID_TELHUREZA_THE_HOUSE_GUARD | cdata(CDATA_ID, rc) == MAX_CREATURE_ID | cdata(CDATA_ID, rc) == 1068 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_LION | cdata(CDATA_ID, rc) == CREATURE_ID_CARBUNCLE | cdata(CDATA_ID, rc) == CREATURE_ID_MEGA_MOLE | cdata(CDATA_ID, rc) == CREATURE_ID_TALPIDAE | cdata(CDATA_ID, rc) == CREATURE_ID_SHINING_SILVER_WOLF | cdata(CDATA_ID, rc) == CREATURE_ID_BLAZE_LION | cdata(CDATA_ID, rc) == CREATURE_ID_CAPTAIN_SHARK | cdata(CDATA_ID, rc) == CREATURE_ID_RAGING_SHARK | cdata(CDATA_ID, rc) == CREATURE_ID_NIGHTMARE_SHARK | cdata(CDATA_ID, rc) == CREATURE_ID_LEGENDARY_WOLF | cdata(CDATA_ID, rc) == CREATURE_ID_DARK_RAIDER | cdata(CDATA_ID, rc) == CREATURE_ID_SEIASHIN | cdata(CDATA_ID, rc) == CREATURE_ID_SALAMANDER | cdata(CDATA_ID, rc) == CREATURE_ID_NUOU | cdata(CDATA_ID, rc) == CREATURE_ID_SIVA_THE_DESTRUCTION | cdata(CDATA_ID, rc) == CREATURE_ID_NAGAREW_THE_OBLIVION_BEAST | cdata(CDATA_ID, rc) == CREATURE_ID_LION2 | cdata(CDATA_ID, rc) == CREATURE_ID_FALLEN_BIRD | cdata(CDATA_ID, rc) == CREATURE_ID_TELHUREZA_THE_HOUSE_GUARD | cdata(CDATA_ID, rc) == CREATURE_ID_DOSUKEBE_SEA_ANEMONE | cdata(CDATA_ID, rc) == CREATURE_ID_DOLPHIN_SOLDIER | cdata(CDATA_ID, rc) == CREATURE_ID_ETHERIAN_PLUS ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(100) + 200
 		cdata(CDATA_WEIGHT, rc) = rnd(100) + 150
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_MILOS_OF_THE_FORGOTTEN_WORLD | cdata(CDATA_ID, rc) == CREATURE_ID_JAGUAR_WARRIOR | cdata(CDATA_ID, rc) == CREATURE_ID_THE_LEOPARD_WARRIOR | cdata(CDATA_ID, rc) == CREATURE_ID_MARKA_THE_SILVER_BEAR | cdata(CDATA_ID, rc) == CREATURE_ID_COMMAND_WOLF | cdata(CDATA_ID, rc) == CREATURE_ID_GIGANTIC_FAIRY | cdata(CDATA_ID, rc) == CREATURE_ID_ZANAN_ENHANCED_SOLDIER | cdata(CDATA_ID, rc) == CREATURE_ID_CUB | cdata(CDATA_ID, rc) == CREATURE_ID_ALFRED_THE_CANGNAN_WIND | (cdata(CDATA_ID, rc) >= CREATURE_ID_BATTLE_ALIEN & cdata(CDATA_ID, rc) <= CREATURE_ID_SHINE_OGRE) | cdata(CDATA_ID, rc) == CREATURE_ID_IDURU_THE_SEMINAR_LECTURER | cdata(CDATA_ID, rc) == CREATURE_ID_BATTLE_HOPPER | cdata(CDATA_ID, rc) == CREATURE_ID_BLACK_HOPPER_X | cdata(CDATA_ID, rc) == CREATURE_ID_DOROTHIA_STANDING_IN_THE_WETLAND | cdata(CDATA_ID, rc) == CREATURE_ID_DUKE_KOBOLD | cdata(CDATA_ID, rc) == CREATURE_ID_LIGHTNING_KOBOLD | cdata(CDATA_ID, rc) == CREATURE_ID_OLD_BELL ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(20) + 180
 		cdata(CDATA_WEIGHT, rc) = rnd(20) + 70
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_URUK_HIGHNESS | cdata(CDATA_ID, rc) == CREATURE_ID_URUK_HAI | cdata(CDATA_ID, rc) == CREATURE_ID_URUK | cdata(CDATA_ID, rc) == CREATURE_ID_FANG_FUNGUS | cdata(CDATA_ID, rc) == CREATURE_ID_HAND_OF_THE_CATGOD | cdata(CDATA_ID, rc) == CREATURE_ID_HELLABYRINTH_RULER | cdata(CDATA_ID, rc) == 1070 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_URUK_HIGHNESS | cdata(CDATA_ID, rc) == CREATURE_ID_URUK_HAI | cdata(CDATA_ID, rc) == CREATURE_ID_URUK | cdata(CDATA_ID, rc) == CREATURE_ID_FANG_FUNGUS | cdata(CDATA_ID, rc) == CREATURE_ID_HAND_OF_THE_CATGOD | cdata(CDATA_ID, rc) == CREATURE_ID_HELLABYRINTH_RULER | cdata(CDATA_ID, rc) == CREATURE_ID_MOSTMUSCYLLA | cdata(CDATA_ID, rc) == CREATURE_ID_ETHERIAN ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(50) + 200
 		cdata(CDATA_WEIGHT, rc) = rnd(30) + 120
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_CUTE_FAIRY | cdata(CDATA_ID, rc) == CREATURE_ID_YOKOSHIMA_ENAGA | cdata(CDATA_ID, rc) == CREATURE_ID_CTHULHICK | cdata(CDATA_ID, rc) == CREATURE_ID_YOUNG_SWALLOW ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(5) + 10
@@ -2360,11 +2374,11 @@
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_ORICHAL_CHILD ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(3) + 19
 		cdata(CDATA_WEIGHT, rc) = 1
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_IMP | cdata(CDATA_ID, rc) == CREATURE_ID_NETHER_IMP | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOS_IMP | cdata(CDATA_ID, rc) == CREATURE_ID_DEMONS_COMMANDER | cdata(CDATA_ID, rc) == CREATURE_ID_CHILD_WEL | cdata(CDATA_ID, rc) == CREATURE_ID_MIZUKI_THE_ABYSS_PRINCESS | cdata(CDATA_ID, rc) == CREATURE_ID_TOWN_CHILD | cdata(CDATA_ID, rc) == CREATURE_ID_NOBLE_CHILD | cdata(CDATA_ID, rc) == CREATURE_ID_LITTLE_SISTER | cdata(CDATA_ID, rc) == CREATURE_ID_CAPYBARA | cdata(CDATA_ID, rc) == CREATURE_ID_THOUSAND_HEDGEHOG | cdata(CDATA_ID, rc) == CREATURE_ID_SHOEBILL | cdata(CDATA_ID, rc) == CREATURE_ID_NERES_THE_AMNESIAC | cdata(CDATA_ID, rc) == CREATURE_ID_RYUTYE_THE_AMNESIAC | cdata(CDATA_ID, rc) == CREATURE_ID_BOYCIANA | cdata(CDATA_ID, rc) == CREATURE_ID_HALLOWEEN_CHILDREN | cdata(CDATA_ID, rc) == CREATURE_ID_HALLOWEEN_CHILDREN2 | cdata(CDATA_ID, rc) == CREATURE_ID_WANDERING_PENGUIN | cdata(CDATA_ID, rc) == CREATURE_ID_ARIBEL_THE_WHITE_ARMS | cdata(CDATA_ID, rc) == CREATURE_ID_PERFORMAID_BITCHIACK | cdata(CDATA_ID, rc) == CREATURE_ID_FOX_BROTHER | cdata(CDATA_ID, rc) == CREATURE_ID_SILVER_FOX_BROTHER | cdata(CDATA_ID, rc) == CREATURE_ID_FOX | cdata(CDATA_ID, rc) == CREATURE_ID_INCONEET | cdata(CDATA_ID, rc) == CREATURE_ID_KOBOLINA | cdata(CDATA_ID, rc) == CREATURE_ID_AIME_THE_STORY_TELLER | cdata(CDATA_ID, rc) == CREATURE_ID_STRAY_SOUL | cdata(CDATA_ID, rc) == CREATURE_ID_IMARITUKA_THE_ZASIKI_WARAI | cdata(CDATA_ID, rc) == CREATURE_ID_ALRAUNE | cdata(CDATA_ID, rc) == CREATURE_ID_HELRAUNE | cdata(CDATA_ID, rc) == 1067 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_IMP | cdata(CDATA_ID, rc) == CREATURE_ID_NETHER_IMP | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOS_IMP | cdata(CDATA_ID, rc) == CREATURE_ID_DEMONS_COMMANDER | cdata(CDATA_ID, rc) == CREATURE_ID_CHILD_WEL | cdata(CDATA_ID, rc) == CREATURE_ID_MIZUKI_THE_ABYSS_PRINCESS | cdata(CDATA_ID, rc) == CREATURE_ID_TOWN_CHILD | cdata(CDATA_ID, rc) == CREATURE_ID_NOBLE_CHILD | cdata(CDATA_ID, rc) == CREATURE_ID_LITTLE_SISTER | cdata(CDATA_ID, rc) == CREATURE_ID_CAPYBARA | cdata(CDATA_ID, rc) == CREATURE_ID_THOUSAND_HEDGEHOG | cdata(CDATA_ID, rc) == CREATURE_ID_SHOEBILL | cdata(CDATA_ID, rc) == CREATURE_ID_NERES_THE_AMNESIAC | cdata(CDATA_ID, rc) == CREATURE_ID_RYUTYE_THE_AMNESIAC | cdata(CDATA_ID, rc) == CREATURE_ID_BOYCIANA | cdata(CDATA_ID, rc) == CREATURE_ID_HALLOWEEN_CHILDREN | cdata(CDATA_ID, rc) == CREATURE_ID_HALLOWEEN_CHILDREN2 | cdata(CDATA_ID, rc) == CREATURE_ID_WANDERING_PENGUIN | cdata(CDATA_ID, rc) == CREATURE_ID_ARIBEL_THE_WHITE_ARMS | cdata(CDATA_ID, rc) == CREATURE_ID_PERFORMAID_BITCHIACK | cdata(CDATA_ID, rc) == CREATURE_ID_FOX_BROTHER | cdata(CDATA_ID, rc) == CREATURE_ID_SILVER_FOX_BROTHER | cdata(CDATA_ID, rc) == CREATURE_ID_FOX | cdata(CDATA_ID, rc) == CREATURE_ID_INCONEET | cdata(CDATA_ID, rc) == CREATURE_ID_KOBOLINA | cdata(CDATA_ID, rc) == CREATURE_ID_AIME_THE_STORY_TELLER | cdata(CDATA_ID, rc) == CREATURE_ID_STRAY_SOUL | cdata(CDATA_ID, rc) == CREATURE_ID_IMARITUKA_THE_ZASIKI_WARAI | cdata(CDATA_ID, rc) == CREATURE_ID_ALRAUNE | cdata(CDATA_ID, rc) == CREATURE_ID_HELRAUNE | cdata(CDATA_ID, rc) == CREATURE_ID_PROVOCASQUID ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(30) + 110
 		cdata(CDATA_WEIGHT, rc) = rnd(10) + 25
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_LITTLE_BOY | cdata(CDATA_ID, rc) == CREATURE_ID_S_BOY ) {
 		cdata(CDATA_HEIGHT, rc) = rnd(20) + 130
@@ -2411,17 +2425,17 @@
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 12 - rnd(5)
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_GWEN_THE_PITILESS | cdata(CDATA_ID, rc) == CREATURE_ID_EILA_THE_FUGITIVE_KUNOICHI | cdata(CDATA_ID, rc) == CREATURE_ID_NEW_CITIZEN | cdata(CDATA_ID, rc) == CREATURE_ID_FASHIONABLE_KUNOICHI | cdata(CDATA_ID, rc) == CREATURE_ID_ALCHEMIST_NAPLUS | cdata(CDATA_ID, rc) == CREATURE_ID_RECONCILED_CLEANER | cdata(CDATA_ID, rc) == CREATURE_ID_MICHES_THE_APPRENTICE | cdata(CDATA_ID, rc) == CREATURE_ID_NOEL_THE_BOMBER | cdata(CDATA_ID, rc) == CREATURE_ID_RENAI_THE_OVER_MESHERA | cdata(CDATA_ID, rc) == CREATURE_ID_RIANNA_THE_DAYDREAMER | cdata(CDATA_ID, rc) == CREATURE_ID_ALSAPIA_THE_MURDERER_MASK | cdata(CDATA_ID, rc) == CREATURE_ID_MARY_THE_FLOWER_PICKER ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 15 - rnd(5)
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SICKFULL_OLDER_BROTHER | cdata(CDATA_ID, rc) == CREATURE_ID_TELHUREZA_THE_HOUSE_GUARD ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SICKFULL_OLDER_BROTHER | cdata(CDATA_ID, rc) == CREATURE_ID_TELHUREZA_THE_HOUSE_GUARD | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_MEM | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_FWBS | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_FSSSY | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_CHRDH | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_VARGM | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_DIBWL | cdata(CDATA_ID, rc) == CREATURE_ID_CHAOSHAPRINCESS_ZEHLS ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 18 - rnd(5)
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_INQTUAL_THE_REVENGE | cdata(CDATA_ID, rc) == CREATURE_ID_REGULUS_THE_ALTERED | cdata(CDATA_ID, rc) == CREATURE_ID_FRON_THE_TOUR_PLANNER | cdata(CDATA_ID, rc) == CREATURE_ID_MARKA_THE_SILVER_BEAR | cdata(CDATA_ID, rc) == CREATURE_ID_SPIPHA_THE_DRAGON_HUNTER | cdata(CDATA_ID, rc) == CREATURE_ID_AILE_THE_ATTENDANT | cdata(CDATA_ID, rc) == CREATURE_ID_NAZUNA_THE_INSTRUCTOR | cdata(CDATA_ID, rc) == CREATURE_ID_GETUEI_THE_NINJA_MASTER | cdata(CDATA_ID, rc) == CREATURE_ID_SECURITY_OFFICER_ORVILLE | cdata(CDATA_ID, rc) == CREATURE_ID_MILIS_CAPTAIN_OF_THE_SPECIAL_FORCES | cdata(CDATA_ID, rc) == CREATURE_ID_SHENA_THE_DRAW | cdata(CDATA_ID, rc) == CREATURE_ID_SILVIA_THE_PRINCESS | cdata(CDATA_ID, rc) == CREATURE_ID_TAM_THE_CAT_HATER | cdata(CDATA_ID, rc) == CREATURE_ID_MIA_THE_CAT_FREAK | cdata(CDATA_ID, rc) == CREATURE_ID_FRAY_THE_FIGHTER_GUILDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_STRANGE_SCIENTIST | cdata(CDATA_ID, rc) == CREATURE_ID_SKOGSRA | cdata(CDATA_ID, rc) == CREATURE_ID_PART_TIME_WORKER_THE_RED_SWORD | cdata(CDATA_ID, rc) == CREATURE_ID_BUTLER | cdata(CDATA_ID, rc) == CREATURE_ID_NANCY_THE_WANDERLUST | cdata(CDATA_ID, rc) == CREATURE_ID_JENNA_THE_MYTHICAL_MANIAC | cdata(CDATA_ID, rc) == CREATURE_ID_PROVIDENCE_GAZE | cdata(CDATA_ID, rc) == CREATURE_ID_OXODE_THE_QUEEN_BEE | cdata(CDATA_ID, rc) == 1070 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_INQTUAL_THE_REVENGE | cdata(CDATA_ID, rc) == CREATURE_ID_REGULUS_THE_ALTERED | cdata(CDATA_ID, rc) == CREATURE_ID_FRON_THE_TOUR_PLANNER | cdata(CDATA_ID, rc) == CREATURE_ID_MARKA_THE_SILVER_BEAR | cdata(CDATA_ID, rc) == CREATURE_ID_SPIPHA_THE_DRAGON_HUNTER | cdata(CDATA_ID, rc) == CREATURE_ID_AILE_THE_ATTENDANT | cdata(CDATA_ID, rc) == CREATURE_ID_NAZUNA_THE_INSTRUCTOR | cdata(CDATA_ID, rc) == CREATURE_ID_GETUEI_THE_NINJA_MASTER | cdata(CDATA_ID, rc) == CREATURE_ID_SECURITY_OFFICER_ORVILLE | cdata(CDATA_ID, rc) == CREATURE_ID_MILIS_CAPTAIN_OF_THE_SPECIAL_FORCES | cdata(CDATA_ID, rc) == CREATURE_ID_SHENA_THE_DRAW | cdata(CDATA_ID, rc) == CREATURE_ID_SILVIA_THE_PRINCESS | cdata(CDATA_ID, rc) == CREATURE_ID_TAM_THE_CAT_HATER | cdata(CDATA_ID, rc) == CREATURE_ID_MIA_THE_CAT_FREAK | cdata(CDATA_ID, rc) == CREATURE_ID_FRAY_THE_FIGHTER_GUILDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_STRANGE_SCIENTIST | cdata(CDATA_ID, rc) == CREATURE_ID_SKOGSRA | cdata(CDATA_ID, rc) == CREATURE_ID_PART_TIME_WORKER_THE_RED_SWORD | cdata(CDATA_ID, rc) == CREATURE_ID_BUTLER | cdata(CDATA_ID, rc) == CREATURE_ID_NANCY_THE_WANDERLUST | cdata(CDATA_ID, rc) == CREATURE_ID_JENNA_THE_MYTHICAL_MANIAC | cdata(CDATA_ID, rc) == CREATURE_ID_PROVIDENCE_GAZE | cdata(CDATA_ID, rc) == CREATURE_ID_OXODE_THE_QUEEN_BEE | cdata(CDATA_ID, rc) == CREATURE_ID_MOSTMUSCYLLA ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 20 - rnd(8)
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_AIKAGE_THE_SHINOBI_MASK | cdata(CDATA_ID, rc) == CREATURE_ID_BLACK_GAUNTLET_LEOLD | cdata(CDATA_ID, rc) == CREATURE_ID_LEAD_DEVELOPER_DR_GAVELA | cdata(CDATA_ID, rc) == CREATURE_ID_ARMA_THE_TOUR_GUIDE | cdata(CDATA_ID, rc) == CREATURE_ID_MURDER_KNIGHT | cdata(CDATA_ID, rc) == CREATURE_ID_MEFAN_THE_BARD | cdata(CDATA_ID, rc) == CREATURE_ID_RENTON_THE_SUFFERING_WIZARD | cdata(CDATA_ID, rc) == CREATURE_ID_MARKS_THE_GREAT_THIEF | cdata(CDATA_ID, rc) == CREATURE_ID_SIN_THE_THIEF_GUILDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_BETHEL_THE_WHITE_HAWK | cdata(CDATA_ID, rc) == CREATURE_ID_WHOM_DWELL_IN_THE_VANITY | cdata(CDATA_ID, rc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN | cdata(CDATA_ID, rc) == CREATURE_ID_MAILE_THE_MARIONETTE_SHAMAN | cdata(CDATA_ID, rc) == CREATURE_ID_CRAY_THE_CURIOUS_ADVENTURER | cdata(CDATA_ID, rc) == CREATURE_ID_EIGHTY_SHAKU ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_AIKAGE_THE_SHINOBI_MASK | cdata(CDATA_ID, rc) == CREATURE_ID_BLACK_GAUNTLET_LEOLD | cdata(CDATA_ID, rc) == CREATURE_ID_LEAD_DEVELOPER_DR_GAVELA | cdata(CDATA_ID, rc) == CREATURE_ID_ARMA_THE_TOUR_GUIDE | cdata(CDATA_ID, rc) == CREATURE_ID_MURDER_KNIGHT | cdata(CDATA_ID, rc) == CREATURE_ID_MEFAN_THE_BARD | cdata(CDATA_ID, rc) == CREATURE_ID_RENTON_THE_SUFFERING_WIZARD | cdata(CDATA_ID, rc) == CREATURE_ID_MARKS_THE_GREAT_THIEF | cdata(CDATA_ID, rc) == CREATURE_ID_SIN_THE_THIEF_GUILDMASTER | cdata(CDATA_ID, rc) == CREATURE_ID_BETHEL_THE_WHITE_HAWK | cdata(CDATA_ID, rc) == CREATURE_ID_WHOM_DWELL_IN_THE_VANITY | cdata(CDATA_ID, rc) == CREATURE_ID_LOYTER_THE_CRIMSON_OF_ZANAN | cdata(CDATA_ID, rc) == CREATURE_ID_MAILE_THE_MARIONETTE_SHAMAN | cdata(CDATA_ID, rc) == CREATURE_ID_CRAY_THE_CURIOUS_ADVENTURER | cdata(CDATA_ID, rc) == CREATURE_ID_EIGHTY_SHAKU | cdata(CDATA_ID, rc) == CREATURE_ID_ETHERIAN | cdata(CDATA_ID, rc) == CREATURE_ID_ETHERIAN_PLUS ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 28 - rnd(5)
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_AJETALIO_THE_SEMINAR_LECTURER ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 27
 	}
@@ -2432,11 +2446,11 @@
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 48
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_MITO_THE_SEMINAR_LECTURER ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 26
 	}
-	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SHURAIDA_THE_EXPERT_MERC | cdata(CDATA_ID, rc) == CREATURE_ID_MARY_THE_INSECT_MASTER | cdata(CDATA_ID, rc) == CREATURE_ID_BANKRUPT_GUO | cdata(CDATA_ID, rc) == CREATURE_ID_CAIM_THE_MAD_RICH | cdata(CDATA_ID, rc) == CREATURE_ID_THE_LEOPARD_WARRIOR | cdata(CDATA_ID, rc) == CREATURE_ID_ERYSTIA_THE_SCHOLAR_OF_HISTORY | cdata(CDATA_ID, rc) == CREATURE_ID_STERSHA_THE_QUEEN_OF_PALMIA | cdata(CDATA_ID, rc) == CREATURE_ID_XABI_THE_KING_OF_PALMIA | cdata(CDATA_ID, rc) == CREATURE_ID_GILBERT_THE_COLONEL | cdata(CDATA_ID, rc) == CREATURE_ID_PAELS_MOM_LILY | cdata(CDATA_ID, rc) == CREATURE_ID_RAPHAEL_THE_WOMANIZER | cdata(CDATA_ID, rc) == CREATURE_ID_ICOLLE_THE_BIOLOGIST | cdata(CDATA_ID, rc) == CREATURE_ID_BALZAK_THE_JANITOR | cdata(CDATA_ID, rc) == CREATURE_ID_MYSTERIOUS_PRODUCER | cdata(CDATA_ID, rc) == CREATURE_ID_ZISILION_THE_MINE_KING | cdata(CDATA_ID, rc) == CREATURE_ID_TONI_THE_ANGLER | cdata(CDATA_ID, rc) == CREATURE_ID_MANSON_THE_CAREFUL_ADVENTURER | cdata(CDATA_ID, rc) == CREATURE_ID_CURSE_GRAPPLER | cdata(CDATA_ID, rc) == CREATURE_ID_MAG_COUNT | cdata(CDATA_ID, rc) == CREATURE_ID_E_MAG_DUKE | cdata(CDATA_ID, rc) == 1072 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SHURAIDA_THE_EXPERT_MERC | cdata(CDATA_ID, rc) == CREATURE_ID_MARY_THE_INSECT_MASTER | cdata(CDATA_ID, rc) == CREATURE_ID_BANKRUPT_GUO | cdata(CDATA_ID, rc) == CREATURE_ID_CAIM_THE_MAD_RICH | cdata(CDATA_ID, rc) == CREATURE_ID_THE_LEOPARD_WARRIOR | cdata(CDATA_ID, rc) == CREATURE_ID_ERYSTIA_THE_SCHOLAR_OF_HISTORY | cdata(CDATA_ID, rc) == CREATURE_ID_STERSHA_THE_QUEEN_OF_PALMIA | cdata(CDATA_ID, rc) == CREATURE_ID_XABI_THE_KING_OF_PALMIA | cdata(CDATA_ID, rc) == CREATURE_ID_GILBERT_THE_COLONEL | cdata(CDATA_ID, rc) == CREATURE_ID_PAELS_MOM_LILY | cdata(CDATA_ID, rc) == CREATURE_ID_RAPHAEL_THE_WOMANIZER | cdata(CDATA_ID, rc) == CREATURE_ID_ICOLLE_THE_BIOLOGIST | cdata(CDATA_ID, rc) == CREATURE_ID_BALZAK_THE_JANITOR | cdata(CDATA_ID, rc) == CREATURE_ID_MYSTERIOUS_PRODUCER | cdata(CDATA_ID, rc) == CREATURE_ID_ZISILION_THE_MINE_KING | cdata(CDATA_ID, rc) == CREATURE_ID_TONI_THE_ANGLER | cdata(CDATA_ID, rc) == CREATURE_ID_MANSON_THE_CAREFUL_ADVENTURER | cdata(CDATA_ID, rc) == CREATURE_ID_CURSE_GRAPPLER | cdata(CDATA_ID, rc) == CREATURE_ID_MAG_COUNT | cdata(CDATA_ID, rc) == CREATURE_ID_E_MAG_DUKE | cdata(CDATA_ID, rc) == CREATURE_ID_SP_CHAMPION ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 30 - rnd(15)
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_KUROYA_THE_LOOKING_UNIVERSE | cdata(CDATA_ID, rc) == CREATURE_ID_LEND_THE_TAKER | cdata(CDATA_ID, rc) == CREATURE_ID_HEINRICH_THE_ARMORED_GENERAL | cdata(CDATA_ID, rc) == CREATURE_ID_MAD_SCIENTIST | cdata(CDATA_ID, rc) == CREATURE_ID_CONERY_PALMIAN_MAJOR_GENERAL | cdata(CDATA_ID, rc) == CREATURE_ID_SILVER_SKULL_MAJESTY | cdata(CDATA_ID, rc) == CREATURE_ID_JANKEN_KING ) {
 		cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 45 - rnd(15)
 	}
@@ -2461,11 +2475,11 @@
 		}
 		else {
 			cdata(CDATA_AGE, rc) = gdata(GDATA_YEAR) - 5 - rnd(5)
 		}
 	}
-	if ( cdata(CDATA_ID, rc) == 1072 ) {
+	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SP_CHAMPION ) {
 		cdata(CDATA_MELEE_STYLE, rc) = 0
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_H_SISTER2 | cdata(CDATA_ID, rc) == CREATURE_ID_YOUNGER_SISTER | cdata(CDATA_ID, rc) == CREATURE_ID_YOUNGER_SISTER2 | cdata(CDATA_ID, rc) == CREATURE_ID_YOUNGER_CAT_SISTER ) {
 		gdata(GDATA_FLAG_YOUNGER_SISTERS)++
 	}
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/chara_func.hsp ../2.17-borscht/chara_func.hsp
--- ../2.15R-borscht/chara_func.hsp	2023-05-12 09:08:03.439110900 +0800
+++ ../2.17-borscht/chara_func.hsp	2023-05-12 09:05:56.674316700 +0800
@@ -1763,19 +1763,16 @@
 		}
 	}
 	locvar_addbuff_fixeddur = addbuff_arg4
 	if ( bdataref(BDATAREF_BUFF_TYPE, addbuff_buffid) == BUFF_TYPE_HEX ) {
 		locvar_addbuff_f = 0
-		if ( sdata(SKILL_RES_MAGIC, addbuff_charid) / 2 > rnd(addbuff_arg3 * 2 + 100) ) {
-			locvar_addbuff_f = 1
+		if ( 0 ) {
+			txt lang("パワー" + addbuff_arg3 + "。", "But it produces no effect.")
 		}
-		if ( addbuff_arg3 * 3 < sdata(SKILL_RES_MAGIC, addbuff_charid) ) {
+		if ( sdata(SKILL_NORMAL_FAITH, addbuff_charid) * 2 + 100 > rnd(addbuff_arg3 * 2 + 100) ) {
 			locvar_addbuff_f = 1
 		}
-		if ( addbuff_arg3 / 3 > sdata(SKILL_RES_MAGIC, addbuff_charid) ) {
-			locvar_addbuff_f = 0
-		}
 		if ( cdata(CDATA_QUALITY, addbuff_charid) > FIX_QUALITY_GREAT | cdata(CDATA_ID, addbuff_charid) == CREATURE_ID_AILE_THE_ATTENDANT ) {
 			if ( rnd(4) ) {
 				locvar_addbuff_f = 1
 			}
 			else {
@@ -2120,24 +2117,24 @@
 		await cfg_animewait + 15 + (locvar_animeblood_ele2 != 0) * 20
 	loop
 	gmode 2
 	return
 
-*label_3649
-	goto *label_3657
+*label_3673
+	goto *label_3681
 
 #deffunc resistmod int resistmod_charid, int resistmod_ele, int resistmod_arg3
 	locvar_resistmod_lv = sorg(resistmod_ele, resistmod_charid) + resistmod_arg3
-	if ( sorg(resistmod_ele, resistmod_charid) >= 200 & resistmod_arg3 >= 50 ) {
+	if ( sorg(resistmod_ele, resistmod_charid) >= 300 & resistmod_arg3 >= 25 | sorg(resistmod_ele, resistmod_charid) < 100 ) {
 		txt lang("何もおきない… ", "Nothing happens...")
 	}
 	else {
 		if ( locvar_resistmod_lv < 50 ) {
 			locvar_resistmod_lv = 50
 		}
-		if ( locvar_resistmod_lv > 200 ) {
-			locvar_resistmod_lv = 200
+		if ( locvar_resistmod_lv >= 300 ) {
+			locvar_resistmod_lv = 300
 		}
 		if ( resistmod_arg3 >= 50 ) {
 			txtef COLOR_GREEN
 			if ( resistmod_ele == SKILL_RES_FIRE ) {
 				txt lang(name(resistmod_charid) + "の身体は急に火照りだした。", "Suddenly, " + name(resistmod_charid) + " feel" + _s(resistmod_charid) + " very hot.")
@@ -3320,19 +3317,27 @@
 			map(locvar_spillblood_dx, locvar_spillblood_dy, MAP_BLOOD_AND_DEBRIS) = map(locvar_spillblood_dx, locvar_spillblood_dy, MAP_BLOOD_AND_DEBRIS) \ 10 + (map(locvar_spillblood_dx, locvar_spillblood_dy, MAP_BLOOD_AND_DEBRIS) / 10 + 1) * 10
 		}
 	loop
 	return
 
-*label_3672
-	goto *label_3674
+*label_3696
+	goto *label_3698
 
 #deffunc check_talk int check_talk_arg1, int check_talk_arg2
 	if ( cdata(CDATA_EXIST, check_talk_arg2) == CHAR_STATE_ALIVE ) {
 		return
 	}
 	if ( check_talk_arg1 >= 0 ) {
 		if ( check_talk_arg1 == 0 | cdata(CDATA_RELATION, check_talk_arg1) >= RELATION_ALLY ) {
+			if ( cdata(CDATA_LEVEL, CHARA_PLAYER) < cdata(CDATA_LEVEL, check_talk_arg2) ) {
+				if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 4 ) {
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+				}
+			}
 			if ( cbit(CHARA_BIT_NECRO, check_talk_arg2) != TRUE & cdata(CDATA_RELATION, check_talk_arg2) != RELATION_ALLY & gdata(GDATA_FLAG_MAIN) != 900 ) {
 				if ( gdata(GDATA_FLAG_LEOLD_JOB_STAGE) == 1 ) {
 					if ( cdata(CDATA_LEVEL, check_talk_arg2) >= gdata(GDATA_FLAG_LEOLD_JOB_TIER) ) {
 						if ( cdata(CDATA_RELATION_ORG, check_talk_arg2) == RELATION_ENEMY ) {
 							gdata(GDATA_FLAG_LEOLD_JOB_STAGE) = 2
@@ -3626,16 +3631,24 @@
 	}
 	cdata(CDATA_EXP, check_talk_arg1) += locvar_check_talk_exp
 	cdata(CDATA_AI_AGGRO, check_talk_arg1) = 0
 	return
 
-*label_3674
-	goto *label_3676
+*label_3698
+	goto *label_3700
 
 #deffunc check_kill int check_kill_arg1, int check_kill_arg2
 	if ( check_kill_arg1 >= 0 ) {
 		if ( check_kill_arg1 == 0 | cdata(CDATA_RELATION, check_kill_arg1) >= RELATION_ALLY ) {
+			if ( cdata(CDATA_LEVEL, CHARA_PLAYER) < cdata(CDATA_LEVEL, check_kill_arg2) ) {
+				if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 4 ) {
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+				}
+			}
 			if ( cbit(CHARA_BIT_NECRO, check_kill_arg2) != TRUE & cdata(CDATA_RELATION, check_kill_arg2) != RELATION_ALLY & gdata(GDATA_FLAG_MAIN) != 900 ) {
 				if ( gdata(GDATA_FLAG_LEOLD_JOB_STAGE) == 1 ) {
 					if ( cdata(CDATA_LEVEL, check_kill_arg2) >= gdata(GDATA_FLAG_LEOLD_JOB_TIER) ) {
 						if ( cdata(CDATA_RELATION_ORG, check_kill_arg2) == RELATION_ENEMY ) {
 							gdata(GDATA_FLAG_LEOLD_JOB_STAGE) = 2
@@ -3682,15 +3695,10 @@
 			if ( cbit(CHARA_BIT_NECRO, check_kill_arg2) != TRUE & cdata(CDATA_RELATION, check_kill_arg2) != RELATION_ALLY ) {
 				if ( check_kill_arg2 >= 16 ) {
 					if ( check_kill_arg1 < 16 ) {
 						gdata(GDATA_KILLED)++
 					}
-					if ( cdata(CDATA_ID, check_kill_arg2) == gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) ) {
-						if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 ) {
-							gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA)--
-						}
-					}
 					if ( cdata(CDATA_RELATION_ORG, check_kill_arg2) >= RELATION_NEUTRAL ) {
 						locvar_check_kill_p = -2
 					}
 					if ( cdata(CDATA_ID, check_kill_arg2) == CREATURE_ID_RICH_PERSON ) {
 						locvar_check_kill_p = -15
@@ -4736,10 +4744,28 @@
 		if ( txteledmg_arg1 == 2 ) {
 			txt lang(name(txteledmg_arg3) + "は豆腐のかどが頭にぶつかって死んだ。", name(txteledmg_arg3) + " die" + _s(txteledmg_arg3) + " from tofu clash at the head.")
 		}
 		return
 	}
+	if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 100 ) {
+		if ( txteledmg_arg1 == 1 ) {
+			txt lang("人形に変えて事実上殺した。", "change" + _s(txteledmg_arg2) + " " + name(txteledmg_arg3) + " into a doll.")
+		}
+		if ( txteledmg_arg1 == 2 ) {
+			txt lang(name(txteledmg_arg3) + "は自由を奪われ人形になった。", name(txteledmg_arg3) + " change" + _s(txteledmg_arg3) + " into a doll.")
+		}
+		return
+	}
+	if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == (-1) ) {
+		if ( txteledmg_arg1 == 1 ) {
+			txt lang("内部から崩壊させて殺した。", "burst" + _s(txteledmg_arg2) + " the body of " + him(txteledmg_arg3) + ".")
+		}
+		if ( txteledmg_arg1 == 2 ) {
+			txt lang(name(txteledmg_arg3) + "は身体が耐え切れずに崩壊した。", name(txteledmg_arg3) + " burst" + _s(txteledmg_arg3) + " and die" + _s(txteledmg_arg3) + ".")
+		}
+		return
+	}
 	if ( txteledmg_arg1 == 0 ) {
 		if ( synccheck(txteledmg_arg3, -1) ) {
 			txt lang(name(txteledmg_arg3) + "は傷ついた。", name(txteledmg_arg3) + " " + is(txteledmg_arg3) + " wounded.")
 		}
 	}
@@ -4790,11 +4816,11 @@
 			if ( locvar_dmghp_r > 0 ) {
 				locvar_dmghp_r = locvar_dmghp_r * 2 / 3
 			}
 			locvar_dmghp_dmg = locvar_dmghp_dmg * 100 / limit(locvar_dmghp_r + 110, 50, 3000)
 		}
-		if ( locvar_dmghp_ele == 68 ) {
+		if ( locvar_dmghp_ele == 68 | dmghp_source == DAMAGE_FROM_SUFFOCATION | dmghp_source == DAMAGE_FROM_POISON ) {
 			locvar_dmghp_r = sdata(SKILL_ATTR_CON, dmghp_charid)
 			locvar_dmghp_dmg = locvar_dmghp_dmg * 100 / (locvar_dmghp_r + 100)
 		}
 	}
 	else {
@@ -5243,13 +5269,10 @@
 		}
 	}
 	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 100 ) {
 		locvar_dmghp_dmg = locvar_dmghp_dmg * 3 / 5
 	}
-	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
-		locvar_dmghp_dmg = locvar_dmghp_dmg / 3 + 1
-	}
 	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 1200 ) {
 		locvar_dmghp_dmg = locvar_dmghp_dmg * 1 / 6 + 1
 	}
 	if ( dmghp_source >= (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */) ) {
 		if ( locvar_dmghp_dmg > 0 ) {
@@ -5307,11 +5330,11 @@
 		}
 	}
 	if ( gdata(GDATA_FLAG_INVULNERABLE_TURNS) > 0 & dmghp_charid == CHARA_PLAYER ) {
 		locvar_dmghp_dmg = 0
 	}
-	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
+	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 | gdata(GDATA_TEMPORARY_FLAGS2) == 4771 ) {
 		if ( locvar_dmghp_dmg > cdata(CDATA_HP, dmghp_charid) ) {
 			locvar_dmghp_dmg = 0
 			cdata(CDATA_HP, dmghp_charid) = 0
 		}
 	}
@@ -6700,11 +6723,11 @@
 			}
 		}
 		if ( gdata(GDATA_RIDER) != dmghp_charid | dmghp_charid == CHARA_PLAYER ) {
 			cell_removechara cdata(CDATA_X, dmghp_charid), cdata(CDATA_Y, dmghp_charid)
 		}
-		if ( dmghp_source != DAMAGE_FROM_PERSUASION_LOW ) {
+		if ( dmghp_source != DAMAGE_FROM_PERSUASION_HIGH & dmghp_source != DAMAGE_FROM_PERSUASION_LOW ) {
 			if ( cbit(CHARA_BIT_STONE_BLOOD, dmghp_charid) ) {
 				if ( synccheck(dmghp_charid, -1) ) {
 					x = cdata(CDATA_X, dmghp_charid)
 					y = cdata(CDATA_Y, dmghp_charid)
 					snd SOUNDLIST_CRUSH1, FALSE, TRUE
@@ -7430,28 +7453,71 @@
 			}
 		}
 		check_kill dmghp_source, dmghp_charid
 		catitem = 0
 		rollanatomy = 0
+		rollanatomye = 0
+		rollanatomym = 0
+		rollanatomyr = 0
+		rollsenseki = 0
 		if ( rnd(60) == 0 ) {
 			rollanatomy = 1
 		}
 		if ( dmghp_source >= (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */) ) {
 			if ( cdata(CDATA_ID, dmghp_source) == CREATURE_ID_BLACK_CAT ) {
 				if ( cdata(CDATA_RELATION, dmghp_source) == RELATION_ALLY ) {
 					catitem = dmghp_source
 				}
 			}
-			if ( int(sqrt(sdata(SKILL_NORMAL_ANATOMY, dmghp_source))) > rnd(150) ) {
-				rollanatomy = 1
+			locvar_dmghp_anatomy = sdata(SKILL_NORMAL_ANATOMY, dmghp_source) + 1
+			if ( sdata(SKILL_NORMAL_ANATOMY, dmghp_source) > 0 ) {
+				locvar_dmghp_anatomy += 50
+			}
+			if ( cdata(CDATA_RELATION, dmghp_source) == RELATION_ALLY | dmghp_source == (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */) ) {
+				repeat 16 - 1, 1
+					if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
+						continue
+					}
+					if ( dmghp_source == cnt ) {
+						continue
+					}
+					locvar_dmghp_anatomy += sdata(SKILL_NORMAL_ANATOMY, cnt) + 1
+				loop
+			}
+			if ( int(sqrt(locvar_dmghp_anatomy)) > rnd(150) ) {
+				if ( rnd(3) == 0 ) {
+					rollanatomy = 1
+				}
+			}
+			if ( int(sqrt(locvar_dmghp_anatomy)) > rnd(150) ) {
+				if ( rnd(3) == 0 ) {
+					rollanatomye = 1
+				}
 			}
-			skillexp SKILL_NORMAL_ANATOMY, dmghp_source, 10 + rollanatomy * 4
+			if ( int(sqrt(locvar_dmghp_anatomy)) > rnd(150) ) {
+				if ( rnd(3) == 0 ) {
+					rollanatomym = 1
+				}
+			}
+			if ( int(sqrt(locvar_dmghp_anatomy)) > rnd(150) ) {
+				if ( rnd(3) == 0 ) {
+					rollanatomyr = 1
+				}
+			}
+			skillexp SKILL_NORMAL_ANATOMY, dmghp_source, 10 + rollanatomy * 4 + rollanatomye * 4 + rollanatomym * 4 + rollanatomyr * 4
 			if ( cbit(CHARA_BIT_NECRO, dmghp_source) ) {
-				skillexp SKILL_NORMAL_ANATOMY, CHARA_PLAYER, 30 + rollanatomy * 8
+				skillexp SKILL_NORMAL_ANATOMY, CHARA_PLAYER, 30 + rollanatomy * 8 + rollanatomye * 8 + rollanatomym * 8 + rollanatomyr * 8
 			}
 		}
-		if ( dmghp_source == DAMAGE_FROM_PERSUASION_LOW ) {
+		else {
+			rollsenseki = 1
+		}
+		rollovercast = 0
+		if ( dmghp_source == DAMAGE_FROM_OVERCAST ) {
+			rollovercast = 1
+		}
+		if ( dmghp_source == DAMAGE_FROM_PERSUASION_HIGH | dmghp_source == DAMAGE_FROM_PERSUASION_LOW ) {
 			gdata(GDATA_FLAG_TALKING_USED) = 100
 		}
 		rc = dmghp_charid
 		gosub *item_loot
 		gdata(GDATA_FLAG_TALKING_USED) = 0
@@ -7511,18 +7577,22 @@
 	}
 	gdata(GDATA_DMG_TYPE) = 0
 	txt3rd = 0
 	return
 
-*label_3714
-	goto *label_3719
+*label_3739
+	goto *label_3744
 
 #deffunc dmgmp int dmgmp_charid, int dmgmp_arg2
 	cdata(CDATA_MP, dmgmp_charid) -= dmgmp_arg2
 	if ( cdata(CDATA_MP, dmgmp_charid) < (-99999) ) {
 		cdata(CDATA_MP, dmgmp_charid) = -99999
 	}
+	if ( cfg_dhyouji == 1 ) {
+		txtef COLOR_LIGHT_BLUE2
+		txt "<" + dmgmp_arg2 + ">"
+	}
 	if ( cdata(CDATA_MP, dmgmp_charid) < 0 ) {
 		r1 = dmgmp_charid
 		gosub *expMagicCapacity
 		locvar_dmgmp_d = -cdata(CDATA_MP, dmgmp_charid) * 400 / (100 + sdata(SKILL_NORMAL_MAGIC_CAPACITY, dmgmp_charid) * 10)
 		if ( dmgmp_charid == CHARA_PLAYER ) {
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/chat.hsp ../2.17-borscht/chat.hsp
--- ../2.15R-borscht/chat.hsp	2023-05-12 09:08:03.489975500 +0800
+++ ../2.17-borscht/chat.hsp	2023-05-12 09:05:56.977556800 +0800
@@ -306,10 +306,16 @@
 			}
 			goto *chat_end
 		}
 	}
 	kaiwaev = 0
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 3 ) {
+		snd SOUNDLIST_WRITE1
+		txtef COLOR_GREEN
+		txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+		cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+	}
 	if ( cdata(CDATA_ID, tc) == CREATURE_ID_ALFRED_THE_CANGNAN_WIND & gdata(GDATA_AREA) == AREA_CHAOS_CRADLE & gdata(GDATA_LEVEL) == 173 & cdata(CDATA_ALLIED, tc) == 0 ) {
 		listmax = 0
 		buff = lang("誰…ですか…貴方…は？", "Sorry, this is untranslated sentence.")
 		tc = tc * (0 == 0) + (0 != 0) * 0
 		list(0, listmax) = 0
@@ -813,10 +819,16 @@
 			snd SOUNDLIST_DRINK1
 			txt lang("あなたと" + name(tc) + "は乾杯した！", cnvtalk("Cheers!"))
 			txtef COLOR_SKY_BLUE
 			txtmore
 			txt lang("「うぃっ！」", "*Hic*"), lang("「うまいぜ」", cnvtalk("Ah, good booze.")), lang("「らららー♪」", cnvtalk("La-la-la-la.")), lang("「ひっく」", cnvtalk("I'm going to heaven.")), lang("「ふぅ」", cnvtalk("Whew!")), lang("「たまらないわ」", cnvtalk("I'm revived!")), lang("「んまっ♪」", cnvtalk("Awesome."))
+			if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+			}
 			dmgcon tc, CONDITION_DRUNK, 1000
 			dmgcon cc, CONDITION_DRUNK, 1000
 			modimp tc, 15
 			goto *chat_event_SWEND1
 		}
@@ -9484,45 +9496,77 @@
 		_switch_sw++
 	}
 	if ( _switch_val == 288 | _switch_sw ) {
 		_switch_sw = 0
 		if ( gdata(GDATA_FLAG_GUILD_MAGE) == 1 ) {
-			if ( gdata(GDATA_RANK_GUILD) > 8000 ) {
-				listmax = 0
-				buff = lang("新しく入った方ですか。頑張ってください。", "One of the new arrivals? Do your best.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
+			list(0, listmax) = 2
+			listn(0, listmax) = lang("挨拶する", "Let's Talk.")
+			listmax++
+			list(0, listmax) = 1
+			listn(0, listmax) = lang("投資したい", "Need someone to invest in your guild?")
+			listmax++
+			list(0, listmax) = 0
+			listn(0, listmax) = lang("ギルドを脱退したい", "I want to leave your guild...")
+			listmax++
+			buff = lang("…。", "...")
+			gosub *chat_select
+			if ( chatval == 0 ) {
+				list(0, listmax) = 11
+				listn(0, listmax) = lang("考え直す", "I will reconsider.")
 				listmax++
-				chatesc = 1
+				list(0, listmax) = 10
+				listn(0, listmax) = lang("【ギルドを脱退する】", "I leave this guild.")
+				listmax++
+				buff = lang("…そこまで言うだけの何かがあったのですね。いいでしょう、詳しくは訊きません。ですが、ここまでの頑張りを全て捨て去るほどのことなのでしょうか？よく考えてみてください。", "...Something happened to you? OK, I won't ask for details. But is it enough to throw away all the hard work so far? please consider.")
 				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( chatval == 11 ) {
+					listmax = 0
+					buff = lang("そうそう。一時の感情で行動すると大変ですよ。", "Yes Yes. It is not good to act on temporary feelings.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
 				}
-				goto *chat_end
-			}
-			if ( gdata(GDATA_RANK_GUILD) > 4000 ) {
-				listmax = 0
-				buff = lang("最近活躍しているらしいですね。あなたには期待していますよ。", "Lately seems you've been quite active. I look forward to your progress.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( chatval == 10 ) {
+					listmax = 0
+					buff = lang("…意志は固いようですね。わかりました。私があなたの脱退を認めます。", "...You seem to have a strong will. understood. I accept your withdrawal.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					txtef COLOR_RED
+					txt lang("魔術士ギルドを脱退した！", "You left the Mage Guild...")
+					gdata(GDATA_FLAG_GUILD_MAGE) = 0
+					gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
+					gdata(GDATA_FLAG_SUB_MAGE_1) = 0
+					if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) < 1000 ) {
+						gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 0
 					}
+					gdata(GDATA_FLAG_SUB_GUILD_MAGE) = 0
 				}
 				goto *chat_end
 			}
-			if ( gdata(GDATA_RANK_GUILD) > 600 ) {
+			if ( chatval == 1 ) {
 				listmax = 0
-				buff = lang("以前は他の２ギルドに押され気味でしたが…あなたが来てからこのギルドもかなり活気が戻りました。…ありがとうございます。", "Some time ago it felt like we were being suppressed by two guilds... but since your arrival we've gained momentum. ...You have my thanks.")
+				buff = lang("未実装！", "Under development!")
 				tc = tc * (0 == 0) + (0 != 0) * 0
 				list(0, listmax) = 0
 				listn(0, listmax) = strbye
 				listmax++
 				chatesc = 1
@@ -9532,96 +9576,147 @@
 						goto *chat_end
 					}
 				}
 				goto *chat_end
 			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) < 1 ) {
-				listmax = 0
-				buff = lang("狡猾な盗賊ギルドと野蛮な戦士ギルドを制し、我々魔術士ギルドの力を世間に見せつけるのです！あなたにはどちらか片方のギルドのマスターを倒してきてほしいのです。もう片方は私が相手しましょう。", "By claiming rule over the dastardly Thieves guild and the Savage fighters our Mages guild will show the world our might! I want you to defeat the guild master of one of the guilds.  I will take care of the other.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+			if ( chatval == 2 ) {
+				if ( gdata(GDATA_RANK_GUILD) > 8000 ) {
+					listmax = 0
+					buff = lang("新しく入った方ですか。頑張ってください。", "One of the new arrivals? Do your best.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1
-				snd SOUNDLIST_WRITE1
-				txtef COLOR_GREEN
-				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) == 1 ) {
-				listmax = 0
-				buff = lang("さて、私はどちらのギルドを攻めましょうかね…。", "Now then, which guild shall I combat?")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_RANK_GUILD) > 4000 ) {
+					listmax = 0
+					buff = lang("最近活躍しているらしいですね。あなたには期待していますよ。", "Lately seems you've been quite active. I look forward to your progress.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) == 2 ) {
-				listmax = 0
-				buff = lang("素晴らしい！あなたならやってくれると信じていました！これは私からの特別報酬です。どうか受け取ってください。", "Wonderful! I believed you would succeed! This is a special reward from me.  Please take it.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_RANK_GUILD) > 600 ) {
+					listmax = 0
+					buff = lang("以前は他の２ギルドに押され気味でしたが…あなたが来てからこのギルドもかなり活気が戻りました。…ありがとうございます。", "Some time ago it felt like we were being suppressed by two guilds... but since your arrival we've gained momentum. ...You have my thanks.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				flt
-				itemcreate -1, ITEM_ID_BOOK_BOKONON, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
-				flt
-				itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
-				flt
-				itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
-				txt lang("クエストを達成した！", "You have completed the quest!")
-				snd SOUNDLIST_COMPLETE1
-				txtmore
-				txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
-				snd SOUNDLIST_WRITE1
-				txtef COLOR_GREEN
-				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-				gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1000
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) >= 3 ) {
-				listmax = 0
-				buff = lang("次のギルドマスターはあなたしかいない。私だけではなく皆もそう考えているようです。" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…これからもよろしく頼みますね。", "There is none other than you worthy of guild master. Not just me but everyone feels the same. " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "...From now on we leave things in your hands.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) < 1 ) {
+					listmax = 0
+					buff = lang("狡猾な盗賊ギルドと野蛮な戦士ギルドを制し、我々魔術士ギルドの力を世間に見せつけるのです！あなたにはどちらか片方のギルドのマスターを倒してきてほしいのです。もう片方は私が相手しましょう。", "By claiming rule over the dastardly Thieves guild and the Savage fighters our Mages guild will show the world our might! I want you to defeat the guild master of one of the guilds.  I will take care of the other.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) == 1 ) {
+					listmax = 0
+					buff = lang("さて、私はどちらのギルドを攻めましょうかね…。", "Now then, which guild shall I combat?")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) == 2 ) {
+					listmax = 0
+					buff = lang("素晴らしい！あなたならやってくれると信じていました！これは私からの特別報酬です。どうか受け取ってください。", "Wonderful! I believed you would succeed! This is a special reward from me.  Please take it.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					flt
+					itemcreate -1, ITEM_ID_BOOK_BOKONON, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					flt
+					itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
+					flt
+					itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
+					txt lang("クエストを達成した！", "You have completed the quest!")
+					snd SOUNDLIST_COMPLETE1
+					txtmore
+					txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1000
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS1) >= 3 ) {
+					listmax = 0
+					buff = lang("次のギルドマスターはあなたしかいない。私だけではなく皆もそう考えているようです。" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…これからもよろしく頼みますね。", "There is none other than you worthy of guild master. Not just me but everyone feels the same. " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "...From now on we leave things in your hands.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1000
+					goto *chat_end
 				}
-				gdata(GDATA_FLAG_SUB_GUILD_WARS1) = 1000
-				goto *chat_end
 			}
+			goto *chat_end
 		}
 		listmax = 0
-		buff = lang("どちらさまでしょう？見かけない顔ですね。", "Sorry...who are you?")
+		buff = lang("部外者にいられると困ります。すぐに立ち去ってください。", "Get out, outsiders.")
 		tc = tc * (0 == 0) + (0 != 0) * 0
 		list(0, listmax) = 0
 		listn(0, listmax) = strbye
 		listmax++
 		chatesc = 1
@@ -9636,45 +9731,77 @@
 		_switch_sw++
 	}
 	if ( _switch_val == 291 | _switch_sw ) {
 		_switch_sw = 0
 		if ( gdata(GDATA_FLAG_GUILD_FIGHTER) == 1 ) {
-			if ( gdata(GDATA_RANK_GUILD) > 8000 ) {
-				listmax = 0
-				buff = lang("新人か。精進するように。", "A new recruit. With due diligence.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
+			list(0, listmax) = 2
+			listn(0, listmax) = lang("挨拶する", "Let's Talk.")
+			listmax++
+			list(0, listmax) = 1
+			listn(0, listmax) = lang("投資したい", "Need someone to invest in your guild?")
+			listmax++
+			list(0, listmax) = 0
+			listn(0, listmax) = lang("ギルドを脱退したい", "I want to leave your guild...")
+			listmax++
+			buff = lang("…。", "...")
+			gosub *chat_select
+			if ( chatval == 0 ) {
+				list(0, listmax) = 11
+				listn(0, listmax) = lang("考え直す", "I will reconsider.")
 				listmax++
-				chatesc = 1
+				list(0, listmax) = 10
+				listn(0, listmax) = lang("【ギルドを脱退する】", "I leave this guild.")
+				listmax++
+				buff = lang("…何！？もしかしてギルドマスターである私が弱いからか？くっ…いいだろう。去る者は追わない。だが、もしも気が変わったら戻ってこい。下っ端からのやり直しになるがな。", "...what! ? Is it because I'm weak as the guild master? Kuh... I don't mind. I don't chase those who leave But if you change your mind, come back. However, you will have to start over from the bottom.")
 				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( chatval == 11 ) {
+					listmax = 0
+					buff = lang("きっと戦いで疲れているのだろう。少し休むといい。", "You must be tired from fighting. You should rest for a while.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
 				}
-				goto *chat_end
-			}
-			if ( gdata(GDATA_RANK_GUILD) > 4000 ) {
-				listmax = 0
-				buff = lang("最近活躍しているらしいじゃないか。君には期待しているよ。", "You've been quite active recently. I expect much from you.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( chatval == 10 ) {
+					listmax = 0
+					buff = lang("…さらば、戦士よ！今までご苦労だった！", "...Farewell, Warrior! It's been hard work until now!")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					txtef COLOR_RED
+					txt lang("戦士ギルドを脱退した！", "You left the Fighter Guild...")
+					gdata(GDATA_FLAG_GUILD_FIGHTER) = 0
+					gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 0
+					gdata(GDATA_FLAG_SUB_FIGHTER_1) = 0
+					gdata(GDATA_FLAG_SUB_GUILD_FIGHTER) = 0
+					if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) < 1000 ) {
+						gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 0
 					}
 				}
 				goto *chat_end
 			}
-			if ( gdata(GDATA_RANK_GUILD) > 600 ) {
+			if ( chatval == 1 ) {
 				listmax = 0
-				buff = lang("他の者たちも君に負けじと切磋琢磨している。いい傾向だ、君がわがギルドに加入してくれて本当によかった…。", "Others have refined themselves to surpass you. It's a magnificent trend. I honestly appreciate you choosing our guild...")
+				buff = lang("未実装！", "Under development!")
 				tc = tc * (0 == 0) + (0 != 0) * 0
 				list(0, listmax) = 0
 				listn(0, listmax) = strbye
 				listmax++
 				chatesc = 1
@@ -9684,96 +9811,147 @@
 						goto *chat_end
 					}
 				}
 				goto *chat_end
 			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) < 1 ) {
-				listmax = 0
-				buff = lang("戦士の力を目にもの見せる時が来た！盗賊ギルドと魔術士ギルド、腑抜けた両ギルドのマスターを私と君で打倒するぞ！戦いやすい方のマスターを倒してきてくれ。もう片方は私が引き受けよう。", "The time has come to show the might of we warriors! We shall overthrow the cowardly guild masters both! Please defeat the lesser of the two masters. The other I shall.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+			if ( chatval == 2 ) {
+				if ( gdata(GDATA_RANK_GUILD) > 8000 ) {
+					listmax = 0
+					buff = lang("新人か。精進するように。", "A new recruit. With due diligence.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1
-				snd SOUNDLIST_WRITE1
-				txtef COLOR_GREEN
-				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) == 1 ) {
-				listmax = 0
-				buff = lang("うむ、明確な打倒目標があると素振りにも気合が入るな！", "Mm, having a discernable opponent has my blood flowing!")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_RANK_GUILD) > 4000 ) {
+					listmax = 0
+					buff = lang("最近活躍しているらしいじゃないか。君には期待しているよ。", "You've been quite active recently. I expect much from you.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) == 2 ) {
-				listmax = 0
-				buff = lang("勝ってきたか！君ならばやってくれると信じていたよ！これは私からの特別報酬だ。受け取ってほしいな。", "You have been victorious! I believed you would! This is a special reward from me. Please accept it.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_RANK_GUILD) > 600 ) {
+					listmax = 0
+					buff = lang("他の者たちも君に負けじと切磋琢磨している。いい傾向だ、君がわがギルドに加入してくれて本当によかった…。", "Others have refined themselves to surpass you. It's a magnificent trend. I honestly appreciate you choosing our guild...")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				flt
-				itemcreate -1, ITEM_ID_FLAME_EDGE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
-				flt
-				itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
-				flt
-				itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
-				txt lang("クエストを達成した！", "You have completed the quest!")
-				snd SOUNDLIST_COMPLETE1
-				txtmore
-				txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
-				snd SOUNDLIST_WRITE1
-				txtef COLOR_GREEN
-				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-				gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1000
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) >= 3 ) {
-				listmax = 0
-				buff = lang("次のギルドマスターは君しかいない。私だけではなく皆もそう考えているはずだ。" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "、これからもよろしく頼むぞ。", "There is no other than you for the next guild master. Not just me but everyone believes so. " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", we are looking forward to working with you.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) < 1 ) {
+					listmax = 0
+					buff = lang("戦士の力を目にもの見せる時が来た！盗賊ギルドと魔術士ギルド、腑抜けた両ギルドのマスターを私と君で打倒するぞ！戦いやすい方のマスターを倒してきてくれ。もう片方は私が引き受けよう。", "The time has come to show the might of we warriors! We shall overthrow the cowardly guild masters both! Please defeat the lesser of the two masters. The other I shall.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) == 1 ) {
+					listmax = 0
+					buff = lang("うむ、明確な打倒目標があると素振りにも気合が入るな！", "Mm, having a discernable opponent has my blood flowing!")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) == 2 ) {
+					listmax = 0
+					buff = lang("勝ってきたか！君ならばやってくれると信じていたよ！これは私からの特別報酬だ。受け取ってほしいな。", "You have been victorious! I believed you would! This is a special reward from me. Please accept it.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					flt
+					itemcreate -1, ITEM_ID_FLAME_EDGE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					flt
+					itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
+					flt
+					itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
+					txt lang("クエストを達成した！", "You have completed the quest!")
+					snd SOUNDLIST_COMPLETE1
+					txtmore
+					txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1000
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS3) >= 3 ) {
+					listmax = 0
+					buff = lang("次のギルドマスターは君しかいない。私だけではなく皆もそう考えているはずだ。" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "、これからもよろしく頼むぞ。", "There is no other than you for the next guild master. Not just me but everyone believes so. " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", we are looking forward to working with you.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1000
+					goto *chat_end
 				}
-				gdata(GDATA_FLAG_SUB_GUILD_WARS3) = 1000
-				goto *chat_end
 			}
+			goto *chat_end
 		}
 		listmax = 0
-		buff = lang("誰だ？見かけない顔だな。", "Who are you? I haven't seen your face before.")
+		buff = lang("他の者が気づく前に出て行ってくれ。", "Get out, outsiders.")
 		tc = tc * (0 == 0) + (0 != 0) * 0
 		list(0, listmax) = 0
 		listn(0, listmax) = strbye
 		listmax++
 		chatesc = 1
@@ -9788,45 +9966,77 @@
 		_switch_sw++
 	}
 	if ( _switch_val == 292 | _switch_sw ) {
 		_switch_sw = 0
 		if ( gdata(GDATA_FLAG_GUILD_THIEF) == 1 ) {
-			if ( gdata(GDATA_RANK_GUILD) > 8000 ) {
-				listmax = 0
-				buff = lang("貴様が新入りか。ヘマはするなよ。", "Yer a newbie. Don't screw up.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
+			list(0, listmax) = 2
+			listn(0, listmax) = lang("挨拶する", "Let's Talk.")
+			listmax++
+			list(0, listmax) = 1
+			listn(0, listmax) = lang("投資したい", "Need someone to invest in your guild?")
+			listmax++
+			list(0, listmax) = 0
+			listn(0, listmax) = lang("ギルドを脱退したい", "I want to leave your guild...")
+			listmax++
+			buff = lang("…。", "...")
+			gosub *chat_select
+			if ( chatval == 0 ) {
+				list(0, listmax) = 11
+				listn(0, listmax) = lang("考え直す", "I will reconsider.")
 				listmax++
-				chatesc = 1
+				list(0, listmax) = 10
+				listn(0, listmax) = lang("【ギルドを脱退する】", "I leave this guild.")
+				listmax++
+				buff = lang("…足を洗いたくなったのか。わかった、貴様のことは忘れよう。貴様もここで見たことは忘れろ。これからは裏社会に関わらず、真っ当に生きていくことだ。", "...So you wanted to quit the guild. All right, I'll forget about you. Forget what you saw here. From now on, live your life regardless of the underworld.")
 				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( chatval == 11 ) {
+					listmax = 0
+					buff = lang("驚かせるな。", "Don't be surprised!")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
 				}
-				goto *chat_end
-			}
-			if ( gdata(GDATA_RANK_GUILD) > 4000 ) {
-				listmax = 0
-				buff = lang("貴様の働きぶりには正直感心している。だが油断はしないことだ。", "Yer stuff is pretty good. Don't be getting lazy.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( chatval == 10 ) {
+					listmax = 0
+					buff = lang("…達者でな。", "...Take care.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					txtef COLOR_RED
+					txt lang("盗賊ギルドを脱退した！", "You left the Thieves Guild...")
+					gdata(GDATA_FLAG_GUILD_THIEF) = 0
+					gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = 0
+					gdata(GDATA_FLAG_SUB_THIEF_1) = 0
+					gdata(GDATA_FLAG_SUB_GUILD_THIEF) = 0
+					if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) < 1000 ) {
+						gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 0
 					}
 				}
 				goto *chat_end
 			}
-			if ( gdata(GDATA_RANK_GUILD) > 600 ) {
+			if ( chatval == 1 ) {
 				listmax = 0
-				buff = lang("貴様ほどの冒険者ならば他のギルドでも活躍できたろうに。わざわざ闇に生きるとは変わったやつだ。…おかげで助かってはいるがな。", "Since yer such a great adventurer ya coulda gone to another guild. Yer a strange one fer picking ours. Big help for us ya been.")
+				buff = lang("未実装！", "Under development!")
 				tc = tc * (0 == 0) + (0 != 0) * 0
 				list(0, listmax) = 0
 				listn(0, listmax) = strbye
 				listmax++
 				chatesc = 1
@@ -9836,96 +10046,147 @@
 						goto *chat_end
 					}
 				}
 				goto *chat_end
 			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) < 1 ) {
-				listmax = 0
-				buff = lang("とっておきの仕事が入った。魔術士ギルドと戦士ギルドのギルドマスターを片づける。重要な仕事だが…" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "、貴様に片方のマスターの始末を任せる。しくじるなよ。", "Got a reserved mission. We're gonna ice the mage and warrior guild masters. Pretty important job ya see..." + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", Yer gonna take down one of them. Don't screw up.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+			if ( chatval == 2 ) {
+				if ( gdata(GDATA_RANK_GUILD) > 8000 ) {
+					listmax = 0
+					buff = lang("貴様が新入りか。ヘマはするなよ。", "Yer a newbie. Don't screw up.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1
-				snd SOUNDLIST_WRITE1
-				txtef COLOR_GREEN
-				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) == 1 ) {
-				listmax = 0
-				buff = lang("貴様なら他のギルドマスターにもきっと勝てるさ。ふっ、他人をここまで信頼するとは俺も甘くなったものだ。", "Ya can probably take down one of the other guild masters. Heh, Can't believe I'm trustin someone else this much, I've gotten soft.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_RANK_GUILD) > 4000 ) {
+					listmax = 0
+					buff = lang("貴様の働きぶりには正直感心している。だが油断はしないことだ。", "Yer stuff is pretty good. Don't be getting lazy.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) == 2 ) {
-				listmax = 0
-				buff = lang("遅かったな…別に心配をしていたわけではないが。こいつは貴様の分け前だ。とっておけ。", "Too yer sweet time... Not like I was worried. Here's yer share. Take it.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_RANK_GUILD) > 600 ) {
+					listmax = 0
+					buff = lang("貴様ほどの冒険者ならば他のギルドでも活躍できたろうに。わざわざ闇に生きるとは変わったやつだ。…おかげで助かってはいるがな。", "Since yer such a great adventurer ya coulda gone to another guild. Yer a strange one fer picking ours. Big help for us ya been.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					goto *chat_end
 				}
-				flt
-				itemcreate -1, ITEM_ID_WOODEN_HORSE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
-				flt
-				itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
-				flt
-				itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
-				txt lang("クエストを達成した！", "You have completed the quest!")
-				snd SOUNDLIST_COMPLETE1
-				txtmore
-				txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
-				snd SOUNDLIST_WRITE1
-				txtef COLOR_GREEN
-				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-				gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1000
-				goto *chat_end
-			}
-			if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) >= 3 ) {
-				listmax = 0
-				buff = lang("次のギルドマスターを貴様に任せてやってもいいと思っている。" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…裏切らないでくれよ。", "I'm thinkin I can just leave it up to you for next guild master. " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", ya better not double cross us.")
-				tc = tc * (0 == 0) + (0 != 0) * 0
-				list(0, listmax) = 0
-				listn(0, listmax) = strbye
-				listmax++
-				chatesc = 1
-				gosub *chat_select
-				if ( scenemode ) {
-					if ( scene_cut == 1 ) {
-						goto *chat_end
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) < 1 ) {
+					listmax = 0
+					buff = lang("とっておきの仕事が入った。魔術士ギルドと戦士ギルドのギルドマスターを片づける。重要な仕事だが…" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "、貴様に片方のマスターの始末を任せる。しくじるなよ。", "Got a reserved mission. We're gonna ice the mage and warrior guild masters. Pretty important job ya see..." + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", Yer gonna take down one of them. Don't screw up.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
 					}
+					gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) == 1 ) {
+					listmax = 0
+					buff = lang("貴様なら他のギルドマスターにもきっと勝てるさ。ふっ、他人をここまで信頼するとは俺も甘くなったものだ。", "Ya can probably take down one of the other guild masters. Heh, Can't believe I'm trustin someone else this much, I've gotten soft.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) == 2 ) {
+					listmax = 0
+					buff = lang("遅かったな…別に心配をしていたわけではないが。こいつは貴様の分け前だ。とっておけ。", "Too yer sweet time... Not like I was worried. Here's yer share. Take it.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					flt
+					itemcreate -1, ITEM_ID_WOODEN_HORSE, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					flt
+					itemcreate -1, ITEM_ID_SMALL_MEDAL, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
+					flt
+					itemcreate -1, ITEM_ID_PLATINUM_COIN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 4
+					txt lang("クエストを達成した！", "You have completed the quest!")
+					snd SOUNDLIST_COMPLETE1
+					txtmore
+					txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1000
+					goto *chat_end
+				}
+				if ( gdata(GDATA_FLAG_SUB_GUILD_WARS2) >= 3 ) {
+					listmax = 0
+					buff = lang("次のギルドマスターを貴様に任せてやってもいいと思っている。" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…裏切らないでくれよ。", "I'm thinkin I can just leave it up to you for next guild master. " + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", ya better not double cross us.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1000
+					goto *chat_end
 				}
-				gdata(GDATA_FLAG_SUB_GUILD_WARS2) = 1000
-				goto *chat_end
 			}
+			goto *chat_end
 		}
 		listmax = 0
-		buff = lang("貴様…何者だ？", "Who the hell are you?")
+		buff = lang("すぐに出ていけ。こんなところに用はないはずだ。", "Get out, outsiders.")
 		tc = tc * (0 == 0) + (0 != 0) * 0
 		list(0, listmax) = 0
 		listn(0, listmax) = strbye
 		listmax++
 		chatesc = 1
@@ -9983,11 +10244,11 @@
 						if ( scene_cut == 1 ) {
 							goto *chat_end
 						}
 					}
 					listmax = 0
-					buff = lang("この世界には、特殊な古代文字で書かれた古書物が散らばっている。これらを収集し、解読した後に、私の横にある納入箱に収めたまえ。古書物の価値に応じてギルドポイントを与えよう。30ギルドポイント、これがお前に課せられた試験のノルマだ…", "In north Tyris, there are several ancient books encrypted with an unique rune language. Should you want to join the guild, put them into the delivery chest after you have decrypted them and we shall reward you with guild points.")
+					buff = lang("この世界には、特殊な古代文字で書かれた古書物が散らばっている。これらを収集し、解読した後に、私の横にある納入箱に収めたまえ。古書物の価値に応じてギルドポイントを与えよう。15ギルドポイント、これがお前に課せられた試験のノルマだ…", "In north Tyris, there are several ancient books encrypted with an unique rune language. Should you want to join the guild, put them into the delivery chest after you have decrypted them and we shall reward you with guild points.")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -9996,16 +10257,16 @@
 						if ( scene_cut == 1 ) {
 							goto *chat_end
 						}
 					}
 					gdata(GDATA_FLAG_SUB_GUILD_MAGE) = 1
-					gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 30
+					gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 15
 					snd SOUNDLIST_WRITE1
 					txtef COLOR_GREEN
 					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 					listmax = 0
-					buff = lang("ギルドポイントを規定の値まで集めたら、また私に話しかけてくれ。", "You will need to gather 30 guild points in order to enter the Mages Guild. Until then, we have no more to speak.")
+					buff = lang("ギルドポイントを規定の値まで集めたら、また私に話しかけてくれ。", "You will need to gather 15 guild points in order to enter the Mages Guild. Until then, we have no more to speak.")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -10017,11 +10278,11 @@
 					}
 					goto *chat_unique
 				}
 				if ( gdata(GDATA_FLAG_GUILD_MAGE_NORMA) > 0 ) {
 					listmax = 0
-					buff = lang("まだノルマが残っているじゃないか…ギルドに加入するには、審査を通らなければならないぞ。", "To pass the test, you need to gather 30 guild points.")
+					buff = lang("まだノルマが残っているじゃないか…ギルドに加入するには、審査を通らなければならないぞ。", "To pass the test, you need to gather 15 guild points.")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -10044,10 +10305,28 @@
 				if ( scenemode ) {
 					if ( scene_cut == 1 ) {
 						goto *chat_end
 					}
 				}
+				if ( gdata(GDATA_FLAG_GUILD_THIEF) != 0 | gdata(GDATA_FLAG_GUILD_FIGHTER) != 0 ) {
+					listmax = 0
+					buff = lang("だが加入する前に、現在のギルドを正式に抜けてこい。手続きをせず勝手に辞めるような者は、組織として信用できない。当然だろう？", "But before joining, formally leave your current guild. A person who quits arbitrarily without following procedures cannot be trusted as an organization.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strmore
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_FAIL1
+					txt lang("所属ギルドマスターに脱退を伝えよう。", "You need to tell your guildmaster that you are leaving.")
+					goto *chat_unique
+				}
 				gdata(GDATA_RANK_GUILD) = 10000
 				gdata(GDATA_FLAG_GUILD_THIEF) = 0
 				gdata(GDATA_FLAG_GUILD_FIGHTER) = 0
 				gdata(GDATA_FLAG_GUILD_MAGE) = 1
 				gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
@@ -10104,11 +10383,11 @@
 		listmax++
 		buff = lang("ようこそ魔術士ギルドへ、" + ranktitle(8) + "の" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…どうぞ中にお入り下さい。", "Welcome to the Mages Guild, " + ranktitle(8) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "... Please come in.")
 		gosub *chat_select
 		if ( chatval == 1 ) {
 			gdata(GDATA_FLAG_SUB_MAGE_1) = 1
-			gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 75 - gdata(GDATA_RANK_GUILD) / 200
+			gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 40 - gdata(GDATA_RANK_GUILD) / 400
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
 			buff = lang("良い心がけです。あなたにランク昇格のためのノルマを与えましょう。世界に散らばった古書物を解読し、納入してください。" + gdata(GDATA_FLAG_GUILD_MAGE_NORMA) + "ギルドポイントが集まったら、昇進のための審査会に報告してあげましょう。", "Sure, there're plenty of tasks for you. For now, collect the ancient books and decrypt them. When you gather " + gdata(GDATA_FLAG_GUILD_MAGE_NORMA) + " guild points, we will think about your promotion.")
@@ -10121,10 +10400,13 @@
 			if ( scenemode ) {
 				if ( scene_cut == 1 ) {
 					goto *chat_end
 				}
 			}
+			if ( 0 ) {
+				gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
+			}
 			goto *chat_unique
 		}
 		if ( chatval == 2 ) {
 			if ( gdata(GDATA_FLAG_GUILD_MAGE_NORMA) > 0 ) {
 				listmax = 0
@@ -10155,11 +10437,11 @@
 			txtmore
 			txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-			modrank 8, 500, 8
+			modrank 8, 1500, 10
 			listmax = 0
 			buff = lang("確かにノルマの達成を確認しました。早速審査会を開いてあなたの功績を報告しましょう。", "You've done very well. I will give a report of your achievement to the council.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
@@ -10225,11 +10507,11 @@
 					gdata(GDATA_FLAG_SUB_GUILD_THIEF) = 1
 					snd SOUNDLIST_WRITE1
 					txtef COLOR_GREEN
 					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 					listmax = 0
-					buff = lang("なに、簡単な試験だ。一定期間経過した冒険者には税金が毎月徴収されるのは知っているな？その税金を4ヶ月滞納するだけだ。無論、お前は犯罪者となり、国の犬に追われる事になるだろう。その覚悟がないならば、盗賊ギルドに入るなど諦めることだ。", "It is a simple task. We require you to not pay tax for 4 months. Take it granted the guards will try to hunt you down. If you aren't ready to face it, just forget it.")
+					buff = lang("なに、簡単な試験だ。お前のカルマを−100まで落としてこい。−31からは指名手配され、国の犬に追われる事になるだろう。その覚悟がないならば、盗賊ギルドに入るなど諦めることだ。", "It is a simple task. We require you to drop your karma at -100. Take it granted the guards will try to hunt you down -31 onwards. If you aren't ready to face it, just forget it.")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -10239,13 +10521,13 @@
 							goto *chat_end
 						}
 					}
 					goto *chat_unique
 				}
-				if ( gdata(GDATA_BILL) <= 4 & 0 == 0 ) {
+				if ( cdata(CDATA_KARMA, CHARA_PLAYER) > (-100) ) {
 					listmax = 0
-					buff = lang("どうした？試験の内容は伝えたはずだ。税金を4ヶ月以上滞納してからまた来るがいい。", "I've already told you what you must do. Don't pay tax for 4 months.")
+					buff = lang("どうした？試験の内容は伝えたはずだ。カルマを−100まで落としてからまた来るがいい。", "I've already told you what you must do. Drop your karma at -100.")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -10268,10 +10550,28 @@
 				if ( scenemode ) {
 					if ( scene_cut == 1 ) {
 						goto *chat_end
 					}
 				}
+				if ( gdata(GDATA_FLAG_GUILD_FIGHTER) != 0 | gdata(GDATA_FLAG_GUILD_MAGE) != 0 ) {
+					listmax = 0
+					buff = lang("だが加入する前に、現在のギルドを正式に抜けてこい。手続きをせず勝手に辞めるような者は、組織として信用できない。当然だろう？", "But before joining, formally leave your current guild. A person who quits arbitrarily without following procedures cannot be trusted as an organization.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strmore
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_FAIL1
+					txt lang("所属ギルドマスターに脱退を伝えよう。", "You need to tell your guildmaster that you are leaving.")
+					goto *chat_unique
+				}
 				gdata(GDATA_RANK_GUILD) = 10000
 				gdata(GDATA_FLAG_GUILD_THIEF) = 1
 				gdata(GDATA_FLAG_GUILD_FIGHTER) = 0
 				gdata(GDATA_FLAG_GUILD_MAGE) = 0
 				gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
@@ -10328,11 +10628,11 @@
 		listmax++
 		buff = lang("ようこそ盗賊ギルドへ、" + ranktitle(8) + "の" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…どうぞ中にお入り下さい。", "Welcome to the Thieves Guild, " + ranktitle(8) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "... Please come in.")
 		gosub *chat_select
 		if ( chatval == 1 ) {
 			gdata(GDATA_FLAG_SUB_THIEF_1) = 1
-			gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = (10000 - gdata(GDATA_RANK_GUILD)) * 6 + 1000
+			gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = (10000 - gdata(GDATA_RANK_GUILD)) * 3 + 1000
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
 			buff = lang("良い心がけです。あなたにランク昇格のためのノルマを与えましょう。他人の所有物を奪い取り、盗品を売り払いなさい。金貨" + gdata(GDATA_FLAG_GUILD_THIEF_NORMA) + "枚相当の盗品を売ったら、昇進のための審査会に報告してあげましょう。", "Alright. The Thieves Guild wants you to put stolen goods into circulation. Steal some goods and sell them to any vendors. When the sum of your earning reachs " + gdata(GDATA_FLAG_GUILD_THIEF_NORMA) + " gold pieces, we will think about your promotion.")
@@ -10379,11 +10679,11 @@
 			txtmore
 			txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-			modrank 8, 500, 8
+			modrank 8, 1500, 10
 			listmax = 0
 			buff = lang("確かにノルマの達成を確認しました。早速審査会を開いてあなたの功績を報告しましょう。", "You've done very well. I will give a report of your achievement to the council.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
@@ -10448,32 +10748,15 @@
 					}
 					gdata(GDATA_FLAG_SUB_GUILD_FIGHTER) = 1
 					snd SOUNDLIST_WRITE1
 					txtef COLOR_GREEN
 					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-					repeat
-						flt 10
-						characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
-						if ( refchara(cdata(CDATA_ID, MAX_CHARA_NC), DBSPEC_CHARA_RARE) < 70 ) {
-							continue
-						}
-						if ( cdata(CDATA_RELATION, MAX_CHARA_NC) != RELATION_ENEMY ) {
-							continue
-						}
-						if ( cdata(CDATA_QUALITY, MAX_CHARA_NC) >= FIX_QUALITY_MIRACLE ) {
-							continue
-						}
-						if ( cdata(CDATA_LEVEL, MAX_CHARA_NC) > cdata(CDATA_LEVEL, CHARA_PLAYER) * 2 ) {
-							continue
-						}
-						break
-					loop
-					gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 5
-					gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = cdata(CDATA_ID, MAX_CHARA_NC)
-					chara_vanquish MAX_CHARA_NC
+					gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 1
+					gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL) = rnd(8)
+					gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = 5
 					listmax = 0
-					buff = lang("" + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + "を" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "匹討伐するのが、お前に課せられた試験だ。ノルマを達成したら、私に報告したまえ。", "The task given to you is this. Find and slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + ". When you complete this, talk to me again")
+					buff = lang("" + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "階相当以上の" + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + "のランダムネフィアを" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "個制覇するのが、お前に課せられた試験だ。ノルマを達成したら、私に報告したまえ。", "The task given to you is this. Find and slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + ". When you complete this, talk to me again")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -10483,13 +10766,13 @@
 							goto *chat_end
 						}
 					}
 					goto *chat_unique
 				}
-				if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 & 0 == 0 ) {
+				if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 ) {
 					listmax = 0
-					buff = lang("どうした？試験の内容は伝えたはずだ。" + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + "をあと" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "匹討伐してからまた来なさい。", "You still need to slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " more " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + ".")
+					buff = lang("どうした？試験の内容は伝えたはずだ。" + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "階相当以上の" + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + "のランダムネフィアを" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "個制覇してからまた来なさい。", "You still need to conquer " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + " random nefia more " + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "Lv.")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -10512,10 +10795,28 @@
 				if ( scenemode ) {
 					if ( scene_cut == 1 ) {
 						goto *chat_end
 					}
 				}
+				if ( gdata(GDATA_FLAG_GUILD_THIEF) != 0 | gdata(GDATA_FLAG_GUILD_MAGE) != 0 ) {
+					listmax = 0
+					buff = lang("だが加入する前に、現在のギルドを正式に抜けてこい。手続きをせず勝手に辞めるような者は、組織として信用できない。当然だろう？", "But before joining, formally leave your current guild. A person who quits arbitrarily without following procedures cannot be trusted as an organization.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strmore
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_FAIL1
+					txt lang("所属ギルドマスターに脱退を伝えよう。", "You need to tell your guildmaster that you are leaving.")
+					goto *chat_unique
+				}
 				gdata(GDATA_RANK_GUILD) = 10000
 				gdata(GDATA_FLAG_GUILD_THIEF) = 0
 				gdata(GDATA_FLAG_GUILD_FIGHTER) = 1
 				gdata(GDATA_FLAG_GUILD_MAGE) = 0
 				gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
@@ -10573,36 +10874,19 @@
 		listn(0, listmax) = strbye
 		listmax++
 		buff = lang("ようこそ戦士ギルドへ、" + ranktitle(8) + "の" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "…どうぞ中にお入り下さい。", "Welcome to the Fighters Guild, " + ranktitle(8) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "... Please come in.")
 		gosub *chat_select
 		if ( chatval == 1 ) {
-			repeat
-				flt cdata(CDATA_LEVEL, CHARA_PLAYER) + 10
-				characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
-				if ( refchara(cdata(CDATA_ID, MAX_CHARA_NC), DBSPEC_CHARA_RARE) < 70 ) {
-					continue
-				}
-				if ( cdata(CDATA_RELATION, MAX_CHARA_NC) != RELATION_ENEMY ) {
-					continue
-				}
-				if ( cdata(CDATA_QUALITY, MAX_CHARA_NC) >= FIX_QUALITY_MIRACLE ) {
-					continue
-				}
-				if ( cdata(CDATA_LEVEL, MAX_CHARA_NC) > cdata(CDATA_LEVEL, CHARA_PLAYER) * 2 ) {
-					continue
-				}
-				break
-			loop
-			gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 3
-			gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = cdata(CDATA_ID, MAX_CHARA_NC)
-			chara_vanquish MAX_CHARA_NC
+			gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 1
+			gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL) = rnd(8)
+			gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = 30 - gdata(GDATA_RANK_GUILD) / 400
 			gdata(GDATA_FLAG_SUB_FIGHTER_1) = 1
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
-			buff = lang("良い心がけです。あなたにランク昇格のためのノルマを与えましょう。" + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + "をあと" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "匹討伐してからまた来なさい。昇進のための審査会に報告してあげましょう。", "There's a task for you. Go find and slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + ". Then we will think about your promotion.")
+			buff = lang("良い心がけです。あなたにランク昇格のためのノルマを与えましょう。" + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "階相当以上の" + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + "のランダムネフィアを" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "個制覇してからまた来なさい。昇進のための審査会に報告してあげましょう。", "There's a task for you. Go find and conquer " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + " random nefia more " + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "Lv. Then we will think about your promotion.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
 			listmax++
 			chatesc = 1
@@ -10613,11 +10897,11 @@
 				}
 			}
 			goto *chat_unique
 		}
 		if ( chatval == 2 ) {
-			if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 & 0 == 0 ) {
+			if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 ) {
 				listmax = 0
 				buff = lang("どうしました？まだノルマが残っていますよ。", "You have your task to complete.")
 				tc = tc * (0 == 0) + (0 != 0) * 0
 				list(0, listmax) = 0
 				listn(0, listmax) = strmore
@@ -10644,11 +10928,11 @@
 			txtmore
 			txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-			modrank 8, 500, 8
+			modrank 8, 1500, 10
 			listmax = 0
 			buff = lang("確かにノルマの達成を確認しました。早速審査会を開いてあなたの功績を報告しましょう。", "You've done very well. I will give a report of your achievement to the council.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
@@ -16515,10 +16799,96 @@
 				}
 			}
 			gdata(GDATA_FLAG_MAIN) = 223
 			goto *chat_end
 		}
+		if ( gdata(GDATA_FLAG_MAIN) >= 223 ) {
+			if ( cdata(CDATA_MATERIAL3_COUNTER, tc) == 0 ) {
+				p = 0
+				inv_getheader 0
+				repeat invrange, invhead
+					if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
+						continue
+					}
+					if ( inv(INV_ITEM_ID, cnt) != ITEM_ID_CF_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_CRUSH_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_BATTLE_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_SUPER_POTIOMAN ) {
+						continue
+					}
+					if ( inv(INV_ITEM_PARAM3, cnt) == 0 ) {
+						continue
+					}
+					p = 1
+					break
+				loop
+				if ( p == 1 ) {
+					listmax = 0
+					buff = lang("ちょっと待て、何だその小型ロボみたいなのは。ポーショマン？ほぅ、飲み物の栓を発射するのか…。", "What? Potioman...?")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strmore
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					listmax = 0
+					buff = lang("うーむ。ちゃちゃっと本体を強化してやろうと思ったが、これは一種の工芸品だな。繊細な職人技だらけで簡単には手を加えられん。外付けの強化パーツで機能を追加したほうがよさそうだ。", "Huh, Full of delicate craftsmanship, it cannot be easily remodeled. It seems better to add functions with external reinforcement parts.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strmore
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					redraw 0
+					gosub *screen_draw
+					gosub *screen_fade
+					gsel BUFFER_BUF
+					pos 0, 0
+					picload exedir + "graphic\\face1" + devfile + ".bmp", 1
+					gsel BUFFER_SCREEN
+					listmax = 0
+					buff = lang("ほれ、以前似たようなものを設計したことがあってな。即興でダウンサイジングして機能調整したが性能は保障する。", ".....")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strmore
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					listmax = 0
+					buff = lang("ここを外してこっちとくっつけて展開させると強化アームになり、こっちのジョイントをスライドしてこっちとくっつければバレルになる。さらにこれを分割してさっきの余剰パーツをここにはめ込んで…ん？分かったよ手順書もつけてやる。作った俺は苦にならないんだが…やはり皆が言うように複雑すぎたのか？一応、形態数を抑えて戦闘中でも組み替えられる程度に簡略化したつもりなんだぞ。まぁ、いい気晴らしになったよ。", "...Okay! Bring this item.")
+					tc = tc * (0 == 0) + (0 != 0) * 0
+					list(0, listmax) = 0
+					listn(0, listmax) = strbye
+					listmax++
+					chatesc = 1
+					gosub *chat_select
+					if ( scenemode ) {
+						if ( scene_cut == 1 ) {
+							goto *chat_end
+						}
+					}
+					snd SOUNDLIST_COMPLETE1
+					flt
+					itemcreate -1, ITEM_ID_X_FRAME, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					cdata(CDATA_MATERIAL3_COUNTER, tc) = 1
+					txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
+					goto *chat_end
+				}
+			}
+		}
 		if ( gdata(GDATA_FLAG_MAIN) >= 223 & gdata(GDATA_FLAG_MAIN) <= 330 ) {
 			buff = lang("よう、" + cdatan(CDATAN_NAME, CHARA_PLAYER) + "。お前は面白そうだからな。何か用があるなら俺の貴重な時間を割いてやるぞ。", "" + cdatan(CDATAN_NAME, CHARA_PLAYER) + ", how's your investigation going? Ask anything you'd like to know.")
 			list(0, listmax) = 7
 			listn(0, listmax) = lang("装備部位を増やしたい", "Tell me about Rehmido.")
 			listmax++
@@ -19207,11 +19577,11 @@
 		listmax++
 		buff = lang("私は魔術士ギルドの調査員。ギルドメンバーのサウスティリスでの功績を調査しているのです。", "Welcome to the Mages Guild, " + ranktitle(8) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "... Please come in.")
 		gosub *chat_select
 		if ( chatval == 1 ) {
 			gdata(GDATA_FLAG_SUB_MAGE_1) = 1
-			gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 75 - gdata(GDATA_RANK_GUILD) / 200
+			gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 40 - gdata(GDATA_RANK_GUILD) / 400
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
 			buff = lang("良い心がけです。あなたにランク昇格のためのノルマを与えましょう。世界に散らばった古書物を解読し、納入してください。" + gdata(GDATA_FLAG_GUILD_MAGE_NORMA) + "ギルドポイントが集まったら、昇進のための審査会に報告してあげましょう。", "Sure, there're plenty of tasks for you. For now, collect the ancient books and decrypt them. When you gather " + gdata(GDATA_FLAG_GUILD_MAGE_NORMA) + " guild points, we will think about your promotion.")
@@ -19258,11 +19628,11 @@
 			txtmore
 			txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-			modrank 8, 500, 8
+			modrank 8, 1500, 10
 			listmax = 0
 			buff = lang("確かにノルマの達成を確認しました。早速本部にあなたの功績を報告しましょう。", "You've done very well. I will give a report of your achievement to the council.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
@@ -19299,11 +19669,11 @@
 		listmax++
 		buff = lang("あたしは盗賊ギルドの調査員…ギルドメンバーのサウスティリスでの功績を調査しているのよ…。", "Welcome to the Thieves Guild, " + ranktitle(8) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "... Please come in.")
 		gosub *chat_select
 		if ( chatval == 1 ) {
 			gdata(GDATA_FLAG_SUB_THIEF_1) = 1
-			gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = (10000 - gdata(GDATA_RANK_GUILD)) * 6 + 1000
+			gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = (10000 - gdata(GDATA_RANK_GUILD)) * 3 + 1000
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
 			buff = lang("良い心がけね。あなたにランク昇格のためのノルマを与えるわ。他人の所有物を奪い取り、盗品を売り払いなさい。金貨" + gdata(GDATA_FLAG_GUILD_THIEF_NORMA) + "枚相当の盗品を売ったら、昇進のための審査会に報告してあげる…。", "Alright. The Thieves Guild wants you to put stolen goods into circulation. Steal some goods and sell them to any vendors. When the sum of your earning reachs " + gdata(GDATA_FLAG_GUILD_THIEF_NORMA) + " gold pieces, we will think about your promotion.")
@@ -19350,11 +19720,11 @@
 			txtmore
 			txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-			modrank 8, 500, 8
+			modrank 8, 1500, 10
 			listmax = 0
 			buff = lang("確かにノルマの達成を確認したわ。早速本部にあなたの功績を報告するわね…。", "You've done very well. I will give a report of your achievement to the council.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
@@ -19390,36 +19760,19 @@
 		listn(0, listmax) = strbye
 		listmax++
 		buff = lang("私は戦士ギルドの調査員。ギルドメンバーのサウスティリスでの功績を調査しているのだ。", "Welcome to the Fighters Guild, " + ranktitle(8) + " " + cdatan(CDATAN_NAME, CHARA_PLAYER) + "... Please come in.")
 		gosub *chat_select
 		if ( chatval == 1 ) {
-			repeat
-				flt cdata(CDATA_LEVEL, CHARA_PLAYER) + 10
-				characreate MAX_CHARA_NC, CREATURE_ID_BUG, -3, 0
-				if ( refchara(cdata(CDATA_ID, MAX_CHARA_NC), DBSPEC_CHARA_RARE) < 70 ) {
-					continue
-				}
-				if ( cdata(CDATA_RELATION, MAX_CHARA_NC) != RELATION_ENEMY ) {
-					continue
-				}
-				if ( cdata(CDATA_QUALITY, MAX_CHARA_NC) >= FIX_QUALITY_MIRACLE ) {
-					continue
-				}
-				if ( cdata(CDATA_LEVEL, MAX_CHARA_NC) > cdata(CDATA_LEVEL, CHARA_PLAYER) * 3 ) {
-					continue
-				}
-				break
-			loop
-			gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 3
-			gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = cdata(CDATA_ID, MAX_CHARA_NC)
-			chara_vanquish MAX_CHARA_NC
+			gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 1
+			gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL) = rnd(8)
+			gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = 40 - gdata(GDATA_RANK_GUILD) / 400
 			gdata(GDATA_FLAG_SUB_FIGHTER_1) = 1
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
-			buff = lang("良い心がけだ。お前にランク昇格のためのノルマを与えよう。" + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + "をあと" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "匹討伐してからまた来なさい。本部に報告してあげよう。", "There's a task for you. Go find and slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + ". Then we will think about your promotion.")
+			buff = lang("良い心がけだ。お前にランク昇格のためのノルマを与えよう。" + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "階相当以上の" + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + "のランダムネフィアを" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "個制覇してからまた来なさい。本部に報告してあげよう。", "There's a task for you. Go find and slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + ". Then we will think about your promotion.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
 			listmax++
 			chatesc = 1
@@ -19461,11 +19814,11 @@
 			txtmore
 			txt lang("何かが足元に転がってきた。", "Something is put on the ground.")
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
-			modrank 8, 500, 8
+			modrank 8, 1500, 10
 			listmax = 0
 			buff = lang("確かにノルマの達成を確認した。早速本部にお前の功績を報告しよう。", "You've done very well. I will give a report of your achievement to the council.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
@@ -23749,22 +24102,22 @@
 	if ( _switch_val == 1034 | _switch_sw ) {
 		_switch_sw = 0
 		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
 			if ( gdata(GDATA_LEVEL) == 1 ) {
 				list(0, listmax) = 0
-				listn(0, listmax) = lang("ここまでよく頑張った！", "Sorry, this is untranslated sentence.")
+				listn(0, listmax) = lang("ここまでよく頑張った！", "You did well!")
 				listmax++
 				list(0, listmax) = 1
-				listn(0, listmax) = lang("もう安全だよ…", "Sorry, this is untranslated sentence.")
+				listn(0, listmax) = lang("もう安全だよ…", "You're safe now...")
 				listmax++
 				list(0, listmax) = 2
-				listn(0, listmax) = lang("えっ、ここ暖かいの？", "Sorry, this is untranslated sentence.")
+				listn(0, listmax) = lang("えっ、ここ暖かいの？", "Eh, is it warm here?")
 				listmax++
 				list(0, listmax) = 3
-				listn(0, listmax) = lang("楽しく暮らせよクソガキ", "Sorry, this is untranslated sentence.")
+				listn(0, listmax) = lang("楽しく暮らせよクソガキ", "Good bye, fucking kid...")
 				listmax++
-				buff = lang("ここは、あたたかいね…。", "Thank you...")
+				buff = lang("ここは、あたたかいね…。", "It's so warm here...")
 				chatesc = 0
 				gosub *chat_select
 				txtef COLOR_GREEN
 				txt lang(name(tc) + "の姿は薄れ、見えなくなった…。", name(tc) + " faded out and became invisible...")
 				soulimit = 0
@@ -23779,11 +24132,11 @@
 		}
 		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
 			if ( gdata(GDATA_LEVEL) == 31 | gdata(GDATA_LEVEL) == 32 ) {
 				if ( soulstage == 2 ) {
 					listmax = 0
-					buff = lang("もうイヤ…！", "Sorry, this is untranslated sentence.")
+					buff = lang("もうイヤ…！", "No more...!")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -23792,26 +24145,26 @@
 						if ( scene_cut == 1 ) {
 							goto *chat_end
 						}
 					}
 					list(0, listmax) = 0
-					listn(0, listmax) = lang("必ず守ると約束する！", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("必ず守ると約束する！", "I promise to protect you!")
 					listmax++
 					list(0, listmax) = 1
-					listn(0, listmax) = lang("もう少しだから頑張ろう？", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("もう少しだから頑張ろう？", "It's a little bit more, so let's do our best.")
 					listmax++
 					list(0, listmax) = 2
-					listn(0, listmax) = lang("泣きたいのはこっちだよ〜！", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("泣きたいのはこっちだよ〜！", "I want to cry!")
 					listmax++
 					list(0, listmax) = 3
-					listn(0, listmax) = lang("黙って走れクソガキ", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("黙って走れクソガキ", "Shut up and run you fucking kid.")
 					listmax++
 					buff = lang("(" + name(tc) + "は泣いてうずくまってしまった…)", "(" + name(tc) + " cried and crouched...)")
 					chatesc = 0
 					gosub *chat_select
 					listmax = 0
-					buff = lang("が、がんばる…。", "O..OK...")
+					buff = lang("が、がんばる…。", "I..I'll do my best...")
 					tc = tc * (0 == 0) + (0 != 0) * 0
 					list(0, listmax) = 0
 					listn(0, listmax) = strmore
 					listmax++
 					chatesc = 1
@@ -23828,22 +24181,22 @@
 		}
 		if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
 			if ( gdata(GDATA_LEVEL) == 60 ) {
 				if ( soulstage < 2 ) {
 					list(0, listmax) = 0
-					listn(0, listmax) = lang("君を助けに来た！", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("君を助けに来た！", "I've come to help you!")
 					listmax++
 					list(0, listmax) = 1
-					listn(0, listmax) = lang("一緒に探してあげるよ", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("一緒に探してあげるよ", "I'll help you find your mother.")
 					listmax++
 					list(0, listmax) = 2
-					listn(0, listmax) = lang("お父さんのことも探してあげよう？", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("お父さんのことも探してあげよう？", "Do you want me to look for your father too?")
 					listmax++
 					list(0, listmax) = 3
-					listn(0, listmax) = lang("いいから着いてこいクソガキ", "Sorry, this is untranslated sentence.")
+					listn(0, listmax) = lang("いいから着いてこいクソガキ", "Just follow me, fucking kid!")
 					listmax++
-					buff = lang("お母さん…どこ…。こわいよぉ…！", "Sorry, this is untranslated sentence.")
+					buff = lang("お母さん…どこ…。こわいよぉ…！", "Mother...where...I'm scared...!")
 					chatesc = 0
 					gosub *chat_select
 					listmax = 0
 					buff = lang("う、うん…。", "O..OK...")
 					tc = tc * (0 == 0) + (0 != 0) * 0
@@ -23886,11 +24239,11 @@
 	}
 	if ( _switch_val == 637 | _switch_sw ) {
 		_switch_sw = 0
 		if ( gdata(GDATA_FLAG_SUB_AMURDAD) \ 10 == 2 ) {
 			listmax = 0
-			buff = lang("お疲れさま…これは報酬…。他の子を見つけたらまた連絡する…。今は魂を休めて…。", "Sorry, this is untranslated sentence.")
+			buff = lang("お疲れさま…これは報酬…。他の子を見つけたらまた連絡する…。今は魂を休めて…。", "Thank you for your hard work...this is the reward...I'll let you know if I find another child. Rest your soul now...")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strmore
 			listmax++
 			chatesc = 1
@@ -23947,15 +24300,15 @@
 			listn(0, listmax) = lang("わかった", "I'll try to do.")
 			listmax++
 			list(0, listmax) = 1
 			listn(0, listmax) = lang("わからん", "I'm busy now.")
 			listmax++
-			buff = lang("悪鬼たちに囚われた無垢な魂を見つけた…。ここを離れられないから…君に救ってきてほしい。道は作る…。", "Sorry, this is untranslated sentence.")
+			buff = lang("悪鬼たちに囚われた無垢な魂を見つけた…。ここを離れられないから…君に救ってきてほしい。道は作る…。", "I found an innocent soul trapped by demons...I can't leave here...so I want you to come rescue...I make a way...")
 			gosub *chat_select
 			if ( chatval != 0 ) {
 				listmax = 0
-				buff = lang("わかって…。", "Sorry, this is untranslated sentence.")
+				buff = lang("わかって…。", "Please understand...")
 				tc = tc * (0 == 0) + (0 != 0) * 0
 				list(0, listmax) = 0
 				listn(0, listmax) = strbye
 				listmax++
 				chatesc = 1
@@ -23978,11 +24331,11 @@
 			}
 			snd SOUNDLIST_WRITE1
 			txtef COLOR_GREEN
 			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
 			listmax = 0
-			buff = lang("侵入したら、気づかれる前に…急いで…。", "Sorry, this is untranslated sentence.")
+			buff = lang("侵入したら、気づかれる前に…急いで…。", "Once infiltrated, before the enemy notices...Hurry up...")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
 			listmax++
 			chatesc = 1
@@ -23990,28 +24343,25 @@
 			if ( scenemode ) {
 				if ( scene_cut == 1 ) {
 					goto *chat_end
 				}
 			}
-			soulimit = 4444
+			soulimit = 6666
 			soulstage = 1
 			mdata(MDATA_DOWNSTAIRS_POS) = cdata(CDATA_Y, CHARA_PLAYER) * 1000 + cdata(CDATA_X, CHARA_PLAYER)
 			gdata(GDATA_TELEPORT_AREA) = AREA_AMUR_CAGE
 			gdata(GDATA_TELEPORT_LEVEL) = 10
-			if ( 0 ) {
-				soulimit = 2000
-			}
 			levelexitby = MAP_EXIT_TELEPORT
 			gdata(GDATA_LEVEL_START_ON) = 7
 			mapstartx = 17
 			mapstarty = 3
 			chatteleport = 1
 			goto *chat_end
 		}
 		if ( gdata(GDATA_FLAG_SUB_AMURDAD) == 0 ) {
 			listmax = 0
-			buff = lang("定命の君に、頼みたいことがある…。気が向いたら…また話しかけて…。", "Sorry, this is untranslated sentence.")
+			buff = lang("定命の君に、頼みたいことがある…。気が向いたら…また話しかけて…。", "I have a favor to ask of you...If you feel like it...talk to me again...")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strmore
 			listmax++
 			chatesc = 1
@@ -25526,17 +25876,156 @@
 			}
 			if ( gdata(GDATA_THALIA_LIMIT) > 2000 ) {
 				gdata(GDATA_THALIA_LIMIT) = 2000
 			}
 			list(0, listmax) = 0
-			listn(0, listmax) = lang("どうだろう", "Please tell me my misfortune.")
+			listn(0, listmax) = lang("どうだろう", "I am not sure.")
 			listmax++
 			list(0, listmax) = 1
-			listn(0, listmax) = lang("合成用アイテムを持ってきた", "Sorry.")
+			listn(0, listmax) = lang("合成用アイテムを持ってきた", "I brought an item for synthesis.")
+			listmax++
+			list(0, listmax) = 2
+			listn(0, listmax) = lang("ポーショマンの進化", "Can you evolve my potioman?")
 			listmax++
-			buff = lang("よく夜中に猫やサリムがベッドに潜り込んでくるのじゃ。そんなに寒いのかのう？単にわしが寒さに慣れておるのかもな…ロストイルヴァに来る前はメイルーンに住んでいたからのう。", "So you are also of the same genus as the others...")
+			buff = lang("よく夜中に猫やサリムがベッドに潜り込んでくるのじゃ。そんなに寒いのかのう？単にわしが寒さに慣れておるのかもな…ロストイルヴァに来る前はメイルーンに住んでいたからのう。", "Cats and Thalia often come into my bed in the middle of the night. Is it really that cold here?")
 			gosub *chat_select
+			if ( chatval == 2 ) {
+				txt lang("対象のポーショマンは？", "Which potioman?")
+				invsubroutine = 1
+				invctrl = INVCTRL_MATERIAL_ENCHANT, 30
+				snd SOUNDLIST_INV
+				gosub *com_inventory
+				if ( stat == 1 ) {
+					cibk = ci
+					if ( inv(INV_ITEM_SHOP_SAMPLE, cibk) == 0 ) {
+						listmax = 0
+						buff = lang("なんじゃ、このクオリティの高いポーショマンは！？こ、この出来ならばとっておきの細工が使えそうじゃ…。", "What is this quality potion man! ? With this quality, that mystery seems to be usable...")
+						tc = tc * (0 == 0) + (0 != 0) * 0
+						list(0, listmax) = 0
+						listn(0, listmax) = strmore
+						listmax++
+						chatesc = 1
+						gosub *chat_select
+						if ( scenemode ) {
+							if ( scene_cut == 1 ) {
+								goto *chat_end
+							}
+						}
+					}
+					if ( inv(INV_ITEM_SHOP_SAMPLE, cibk) != 0 ) {
+						listmax = 0
+						buff = lang("ああ、前に進化させたやつの属性変更じゃな。", "Ah, it's an attribute change of the one that was evolved before.")
+						tc = tc * (0 == 0) + (0 != 0) * 0
+						list(0, listmax) = 0
+						listn(0, listmax) = strmore
+						listmax++
+						chatesc = 1
+						gosub *chat_select
+						if ( scenemode ) {
+							if ( scene_cut == 1 ) {
+								goto *chat_end
+							}
+						}
+					}
+					item_find ITEM_ID_EVITEM, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_CHARAS
+					if ( stat != (-1) ) {
+						ci = stat
+						if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
+							list(0, listmax) = 1
+							listn(0, listmax) = lang(itemname(ci, 1) + "を渡す", "Here, take my " + itemname(ci, 1) + ".")
+							listmax++
+						}
+					}
+					list(0, listmax) = 0
+					listn(0, listmax) = lang("考えておく", "Someday.")
+					listmax++
+					buff = lang("…よし、なんでもいいから進化アイテムを１つ持ってくるのじゃ。言っておくが種類は仕上がりに影響せんからの。", "…Okay, bring me an evolution item, whatever it is.")
+					gosub *chat_select
+					if ( chatval != 1 ) {
+						listmax = 0
+						buff = lang("ふぅん。", "Huh.")
+						tc = tc * (0 == 0) + (0 != 0) * 0
+						list(0, listmax) = 0
+						listn(0, listmax) = strmore
+						listmax++
+						chatesc = 1
+						gosub *chat_select
+						if ( scenemode ) {
+							if ( scene_cut == 1 ) {
+								goto *chat_end
+							}
+						}
+						goto *chat_end
+					}
+					list(0, listmax) = 0
+					listn(0, listmax) = lang("やっぱりやめとく", "After all it is okay as it is.")
+					listmax++
+					list(0, listmax) = 1
+					listn(0, listmax) = lang("火炎", "fire")
+					listmax++
+					list(0, listmax) = 2
+					listn(0, listmax) = lang("冷気", "cold")
+					listmax++
+					list(0, listmax) = 3
+					listn(0, listmax) = lang("電撃", "lightning")
+					listmax++
+					list(0, listmax) = 4
+					listn(0, listmax) = lang("暗黒", "darkness")
+					listmax++
+					list(0, listmax) = 5
+					listn(0, listmax) = lang("幻惑", "mind")
+					listmax++
+					list(0, listmax) = 6
+					listn(0, listmax) = lang("毒", "poison")
+					listmax++
+					list(0, listmax) = 7
+					listn(0, listmax) = lang("地獄", "nether")
+					listmax++
+					list(0, listmax) = 8
+					listn(0, listmax) = lang("音", "sound")
+					listmax++
+					list(0, listmax) = 9
+					listn(0, listmax) = lang("神経", "nerve")
+					listmax++
+					list(0, listmax) = 10
+					listn(0, listmax) = lang("混沌", "chaos")
+					listmax++
+					buff = lang("こいつは属性の力を得て生まれ変わるが…どの属性がよいかのう？後から変えられるし、色で決めるのもよいと思うぞ。", "Hmmm, This potioman gets the power of an attribute and is reborn...Which attribute do you want? You can change it later, and I think it's good to decide by color.")
+					chatesc = 1
+					gosub *chat_select
+					pot = chatval
+					if ( chatval >= 1 & chatval <= 10 ) {
+						ele = chatval + 49
+						inv(INV_ITEM_SHOP_SAMPLE, cibk) = ele
+						snd SOUNDLIST_BUILD1
+						inv(INV_ITEM_NUM, ci)--
+						gosub *calcBurdenPc
+						redraw 0
+						gosub *screen_draw
+						gosub *screen_fade
+						gsel BUFFER_BUF
+						pos 0, 0
+						picload exedir + "graphic\\face1" + devfile + ".bmp", 1
+						gsel BUFFER_SCREEN
+						snd SOUNDLIST_COMPLETE1
+						listmax = 0
+						buff = lang("で、出来たぞ！これがおぬしの新生ポーショマンじゃあ！大事にするんじゃぞ。", "Here you are...This is your new potioman!!")
+						tc = tc * (0 == 0) + (0 != 0) * 0
+						list(0, listmax) = 0
+						listn(0, listmax) = strmore
+						listmax++
+						chatesc = 1
+						gosub *chat_select
+						if ( scenemode ) {
+							if ( scene_cut == 1 ) {
+								goto *chat_end
+							}
+						}
+					}
+				}
+				goto *chat_end
+			}
 			if ( chatval == 1 ) {
 				kiseki = gdata(GDATA_THALIA_LIMIT) + 500
 				kiseki2 = gdata(GDATA_THALIA_LIMIT) + 1000
 				listmax = 0
 				buff = lang("おお、練習に付き合ってくれるのか。それで、エンチャントを付与する武具はどれじゃ？エンチャントが強力な武具は、魔術抵抗があって付与できないかもしれん。そうじゃな…サリムの言うエンチャント強度とやらで言うと、今は固定アーティファクトなら" + gdata(GDATA_THALIA_LIMIT) + "パワー、奇跡品なら" + kiseki + "パワー、神器品なら" + kiseki2 + "パワー、辺りが限界じゃ。それとネフィアティア以外を合成する場合は能力獲得の巻き物を一枚使うのう。", "So you are also of the same genus as the others...")
@@ -27338,11 +27827,11 @@
 				if ( scene_cut == 1 ) {
 					goto *chat_end
 				}
 			}
 			listmax = 0
-			buff = lang("…あと、おひねりもよろしくっ！", "Sorry, this is untranslated sentence.")
+			buff = lang("…月末の限定コンサートもよろしくっ！", "Sorry, this is untranslated sentence.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strbye
 			listmax++
 			chatesc = 1
@@ -31983,11 +32472,11 @@
 				if ( scene_cut == 1 ) {
 					goto *chat_end
 				}
 			}
 			listmax = 0
-			buff = lang("ランダムネフィアは３〜６層で構成され、最下層のボスを倒せば攻略完了となり宝が手に入ります。ボスを倒す前に最下層から逃げると、失敗となり攻略不能になります。あと、ランダムネフィアの表層以外の階層には、金貨が集められている箇所が必ず存在します。なんだかネフィアが冒険者を誘っているみたいで不気味ですが…ありがたく拾っておきましょう。", "Random Nefia have 3 to 6 floors and a boss on the bottom floor that drops treasure when defeated. If you go out of the last floor before defeating the boss, you'll fail to clear the Nefia and won't be able to try it again. Random Nefia also have gold pieces scattered throughout them - but never on their first floor. They're like bait to attract adventurers... creepy if you ask me, but hey it's free money.")
+			buff = lang("ランダムネフィアは３層で構成され、最下層のボスを倒せば攻略完了となり宝が手に入ります。ボスを倒す前に最下層から逃げると、失敗となり攻略不能になります。あと、ランダムネフィアの表層以外の階層には、金貨が集められている箇所が必ず存在します。なんだかネフィアが冒険者を誘っているみたいで不気味ですが…ありがたく拾っておきましょう。", "Random Nefia have 3 floors and a boss on the bottom floor that drops treasure when defeated. If you go out of the last floor before defeating the boss, you'll fail to clear the Nefia and won't be able to try it again. Random Nefia also have gold pieces scattered throughout them - but never on their first floor. They're like bait to attract adventurers... creepy if you ask me, but hey it's free money.")
 			tc = tc * (0 == 0) + (0 != 0) * 0
 			list(0, listmax) = 0
 			listn(0, listmax) = strmore
 			listmax++
 			chatesc = 1
@@ -45163,10 +45652,16 @@
 			goto *chat_default
 		}
 		snd SOUNDLIST_PAYGOLD1
 		cdata(CDATA_GOLD, CHARA_PLAYER) -= calcmealvalued()
 		snd SOUNDLIST_DRINK1
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+			snd SOUNDLIST_WRITE1
+			txtef COLOR_GREEN
+			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+			cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+		}
 		cdata(CDATA_THIRST, CHARA_PLAYER) = 15000
 		if ( cdata(CDATA_HUNGER, CHARA_PLAYER) < 15000 - 1000 ) {
 			cdata(CDATA_HUNGER, CHARA_PLAYER) += 1000
 		}
 		buff = lang(_dozo(), "Here you are.")
@@ -45245,10 +45740,16 @@
 					cdata(CDATA_THIRST, tc) = 15000
 					if ( cdata(CDATA_HUNGER, tc) < 15000 - 1000 ) {
 						cdata(CDATA_HUNGER, tc) += 1000
 					}
 				loop
+				if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+				}
 				txtef COLOR_GREEN
 				if ( val == 0 ) {
 					txt lang("くう〜っ！", "Delicious...!!!")
 				}
 				if ( val == 1 ) {
@@ -53131,11 +53632,11 @@
 			fmode = 3
 			gosub *game_ctrlFile
 		}
 	}
 	invfile = cdata(CDATA_ROLE_FILE_ID, tc)
-	goto *shop_end
+	goto *label_6749
 
 *shop
 	mode = MODELIST_SHOP
 	file = "shoptmp.s2"
 	fmode = 4
@@ -53149,11 +53650,11 @@
 			shoptrade = 1
 		}
 	}
 	goto *com_inventory
 
-*shop_end
+*label_6749
 	file = "shop" + invfile + ".s2"
 	fmode = 4
 	gosub *game_ctrlFile
 	file = "shoptmp.s2"
 	fmode = 3
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/chips.hsp ../2.17-borscht/chips.hsp
--- ../2.15R-borscht/chips.hsp	2023-05-12 09:08:03.523884000 +0800
+++ ../2.17-borscht/chips.hsp	2023-05-12 09:05:57.007868500 +0800
@@ -1478,11 +1478,17 @@
 	chipc(CHIPC_HEIGHT, xy2pic(27, 31)) = inf_tiles * 2, inf_tiles + 16
 	chipc(CHIPC_HEIGHT, xy2pic(28, 31)) = inf_tiles * 2, inf_tiles + 16
 	chipc(CHIPC_HEIGHT, xy2pic(29, 31)) = inf_tiles * 2, inf_tiles + 16
 	chipc(CHIPC_HEIGHT, xy2pic(30, 31)) = inf_tiles * 2, inf_tiles + 16
 	chipc(CHIPC_HEIGHT, xy2pic(31, 31)) = inf_tiles * 2, inf_tiles + 16
-	chipc(CHIPC_HEIGHT, xy2pic(32, 31)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(0, 35)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(1, 35)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(2, 35)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(3, 35)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(4, 35)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(5, 35)) = inf_tiles * 2, inf_tiles + 16
+	chipc(CHIPC_HEIGHT, xy2pic(6, 35)) = inf_tiles * 2, inf_tiles + 16
 	dim deco, 3, 300
 	repeat 16
 		deco(0, 1 + cnt * 16) = 0, 1
 		deco(0, 2 + cnt * 16) = 1, 2
 		deco(0, 4 + cnt * 16) = 1, 0
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/command.hsp ../2.17-borscht/command.hsp
--- ../2.15R-borscht/command.hsp	2023-05-12 09:08:03.562780100 +0800
+++ ../2.17-borscht/command.hsp	2023-05-12 09:05:57.079124000 +0800
@@ -46,10 +46,35 @@
 			bedtxt += lang("寝心地が良さそうだ。", "I seem to be able to sleep comfortably.")
 		}
 		if ( inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_KINGS_BED | inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_HAPPY_BED ) {
 			bedtxt += lang("とっても寝心地が良さそうだ！", "I seem to be able to sleep very comfortably!")
 		}
+		if ( inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_BOMB_BARREL ) {
+			if ( cdatan(CDATAN_FAKE_CLASS, CHARA_PLAYER) == "錬金術士" ) {
+				bedtxt += lang("「たる…」", "")
+			}
+		}
+		if ( inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_POTION_NEKTAR ) {
+			if ( cdatan(CDATAN_FAKE_CLASS, CHARA_PLAYER) == "錬金術士" ) {
+				bedtxt += lang("「たる〜」", "")
+			}
+		}
+		if ( inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_SNOW_BARREL ) {
+			if ( cdatan(CDATAN_FAKE_CLASS, CHARA_PLAYER) == "錬金術士" ) {
+				bedtxt += lang("「たるっ」", "")
+			}
+		}
+		if ( inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_CARGO_BARREL ) {
+			if ( cdatan(CDATAN_FAKE_CLASS, CHARA_PLAYER) == "錬金術士" ) {
+				bedtxt += lang("「たる！」", "")
+			}
+		}
+		if ( inv(INV_ITEM_ID, rtval(1)) == ITEM_ID_BARREL ) {
+			if ( cdatan(CDATAN_FAKE_CLASS, CHARA_PLAYER) == "錬金術士" ) {
+				bedtxt += lang("「たーる」", "")
+			}
+		}
 		return bedtxt
 	}
 	else {
 		return lang("ここには" + rtval + "種類のアイテムがある。", "There are " + rtval + " items lying here.")
 	}
@@ -2772,10 +2797,12 @@
 		noteadd ""
 	loop
 	noteadd " - Quest - "
 	noteadd ""
 	gosub *quest_info
+	val = 0
+	gosub *label_0439
 	repeat gdata(GDATA_CLIENT)
 		if ( qdata(QDATA_STATE, cnt) == QUEST_STATE_NONE ) {
 			continue
 		}
 		rq = cnt
@@ -2989,14 +3016,20 @@
 			color 0, 0, 200
 			if ( s(1) == "QL" ) {
 				color 100, 100, 0
 			}
 			if ( s(1) == "QC" ) {
-				color 0, 100, 100
+				color 0, 100, 0
 			}
 			if ( s(1) == "QM" ) {
-				color 0, 100, 0
+				color 200, 0, 0
+			}
+			if ( s(1) == "QD" ) {
+				color 200, 100, 0
+			}
+			if ( s(1) == "QS" ) {
+				color 0, 100, 100
 			}
 			if ( s(1) == "RE" ) {
 				color 100, 0, 0
 				font lang(cfg_font1, cfg_font2), 12 + sizefix - en * 2, 0
 			}
@@ -5060,11 +5093,11 @@
 			txt lang("その行為は、ワールドマップにいる間はできない。", "You can't do that while you're in a global area.")
 			display_msg
 			redraw 1
 			goto *pc_turn
 		}
-		if ( efid < 848 ) {
+		if ( efid < MAX_SKILL ) {
 			if ( spact(efid - STARTING_SKILL_SPACT) == 0 ) {
 				txt lang("もうその行動はできない。", "You can't use this shortcut any more.")
 				gosub *screen_draw
 				goto *pc_turn
 			}
@@ -5159,11 +5192,11 @@
 				list(0, listmax) = cnt, 15
 				listmax++
 			}
 		}
 	loop
-	repeat 848 - 600
+	repeat 852 - 600
 		if ( spact(cnt) == 1 ) {
 			if ( sdataref(SKILL_DATAREF_TG, cnt + 600) / 1000 * 1000 != 3000 & cnt + 600 != 746 & cnt + 600 != 667 & cnt + 600 != 693 & cnt + 600 != 740 ) {
 				list(0, listmax) = cnt + 600, sdataref(SKILL_DATAREF_USE, 600 + cnt)
 				listmax++
 			}
@@ -5305,11 +5338,11 @@
 	}
 	if ( key == key_msglog ) {
 		snd SOUNDLIST_CHEST1
 		txtef COLOR_GREEN
 		txt lang("【技能・全表示】", "[Sealed skills release]")
-		repeat 848 - 600
+		repeat 852 - 600
 			if ( spact(cnt) == 2 ) {
 				if ( sdataref(SKILL_DATAREF_TG, cnt + 600) / 1000 * 1000 != 3000 & cnt + 600 != 746 & cnt + 600 != 667 & cnt + 600 != 693 & cnt + 600 != 740 ) {
 					spact(cnt) = 1
 				}
 			}
@@ -5378,11 +5411,11 @@
 	cc = CHARA_PLAYER
 	cs_bk = -1
 	cs = commark(2) \ 1000
 	page = commark(2) / 1000
 	curmenu = 2
-	repeat 848 - 600
+	repeat 852 - 600
 		if ( spact(cnt) == 1 ) {
 			if ( sdataref(SKILL_DATAREF_TG, cnt + 600) / 1000 * 1000 == 3000 | cnt + 600 == 746 | cnt + 600 == 667 | cnt + 600 == 693 | cnt + 600 == 740 ) {
 				list(0, listmax) = cnt + 600, sdataref(SKILL_DATAREF_USE, 600 + cnt)
 				listmax++
 			}
@@ -5517,11 +5550,11 @@
 	}
 	if ( key == key_msglog ) {
 		snd SOUNDLIST_CHEST1
 		txtef COLOR_GREEN
 		txt lang("【広域技能・全表示】", "[Sealed skills release]")
-		repeat 848 - 600
+		repeat 852 - 600
 			if ( spact(cnt) == 2 ) {
 				if ( sdataref(SKILL_DATAREF_TG, cnt + 600) / 1000 * 1000 == 3000 | cnt + 600 == 746 | cnt + 600 == 667 | cnt + 600 == 693 | cnt + 600 == 740 ) {
 					spact(cnt) = 1
 				}
 			}
@@ -5797,11 +5830,11 @@
 		}
 	}
 	txt lang(name(tc) + "に何をする？ ", "What action do you want to perform to " + him(tc) + "? ")
 	kakudo2 = cdata(CDATA_MARK_ITEM_ADJUST_R, tc) * 15
 	if ( 0 ) {
-		txt lang("cTone(tc)が" + cdata(CDATA_TONE, tc) + "でcSexT(tc)で" + cdata(CDATA_TONE_SEX, tc) + "", "You cannot leave livestock on hanging.")
+		txt lang("スタイルが" + cdata(CDATA_ATTACK_STYLE, tc) + "。", "You cannot leave livestock on hanging.")
 	}
 	if ( cdata(CDATA_PV_FIX, tc) == 100 & cdata(CDATA_DV_FIX, tc) == 100 ) {
 		if ( cdatan(CDATAN_RACE, tc) == "slime" ) {
 			cdata(CDATA_PV_FIX, tc) = 200
 		}
@@ -6157,10 +6190,16 @@
 		}
 		if ( rtval == 0 ) {
 			txt lang(cdatan(CDATAN_NAME, tc) + "はあなたが何を伝えようとしたのか、すごく気になっている…。", cdatan(CDATAN_NAME, tc) + " cares what you tried to tell.")
 			cdata(CDATA_EMO_ICON, tc) = 21 + 100 * 3
 		}
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 5 ) {
+			snd SOUNDLIST_WRITE1
+			txtef COLOR_GREEN
+			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+			cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+		}
 		cdata(CDATA_INTEREST, tc) -= 80
 		cdata(CDATA_INTEREST_RENEW, tc) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 12
 		if ( rtval >= 1 & rtval <= 3 ) {
 			if ( cdata(CDATA_IMPRESSION, tc) >= 150 ) {
 				modimp tc, 12
@@ -6204,11 +6243,11 @@
 				if ( gdata(GDATA_FLAG_GAME_MODE) == 2 | gdata(GDATA_FLAG_GAME_MODE) == 5 ) {
 					snd SOUNDLIST_FAIL1
 					txt lang("このゲームモードでは遺伝子を残せない。", "I do not make gene in this game mode.")
 					goto *turn_end
 				}
-				if ( gdata(GDATA_SLEEP) < 15 ) {
+				if ( gdata(GDATA_SLEEP) < 13 ) {
 					snd SOUNDLIST_FAIL1
 					txt lang("「まだ眠くない" + _yo(3) + "」", cdatan(CDATAN_NAME, tc) + " isn't sleepy yet.")
 					goto *turn_end
 				}
 				if ( gdata(GDATA_AREA) == AREA_SHELTER ) {
@@ -11739,10 +11778,37 @@
 					}
 					if ( inv(INV_ITEM_PARAM2, cnt) != 0 ) {
 						continue
 					}
 				}
+				if ( invctrl(1) == 28 ) {
+					if ( inv(INV_ITEM_ID, cnt) != ITEM_ID_CF_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_CRUSH_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_BATTLE_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_SUPER_POTIOMAN ) {
+						continue
+					}
+					if ( inv(INV_ITEM_AMUR_CAGE, cnt) == 0 ) {
+						continue
+					}
+				}
+				if ( invctrl(1) == 29 ) {
+					if ( inv(INV_ITEM_ID, cnt) != ITEM_ID_CF_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_CRUSH_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_BATTLE_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_SUPER_POTIOMAN ) {
+						continue
+					}
+					if ( inv(INV_ITEM_PARAM3, cnt) == 0 ) {
+						continue
+					}
+					if ( inv(INV_ITEM_AMUR_CAGE, cnt) != 0 ) {
+						continue
+					}
+				}
+				if ( invctrl(1) == 30 ) {
+					if ( inv(INV_ITEM_ID, cnt) != ITEM_ID_CF_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_CRUSH_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_BATTLE_POTIOMAN & inv(INV_ITEM_ID, cnt) != ITEM_ID_SUPER_POTIOMAN ) {
+						continue
+					}
+					if ( inv(INV_ITEM_PARAM3, cnt) == 0 ) {
+						continue
+					}
+				}
 			}
 			if ( invctrl == INVCTRL_PUT ) {
 				if ( invctrl(1) == 0 ) {
 					if ( gdata(GDATA_AREA) == AREA_LUMIEST | gdata(GDATA_AREA) == AREA_ARCBELC ) {
 						if ( inv(INV_ITEM_ID, cnt) != ITEM_ID_ANCIENT_BOOK | inv(INV_ITEM_PARAM2, cnt) == 0 ) {
@@ -12318,10 +12384,22 @@
 			}
 		}
 		pos wx + 37, wy + 69 + cnt * 19
 		gmode 2, chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1))
 		grotate BUFFER_ITEM, 0, 960, 0, chipi(CHIPI_WIDTH, p(1)) * inf_tiles / chipi(CHIPI_HEIGHT, p(1)), inf_tiles
+		if ( inv(INV_ITEM_ID, p) == ITEM_ID_CF_POTIOMAN | inv(INV_ITEM_ID, p) == ITEM_ID_CRUSH_POTIOMAN | inv(INV_ITEM_ID, p) == ITEM_ID_BATTLE_POTIOMAN | inv(INV_ITEM_ID, p) == ITEM_ID_SUPER_POTIOMAN ) {
+			if ( inv(INV_ITEM_SHOP_SAMPLE, p) > 0 ) {
+				pos wx + 37, wy + 69 + cnt * 19
+				gmode 2, chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1))
+				grotate BUFFER_ITEM, 1008 - (inv(INV_ITEM_SHOP_SAMPLE, p) - 50) * 48, 1776, 0, 48, 48
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, p) > 0 ) {
+				pos wx + 37, wy + 69 + cnt * 19
+				gmode 2, chipi(CHIPI_WIDTH, p(1)), chipi(CHIPI_HEIGHT, p(1))
+				grotate BUFFER_ITEM, 1344 - inv(INV_ITEM_AMUR_CAGE, p) * 48, 1776, 0, 48, 48
+			}
+		}
 		if ( inv(INV_ITEM_EQUIP, p) != 0 ) {
 			pos wx + 46, wy + 72 + cnt * 18 - 3
 			gcopy BUFFER_INF, 12, 348, 12, 12
 			if ( inv(INV_ITEM_KNOWN, p) == ITEM_KNOWN_FULL ) {
 				if ( inv(INV_ITEM_IDENTIFY_LEVEL, p) == 100 ) {
@@ -13322,16 +13400,16 @@
 		}
 		if ( invctrl == INVCTRL_PUT ) {
 			if ( invctrl(1) == 0 ) {
 				snd SOUNDLIST_INV
 				if ( gdata(GDATA_AREA) == AREA_LUMIEST | gdata(GDATA_AREA) == AREA_ARCBELC ) {
-					gdata(GDATA_FLAG_GUILD_MAGE_NORMA) -= (inv(INV_ITEM_PARAM1, ci) + 1) * inv(INV_ITEM_NUM, ci)
+					gdata(GDATA_FLAG_GUILD_MAGE_NORMA) -= (inv(INV_ITEM_PARAM1, ci) + 5) * inv(INV_ITEM_NUM, ci)
 					if ( gdata(GDATA_FLAG_GUILD_MAGE_NORMA) <= 0 ) {
 						gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
 					}
 					txtef COLOR_GREEN
-					txt lang(itemname(ci) + "を納入した", "You deliver " + itemname(ci) + ". ") + "(" + (inv(INV_ITEM_PARAM1, ci) + 1) * inv(INV_ITEM_NUM, ci) + " Guild Point)"
+					txt lang(itemname(ci) + "を納入した", "You deliver " + itemname(ci) + ". ") + "(" + (inv(INV_ITEM_PARAM1, ci) + 5) * inv(INV_ITEM_NUM, ci) + " Guild Point)"
 					if ( gdata(GDATA_FLAG_GUILD_MAGE_NORMA) == 0 ) {
 						snd SOUNDLIST_COMPLETE1
 						txtef COLOR_GREEN
 						txt lang("ノルマを達成した！", "You fulfill the quota!")
 					}
@@ -13718,11 +13796,11 @@
 			gosub *screen_draw
 			menucycle = 1
 			goto *com_wear
 		}
 		if ( invctrl == INVCTRL_SHOP_BUY | invctrl == INVCTRL_SHOP_SELL | invctrl == INVCTRL_INV_FILE_GET | invctrl == INVCTRL_METAL ) {
-			goto *shop_end
+			goto *label_6749
 		}
 		if ( invally == 1 ) {
 			invally = 0
 		}
 		if ( dropcontinue ) {
@@ -15238,11 +15316,11 @@
 	gosub *db_class
 	buff = ""
 	notesel buff
 	procid = (procid + 1) \ 4
 	proclist(procid) = "Dump:1" + " ct:" + ct
-	noteadd "Elona Version " + "6.15" + " キャラクター情報 " + gdata(GDATA_YEAR) + "年" + gdata(GDATA_MONTH) + "月" + gdata(GDATA_DAY) + "日 " + gdata(GDATA_HOUR) + "時" + gdata(GDATA_MIN) + "分  " + mdatan(0)
+	noteadd "Elona Version " + "6.17" + " キャラクター情報 " + gdata(GDATA_YEAR) + "年" + gdata(GDATA_MONTH) + "月" + gdata(GDATA_DAY) + "日 " + gdata(GDATA_HOUR) + "時" + gdata(GDATA_MIN) + "分  " + mdatan(0)
 	noteadd ""
 	noteadd "  " + fixtxt("" + cdatan(CDATAN_AKA, CHARA_PLAYER) + cdatan(CDATAN_NAME, CHARA_PLAYER), 34) + _sex(cdata(CDATA_SEX, CHARA_PLAYER)) + " " + calcage(0) + "歳" + "  " + cdata(CDATA_HEIGHT, CHARA_PLAYER) + "cm" + " " + cdata(CDATA_WEIGHT, CHARA_PLAYER) + "kg"
 	noteadd ""
 	noteadd fixtxt("種族       : " + racename, 30) + fixtxt("信仰      : " + godname(cdata(CDATA_GOD, CHARA_PLAYER)), 32)
 	noteadd fixtxt("職業       : " + classname, 30) + fixtxt("所属      : " + guildname(), 32)
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/db_card.hsp ../2.17-borscht/db_card.hsp
--- ../2.15R-borscht/db_card.hsp	2023-05-12 09:08:03.606662800 +0800
+++ ../2.17-borscht/db_card.hsp	2023-05-12 09:05:57.186106400 +0800
@@ -1,6 +1,123 @@
 *db_card
+	if ( dbid == 1081 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。死こそが万人にとっての救いであると考えており、生気のない目で各地を放浪しながら殺戮を繰り返している。", "")
+		cardrefdomain = 6
+		cardrefrare = 20
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<天屍>", "chaoshaprincess ZEHLS")
+		cardrefpic = xy2pic(6, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1081 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1080 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。胴長短足なのを気にしており、そこをイジられるとマジでキレる。舌はとても長く、かなり精密に動かせる。", "")
+		cardrefdomain = 6
+		cardrefrare = 30
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<魔鱗>", "chaoshaprincess DIBWL")
+		cardrefpic = xy2pic(5, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1080 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1079 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。生体組織が岩石やナノマシンに置き換わってしまったが、見た目によらず熱いハートを持っている。", "")
+		cardrefdomain = 6
+		cardrefrare = 40
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<物機>", "chaoshaprincess VARGM")
+		cardrefpic = xy2pic(4, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1079 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1078 ) {
+		cardreftype = 10
+		cardrefskill = lang("エーテリアンと化した後もエーテル病が進行し続け、こんなことになってしまった。人間の意識は欠片も残っていない。もはや、いかなる魔法や薬を用いても元には戻れない。死だけが救いである。", "")
+		cardrefdomain = 6
+		cardrefrare = 30
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("エーテリアンプラス", "etherian plus")
+		cardrefpic = xy2pic(5, 34) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1078 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1077 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。聴力と脚力と腕力と飛行能力に優れるが、もふもふ力が一番の自慢。本人は気づいていないが色々な獣臭さが混ざったような体臭がなかなかキツい。", "")
+		cardrefdomain = 6
+		cardrefrare = 50
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<獣羽>", "chaoshaprincess CHRDH")
+		cardrefpic = xy2pic(3, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1077 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1076 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。興奮するとよくわからない粘性の液体が全身から分泌されるため悩んでいたが、最近になってこれが自分の汗なのだと気づいた。", "")
+		cardrefdomain = 6
+		cardrefrare = 60
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<水粘>", "chaoshaprincess FSSSY")
+		cardrefpic = xy2pic(2, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1076 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1075 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。好みのタイプはご飯をいっぱいくれる人。食事に熱中しすぎて周りが見えなくなる癖があり、ついつい食べすぎてお腹がぽっこりしがち。", "")
+		cardrefdomain = 6
+		cardrefrare = 70
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<虫蟲>", "chaoshaprincess FWBS")
+		cardrefpic = xy2pic(1, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1075 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1074 ) {
+		cardreftype = 10
+		cardrefskill = lang("出身地は異形の森の近く。身体のあちこちが先祖返りを起こしており、人里から追い出された。自分は日陰者だと自覚しており、ジメジメしたところで静かにしていることを好む。だが本当は陽の当たるところで皆と賑やかに過ごすことを夢見ている。", "")
+		cardrefdomain = 6
+		cardrefrare = 80
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("混形姫<殖花>", "chaoshaprincess MEM")
+		cardrefpic = xy2pic(0, 35) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1074 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
+	if ( dbid == 1073 ) {
+		cardreftype = 10
+		cardrefskill = lang("元人間。エーテルに特に弱い体質だったらしいが、最初は顔の異形化だけで済んでいた。症状が悪化して全身がめちゃくちゃに変異してしまい、今では人格も理性も残っていない化け物。こうなる前に対処したいところだが治療法は確立されておらず、奇跡でも起きない限り悪化は止まらない。", "")
+		cardrefdomain = 6
+		cardrefrare = 50
+		cardrefcost = 1
+		cardrefattack = 690
+		cardrefhp = 3
+		cardrefn = lang("エーテリアン", "etherian")
+		cardrefpic = xy2pic(4, 34) + COLOR_DEFAULT * COLOR_TINT_MULT
+		cardrefrace = "1073 effect:" + skillname(cardrefattack) + " "
+		return 1
+	}
 	if ( dbid == 1072 ) {
 		cardreftype = 10
 		cardrefskill = lang("鮫殴りセンターと真っ向から殴り合いをするために進化した、海の覇者。鼻先を殴られるのに弱いというデマを信じて殴り掛かって来た挑戦者に、強烈なカウンターを食らわせる。歯がすぐに生え変わるのでマウスピースはつけない主義。", "")
 		cardrefdomain = 6
 		cardrefrare = 10
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/event.hsp ../2.17-borscht/event.hsp
--- ../2.15R-borscht/event.hsp	2023-05-12 09:08:03.854003200 +0800
+++ ../2.17-borscht/event.hsp	2023-05-12 09:05:58.374391600 +0800
@@ -3344,11 +3344,78 @@
 				}
 			}
 		}
 	}
 	return
-	goto *label_5275
+
+*shop_end
+	invfile = 4
+	file = "shoptmp.s2"
+	fmode = 4
+	gosub *game_ctrlFile
+	file = "shop" + 4 + ".s2"
+	existwrapper exedir + "tmp\\" + file
+	if ( strsize != (-1) ) {
+		fmode = 3
+		gosub *game_ctrlFile
+	}
+	else {
+		inv_getheader -1
+		repeat invrange, invhead
+			inv(INV_ITEM_NUM, cnt) = 0
+		loop
+	}
+	inv_getheader -1
+	p = -1
+	repeat invrange, invhead
+		if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
+			p = cnt
+			break
+		}
+	loop
+	if ( p == (-1) ) {
+		item_compress -1
+	}
+	mode = MODELIST_SHOP
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 2 ) {
+		dbid = 1271
+	}
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 3 ) {
+		dbid = 1270
+	}
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 4 ) {
+		dbid = 1269
+	}
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 5 ) {
+		dbid = 1270
+	}
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 6 ) {
+		dbid = 1269
+	}
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 0 ) {
+		dbid = 1270
+	}
+	if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) / 10 \ 7 == 1 ) {
+		dbid = 1269
+	}
+	flt
+	itemcreate -1, dbid, -1, -1, 0
+	inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+	snd SOUNDLIST_DING2
+	txtmore
+	txtef COLOR_SKY_BLUE
+	txt lang("デイリークエストの報酬アイテムが給料として振り込まれた。", "As a salary, dairy quest reward have been sent to your house.")
+	file = "shop" + invfile + ".s2"
+	fmode = 4
+	gosub *game_ctrlFile
+	file = "shoptmp.s2"
+	fmode = 3
+	gosub *game_ctrlFile
+	mode = MODELIST_MAIN
+	return
+	goto *label_5303
+
 
 
 
 
 
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/god.hsp ../2.17-borscht/god.hsp
--- ../2.15R-borscht/god.hsp	2023-05-12 09:08:03.881926900 +0800
+++ ../2.17-borscht/god.hsp	2023-05-12 09:05:58.383348200 +0800
@@ -1,25 +1,41 @@
 #deffunc modpiety int modpiety_arg1
 	if ( gdata(GDATA_GOD_RANK) == 4 ) {
 		if ( cdata(CDATA_PIETY, CHARA_PLAYER) >= 4000 ) {
 			gdata(GDATA_GOD_RANK)++
+			txtnew
 			txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_LOVE
+			snd SOUNDLIST_MIND000
+			txtef COLOR_YELLOW2
+			txt lang("今なら、神への祈りが特別なものをもたらすかもしれない！", " Now prayer to God may bring something special!")
+			await 500
 		}
 	}
 	if ( gdata(GDATA_GOD_RANK) == 2 ) {
 		if ( cdata(CDATA_PIETY, CHARA_PLAYER) >= 2500 ) {
 			gdata(GDATA_GOD_RANK)++
+			txtnew
 			txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_LIKE
+			snd SOUNDLIST_MIND000
+			txtef COLOR_YELLOW2
+			txt lang("今なら、神への祈りが特別なものをもたらすかもしれない！", " Now prayer to God may bring something special!")
+			await 500
 		}
 	}
 	if ( gdata(GDATA_GOD_RANK) == 0 ) {
 		if ( cdata(CDATA_PIETY, CHARA_PLAYER) >= 1500 ) {
 			gdata(GDATA_GOD_RANK)++
+			txtnew
 			txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_LIKE
+			snd SOUNDLIST_MIND000
+			txtef COLOR_YELLOW2
+			txt lang("今なら、神への祈りが特別なものをもたらすかもしれない！", " Now prayer to God may bring something special!")
+			await 500
 		}
 	}
 	if ( sdata(SKILL_NORMAL_FAITH, CHARA_PLAYER) * 100 < cdata(CDATA_PIETY, CHARA_PLAYER) ) {
+		txtnew
 		txt lang("あなたの信仰は既に限界まで高まっている。", " Your God becomes indifferent to your gift.")
 		return 0
 	}
 	cdata(CDATA_PIETY, CHARA_PLAYER) += modpiety_arg1 / (1 + (gdata(GDATA_AREA) == AREA_SHOW_HOUSE) * 9)
 	return 1
@@ -343,10 +359,16 @@
 	gmode 0
 	pos 0, 0
 	picload exedir + "\\graphic\\bg_altar.bmp", 1
 	pos 0, 0
 	gzoom windoww, windowh - inf_verh, 4, 0, 0, 600, 400, 1
+	gsel BUFFER_BUF
+	gmode 0
+	pos 0, 0
+	picload exedir + "\\graphic\\bg_altar.bmp", 1
+	pos 0, 0
+	gzoom windoww, windowh - inf_verh, 4, 0, 0, 600, 400, 1
 	gsel BUFFER_SCREEN
 	keyrange = 0
 	repeat pagesize
 		p = pagesize * page + cnt
 		if ( p >= listmax ) {
@@ -412,11 +434,11 @@
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 2 ) {
 			bmes lang("「ノロマは死ぬ、ってことにようやく気づいたみたいね」", "--- Ahaha! Looks like you finally realized that slow is going to die! ---"), 155, 125, 205
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 3 ) {
-			bmes lang("「元素は汝の大いなる力となるであろう」", "--- Elements will be your great power ---"), 255, 255, 205
+			bmes lang("「研鑽せよ。元素は大いなる力を汝にもたらす」", "--- Elements will be your great power ---"), 255, 255, 205
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 4 ) {
 			bmes lang("「たらばがに、すき！！！」", "--- Mewmewmew! Coconut crab! ---"), 105, 255, 255
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 5 ) {
@@ -424,11 +446,11 @@
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 6 ) {
 			bmes lang("「け、怪我を治してあげるって言ってんのよ…」", "--- I-I say that I will heal your wounds... ---"), 255, 255, 255
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 7 ) {
-			bmes lang("「僕、活力…与える…」", "--- I give...vitality... ---"), 105, 255, 105
+			bmes lang("「僕、活力…与える…から」", "--- I give...vitality... ---"), 105, 255, 105
 		}
 		if ( inv(INV_ITEM_PARAM1, ci) == 8 ) {
 			bmes lang("「何するにしても資産は有ったほうがええやろ？ウチの出番やん！」", "--- Yeah~! No matter what you do, it's better to have property, right? ---"), 255, 155, 255
 		}
 	}
@@ -449,10 +471,58 @@
 		cs_list s, wx + 80, wy + dy + cnt * 20 - listmax * 20 - 18, 19
 	loop
 	if ( keyrange != 0 ) {
 		cs_bk = cs
 	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 1 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god1.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 2 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god2.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 3 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god3.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 4 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god4.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 5 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god5.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 6 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god6.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 7 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god7.bmp", 1
+		gsel BUFFER_SCREEN
+	}
+	if ( inv(INV_ITEM_PARAM1, ci) == 8 ) {
+		gsel BUFFER_BUF
+		pos wx + 240, wy - 160
+		picload exedir + "\\graphic\\god8.bmp", 1
+		gsel BUFFER_SCREEN
+	}
 	redraw 1
 	await cfg_wait1
 	key_check
 	cursor_check
 	rtval = -1
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/help.hsp ../2.17-borscht/help.hsp
--- ../2.15R-borscht/help.hsp	2023-05-12 09:08:03.912845900 +0800
+++ ../2.17-borscht/help.hsp	2023-05-12 09:05:58.444185700 +0800
@@ -5351,11 +5351,11 @@
 	}
 	if ( mode == MODELIST_QUICK_START ) {
 		repeat 9
 			gdata(STARTING_GDATA_RANK + cnt) = 5000
 		loop
-		gdata(GDATA_VERSION) = int(double("6.15") * 1000)
+		gdata(GDATA_VERSION) = int(double("6.17") * 1000)
 		gdata(STARTING_GDATA_SHORTCUT + 1) = 424
 		gdata(STARTING_GDATA_SHORTCUT + 2) = 300
 		gdata(STARTING_GDATA_SHORTCUT + 3) = 631
 		gdata(GDATA_COUNT_SHOP) = 1000
 		gdata(GDATA_COUNT_SHELTER) = 100
@@ -5417,11 +5417,12 @@
 		gdata(GDATA_FLAG_SUB_MANYTIA_THE_ADVENTURE_MERCHANT) = 3
 		gdata(GDATA_FLAG_ENTHUMESIS_SPAWNED) = 100
 		gdata(GDATA_FLAG_SUB_MONOCHROME_DELIVERY_SERVICE) = 1
 		gdata(GDATA_FLAG_SUB_REGULUS_MAYROON) = 1
 		gdata(GDATA_FLAG_SUB_THE_DISTANT_SEA_OF_STARS) = 3
-		gdata(GDATA_FLAG_GUILD_MAGE) = 1
+		gdata(GDATA_FLAG_GUILD_MAGE) = 0
+		gdata(GDATA_FLAG_GUILD_THIEF) = 0
 		cdata(CDATA_GOLD, CHARA_PLAYER) = 13000000
 		gdata(GDATA_FLAG_TAX_PREPAID_BALANCE) = 100
 		cdata(CDATA_PLATINUM, CHARA_PLAYER) = 99
 		cdata(CDATA_FAME, CHARA_PLAYER) = 132548
 		cdata(CDATA_AP_CURRENT, CHARA_PLAYER) = 1800
@@ -5452,10 +5453,13 @@
 		inv(INV_ITEM_PARAM1, ci) = 8
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_COFFIN_OF_NECROMANCY, -1, -1, 0
 		inv(INV_ITEM_PARAM1, ci) = 9
 		flt
+		itemcreate CHARA_PLAYER, ITEM_ID_LOVE_POTION, -1, -1, 0
+		inv(INV_ITEM_NUM, ci) = 600
+		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_TEA_LEAF, -1, -1, 0
 		inv(INV_ITEM_LEVEL, ci) = 7
 		inv(INV_ITEM_NUM, ci) = 60
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SOYBEAN, -1, -1, 0
@@ -5468,13 +5472,10 @@
 		inv(INV_ITEM_NUM, ci) = 60
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_PANTY, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 60
 		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_JERKY, -1, -1, 0
-		inv(INV_ITEM_LEVEL, ci) = 10
-		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SURVIVABILITY_EXTENDER_Y, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 30
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SURVIVABILITY_EXTENDER_X, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 30
@@ -5502,18 +5503,10 @@
 		inv(INV_ITEM_NUM, ci) = 30
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_M202_SPECIAL, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 30
 		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_ESSENTIAL_OIL, -1, -1, 0
-		inv(INV_ITEM_NUM, ci) = 30
-		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
-		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_GASOLINE, -1, -1, 0
-		inv(INV_ITEM_NUM, ci) = 20
-		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
-		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_JUKE_BOX, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 20
 		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_BLESSED
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SCROLL_WONDER, -1, -1, 0
@@ -5619,10 +5612,22 @@
 		inv(INV_ITEM_NUM, ci) = 2
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_ANCIENT_BOOK, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 10
 		flt
+		itemcreate CHARA_PLAYER, ITEM_ID_ANCIENT_BOOK, -1, -1, 0
+		inv(INV_ITEM_NUM, ci) = 10
+		flt
+		itemcreate CHARA_PLAYER, ITEM_ID_ANCIENT_BOOK, -1, -1, 0
+		inv(INV_ITEM_NUM, ci) = 10
+		flt
+		itemcreate CHARA_PLAYER, ITEM_ID_ANCIENT_BOOK, -1, -1, 0
+		inv(INV_ITEM_NUM, ci) = 10
+		flt
+		itemcreate CHARA_PLAYER, ITEM_ID_ANCIENT_BOOK, -1, -1, 0
+		inv(INV_ITEM_NUM, ci) = 10
+		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SMALL_MEDAL, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 100
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SCROLL_SUPERIOR_MATERIAL, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 100
@@ -5636,22 +5641,10 @@
 		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_DD_CEMETERY_KEY, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 2
 		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_MATERIAL_KIT, -1, -1, 0
-		inv(INV_ITEM_NUM, ci) = 20
-		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_ETHER
-		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_MATERIAL_KIT, -1, -1, 0
-		inv(INV_ITEM_NUM, ci) = 20
-		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_ADAMANTIUM
-		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_MATERIAL_KIT, -1, -1, 0
-		inv(INV_ITEM_NUM, ci) = 20
-		inv(INV_ITEM_MATERIAL, ci) = ITEM_MATERIAL_DRAGON
-		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_MANA_CRYSTAL, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 100
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_COFFIN, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 100
@@ -5761,13 +5754,10 @@
 		itemcreate CHARA_PLAYER, ITEM_ID_STOMAFILLIA, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 10
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_POTION_MUTATION, -1, -1, 0
 		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_LOVE_POTION, -1, -1, 0
-		inv(INV_ITEM_NUM, ci) = 50
-		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_ROD_ALCHEMY, -1, -1, 0
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_KITTY_BANK, -1, -1, 0
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_MOON_GATE, -1, -1, 0
@@ -5847,16 +5837,10 @@
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_DEED_OF_MAGIC_LOCOMOTIVE, -1, -1, 0
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_DEED_OF_LAND_BATTLESHIP, -1, -1, 0
 		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_AWESOME_SWIMWEAR, -1, -1, 0
-		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_WAR_SUIT, -1, -1, 0
-		flt
-		itemcreate CHARA_PLAYER, ITEM_ID_DANGER_SWIMWEAR, -1, -1, 0
-		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SPELLBOOK_HOLY_RAIN, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 10
 		flt
 		itemcreate CHARA_PLAYER, ITEM_ID_SCROLL_HOLY_LIGHT, -1, -1, 0
 		inv(INV_ITEM_NUM, ci) = 10
@@ -5958,11 +5942,11 @@
 		gdata(GDATA_AREA) = AREA_HOME
 		gdata(GDATA_HOME_LEVEL) = 0
 		gosub *setArea
 		gdata(GDATA_LEVEL) = 1
 		gdata(GDATA_LEVEL_START_ON) = 4
-		gdata(GDATA_VERSION) = int(double("6.15") * 1000)
+		gdata(GDATA_VERSION) = int(double("6.17") * 1000)
 		gdata(GDATA_WEATHER) = WEATHER_RAIN, 6
 		repeat 20
 			gdata(STARTING_GDATA_RANK + cnt) = 10000
 		loop
 		gosub *adv_init
@@ -6395,21 +6379,23 @@
 	if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
 		if ( rnd(3) == 0 ) {
 			gdata(GDATA_SLEEP)++
 		}
 		if ( rnd(15) == 0 ) {
-			if ( mode == MODELIST_MAIN ) {
-				if ( gdata(GDATA_FLAG_SLEEP_PREVENTION) <= 0 ) {
-					txt lang("仮眠をとった。", "You take a nap.")
-					gdata(GDATA_SLEEP) -= 3
-					if ( gdata(GDATA_SLEEP) < 0 ) {
-						gdata(GDATA_SLEEP) = 0
+			if ( gdata(GDATA_SLEEP) >= 13 ) {
+				if ( mode == MODELIST_MAIN ) {
+					if ( gdata(GDATA_FLAG_SLEEP_PREVENTION) <= 0 ) {
+						txt lang("仮眠をとった。", "You take a nap.")
+						gdata(GDATA_SLEEP) -= 3
+						if ( gdata(GDATA_SLEEP) < 0 ) {
+							gdata(GDATA_SLEEP) = 0
+						}
+					}
+					if ( gdata(GDATA_FLAG_SLEEP_PREVENTION) > 0 ) {
+						txt lang("眠気を我慢した。", "You put up with sleepiness.")
+						gdata(GDATA_FLAG_SLEEP_PREVENTION)--
 					}
-				}
-				if ( gdata(GDATA_FLAG_SLEEP_PREVENTION) > 0 ) {
-					txt lang("眠気を我慢した。", "You put up with sleepiness.")
-					gdata(GDATA_FLAG_SLEEP_PREVENTION)--
 				}
 			}
 		}
 	}
 	else {
@@ -6419,11 +6405,11 @@
 	}
 	if ( gdata(GDATA_HOUR) == 6 ) {
 		txtef COLOR_YELLOW
 		txt lang("夜が明けた。", "Day breaks.")
 	}
-	if ( gdata(GDATA_SLEEP) >= 15 ) {
+	if ( gdata(GDATA_SLEEP) >= 13 ) {
 		if ( cfg_extrahelp ) {
 			if ( gdata(STARTING_GDATA_HELP + 9) == 0 ) {
 				if ( mode == MODELIST_MAIN ) {
 					if ( cdata(CDATA_ACTION_PERIOD, CHARA_PLAYER) == 0 ) {
 						gdata(STARTING_GDATA_HELP + 9) = 1
@@ -6482,10 +6468,44 @@
 				gdata(GDATA_GUEST)++
 			}
 		}
 		txtef COLOR_YELLOW
 		txt lang("一日が終わり、日付が変わった。", "A day passes and a new day begins.")
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) >= 1000 ) {
+			cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER)++
+		}
+		if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) >= 1000 ) {
+			cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER)++
+		}
+		snd SOUNDLIST_WRITE1
+		txtef COLOR_GREEN
+		txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+		repeat 10
+			randomize gdata(GDATA_DAY) + gdata(GDATA_MONTH) + gdata(GDATA_YEAR) + cnt
+			daily = rnd(8) + 1
+			if ( daily != cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 ) {
+				cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) = daily
+				break
+			}
+		loop
+		repeat 10
+			randomize gdata(GDATA_DAY) + gdata(GDATA_MONTH) * 2 + gdata(GDATA_YEAR) * 2 + cnt
+			dailyf = rnd(8) + 1
+			if ( dailyf != cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 ) {
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) = dailyf
+				break
+			}
+		loop
+		randomize
+		if ( cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER) >= cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) ) {
+			cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) += 10
+			gosub *shop_end
+		}
+		if ( cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) <= 0 | cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) >= 1010 ) {
+			cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) = 10
+			cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER) = 0
+		}
 		repeat 2
 			if ( gdata(GDATA_FLAG_STUDY_BONUS_KIND) == 0 ) {
 				if ( gdata(GDATA_FLAG_STUDY_BONUS_TRAINING_EXP) >= 15000 ) {
 					gdata(GDATA_FLAG_STUDY_BONUS_KIND) = 1
 					break
@@ -7431,10 +7451,18 @@
 	hear = 0
 	r1 = cc
 	gosub *calcCondition
 	if ( cc == CHARA_PLAYER ) {
 		chatturn = 10
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 8 ) {
+			if ( cdata(CDATA_SP, CHARA_PLAYER) < 50 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+			}
+		}
 		if ( gdata(GDATA_SLEEP_GENE) != 0 ) {
 			if ( gdata(GDATA_SLEEP_GENE) < 10000 ) {
 				gdata(GDATA_SLEEP_GENE) += 10000
 				gdata(GDATA_ROW_ACT) = ACTION_SLEEP
 				gosub *generalAct
@@ -7800,11 +7828,11 @@
 		goto *pc_turn_init_WHILE1
 	}
 
 *pc_turn_init_WEND1
 	if ( dbg_titleinfo ) {
-		title "ElonaPlus 2.15R" + " ver " + "6.15" + " " + exedir + " Seed: " + randseed + "  Loop:" + looplev + " SubLoop:" + sublev + " x:" + cdata(CDATA_X, CHARA_PLAYER) + " y:" + cdata(CDATA_Y, CHARA_PLAYER) + " ev:" + evnum + " q:" + gdata(GDATA_QUEST) + " tile:" + map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), MAP_TILE_ID) + " unpc:" + usernpcmax + "/" + gdata(GDATA_USERNPC_COUNT)
+		title "ElonaPlus 2.17" + " ver " + "6.17" + " " + exedir + " Seed: " + randseed + "  Loop:" + looplev + " SubLoop:" + sublev + " x:" + cdata(CDATA_X, CHARA_PLAYER) + " y:" + cdata(CDATA_Y, CHARA_PLAYER) + " ev:" + evnum + " q:" + gdata(GDATA_QUEST) + " tile:" + map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), MAP_TILE_ID) + " unpc:" + usernpcmax + "/" + gdata(GDATA_USERNPC_COUNT)
 	}
 	if ( trait(TRAIT_ETHER_ADDICTED_POTION) != 0 ) {
 		if ( rnd(5) == 0 ) {
 			inv_getheader 0
 			ci = rnd(invrange) + invhead
@@ -11312,10 +11340,22 @@
 		if ( adata(ADATA_BOSS, gdata(GDATA_AREA)) == (-1) ) {
 			goto *event_SWEND1
 		}
 		music = MUSICLIST_MCVICTORY
 		gosub *music_play
+		if ( gdata(GDATA_FLAG_SUB_GUILD_FIGHTER) == 1 | gdata(GDATA_FLAG_SUB_FIGHTER_1) == 1 ) {
+			if ( adata(ADATA_MIN_LEVEL, gdata(GDATA_AREA)) >= gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) ) {
+				if ( gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL) + 20 == adata(ADATA_TYPE, gdata(GDATA_AREA)) ) {
+					if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 ) {
+						gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA)--
+						snd SOUNDLIST_WRITE1
+						txtef COLOR_GREEN
+						txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					}
+				}
+			}
+		}
 		snd SOUNDLIST_COMPLETE1
 		nkane = limit(gdata(GDATA_LEVEL), 1, 400)
 		flt calcobjlv(), calcfixlv()
 		flttypemajor = FILTER_ITEM_SPELLBOOK
 		itemcreate -1, ITEM_ID_DUMMY, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/init.hsp ../2.17-borscht/init.hsp
--- ../2.15R-borscht/init.hsp	2023-05-12 09:08:03.950744400 +0800
+++ ../2.17-borscht/init.hsp	2023-05-12 09:05:58.568883600 +0800
@@ -1466,13 +1466,13 @@
 		return
 	}
 	return
 
 *sRefDefine
-	dim sdataref, 7, 848
-	sdim skillname, 16, 848
-	sdim skilldesc, 40, 848
+	dim sdataref, 7, 852
+	sdim skillname, 16, 852
+	sdim skilldesc, 40, 852
 	sdim skillencdesc, 40, 600
 	sdataref(SKILL_DATAREF_USE, SKILL_ATTR_LIFE) = SKILL_NONE, SKILL_TYPE_SP, 0, TARGET_TYPE_NONE, 0
 	skillname(SKILL_ATTR_LIFE) = lang("生命力", "Life")
 	skilldesc(SKILL_ATTR_LIFE) = lang("", "")
 	if ( 2 < 600 ) {
@@ -1838,13 +1838,13 @@
 	if ( 187 < 600 ) {
 		skillencdesc(SKILL_NORMAL_GREATER_EVASION) = lang("見切りの腕をあげる", "")
 	}
 	sdataref(SKILL_DATAREF_USE, SKILL_NORMAL_ANATOMY) = SKILL_ATTR_LER, SKILL_TYPE_SP, 0, TARGET_TYPE_NONE, 0
 	skillname(SKILL_NORMAL_ANATOMY) = lang("解剖学", "Anatomy")
-	skilldesc(SKILL_NORMAL_ANATOMY) = lang("死体を残しやすくする", "Gives you a better chance of finding dead bodies.")
+	skilldesc(SKILL_NORMAL_ANATOMY) = lang("死体などを残しやすくする", "Gives you a better chance of finding dead bodies.")
 	if ( 161 < 600 ) {
-		skillencdesc(SKILL_NORMAL_ANATOMY) = lang("死体を残しやすくする", "grants you knowledge of anatomy.")
+		skillencdesc(SKILL_NORMAL_ANATOMY) = lang("死体などを残しやすくする", "grants you knowledge of anatomy.")
 	}
 	sdataref(SKILL_DATAREF_USE, SKILL_NORMAL_LITERACY) = SKILL_ATTR_LER, SKILL_TYPE_SP, 0, TARGET_TYPE_NONE, 0
 	skillname(SKILL_NORMAL_LITERACY) = lang("読書", "Literacy")
 	skilldesc(SKILL_NORMAL_LITERACY) = lang("難解な本の解読を可能にする", "Allows you to read difficult books.")
 	if ( 150 < 600 ) {
@@ -2562,15 +2562,15 @@
 	skillname(SKILL_SPACT_LULWYS_TRICK) = lang("ルルウィの憑依", "Lulwy's Trick")
 	skilldesc(SKILL_SPACT_LULWYS_TRICK) = lang("", "")
 	if ( 625 < 600 ) {
 		skillencdesc(SKILL_SPACT_LULWYS_TRICK) = lang("", "")
 	}
-	sdataref(SKILL_DATAREF_USE, MAX_SKILL) = SKILL_ATTR_WIL, SKILL_TYPE_SP, 5, TARGET_TYPE_SELF_ONLY, 500
-	skillname(MAX_SKILL) = lang("ポージング", "Posing")
-	skilldesc(MAX_SKILL) = lang("ｹﾞｰｼﾞ15％増加/ｶﾞｰﾄﾞﾌﾞﾚｲｸ15％減少", "gauge15gain/GBgauge15reduce")
+	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_POSING) = SKILL_ATTR_WIL, SKILL_TYPE_SP, 5, TARGET_TYPE_SELF_ONLY, 500
+	skillname(SKILL_SPACT_POSING) = lang("ポージング", "Posing")
+	skilldesc(SKILL_SPACT_POSING) = lang("ｹﾞｰｼﾞ15％増加/ｶﾞｰﾄﾞﾌﾞﾚｲｸ15％減少", "gauge15gain/GBgauge15reduce")
 	if ( 846 < 600 ) {
-		skillencdesc(MAX_SKILL) = lang("", "")
+		skillencdesc(SKILL_SPACT_POSING) = lang("", "")
 	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_HARVEST_MANA) = SKILL_ATTR_MAG, SKILL_TYPE_SP, 15, TARGET_TYPE_SELF_ONLY, 700
 	skillname(SKILL_SPACT_HARVEST_MANA) = lang("マナ回復", "Harvest Mana")
 	skilldesc(SKILL_SPACT_HARVEST_MANA) = lang("マナ回復", "Restore MP")
 	if ( 621 < 600 ) {
@@ -2586,15 +2586,15 @@
 	skillname(SKILL_SPACT_VORACITY_FANG) = lang("貪食の牙", "Voracity Fang")
 	skilldesc(SKILL_SPACT_VORACITY_FANG) = lang("体力吸収・満腹時無効", "Drain HP")
 	if ( 748 < 600 ) {
 		skillencdesc(SKILL_SPACT_VORACITY_FANG) = lang("", "")
 	}
-	sdataref(SKILL_DATAREF_USE, 847) = SKILL_ATTR_WIL, SKILL_TYPE_SP, 8, TARGET_TYPE_ENEMY, 0
-	skillname(847) = lang("シャークトレード", "Shark Trade")
-	skilldesc(847) = lang("アイテムを押し付けゲージ20％奪う", "Drain gauge20")
+	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_SHARK_TRADE) = SKILL_ATTR_WIL, SKILL_TYPE_SP, 8, TARGET_TYPE_ENEMY, 0
+	skillname(SKILL_SPACT_SHARK_TRADE) = lang("シャークトレード", "Shark Trade")
+	skilldesc(SKILL_SPACT_SHARK_TRADE) = lang("アイテムを押し付けゲージ20％奪う", "Drain gauge20")
 	if ( 847 < 600 ) {
-		skillencdesc(847) = lang("", "")
+		skillencdesc(SKILL_SPACT_SHARK_TRADE) = lang("", "")
 	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_MEMORY_POISON) = SKILL_ATTR_CON, SKILL_TYPE_HAND, 150, TARGET_TYPE_ENEMY, 0
 	skillname(SKILL_SPACT_MEMORY_POISON) = lang("侵食の毒牙", "Memory Poison")
 	skilldesc(SKILL_SPACT_MEMORY_POISON) = lang("毒属性/能力一時減少", "Decrease ability temporarily")
 	if ( 758 < 600 ) {
@@ -2820,10 +2820,22 @@
 	skillname(SKILL_SPACT_INSTANT_SUTURE) = lang("神速縫合", "Instant Suture")
 	skilldesc(SKILL_SPACT_INSTANT_SUTURE) = lang("敵を束縛/味方は出血半減", "Bind enemy/Halved bleeding")
 	if ( 845 < 600 ) {
 		skillencdesc(SKILL_SPACT_INSTANT_SUTURE) = lang("", "")
 	}
+	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_LIMIT_POWER) = SKILL_ATTR_MAG, SKILL_TYPE_SP, 10, TARGET_TYPE_DIRECTION, 0
+	skillname(SKILL_SPACT_LIMIT_POWER) = lang("<能力の制限>", "<Limit Power>")
+	skilldesc(SKILL_SPACT_LIMIT_POWER) = lang("主能力を一時的に制限", "Temporarily limiter of main status")
+	if ( 850 < 600 ) {
+		skillencdesc(SKILL_SPACT_LIMIT_POWER) = lang("", "")
+	}
+	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_LIMITER_VANISH) = SKILL_ATTR_MAG, SKILL_TYPE_SP, 5, TARGET_TYPE_DIRECTION, 0
+	skillname(SKILL_SPACT_LIMITER_VANISH) = lang("<リミッター解除>", "<Limiter Vanish>")
+	skilldesc(SKILL_SPACT_LIMITER_VANISH) = lang("ゲージ50％以上時に制限解除と衝撃波", "Limiter lift and shock wave/gauge50")
+	if ( 851 < 600 ) {
+		skillencdesc(SKILL_SPACT_LIMITER_VANISH) = lang("", "")
+	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_BLADE_STRINGS) = SKILL_ATTR_DEX, SKILL_TYPE_SP, 10, TARGET_TYPE_DIRECTION, 0
 	skillname(SKILL_SPACT_BLADE_STRINGS) = lang("ブレードストリングス", "Blade Strings")
 	skilldesc(SKILL_SPACT_BLADE_STRINGS) = lang("戦術器用依存攻撃/トラップ設置", "Cutting attack/Trap installation")
 	if ( 769 < 600 ) {
 		skillencdesc(SKILL_SPACT_BLADE_STRINGS) = lang("", "")
@@ -3042,10 +3054,16 @@
 	skillname(SKILL_SPACT_PIERCING_ZERO_SHOOT) = lang("零の間撃・突型", "Zero shoot2")
 	skilldesc(SKILL_SPACT_PIERCING_ZERO_SHOOT) = lang("近いほど貫通率上昇/ゲージ100％消費", "Hitting the target")
 	if ( 717 < 600 ) {
 		skillencdesc(SKILL_SPACT_PIERCING_ZERO_SHOOT) = lang("", "")
 	}
+	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_HYPER_PLUG_BURST) = SKILL_ATTR_PER, SKILL_TYPE_SP, 30, 2000 + 10, 0
+	skillname(SKILL_SPACT_HYPER_PLUG_BURST) = lang("爆栓連発", "Hyper Plug Burst")
+	skilldesc(SKILL_SPACT_HYPER_PLUG_BURST) = lang("ﾎﾟｰｼｮﾏﾝ充填/ゲージ100％消費", "charge the potioman")
+	if ( 849 < 600 ) {
+		skillencdesc(SKILL_SPACT_HYPER_PLUG_BURST) = lang("", "")
+	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_IMPACT_GUNFIRE) = SKILL_ATTR_PER, SKILL_TYPE_SP, 30, 2000 + 10, 0
 	skillname(SKILL_SPACT_IMPACT_GUNFIRE) = lang("重衝撃断動弾", "Impact Gunfire")
 	skilldesc(SKILL_SPACT_IMPACT_GUNFIRE) = lang("衝撃で敵転倒/ゲージ100％消費", "Invert target")
 	if ( 796 < 600 ) {
 		skillencdesc(SKILL_SPACT_IMPACT_GUNFIRE) = lang("", "")
@@ -3402,10 +3420,16 @@
 	skillname(SKILL_SPACT_HAZARD_RECIPE) = lang("ハザードレシピ", "Hazard Recipe")
 	skilldesc(SKILL_SPACT_HAZARD_RECIPE) = lang("食品を化学兵器に作り変える", "Reshape food to chemical weapon")
 	if ( 814 < 600 ) {
 		skillencdesc(SKILL_SPACT_HAZARD_RECIPE) = lang("", "")
 	}
+	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_CUSTOM_CHANGE) = SKILL_ATTR_DEX, SKILL_TYPE_SP, 5, TARGET_TYPE_SELF_ONLY, 0
+	skillname(SKILL_SPACT_CUSTOM_CHANGE) = lang("カスタムチェンジ", "Custom Change")
+	skilldesc(SKILL_SPACT_CUSTOM_CHANGE) = lang("パーツ構成を変えて性能を変化", "Change the performance by changing the parts")
+	if ( 848 < 600 ) {
+		skillencdesc(SKILL_SPACT_CUSTOM_CHANGE) = lang("", "")
+	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_DUPLICANE) = SKILL_ATTR_MAG, SKILL_TYPE_SP, 1, TARGET_TYPE_SELF_ONLY, 0
 	skillname(SKILL_SPACT_DUPLICANE) = lang("デュプリケイン", "Dupli-Cane")
 	skilldesc(SKILL_SPACT_DUPLICANE) = lang("攻撃杖の回数減無効/威力減/Sp3消費", "Use rod without reducing the remaining number.")
 	if ( 756 < 600 ) {
 		skillencdesc(SKILL_SPACT_DUPLICANE) = lang("", "")
@@ -3566,11 +3590,11 @@
 	if ( 742 < 600 ) {
 		skillencdesc(SKILL_SPACT_BODY_BLOW) = lang("", "")
 	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_KNOCKOUT) = SKILL_ATTR_DEX, SKILL_TYPE_SP, 5, TARGET_TYPE_DIRECTION, 0
 	skillname(SKILL_SPACT_KNOCKOUT) = lang("ノックアウト攻撃", "Knockout")
-	skilldesc(SKILL_SPACT_KNOCKOUT) = lang("威力減通常近接攻撃で気絶を狙う", "Attack to stun")
+	skilldesc(SKILL_SPACT_KNOCKOUT) = lang("命中減通常近接攻撃で気絶を狙う", "Attack to stun")
 	if ( 745 < 600 ) {
 		skillencdesc(SKILL_SPACT_KNOCKOUT) = lang("", "")
 	}
 	sdataref(SKILL_DATAREF_USE, SKILL_SPACT_STRUCK_OUT) = SKILL_ATTR_DEX, SKILL_TYPE_SP, 15, 2000 + 6, 500
 	skillname(SKILL_SPACT_STRUCK_OUT) = lang("ストラックアウト", "Struck Out")
@@ -6337,10 +6361,11 @@
 	sndload folder + "semi5.wav", SOUNDLIST_SEMI5
 	sndload folder + "crash14.wav", SOUNDLIST_CRASH14
 	sndload folder + "whistle00.wav", SOUNDLIST_WHISTLE00
 	sndload folder + "gun10.wav", SOUNDLIST_GUN10
 	sndload folder + "chandler23.wav", SOUNDLIST_CHANDLER23
+	sndload folder + "hawk1.wav", SOUNDLIST_HAWK1
 	folder = exedir + "user\\sound\\"
 	sndload folder + "se0.wav", SOUNDLIST_USER_SE00
 	sndload folder + "se1.wav", SOUNDLIST_USER_SE01
 	sndload folder + "se2.wav", SOUNDLIST_USER_SE02
 	sndload folder + "se3.wav", SOUNDLIST_USER_SE03
@@ -8333,10 +8358,16 @@
 	}
 	if ( en ) {
 		_dengon = "none", "Cooperation", "Invitation", "Confession", "Cheering", "Contempt"
 	}
 	if ( jp ) {
+		_nefiatype = "洞窟", "塔", "森", "砦", "巣穴", "霊園", "鉱山", "湖"
+	}
+	if ( en ) {
+		_nefiatype = "Cave", "Tower", "Forest", "Fort", "Nest", "Cemetery", "Mine", "Lake"
+	}
+	if ( jp ) {
 		_seikaku = "未設定", "陽気", "慎重", "献身的", "豪快", "自信家", "謙虚", "寡黙", "勤勉", "純真", "繊細", "温厚", "情熱的", "意地悪", "スケベ", "皮肉屋", "冷徹", "好戦的", "腹黒", "偏執的", "頑固", "守銭奴", "怠惰", "アホ", "能天気", "気分屋", "卑怯", "高慢", "臆病", "陰鬱", "猟奇的", "お茶目", "内気", "神経質", "下品", "天邪鬼", "気丈"
 	}
 	if ( en ) {
 		_seikaku = "none", "Cheerful", "Carefully", "Devoted", "Lively", "Confident", "Humility", "Quiet", "Diligence", "Innocent", "Delicate", "Gentle", "Passionate", "Evil", "Lewd", "Cynic", "Ruthless", "Warlike", "Corrupt", "Paranodic", "Stubborn", "Miser", "Lazy", "Stupid", "Carefree", "Whimsical", "Despicable", "Arrogance", "Cowardly", "Gloomy", "Bizarre", "Playful", "Shy", "Nervous", "Vulgar", "Perversity", "Courageous"
 	}
@@ -10119,10 +10150,81 @@
 			s(cnt) = lang("レイオス", "<Redos>")
 		}
 	loop
 	return
 
+#deffunc txtsetcustom int txtsetcustom_arg1
+	repeat 7
+		i = cnt
+		p(cnt) = p(i)
+		p(i) = cnt
+	loop
+	repeat txtsetcustom_arg1
+		if ( p(cnt) == 0 ) {
+			s(cnt) = lang("やっぱりやめる", "Cancel")
+		}
+		if ( p(cnt) == 1 ) {
+			s(cnt) = lang("スピニングフットに変更", "Change Spinning Foot")
+		}
+		if ( p(cnt) == 2 ) {
+			s(cnt) = lang("マイティアームに変更", "Change Mighty Arm")
+		}
+		if ( p(cnt) == 3 ) {
+			s(cnt) = lang("デュアルコアに変更", "Change Dual Core")
+		}
+		if ( p(cnt) == 4 ) {
+			s(cnt) = lang("ラピッドサーバーに変更", "Change Rapid Server")
+		}
+		if ( p(cnt) == 5 ) {
+			s(cnt) = lang("スナイプヘッドに変更", "Change Snipe Head")
+		}
+		if ( p(cnt) == 6 ) {
+			s(cnt) = lang("デシーヴバレルに変更", "Change Deceive Barrel")
+		}
+	loop
+	return
+
+#deffunc txtsetlimitp int txtsetlimitp_arg1
+	repeat 10
+		i = cnt
+		p(cnt) = p(i)
+		p(i) = cnt
+	loop
+	repeat txtsetlimitp_arg1
+		if ( p(cnt) == 0 ) {
+			s(cnt) = lang("やっぱりやめる", "Cancel")
+		}
+		if ( p(cnt) == 1 ) {
+			s(cnt) = lang("制限レベル１", "Limiter LV.1")
+		}
+		if ( p(cnt) == 2 ) {
+			s(cnt) = lang("制限レベル２", "Limiter LV.2")
+		}
+		if ( p(cnt) == 3 ) {
+			s(cnt) = lang("制限レベル３", "Limiter LV.3")
+		}
+		if ( p(cnt) == 4 ) {
+			s(cnt) = lang("制限レベル４", "Limiter LV.4")
+		}
+		if ( p(cnt) == 5 ) {
+			s(cnt) = lang("制限レベル５", "Limiter LV.5")
+		}
+		if ( p(cnt) == 6 ) {
+			s(cnt) = lang("制限レベル６", "Limiter LV.6")
+		}
+		if ( p(cnt) == 7 ) {
+			s(cnt) = lang("制限レベル７", "Limiter LV.7")
+		}
+		if ( p(cnt) == 8 ) {
+			s(cnt) = lang("制限レベル８", "Limiter LV.8")
+		}
+		if ( p(cnt) == 9 ) {
+			s(cnt) = lang("制限レベル９", "Limiter LV.9")
+		}
+	loop
+	return
+
 #deffunc txtsetnecrom int txtsetnecrom_arg1
 	repeat 5
 		i = cnt
 		p(cnt) = p(i)
 		p(i) = cnt
@@ -11294,17 +11396,17 @@
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_CYBER_DOME ) {
 		s = lang("アクリ・テオラ", "Cyber Dome"), lang("何やら奇妙な建物がある。", "You see a very strange building.")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_BEAST_FORT ) {
-		s = lang("混沌の城《獣》", "Fort of Chaos <Beast>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は80階階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 80) ")
+		s = lang("混沌の城《獣》", "Fort of Chaos <Beast>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は80階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 80) ")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_MACHINE_FORT ) {
-		s = lang("混沌の城《機甲》", "Fort of Chaos <Machine>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は80階階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 80) ")
+		s = lang("混沌の城《機甲》", "Fort of Chaos <Machine>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は80階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 80) ")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_COLLAPSED_FORT ) {
-		s = lang("混沌の城《奇形》", "Fort of Chaos <Collapsed>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は80階階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 80) ")
+		s = lang("混沌の城《奇形》", "Fort of Chaos <Collapsed>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は80階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 80) ")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_PET_ARENA ) {
 		s = lang("コロシアム", "Pet Arena")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_MUSEUM ) {
@@ -11532,17 +11634,17 @@
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_DOJO ) {
 		s = lang("道場", "Doujyou")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_DESTRUCTION_FORT ) {
-		s = lang("混沌の城《破壊》", "Fort of Chaos <Destruction>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は200階階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 200) ")
+		s = lang("混沌の城《破壊》", "Fort of Chaos <Destruction>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は200階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 200) ")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_WEAPONS_FORT ) {
-		s = lang("混沌の城《機皇》", "Fort of Chaos <Weapons>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は200階階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 200) ")
+		s = lang("混沌の城《機皇》", "Fort of Chaos <Weapons>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は200階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 200) ")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_HELL_FORT ) {
-		s = lang("混沌の城《地獄》", "Fort of Chaos <Hell>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は200階階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 200) ")
+		s = lang("混沌の城《地獄》", "Fort of Chaos <Hell>"), lang("不気味な城がある。絶対に入ってはいけない予感がする。(危険度は200階相当)", "You see an unearthly fort. Your inner voice wanrs you to not go there. (Approximate danger level: 200) ")
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_QUEST ) {
 		if ( gdata(GDATA_QUEST) == QUEST_TYPE_HUNT ) {
 			s = lang("街近辺", "The outskirts")
 		}
@@ -11551,18 +11653,18 @@
 		}
 	}
 	if ( adata(ADATA_ID, mapname_mapid) == AREA_RANDOM_DUNGEON ) {
 		s = mapnamerd(adata(ADATA_NAME, mapname_mapid), limitmax(adata(ADATA_MIN_LEVEL, mapname_mapid) / 5, length2(mapnamerd) - 1))
 		if ( adata(ADATA_TYPE, mapname_mapid) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
-			s += lang("洞窟", "Dungeon")
-		}
-		if ( adata(ADATA_TYPE, mapname_mapid) == MAP_TYPE_FOREST ) {
-			s += lang("森", "Forest")
+			s += lang("洞窟", "Cave")
 		}
 		if ( adata(ADATA_TYPE, mapname_mapid) == MAP_TYPE_TOWER ) {
 			s += lang("塔", "Tower")
 		}
+		if ( adata(ADATA_TYPE, mapname_mapid) == MAP_TYPE_FOREST ) {
+			s += lang("森", "Forest")
+		}
 		if ( adata(ADATA_TYPE, mapname_mapid) == MAP_TYPE_FORT ) {
 			s += lang("砦", "Fort")
 		}
 		if ( adata(ADATA_TYPE, mapname_mapid) == MAP_TYPE_NEST ) {
 			s += lang("巣穴", "Nest")
@@ -11586,16 +11688,16 @@
 		}
 		if ( s(1) != "" ) {
 			return s(1)
 		}
 		if ( adata(ADATA_TYPE, mapname_mapid) >= (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
-			return lang(s + "への入り口がある(入り口の危険度は" + adata(ADATA_MIN_LEVEL, mapname_mapid) + "階階相当)。", "You see an entrance leading to " + s + ".(Approximate danger level: " + adata(ADATA_MIN_LEVEL, mapname_mapid) + ") ")
+			return lang(s + "への入り口がある(入り口の危険度は" + adata(ADATA_MIN_LEVEL, mapname_mapid) + "階相当)。", "You see an entrance leading to " + s + ".(Approximate danger level: " + adata(ADATA_MIN_LEVEL, mapname_mapid) + ") ")
 		}
 		return lang(s + "がある。", "You see " + s + ".")
 	}
 	return s
-	goto *label_0385
+	goto *label_0391
 
 #defcfunc txtbuilding int txtbuilding_arg1, int txtbuilding_arg2
 	locvar_txtbuilding_p = bddata(0, txtbuilding_arg1, txtbuilding_arg2)
 	locvar_txtbuilding_s = lang(bdrefn(locvar_txtbuilding_p) + "がある。", "You see " + bdrefn(locvar_txtbuilding_p))
 	return locvar_txtbuilding_s
@@ -17060,14 +17162,118 @@
 		buff += s0
 	}
 	noteadd ""
 	return
 
+*label_0439
+	if ( val == 0 ) {
+		noteadd ""
+		noteadd lang("@QD[デイリークエスト]", "@QD[Daily Quest]")
+	}
+	noteadd lang("@QD<現在：" + cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER) + " / 目標ポイント：" + cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) + ">", "@QD<Now " + cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER) + " / RewardGet " + cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) + ">")
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) >= 1000 ) {
+		s3 = lang("[達成]", "[Done]")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 1 ) {
+		s3 = lang("・何か飲み物を飲もう。", "I will drink something.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 2 ) {
+		s3 = lang("・ワールドマップを歩こう。", "I will walk on the world map.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 3 ) {
+		s3 = lang("・誰かと会話しよう。", "I wll have a conversation with someone.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 4 ) {
+		s3 = lang("・高レベルの相手を倒そう。", "I will defeat high level enemy.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 5 ) {
+		s3 = lang("・誰かに自分の気持ちを伝えよう。", "I will tell someone how I feel.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 6 ) {
+		s3 = lang("・ランダムネフィアを訪れよう。", "I will visit Random Nefia.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) \ 1000 == 7 ) {
+		s3 = lang("・野外を訪れよう。", "I will visit Wilderness.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 8 ) {
+		s3 = lang("・軽疲労になるまで運動しよう。", "I will exercise until I feel lightly tired.")
+		talk_conv s3, 40 - en * 4
+		buff += s3
+	}
+	noteadd ""
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) >= 1000 ) {
+		s4 = lang("[達成]", "[Done]")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 1 ) {
+		s4 = lang("・肉を食べよう。", "I will eat a meat.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 2 ) {
+		s4 = lang("・卵を食べよう。", "I will eat an egg.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 3 ) {
+		s4 = lang("・野菜を食べよう。", "I will eat a vegetable.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 4 ) {
+		s4 = lang("・果物を食べよう。", "I will eat a fruit.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 5 ) {
+		s4 = lang("・パンを食べよう。", "I will eat a bread.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 6 ) {
+		s4 = lang("・木の実を食べよう。", "I will eat a nut.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 7 ) {
+		s4 = lang("・魚介を食べよう。", "I will eat a seafood.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) \ 1000 == 8 ) {
+		s4 = lang("・麺を食べよう。", "I will eat a noodle.")
+		talk_conv s4, 40 - en * 4
+		buff += s4
+	}
+	noteadd ""
+	s5 = lang("・21：00〜23：59に就寝しよう。", "I will go to sleep between 21:00 and 23:59.")
+	talk_conv s5, 40 - en * 4
+	buff += s5
+	noteadd ""
+	return
+
 *quest_info2
 	if ( val == 0 ) {
 		noteadd ""
-		noteadd lang("@QM[サブクエスト]", "@QM[Sub Quest]")
+		noteadd lang("@QS[サブクエスト]", "@QS[Sub Quest]")
 	}
 	p = 0
 	if ( gdata(GDATA_FLAG_SUB_SLIME) != 0 ) {
 		s = lang("ぬいぐるみを守れ！ 6階相当", "Putit attacks Lv6")
 		p = gdata(GDATA_FLAG_SUB_SLIME)
@@ -17551,11 +17757,11 @@
 			}
 		}
 	}
 	if ( val == 0 ) {
 		if ( p == 1 ) {
-			s1 = lang("盗賊ギルドに加入するには、税金を4ヶ月以上滞納した状態で、ダルフィのギルドの番人に話しかける必要がある。", "To join the Thieves Guild, I need to not pay tax for 4 months, that means I'll be a criminal for sure.")
+			s1 = lang("盗賊ギルドに加入するには、カルマを-100にした状態で、ダルフィのギルドの番人に話しかける必要がある。", "To join the Thieves Guild, I need to drop karma at -100, that means I'll be a criminal for sure.")
 			talk_conv s1, 40 - en * 4
 			buff += "(" + s + ")\n" + s1
 			noteadd ""
 		}
 	}
@@ -17569,11 +17775,11 @@
 			}
 		}
 	}
 	if ( val == 0 ) {
 		if ( p == 1 ) {
-			s1 = lang("戦士ギルドに加入するには、" + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + "をあと" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "匹討伐してから、カプールのギルドの番人に話しかける必要がある。", "To join the Fighters Guild, I need to slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " more " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + " and talk to the guild guard in Port Kapul.")
+			s1 = lang("戦士ギルドに加入するには、" + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "階相当以上の" + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + "のランダムネフィアを" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "個制覇してから、カプールのギルドの番人に話しかける必要がある。", "To join the Fighters Guild, I need to conquer " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + " random nefia more " + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "Lv and talk to the guild guard in Port Kapul.")
 			talk_conv s1, 40 - en * 4
 			buff += "(" + s + ")\n" + s1
 			noteadd ""
 		}
 	}
@@ -17605,11 +17811,11 @@
 			}
 		}
 	}
 	if ( val == 0 ) {
 		if ( p == 1 ) {
-			s1 = lang("戦士ギルドのランクを上げるためには、" + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + "をあと" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "匹討伐してから、カプールのギルドの番人に話しかける必要がある。", "To raise the rank in the Fighters Guild, I need to slay " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " more " + refchara(gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF), DBSPEC_CHARA_NAME_ORG, 1) + " and talk to the guild guard in Port Kapul.")
+			s1 = lang("戦士ギルドのランクを上げるためには、" + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "階相当以上の" + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + "のランダムネフィアを" + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + "個制覇してから、カプールのギルドの番人に話しかける必要がある。", "To raise the rank in the Fighters Guild, I need to conquer " + gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) + " " + _nefiatype(gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL)) + " random nefia more " + gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) + "Lv and talk talk to the guild guard in Port Kapul.")
 			talk_conv s1, 40 - en * 4
 			buff += "(" + s + ")\n" + s1
 			noteadd ""
 		}
 	}
@@ -19738,11 +19944,11 @@
 	dim floorstack, 400
 	sdim key_list, 2, 20
 	sdim playerheader, 100
 	sdim artifactlocation
 	sdim newsbuff
-	sdim soundfile, 30, 303
+	sdim soundfile, 30, 304
 	sdim musicfile, 30, 137 + 5
 	dim slight, inf_screenw + 4, inf_screenh + 4
 	dim slightbk, inf_screenw + 4, inf_screenh + 4
 	gsel BUFFER_INF
 	gmode 0
@@ -19789,11 +19995,11 @@
 	sdim filter_creature
 	sdim netbuf, 20000
 	gosub *del_userNpc
 	gosub *del_userTemp
 	gosub *db_setFilterRace
-	gosub *label_8917
+	gosub *db_setFilterCreature
 	gosub *db_setFilterItem
 	gosub *chip_init
 	gosub *building_init
 	gosub *setArea
 	gosub *setCellObj
@@ -19887,11 +20093,11 @@
 		goto *exit_game
 	}
 	else {
 		errorhack++
 	}
-	buf = "HspError " + wparam + " WinError " + GetLastError() + " Ver " + int(double("6.15") * 1000) + " Mode " + mode + "\n"
+	buf = "HspError " + wparam + " WinError " + GetLastError() + " Ver " + int(double("6.17") * 1000) + " Mode " + mode + "\n"
 	buf += "efId " + efid + " efP " + efp + " Area " + gdata(GDATA_AREA) + "/" + gdata(GDATA_LEVEL) + "\n"
 	buf += "ci "
 	if ( ci < 200 ) {
 		buf += "0"
 		if ( ci >= 0 ) {
@@ -20027,11 +20233,14 @@
 	}
 	else {
 		exec exedir + "error.txt", 16
 	}
 	goto *exit_game
-	goto *label_0459
+	goto *label_0466
+
+
+
 
 
 
 
 
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/item.hsp ../2.17-borscht/item.hsp
--- ../2.15R-borscht/item.hsp	2023-05-12 09:08:03.978669700 +0800
+++ ../2.17-borscht/item.hsp	2023-05-12 09:05:58.598261600 +0800
@@ -753,11 +753,11 @@
 		goto *item_loot_SWEND2
 		_switch_sw++
 	}
 	if ( _switch_val == 1 | _switch_sw ) {
 		_switch_sw = 0
-		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
 			if ( rnd(20) == 0 ) {
 				p = 0
 				flt calcobjlv(cdata(CDATA_LEVEL, tc)), calcfixlv(FIX_QUALITY_GOOD)
 				flttypemajor = FILTER_REMAINS
 				flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
@@ -768,11 +768,11 @@
 		goto *item_loot_SWEND2
 		_switch_sw++
 	}
 	if ( _switch_val == 2 | _switch_sw ) {
 		_switch_sw = 0
-		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
 			if ( rnd(20) == 0 ) {
 				p = 0
 				flt calcobjlv(cdata(CDATA_LEVEL, tc)), calcfixlv(FIX_QUALITY_GOOD)
 				flttypemajor = FILTER_REMAINS
 				flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
@@ -937,11 +937,11 @@
 		}
 		goto *item_loot_SWEND2
 	}
 
 *item_loot_SWEND2
-	if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+	if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
 		if ( rnd(40) == 0 ) {
 			p = 0
 			flt calcobjlv(cdata(CDATA_LEVEL, tc)), calcfixlv(FIX_QUALITY_GOOD)
 			flttypemajor = FILTER_REMAINS
 			flttypeminor = (0 /*!!!@[FILTER_NOTHING @@@ FILTER_NOTHING]@!!! */)
@@ -959,11 +959,11 @@
 			itemcreate -1, ITEM_ID_CARD, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 			inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, rc) \ 1000 + cdata(CDATA_CHARA_PIC, rc) * 1000
 			inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, rc)
 			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
 		}
-		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
 			if ( rnd(175) == 0 | gdata(GDATA_FLAG_DUEL_TARGET) == (-2) | cdata(CDATA_QUALITY, rc) == FIX_QUALITY_UNIQUE | cdata(CDATA_ID, rc) == CREATURE_ID_UNITDEAD_KING | cdata(CDATA_ID, rc) == CREATURE_ID_UNITDEAD_QUEEN | cdata(CDATA_ID, rc) == CREATURE_ID_UNITDEAD_JACK | cdata(CDATA_ID, rc) == CREATURE_ID_UNITDEAD_JOKER | cdata(CDATA_ID, rc) == CREATURE_ID_AILE_THE_ATTENDANT | (cdata(CDATA_QUALITY, rc) == FIX_QUALITY_MIRACLE & rnd(2) == 0) | (cdata(CDATA_QUALITY, rc) == FIX_QUALITY_GODLY & rnd(3) == 0) | (cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT & rnd(35) == 0) ) {
 				flt
 				itemcreate -1, ITEM_ID_FIGURINE, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 				inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, rc) \ 1000 + cdata(CDATA_CHARA_PIC, rc) * 1000
 				inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, rc)
@@ -993,11 +993,51 @@
 		itemcreate -1, ITEM_ID_SHOPKEEPERS_TRUNK, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 		inv(INV_ITEM_PARAM1, ci) = cdata(CDATA_ROLE_FILE_ID, rc)
 		inv(INV_ITEM_PROPERTY, ci) = PROP_SHOP
 	}
 	if ( rc >= MAX_CHARA_FOLLOWER ) {
-		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 100 ) {
+			flt
+			itemcreate -1, ITEM_ID_CORPSE, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+			inv(INV_ITEM_PIC, ci) = xy2pic(30, 33)
+			inv(INV_ITEM_PARAM2, ci) = 10
+			inv(INV_ITEM_PARAM3, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 240
+			if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, tc) == TRUE ) {
+				inv(INV_ITEM_LEVEL, ci) += limit(rnd((sdata(SKILL_NORMAL_ANATOMY, CHARA_PLAYER) + 1) / 20 + 2) + situ, 1, 10) + cdata(CDATA_BRUSH_LEVEL, rc)
+			}
+			else {
+				inv(INV_ITEM_LEVEL, ci) += cdata(CDATA_BRUSH_LEVEL, rc)
+				if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_AMUR_CAGE ) {
+					inv(INV_ITEM_AMUR_CAGE, ci) = 1
+				}
+			}
+			remain_make ci, rc
+			inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, tc) \ 1000 + cdata(CDATA_CHARA_PIC, tc) * 1000
+			inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, rc)
+			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
+		}
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+			if ( rollanatomye == 1 | dbg_corpse | (adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, rc) == TRUE & cdata(CDATA_CONDITION_SICK, rc) == 0) ) {
+				flt
+				itemcreate -1, ITEM_ID_EGG, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				if ( stat ) {
+					inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, rc)
+					inv(INV_ITEM_WEIGHT, ci) = limit(cdata(CDATA_WEIGHT, rc) / 10 * 40, 20, 10000)
+					inv(INV_ITEM_VALUE, ci) = limit((cdata(CDATA_WEIGHT, rc) + 2400) / 4, 600, 3000)
+				}
+			}
+		}
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+			if ( rollanatomym == 1 | dbg_corpse | (adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, rc) == TRUE & cdata(CDATA_CONDITION_SICK, rc) == 0) ) {
+				flt
+				itemcreate -1, ITEM_ID_BOTTLE_MILK, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				if ( stat ) {
+					inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, rc)
+				}
+			}
+		}
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
 			if ( rollanatomy == 1 | cdata(CDATA_QUALITY, rc) >= FIX_QUALITY_MIRACLE | dbg_corpse | (adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, rc) == TRUE & cdata(CDATA_CONDITION_SICK, rc) == 0) ) {
 				situ = 0
 				ryou = 0
 				situ2 = 0
 				ryou2 = 0
@@ -1103,12 +1143,40 @@
 					remain_make ci, rc
 				}
 			}
 		}
 	}
-	if ( cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT & rnd(6) == 0 ) {
-		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+	if ( rnd(10) == 0 ) {
+		if ( gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
+			if ( rollsenseki == 1 ) {
+				if ( gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
+					if ( cdata(CDATA_INIT_ATTR, rc) + cdata(CDATA_INIT_LIFEMANA, rc) >= 1000 ) {
+						flt
+						itemcreate -1, ITEM_ID_AWAKE_DESTONE, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+						inv(INV_ITEM_PARAM2, ci) = cdata(CDATA_INIT_ATTR, rc)
+						inv(INV_ITEM_PARAM3, ci) = cdata(CDATA_INIT_LIFEMANA, rc)
+						inv(INV_ITEM_AMUR_CAGE, ci) = cdata(CDATA_INIT_SPEED, rc)
+						inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+					}
+				}
+			}
+			if ( gdata(GDATA_FLAG_TALKING_USED) == 100 ) {
+				flt
+				itemcreate -1, ITEM_ID_FIGHTING_DESTONE, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				inv(INV_ITEM_PARAM2, ci) = limit((cdata(CDATA_LEVEL, rc) / 10 + 1) * 10, 1, 999)
+				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+			}
+			if ( rollovercast == 1 ) {
+				flt
+				itemcreate -1, ITEM_ID_MANA_DESTONE, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				inv(INV_ITEM_PARAM2, ci) = limit((cdata(CDATA_LEVEL, rc) / 10 + 1) * 10, 1, 999)
+				inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
+			}
+		}
+	}
+	if ( cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT & rnd(6) == 0 | rollanatomyr == 1 ) {
+		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) <= 0 & gdata(GDATA_FLAG_TALKING_USED) == 0 ) {
 			flt
 			flttypemajor = FILTER_REMAINS
 			itemcreate -1, ITEM_ID_DUMMY, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 			remain_make ci, rc
 		}
@@ -1397,27 +1465,27 @@
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_SLIME ) {
 		if ( rnd(60) == 0 ) {
 			if ( gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
 				flt
-				itemcreate -1, 1266, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				itemcreate -1, ITEM_ID_SLIME_MOLD, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 			}
 		}
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_ZOMBIE_GIRL ) {
 		if ( rnd(15) == 0 ) {
 			if ( gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
 				flt
-				itemcreate -1, 1266, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				itemcreate -1, ITEM_ID_SLIME_MOLD, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 			}
 		}
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_ZOMBIE_QUEEN | cdata(CDATA_ID, rc) == CREATURE_ID_REQUIEM | cdata(CDATA_ID, rc) == CREATURE_ID_GOTHIC ) {
 		if ( rnd(6) == 0 ) {
 			if ( gdata(GDATA_FLAG_RARE_DROP) == 100 ) {
 				flt
-				itemcreate -1, 1266, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
+				itemcreate -1, ITEM_ID_SLIME_MOLD, cdata(CDATA_X, rc), cdata(CDATA_Y, rc), 0
 			}
 		}
 	}
 	if ( cdata(CDATA_ID, rc) == CREATURE_ID_GWEN_THE_INNOCENT | cdata(CDATA_ID, rc) == CREATURE_ID_GWEN_THE_PITILESS ) {
 		if ( rnd(50) == 0 ) {
@@ -2229,11 +2297,11 @@
 		inv(INV_ITEM_PARAM1, ci) = rnd(36) + 1
 	}
 	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_BOTTLE_DYE ) {
 		inv(INV_ITEM_COL, ci) = rnd(31)
 	}
-	if ( inv(INV_ITEM_ID, ci) == 1267 ) {
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_SLIME_FUKAGURUMI ) {
 		inv(INV_ITEM_PARAM1, ci) = rnd(1000) + 1
 	}
 	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_RED_BOOK ) {
 		if ( inv(INV_ITEM_PARAM1, ci) == 0 ) {
 			inv(INV_ITEM_PARAM1, ci) = isetbook(rnd(length(isetbook)))
@@ -2966,10 +3034,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 17, 10 + inv(INV_ITEM_LEVEL, ci)
 			fdmax++
 		}
 		nutrition = 2000
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 1 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 8 ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 17, 20
 			fdmax++
@@ -2981,10 +3057,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 15, 20
 			fdmax++
 		}
 		nutrition = 2000
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 2 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 2 | inv(INV_ITEM_ID, ci) == ITEM_ID_DRIED_VEGETABLE ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 15, 50 + inv(INV_ITEM_LEVEL, ci)
 			fdmax++
@@ -2992,10 +3076,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 14, 50 + inv(INV_ITEM_LEVEL, ci)
 			fdmax++
 		}
 		nutrition = 2000
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 3 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 3 | inv(INV_ITEM_ID, ci) == ITEM_ID_DRIED_FRUIT ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 16, 50 + inv(INV_ITEM_LEVEL, ci)
 			fdmax++
@@ -3007,10 +3099,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 13, 30 + inv(INV_ITEM_LEVEL, ci)
 			fdmax++
 		}
 		nutrition = 1500
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 4 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 7 ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 10, 25
 			fdmax++
@@ -3026,10 +3126,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 11, 25
 			fdmax++
 		}
 		nutrition = 2800
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 5 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 4 ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 16, 40
 			fdmax++
@@ -3041,10 +3149,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 14, 30
 			fdmax++
 		}
 		nutrition = 1500
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 6 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 6 | inv(INV_ITEM_ID, ci) == ITEM_ID_DRIED_FISH ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 14, 40 + inv(INV_ITEM_LEVEL, ci)
 			fdmax++
@@ -3056,10 +3172,18 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 13, 20
 			fdmax++
 		}
 		nutrition = 3000
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 7 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( i == 5 ) {
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 11, 60
 			fdmax++
@@ -3067,10 +3191,78 @@
 		if ( fdmax < 10 ) {
 			fdlist(0, fdmax) = 12, 40
 			fdmax++
 		}
 		nutrition = 3500
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 8 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
+	}
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_B_JERKY | inv(INV_ITEM_ID, ci) == ITEM_ID_FORBIDDEN_MEAT ) {
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 1 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
+	}
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_JACK_LANTERN | inv(INV_ITEM_ID, ci) == ITEM_ID_MANDRAKE_SALAD | inv(INV_ITEM_ID, ci) == ITEM_ID_FRIED_POTATO | inv(INV_ITEM_ID, ci) == ITEM_ID_POP_CORN ) {
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 3 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
+	}
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_MAGIC_FRUIT | inv(INV_ITEM_ID, ci) == ITEM_ID_HAPPY_APPLE ) {
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 4 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
+	}
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_STICK_BREAD | inv(INV_ITEM_ID, ci) == ITEM_ID_PUFF_PUFF_BREAD ) {
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 5 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
+	}
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_GOLD_ACORN | inv(INV_ITEM_ID, ci) == ITEM_ID_CRIMBERRY ) {
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 6 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
+	}
+	if ( inv(INV_ITEM_ID, ci) == ITEM_ID_DEAD_FISH ) {
+		if ( cc == CHARA_PLAYER ) {
+			if ( cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) == 7 ) {
+				snd SOUNDLIST_WRITE1
+				txtef COLOR_GREEN
+				txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+				cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) += 1000
+			}
+		}
 	}
 	if ( inv(INV_ITEM_LEVEL, ci) > 0 & inv(INV_ITEM_LEVEL, ci) <= 15 ) {
 		modgrowth cc, SKILL_ATTR_SPD, inv(INV_ITEM_LEVEL, ci) / 2 + 3
 	}
 	if ( inv(INV_ITEM_PARAM2, ci) > 0 ) {
@@ -3195,11 +3387,11 @@
 		}
 		if ( fatal == 5 ) {
 			txtef COLOR_RED
 			txt lang(name(cc) + "は白目を剥いてぶっ倒れた。", name(cc) + "  roll eyes back and fell down.")
 		}
-		dmghp tc, (sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) / 5 + 5) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) + 1) / 5 + 5) + rnd(sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) * 2 + 5) + (limit(cdata(CDATA_LEVEL, CHARA_PLAYER) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, CHARA_PLAYER) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, CHARA_PLAYER), 1, 2000) * 3) + 30, (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */), MAX_SKILL_RESDMG, 1000
+		dmghp tc, (sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) / 5 + 5) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) + 1) / 5 + 5) + rnd(sdata(SKILL_NORMAL_GENE_ENGINEER, CHARA_PLAYER) * 2 + 5) + (limit(cdata(CDATA_LEVEL, CHARA_PLAYER) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, CHARA_PLAYER) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, CHARA_PLAYER), 1, 2000) * 3) + 30, (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */), SKILL_RESDMG_CONSTITUTION, 1000
 		if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
 			if ( fatal == 0 ) {
 				chara_vomit cc
 				chara_vomit cc
 			}
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/item_func.hsp ../2.17-borscht/item_func.hsp
--- ../2.15R-borscht/item_func.hsp	2023-05-12 09:08:04.038511000 +0800
+++ ../2.17-borscht/item_func.hsp	2023-05-12 09:05:58.632482700 +0800
@@ -45,18 +45,18 @@
 	if ( inv_getowner_itemid >= RANGE_INV2 ) {
 		return -1
 	}
 	return (inv_getowner_itemid - 200) / 20 + 1
 
-*label_0627
-	goto *label_0635
+*label_0634
+	goto *label_0642
 
 #deffunc inv_find int inv_find_item_dbid, int inv_find_invid
 	locvar_inv_find_f = -1
 	inv_getheader inv_find_invid
 	repeat invrange, invhead
-		if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
+		if ( inv(INV_ITEM_NUM, cnt) <= 0 ) {
 			continue
 		}
 		if ( inv(INV_ITEM_ID, cnt) == inv_find_item_dbid ) {
 			locvar_inv_find_f = cnt
 			break
@@ -65,11 +65,11 @@
 	return locvar_inv_find_f
 
 #deffunc fix_find int fix_find_item_dbid, int fix_find_invid
 	inv_getheader fix_find_invid
 	repeat invrange, invhead
-		if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
+		if ( inv(INV_ITEM_NUM, cnt) <= 0 ) {
 			continue
 		}
 		if ( inv(INV_ITEM_ID, cnt) != fix_find_item_dbid ) {
 			continue
 		}
@@ -99,11 +99,11 @@
 			}
 			inv_getheader 0
 		}
 		locvar_item_find_p(2) = cnt
 		repeat invrange, invhead
-			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
+			if ( inv(INV_ITEM_NUM, cnt) <= 0 ) {
 				continue
 			}
 			if ( locvar_item_find_p(2) == 0 ) {
 				if ( inv(INV_ITEM_X, cnt) != cdata(CDATA_X, CHARA_PLAYER) | inv(INV_ITEM_Y, cnt) != cdata(CDATA_Y, CHARA_PLAYER) ) {
 					continue
@@ -838,10 +838,43 @@
 			locvar_itemowner_s += lang("コボルード", "-Kobolord")
 		}
 		if ( inv(INV_ITEM_PARAM3, itemowner_itemid) / 100 == 25 ) {
 			locvar_itemowner_s += lang("ヘラクレスト", "-Hercurest")
 		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 50 ) {
+			locvar_itemowner_s += lang("Ｆ", " F")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 51 ) {
+			locvar_itemowner_s += lang("Ｉ", " I")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 52 ) {
+			locvar_itemowner_s += lang("Ｌ", " L")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 53 ) {
+			locvar_itemowner_s += lang("Ｄ", " D")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 54 ) {
+			locvar_itemowner_s += lang("Ｍ", " M")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 55 ) {
+			locvar_itemowner_s += lang("Ｐ", " P")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 56 ) {
+			locvar_itemowner_s += lang("Ｈ", " H")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 57 ) {
+			locvar_itemowner_s += lang("Ｓ", " S")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 58 ) {
+			locvar_itemowner_s += lang("Ｎ", " N")
+		}
+		if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 59 ) {
+			locvar_itemowner_s += lang("Ｃ", " C")
+		}
+		if ( inv(INV_ITEM_AMUR_CAGE, itemowner_itemid) > 0 ) {
+			locvar_itemowner_s += lang("Ｘ", "X")
+		}
 	}
 	if ( inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_ANCIENT_BOOK ) {
 		if ( jp ) {
 			if ( inv(INV_ITEM_PARAM2, itemowner_itemid) != 0 ) {
 				locvar_itemowner_s += "解読済みの"
@@ -946,11 +979,11 @@
 				return
 			}
 			locvar_itemowner_s += "" + fishdatan(inv(INV_ITEM_SUB_NAME, itemowner_itemid))
 		}
 		else {
-			if ( locvar_itemowner_a == 57000 | locvar_itemowner_a == 62000 | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_FIGURINE | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_CARD | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SHIT | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_BOTTLE_MILK | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SOUL_SPINDLE | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_GOLDEN_DOLL | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SOCKS2 | inv(INV_ITEM_ID, itemowner_itemid) == 1265 ) {
+			if ( locvar_itemowner_a == 57000 | locvar_itemowner_a == 62000 | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_FIGURINE | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_CARD | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SHIT | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_BOTTLE_MILK | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SOUL_SPINDLE | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_GOLDEN_DOLL | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SOCKS2 | inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_NECRO_PARTS ) {
 				if ( inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_SOUL_SPINDLE ) {
 					if ( inv(INV_ITEM_SUB_NAME, itemowner_itemid) < 0 | inv(INV_ITEM_SUB_NAME, itemowner_itemid) >= 1499 ) {
 						locvar_itemowner_s += "/bugged/"
 						return
 					}
@@ -970,11 +1003,11 @@
 						locvar_itemowner_s += lang("", " of ") + refchara(inv(INV_ITEM_SUB_NAME, itemowner_itemid), DBSPEC_CHARA_NAME_ORG, 1)
 						if ( jp ) {
 							locvar_itemowner_s += "の"
 						}
 					}
-					if ( inv(INV_ITEM_ID, itemowner_itemid) == 1265 ) {
+					if ( inv(INV_ITEM_ID, itemowner_itemid) == ITEM_ID_NECRO_PARTS ) {
 						if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 1 ) {
 							locvar_itemowner_s += lang("あたま", "head")
 						}
 						if ( inv(INV_ITEM_SHOP_SAMPLE, itemowner_itemid) == 2 ) {
 							locvar_itemowner_s += lang("くび", "neck")
@@ -1179,11 +1212,23 @@
 			if ( locvar_itemname_num2 > 1 ) {
 				locvar_itemowner_s = "" + locvar_itemname_num2 + " " + locvar_itemowner_s
 			}
 		}
 	}
-	if ( inv(INV_ITEM_SHOP_SAMPLE, itemname_itemid) == 100 ) {
+	if ( ibit(ITEM_BIT_ALIVE, itemname_itemid) == TRUE ) {
+		if ( inv(INV_ITEM_PARAM1, itemname_itemid) < 15 ) {
+			if ( inv(INV_ITEM_PARAM2, itemname_itemid) >= inv(INV_ITEM_PARAM1, itemname_itemid) * 100 ) {
+				if ( jp ) {
+					locvar_itemowner_s += "[成長可能な]"
+				}
+				else {
+					locvar_itemowner_s += "[Growable] "
+				}
+			}
+		}
+	}
+	if ( ibit(ITEM_BIT_SHOP_SAMPLE, itemname_itemid) == TRUE ) {
 		if ( jp ) {
 			locvar_itemowner_s += "見本用の"
 		}
 		else {
 			locvar_itemowner_s += "sample "
@@ -1670,14 +1715,18 @@
 	if ( inv(INV_ITEM_KNOWN, itemname_itemid) >= ITEM_KNOWN_FULL ) {
 		if ( inv(INV_ITEM_LEVEL, itemname_itemid) != 0 ) {
 			locvar_itemowner_s += "" + cnvfix(inv(INV_ITEM_LEVEL, itemname_itemid)) + " "
 		}
 		if ( inv(INV_ITEM_PARAM2, itemname_itemid) != 0 ) {
-			if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_SKULL_SWORD | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_VIOLENT_SKULL_SWORD | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MAGISTUS | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_TRISMAGISTUS | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MYSTERIOUS_FOSSIL | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MEMORY_FRAGMENT ) {
+			if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_SKULL_SWORD | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_VIOLENT_SKULL_SWORD | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MAGISTUS | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_TRISMAGISTUS | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MYSTERIOUS_FOSSIL | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MEMORY_FRAGMENT | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_MANA_DESTONE | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_FIGHTING_DESTONE | inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_DEVIL_FRAGMENT ) {
 				locvar_itemowner_s += "(LV." + inv(INV_ITEM_PARAM2, itemname_itemid) + ")"
 			}
 		}
+		if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_AWAKE_DESTONE ) {
+			locvar_itemname_init = (inv(INV_ITEM_PARAM2, itemname_itemid) + inv(INV_ITEM_PARAM3, itemname_itemid) + inv(INV_ITEM_AMUR_CAGE, itemname_itemid)) / 10
+			locvar_itemowner_s += "(LV." + locvar_itemname_init + ")"
+		}
 		if ( ibit(ITEM_BIT_CHARGE_ITEM, itemname_itemid) == TRUE ) {
 			locvar_itemowner_s += lang("(残り" + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), itemname_itemid) + "回)", "(Charges: " + inv((9 /*!!!@[INV_ITEM_AMMO @@@ INV_ITEM_CHARGE @@@ INV_ITEM_CLIENT @@@ INV_ITEM_FILE @@@ INV_ITEM_NEXT_PERIOD]@!!! */), itemname_itemid) + ")")
 		}
 		if ( refitem(inv(INV_ITEM_ID, itemname_itemid), DBSPEC_TYPE) == FILTER_ITEM_FOOD ) {
 			if ( inv(INV_ITEM_PARAM1, itemname_itemid) != 0 ) {
@@ -1687,11 +1736,11 @@
 			}
 		}
 		if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_BOTTLE_DYE ) {
 			locvar_itemowner_s += "(No." + inv(INV_ITEM_COL, itemname_itemid) + ")"
 		}
-		if ( inv(INV_ITEM_ID, itemname_itemid) == 1267 ) {
+		if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_SLIME_FUKAGURUMI ) {
 			locvar_itemowner_s += lang("", " of ")
 			if ( jp ) {
 				locvar_itemowner_s += "の"
 			}
 			randomize inv(INV_ITEM_PARAM1, itemname_itemid)
@@ -1755,10 +1804,30 @@
 			}
 			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 4 ) {
 				locvar_itemowner_s += lang("(マジンファイヤー)", "(Mazin fire)")
 			}
 		}
+		if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_WHITE_DARK_ORB ) {
+			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 0 ) {
+				locvar_itemowner_s += lang("(バイブロスピア)", "(vibrating spear)")
+			}
+			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 1 ) {
+				locvar_itemowner_s += lang("(ポイズンスピア)", "(poison spear)")
+			}
+			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 2 ) {
+				locvar_itemowner_s += lang("(サイミンスピア)", "(sleepy spear)")
+			}
+			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 3 ) {
+				locvar_itemowner_s += lang("(インクスピア)", "(ink spear)")
+			}
+			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 4 ) {
+				locvar_itemowner_s += lang("(スメリースピア)", "(smelly spear)")
+			}
+			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 5 ) {
+				locvar_itemowner_s += lang("(シビレスピア)", "(paralyze spear)")
+			}
+		}
 		if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_COFFIN_OF_NECROMANCY ) {
 			if ( inv(INV_ITEM_PARAM1, itemname_itemid) <= 2 ) {
 				locvar_itemowner_s += lang("(猫ゾンビ)", "(cat)")
 			}
 			if ( inv(INV_ITEM_PARAM1, itemname_itemid) == 3 ) {
@@ -1940,13 +2009,10 @@
 		}
 	}
 	if ( inv(INV_ITEM_ID, itemname_itemid) == ITEM_ID_DISC ) {
 		locvar_itemowner_s += " <BGM" + inv(INV_ITEM_PARAM1, itemname_itemid) + ">"
 	}
-	if ( 0 ) {
-		locvar_itemowner_s += "(" + inv(INV_ITEM_PIC, itemname_itemid) + ")"
-	}
 	if ( strlen(locvar_itemowner_s) > 66 ) {
 		locvar_itemname_len = zentohan(locvar_itemowner_s, locvar_itemname_buf, 0)
 		sdim locvar_itemname_buf, locvar_itemname_len
 		locvar_itemname_ret = zentohan(locvar_itemowner_s, locvar_itemowner_s, locvar_itemname_len)
 	}
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/main.hsp ../2.17-borscht/main.hsp
--- ../2.15R-borscht/main.hsp	2023-05-12 09:08:04.068430600 +0800
+++ ../2.17-borscht/main.hsp	2023-05-12 09:05:58.636472300 +0800
@@ -181,11 +181,11 @@
 	if ( dbg_randseed != 0 ) {
 		randseed = dbg_randseed
 	}
 	randomize randseed
 	exrand_randomize randseed
-	title "ElonaPlus 2.15R"
+	title "ElonaPlus 2.17"
 	goto *system_init
 	goto *label_0003
 
 #deffunc netload str netload_filename
 	netrequest netload_filename
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/map.hsp ../2.17-borscht/map.hsp
--- ../2.15R-borscht/map.hsp	2023-05-12 09:08:04.099345900 +0800
+++ ../2.17-borscht/map.hsp	2023-05-12 09:05:58.716376500 +0800
@@ -1151,10 +1151,26 @@
 		repeat 5480 - 1320, 1320
 			if ( inv(INV_ITEM_NUM, cnt) != 0 ) {
 			}
 		loop
 	}
+	if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANDOM_DUNGEON ) {
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 6 ) {
+			snd SOUNDLIST_WRITE1
+			txtef COLOR_GREEN
+			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+			cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+		}
+	}
+	if ( gdata(GDATA_AREA) == AREA_WILDERNESS ) {
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 7 ) {
+			snd SOUNDLIST_WRITE1
+			txtef COLOR_GREEN
+			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+			cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+		}
+	}
 	if ( adata(ADATA_TYPE, gdata(GDATA_AREA)) != MAP_TYPE_WORLD & adata(ADATA_TYPE, gdata(GDATA_AREA)) != MAP_TYPE_LOCAL & gdata(GDATA_AREA) != AREA_SHOW_HOUSE ) {
 		autosave = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
 	}
 	mode = MODELIST_NEW
 	goto *map_init
@@ -6326,11 +6342,10 @@
 				cell_featset 17, 2, tile_upstairs, CELL_FEATURE_UPSTAIRS, 11
 			}
 			else {
 				cell_featset 17, 2, tile_upstairs, CELL_FEATURE_UPSTAIRS, 12
 			}
-			txt lang("「…か…び…よ…」", cnvtalk("...dle.. fin..."))
 		}
 		if ( gdata(GDATA_LEVEL) == 22 ) {
 			map_initcustom "meiq122"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
 			mdata(MDATA_TYPE) = MAP_TYPE_VILLAGE
@@ -6353,11 +6368,10 @@
 				cell_featset 6, 7, tile_upstairs, CELL_FEATURE_UPSTAIRS, 11
 			}
 			else {
 				cell_featset 6, 7, tile_upstairs, CELL_FEATURE_UPSTAIRS, 12
 			}
-			txt lang("「こ…び…だ…」", cnvtalk("...ittl.. fin..."))
 		}
 		if ( gdata(GDATA_LEVEL) == 26 ) {
 			map_initcustom "meiq162"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
 			mdata(MDATA_TYPE) = MAP_TYPE_VILLAGE
@@ -6425,11 +6439,10 @@
 				cell_featset 11, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 21
 			}
 			else {
 				cell_featset 11, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 22
 			}
-			txt lang("「あお…だ…」", cnvtalk("Bl.. sta..."))
 			evadd EVENT_AMURDEAD_SUB_FIREWORKS
 		}
 		if ( gdata(GDATA_LEVEL) == 32 ) {
 			map_initcustom "meiq123"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
@@ -6453,11 +6466,10 @@
 				cell_featset 23, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 21
 			}
 			else {
 				cell_featset 23, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 22
 			}
-			txt lang("「あお…だ…」", cnvtalk("Bl.. sta..."))
 			evadd EVENT_AMURDEAD_SUB_FIREWORKS
 		}
 		if ( gdata(GDATA_LEVEL) == 36 ) {
 			map_initcustom "meiq163"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
@@ -6526,11 +6538,10 @@
 				cell_featset 17, 2, tile_upstairs, CELL_FEATURE_UPSTAIRS, 31
 			}
 			else {
 				cell_featset 17, 2, tile_upstairs, CELL_FEATURE_UPSTAIRS, 32
 			}
-			txt lang("「赤の階…だ…」", cnvtalk("Re..d sta..irs..."))
 		}
 		if ( gdata(GDATA_LEVEL) == 42 ) {
 			map_initcustom "meiq124"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
 			mdata(MDATA_TYPE) = MAP_TYPE_VILLAGE
@@ -6553,11 +6564,10 @@
 				cell_featset 11, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 31
 			}
 			else {
 				cell_featset 11, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 32
 			}
-			txt lang("「くすりゆび…階だ…」", cnvtalk("Rin..g fin...ger st...airs..."))
 		}
 		if ( gdata(GDATA_LEVEL) == 46 ) {
 			map_initcustom "meiq164"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
 			mdata(MDATA_TYPE) = MAP_TYPE_VILLAGE
@@ -6625,11 +6635,10 @@
 				cell_featset 23, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 41
 			}
 			else {
 				cell_featset 23, 4, tile_upstairs, CELL_FEATURE_UPSTAIRS, 42
 			}
-			txt lang("「ひとさしゆびの階段だよ…」", cnvtalk("Index finger stairs..."))
 		}
 		if ( gdata(GDATA_LEVEL) == 52 ) {
 			map_initcustom "meiq125"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
 			mdata(MDATA_TYPE) = MAP_TYPE_VILLAGE
@@ -6652,11 +6661,10 @@
 				cell_featset 6, 7, tile_upstairs, CELL_FEATURE_UPSTAIRS, 41
 			}
 			else {
 				cell_featset 6, 7, tile_upstairs, CELL_FEATURE_UPSTAIRS, 42
 			}
-			txt lang("「青の階段だよ…」", cnvtalk("Blue stairs..."))
 		}
 		if ( gdata(GDATA_LEVEL) == 56 ) {
 			map_initcustom "meiq165"
 			mdata(MDATA_FIELD) = MAP_FIELD_INDOOR
 			mdata(MDATA_TYPE) = MAP_TYPE_VILLAGE
@@ -10150,10 +10158,51 @@
 					}
 				}
 			}
 		}
 	}
+	if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
+		if ( gdata(GDATA_LEVEL) == 10 ) {
+			msgtemp += lang("ネヘルタード「時間がない…Shiftキーで走って…」", "Amurdad whispers, " + cnvtalk("There's no time to spare...so run by Shift key..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 11 ) {
+			msgtemp += lang("ネヘルタード「みぎの…どに……」", "Amurdad whispers, " + cnvtalk("...ig...t co....r..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 12 ) {
+			msgtemp += lang("ネヘルタード「ひ…りの…どに…」", "Amurdad whispers, " + cnvtalk("..ef.. c..r..er.."))
+		}
+		if ( gdata(GDATA_LEVEL) == 20 ) {
+			msgtemp += lang("ネヘルタード「何度も親指を目指して…」", "Amurdad whispers, " + cnvtalk("Go thumb stairs...again and again..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 21 ) {
+			msgtemp += lang("ネヘルタード「…か…びの…段…」", "Amurdad whispers, " + cnvtalk("...dle.. fin..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 22 ) {
+			msgtemp += lang("ネヘルタード「こ…びの……だ…」", "Amurdad whispers, " + cnvtalk("...ittl.. fin..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 31 ) {
+			msgtemp += lang("ネヘルタード「あお…階だ…」", "Amurdad whispers, " + cnvtalk("Bl.. sta..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 32 ) {
+			msgtemp += lang("ネヘルタード「あおの…いだ…」", "Amurdad whispers, " + cnvtalk("Bl.. sta..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 41 ) {
+			msgtemp += lang("ネヘルタード「赤の階…ん…」", "Amurdad whispers, " + cnvtalk("R..d st..irs..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 42 ) {
+			msgtemp += lang("ネヘルタード「くすりゆ…の階だ…」", "Amurdad whispers, " + cnvtalk("Ri..g fi...ger st...irs..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 51 ) {
+			msgtemp += lang("ネヘルタード「ひとさしゆびの階段だよ…」", "Amurdad whispers, " + cnvtalk("Index finger stairs..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 52 ) {
+			msgtemp += lang("ネヘルタード「青の階段だよ…」", "Amurdad whispers, " + cnvtalk("Blue stairs..."))
+		}
+		if ( gdata(GDATA_LEVEL) == 60 ) {
+			msgtemp += lang("ネヘルタード「まだ…こちら側の岸にいるはず…」", "Amurdad whispers, " + cnvtalk("There's the child...on the shore on this side..."))
+		}
+	}
 	if ( mdata(MDATA_TYPE) >= (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
 		if ( zyuusann == 100 ) {
 			if ( gdata(GDATA_LEVEL) >= 66 ) {
 				if ( rnd(130) == 0 ) {
 					if ( gdata(GDATA_DAY) == 1 | gdata(GDATA_DAY) == 3 | (gdata(GDATA_DAY) >= 11 & gdata(GDATA_DAY) <= 19) | gdata(GDATA_DAY) == 21 | gdata(GDATA_DAY) == 23 | gdata(GDATA_DAY) == 30 ) {
@@ -13950,11 +13999,11 @@
 			if ( gdata(GDATA_FLAG_STATUE_OPATOS) == 1 ) {
 				adata(ADATA_MIN_LEVEL, p) = adata(ADATA_MIN_LEVEL, p) / 4 + 1
 			}
 		}
 		mltype = 0
-		adata(ADATA_MAX_LEVEL, p) = adata(ADATA_MIN_LEVEL, p) + rnd(4) + 2
+		adata(ADATA_MAX_LEVEL, p) = adata(ADATA_MIN_LEVEL, p) + 2
 		adata(ADATA_CAN_SAVE, p) = 1
 		adata(ADATA_RESTORE_POS, p) = 0
 		adata(ADATA_BOSS, p) = 0
 		adata(ADATA_NAME, p) = rnd(length(mapnamerd))
 		map(x, y, MAP_FEATS_ON_TILE) = 1
@@ -14606,12 +14655,12 @@
 			}
 		}
 	}
 	if ( gdata(GDATA_AREA) == AREA_VALM ) {
 		if ( gdata(GDATA_LEVEL) == 3 ) {
-			if ( gdata(GDATA_SLEEP) >= 15 ) {
-				gdata(GDATA_SLEEP) = 15 - 2
+			if ( gdata(GDATA_SLEEP) >= 13 ) {
+				gdata(GDATA_SLEEP) = 13 - 2
 			}
 			mdata(MDATA_TIMESCALE) = 5000000
 		}
 	}
 	if ( gdata(GDATA_AREA) == AREA_JAIL ) {
@@ -14653,12 +14702,12 @@
 			if ( cdata(CDATA_THIRST, CHARA_PLAYER) < 5000 ) {
 				snd SOUNDLIST_DRINK1
 				txt lang("シェルターの貯蔵飲料を飲んだ。", "You eat stored drink.")
 				cdata(CDATA_THIRST, CHARA_PLAYER) += 5000
 			}
-			if ( gdata(GDATA_SLEEP) >= 15 ) {
-				gdata(GDATA_SLEEP) = 15 - 2
+			if ( gdata(GDATA_SLEEP) >= 13 ) {
+				gdata(GDATA_SLEEP) = 13 - 2
 			}
 			mdata(MDATA_TIMESCALE) = 1000000
 		}
 		else {
 			if ( mdata(MDATA_TIMESCALE) == 1000000 ) {
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/map_user.hsp ../2.17-borscht/map_user.hsp
--- ../2.15R-borscht/map_user.hsp	2023-05-12 09:08:04.182126600 +0800
+++ ../2.17-borscht/map_user.hsp	2023-05-12 09:05:58.763251700 +0800
@@ -567,18 +567,18 @@
 			}
 			if ( inv(INV_ITEM_NUM, cnt) <= 0 ) {
 				continue
 			}
 			if ( chipm(CHIPM_ROLE, map(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), MAP_TILE_ID)) == MAP_CHIP_ROLE_DISPLAY_SPACE ) {
-				inv(INV_ITEM_SHOP_SAMPLE, cnt) = 100
+				ibitmod ITEM_BIT_SHOP_SAMPLE, cnt, TRUE
 			}
 			else {
-				inv(INV_ITEM_SHOP_SAMPLE, cnt) = 0
+				ibitmod ITEM_BIT_SHOP_SAMPLE, cnt, FALSE
 			}
 		loop
 		goto *turn_end
-		goto *label_4616
+		goto *label_4641
 		_switch_sw++
 	}
 	if ( _switch_val == 10 | _switch_sw ) {
 		_switch_sw = 0
 		txt lang(mdatan(0) + "を何と呼ぶ？ ", "What do you want to call " + mdatan(0) + "? ")
@@ -1725,10 +1725,13 @@
 			continue
 		}
 		if ( inv(INV_ITEM_SHOP_SAMPLE, cnt) == 100 ) {
 			continue
 		}
+		if ( ibit(ITEM_BIT_SHOP_SAMPLE, cnt) == TRUE ) {
+			continue
+		}
 		if ( area == gdata(GDATA_AREA) ) {
 			if ( chipm(CHIPM_ROLE, map(inv(INV_ITEM_X, cnt), inv(INV_ITEM_Y, cnt), MAP_TILE_ID)) == MAP_CHIP_ROLE_DISPLAY_SPACE ) {
 				continue
 			}
 		}
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/module.hsp ../2.17-borscht/module.hsp
--- ../2.15R-borscht/module.hsp	2023-05-12 09:08:04.264904300 +0800
+++ ../2.17-borscht/module.hsp	2023-05-12 09:05:58.820403000 +0800
@@ -2108,10 +2108,11 @@
 					repeat 3
 						locvar_cell_draw_cnt2 = 2 - cnt
 						if ( locvar_cell_draw_flooritem(locvar_cell_draw_cnt2) == 999 + 5080 ) {
 							continue
 						}
+						locvar_cell_draw_fp = locvar_cell_draw_flooritem(locvar_cell_draw_cnt2)
 						locvar_cell_draw_p = inv(INV_ITEM_PIC, locvar_cell_draw_flooritem(locvar_cell_draw_cnt2))
 						locvar_cell_draw_i = inv(INV_ITEM_COL, locvar_cell_draw_flooritem(locvar_cell_draw_cnt2))
 						gsel BUFFER_ITEM
 						color 0
 						boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
@@ -2188,10 +2189,20 @@
 								gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
 							}
 							else {
 								gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
 							}
+							if ( inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CF_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CRUSH_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_BATTLE_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_SUPER_POTIOMAN ) {
+								if ( inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) > 0 ) {
+									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) - locvar_cell_draw_stackh
+									gcopy BUFFER_ITEM, 1008 - (inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) - 50) * 48, 1776, 48, 48
+								}
+								if ( inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) > 0 ) {
+									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) - locvar_cell_draw_stackh
+									gcopy BUFFER_ITEM, 1344 - inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) * 48, 1776, 48, 48
+								}
+							}
 						}
 						locvar_cell_draw_stackh += chipi(CHIPI_S, locvar_cell_draw_p)
 						if ( locvar_cell_draw_p == 531 | locvar_cell_draw_p == 1119 | locvar_cell_draw_p == 1206 ) {
 							if ( chipc(CHIPC_HEIGHT, locvar_cell_draw_i) == 96 ) {
 								locvar_cell_draw_stackh += 44
@@ -2200,10 +2211,19 @@
 					loop
 				}
 				else {
 					locvar_cell_draw_i = wpeek(map(locvar_cell_draw_x, locvar_cell_draw_y, MAP_ITEM_CHIPS_MEMORY), 2)
 					locvar_cell_draw_p = wpeek(map(locvar_cell_draw_x, locvar_cell_draw_y, MAP_ITEM_CHIPS_MEMORY), 0)
+					inv_getheader -1
+					repeat invrange, invhead
+						if ( inv(INV_ITEM_NUM, cnt) > 0 ) {
+							if ( inv(INV_ITEM_X, cnt) == locvar_cell_draw_x & inv(INV_ITEM_Y, cnt) == locvar_cell_draw_y ) {
+								rtval(1) = cnt
+							}
+						}
+					loop
+					locvar_cell_draw_fp = rtval(1)
 *skipitemDraw
 					gsel BUFFER_ITEM
 					color 0
 					boxf 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) + 960
 					if ( locvar_cell_draw_p == 528 ) {
@@ -2463,10 +2483,20 @@
 								if ( chipi(CHIPI_F, locvar_cell_draw_p) == 0 ) {
 									gmode 4, inf_tiles, inf_tiles, 140
 									color 0, 0, 0
 									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
 									gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
+									if ( inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CF_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CRUSH_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_BATTLE_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_SUPER_POTIOMAN ) {
+										if ( inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) > 0 ) {
+											pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
+											gcopy BUFFER_ITEM, 1008 - (inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) - 50) * 48, 1776, 48, 48
+										}
+										if ( inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) > 0 ) {
+											pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
+											gcopy BUFFER_ITEM, 1344 - inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) * 48, 1776, 48, 48
+										}
+									}
 								}
 								else {
 									gmode 4, inf_tiles, inf_tiles, 140
 									color 0, 0, 0
 									pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p) + 22
@@ -2477,19 +2507,39 @@
 										gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) - 22
 									}
 									else {
 										gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p) - 22
 									}
+									if ( inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CF_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CRUSH_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_BATTLE_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_SUPER_POTIOMAN ) {
+										if ( inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) > 0 ) {
+											pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
+											gcopy BUFFER_ITEM, 1008 - (inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) - 50) * 48, 1776, 48, 48
+										}
+										if ( inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) > 0 ) {
+											pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
+											gcopy BUFFER_ITEM, 1344 - inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) * 48, 1776, 48, 48
+										}
+									}
 								}
 							}
 							else {
 								if ( chipi(CHIPI_ANIM, locvar_cell_draw_p) == 0 ) {
 									gcopy BUFFER_ITEM, 0, 960, chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
 								}
 								else {
 									gcopy BUFFER_ITEM, chipi(CHIPI_X, locvar_cell_draw_p) + (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) - (locvar_cell_draw_scrturn \ (chipi(CHIPI_ANIM, locvar_cell_draw_p) + 1) == chipi(CHIPI_ANIM, locvar_cell_draw_p)) * 2 * (chipi(CHIPI_ANIM, locvar_cell_draw_p) != 0)) * inf_tiles, chipi(CHIPI_Y, locvar_cell_draw_p), chipi(CHIPI_WIDTH, locvar_cell_draw_p), chipi(CHIPI_HEIGHT, locvar_cell_draw_p)
 								}
+								if ( inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CF_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_CRUSH_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_BATTLE_POTIOMAN | inv(INV_ITEM_ID, locvar_cell_draw_fp) == ITEM_ID_SUPER_POTIOMAN ) {
+									if ( inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) > 0 ) {
+										pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
+										gcopy BUFFER_ITEM, 1008 - (inv(INV_ITEM_SHOP_SAMPLE, locvar_cell_draw_fp) - 50) * 48, 1776, 48, 48
+									}
+									if ( inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) > 0 ) {
+										pos locvar_cell_draw_dx, locvar_cell_draw_dy - chipi(CHIPI_F, locvar_cell_draw_p)
+										gcopy BUFFER_ITEM, 1344 - inv(INV_ITEM_AMUR_CAGE, locvar_cell_draw_fp) * 48, 1776, 48, 48
+									}
+								}
 							}
 						}
 					}
 				}
 			}
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/proc.hsp ../2.17-borscht/proc.hsp
--- ../2.15R-borscht/proc.hsp	2023-05-12 09:08:04.335713000 +0800
+++ ../2.17-borscht/proc.hsp	2023-05-12 09:05:58.947027400 +0800
@@ -190,17 +190,23 @@
 	autosave2 = 1 * (gdata(GDATA_AREA) != AREA_SHOW_HOUSE)
 	return
 
 *disarmTrap
 	if ( feat(FEAT_CELL_SUB_FEATURE_ID) != CELL_SUB_FEATURE_TRAP_HOSTILE_BLADE_STRINGS & feat(FEAT_CELL_SUB_FEATURE_ID) != CELL_SUB_FEATURE_TRAP_PITFALL ) {
-		skillexp SKILL_NORMAL_DISARM_TRAP, cc, 50
-		if ( sdata(SKILL_ATTR_LER, cc) > rnd(10000) ) {
-			skillexp SKILL_NORMAL_DISARM_TRAP, cc, 50
-		}
+		skillexp SKILL_NORMAL_DISARM_TRAP, cc, 100
 	}
 	cell_featset movx, movy, 0
-	txt lang("罠を解除した。", "The trap was disarmed.")
+	txt lang(name(cc) + "は罠を解除した。", name(cc) + " disarmed the trap.")
+	if ( cc == CHARA_PLAYER | cdata(CDATA_RELATION, cc) == RELATION_ALLY ) {
+		if ( feat(FEAT_CELL_SUB_FEATURE_ID) <= CELL_SUB_FEATURE_TRAP_QUEST_PITFALL2 ) {
+			gdata(GDATA_FLAG_ABYSS_POWER) += 3
+			if ( gdata(GDATA_FLAG_ABYSS_POWER) > 100000 ) {
+				gdata(GDATA_FLAG_ABYSS_POWER) = 100000
+			}
+			txt lang("深淵魔力を3獲得した[深淵魔力: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ", "You get 3 abyss powers.[Abyss power: " + gdata(GDATA_FLAG_ABYSS_POWER) + "] ")
+		}
+	}
 	if ( gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
 		if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_QUEST_MINE | feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL ) {
 			snd SOUNDLIST_DIG2
 			qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF))++
 			txtef COLOR_GREEN
@@ -277,19 +283,21 @@
 					feat(FEAT_CELL_PIC) = tile_trap
 				}
 			}
 			refdiff = 100 + gdata(GDATA_LEVEL) * 3 + gdata(GDATA_FLAG_MINEFIELD_QUEST_LEVEL) * 3
 			if ( feat(FEAT_CELL_PIC) == tile_trap ) {
-				refdiff = refdiff / 3
-				if ( sdata(SKILL_NORMAL_DISARM_TRAP, cc) != 0 ) {
-					gosub *calcDisarm
-					if ( stat == 1 ) {
-						gosub *disarmTrap
-						return
-					}
-					else {
-						txt lang("解除に失敗した。", "You fail to disarm the trap.")
+				if ( cdata(CDATA_RELATION, cc) != RELATION_ALLY | feat(FEAT_CELL_SUB_FEATURE_ID) <= CELL_SUB_FEATURE_TRAP_QUEST_PITFALL2 ) {
+					refdiff = refdiff / 3
+					if ( sdata(SKILL_NORMAL_DISARM_TRAP, cc) != 0 ) {
+						gosub *calcDisarm
+						if ( stat == 1 ) {
+							gosub *disarmTrap
+							return
+						}
+						else {
+							txt lang("解除に失敗した。", "You fail to disarm the trap.")
+						}
 					}
 				}
 			}
 			gosub *calcTrap
 			if ( stat == 1 ) {
@@ -311,10 +319,35 @@
 				}
 				efsource = 5
 				if ( synccheck(cc, -1) ) {
 					txt lang(aln(cc) + "罠にかかった！", name(cc) + " activate" + _s(cc) + " a trap!")
 				}
+				if ( feat(FEAT_CELL_SUB_FEATURE_ID) >= CELL_SUB_FEATURE_TRAP_VIBRATING_SPEAR & feat(FEAT_CELL_SUB_FEATURE_ID) <= CELL_SUB_FEATURE_TRAP_PARALYZE_SPEAR ) {
+					cell_featset movx, movy, 0
+					dmg = ((sdata(SKILL_NORMAL_MAGIC_DEVICE, CHARA_PLAYER) + 1) / 5 + 5) * ((sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + 1) / 5 + 5) + rnd(sdata(SKILL_NORMAL_DISARM_TRAP, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1)
+					dmghp cc, dmg, (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */), SKILL_RESDMG_CRUSH, 1000
+					if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
+						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_VIBRATING_SPEAR ) {
+							dmgcon cc, CONDITION_DIM, sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + gdata(GDATA_LEVEL) * 2
+						}
+						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_POISON_SPEAR ) {
+							dmgcon cc, CONDITION_POISON, sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + gdata(GDATA_LEVEL) * 2
+						}
+						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_SLEEPY_SPEAR ) {
+							dmgcon cc, CONDITION_SLEEP, sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + gdata(GDATA_LEVEL) * 2
+						}
+						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_INK_SPEAR ) {
+							dmgcon cc, CONDITION_BLIND, sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + gdata(GDATA_LEVEL) * 2
+						}
+						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_SMELLY_SPEAR ) {
+							dmgcon cc, CONDITION_CONFUSE, sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + gdata(GDATA_LEVEL) * 2
+						}
+						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_PARALYZE_SPEAR ) {
+							dmgcon cc, CONDITION_PARALYZE, sdata(SKILL_NORMAL_DISARM_TRAP, CHARA_PLAYER) + gdata(GDATA_LEVEL) * 2
+						}
+					}
+				}
 				if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_BLIND ) {
 					if ( synccheck(cc, -1) ) {
 						txt lang("墨が噴き出した。", "Gallons of ink spreads.")
 					}
 					cell_featset movx, movy, 0
@@ -429,12 +462,14 @@
 						dmghp cc, limit((gdata(GDATA_LEVEL) + gdata(GDATA_FLAG_MINEFIELD_QUEST_LEVEL)) / 2 + limit(rnd(gdata(GDATA_LEVEL) + gdata(GDATA_FLAG_MINEFIELD_QUEST_LEVEL) + 1) * 2, 1, 9999) - cdata(CDATA_DV, cc), 2, 9999), DAMAGE_FROM_TRAP
 					}
 					if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_PITFALL ) {
 						dmghp cc, limit(gdata(GDATA_LEVEL) / 2 + limit(rnd(gdata(GDATA_LEVEL) + 1) * 2, 1, 9999) - cdata(CDATA_DV, cc), 2, 9999), (0 /*!!!@[CHARA_PLAYER @@@ DAMAGE_FROM_CHARA]@!!! */)
 					}
-					if ( cdata(CDATA_CONDITION_INVERT, cc) < 2 ) {
-						cdata(CDATA_CONDITION_INVERT, cc) = 2
+					if ( cdata(CDATA_EXIST, cc) == CHAR_STATE_ALIVE ) {
+						if ( cdata(CDATA_CONDITION_INVERT, cc) < 2 ) {
+							cdata(CDATA_CONDITION_INVERT, cc) = 2
+						}
 					}
 					if ( gdata(GDATA_QUEST) == QUEST_TYPE_MINEFIELD ) {
 						if ( feat(FEAT_CELL_SUB_FEATURE_ID) == CELL_SUB_FEATURE_TRAP_QUEST_PITFALL ) {
 							qdata(QDATA_PARAM2, gdata(GDATA_QUEST_REF))++
 							txtef COLOR_GREEN
@@ -3722,10 +3757,16 @@
 		return
 	}
 	if ( gdata(GDATA_GOD_TALK) ) {
 		txtgod cdata(CDATA_GOD, CHARA_PLAYER), GOD_TEXT_SLEEP
 	}
+	if ( gdata(GDATA_HOUR) >= 21 & gdata(GDATA_HOUR) < 24 ) {
+		snd SOUNDLIST_WRITE1
+		txtef COLOR_GREEN
+		txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+		cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER)++
+	}
 	redraw 0
 	gosub *sleep_draw_init
 	musicloop = 1
 	music = MUSICLIST_MCCODA
 	gosub *music_play
@@ -3772,11 +3813,11 @@
 			cbitmod (974 /*!!!@[CHARA_BIT_EXCLUSIVE_SKILL_CHARGE @@@ CHARA_BIT_LAY_HAND_CHARGE]@!!! */), tc, TRUE
 		}
 	loop
 	cdata(CDATA_EVOCHAT_POINTS, CHARA_PLAYER) = 10
 	mode = MODELIST_TXT_ADV
-	timeslept = 7 + rnd(5)
+	timeslept = 7 + rnd(4)
 	item_find ITEM_ID_MANIS_ALARM_CLOCK, ITEM_FIND_MODE_DBID, ITEM_FIND_LOCATION_CHARAS
 	if ( stat != (-1) ) {
 		ci = stat
 		if ( inv(INV_ITEM_NUM, ci) >= 1 ) {
 			timeslept = 8
@@ -4263,21 +4304,30 @@
 			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 22 / 10
 		}
 		if ( gdata(GDATA_WEATHER) == WEATHER_ETHER ) {
 			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 5 / 10
 		}
-		cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 100 / (100 + gdata(GDATA_TRAVEL_SPEED) + sdata(SKILL_NORMAL_TRAVELING, CHARA_PLAYER))
 		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) > 0 ) {
-			cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 3 / 5
+			norimono = 500
+		}
+		else {
+			norimono = 0
 		}
+		cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 100 / (100 + gdata(GDATA_TRAVEL_SPEED) + sdata(SKILL_NORMAL_TRAVELING, CHARA_PLAYER) + norimono)
 		if ( gdata(GDATA_FLAG_WORLD_MAP_VEHICLE_KIND) == 2 ) {
 			if ( xy2pic(0, 1) <= map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_TILE_ID) & map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_TILE_ID) < xy2pic(24, 1) & map(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), MAP_TILE_ID) != xy2pic(11, 1) ) {
 				cdata(CDATA_ACTION_PERIOD, cc) = cdata(CDATA_ACTION_PERIOD, cc) * 3 / 5
 			}
 		}
 		return
 	}
+	if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 2 ) {
+		snd SOUNDLIST_WRITE1
+		txtef COLOR_GREEN
+		txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+		cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+	}
 	if ( cdata(CDATA_HUNGER, CHARA_PLAYER) <= 1600 & rnd(10) == 0 ) {
 		inv_getheader cc
 		f = 0
 		repeat invrange, invhead
 			if ( inv(INV_ITEM_NUM, cnt) == 0 ) {
@@ -4823,15 +4873,26 @@
 				}
 				if ( rnd(30) == 0 ) {
 					rtval = 38
 				}
 			}
-			if ( mdata(MDATA_TYPE) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) | mdata(MDATA_TYPE) == (27 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_LAKE]@!!! */) ) {
+			if ( mdata(MDATA_TYPE) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
 				if ( rnd(5) == 0 ) {
 					rtval = -1
 				}
 			}
+			if ( mdata(MDATA_TYPE) == (27 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_LAKE]@!!! */) ) {
+				if ( rnd(10) == 0 ) {
+					rtval = 220
+				}
+				if ( rnd(100) == 0 ) {
+					rtval = 1178
+				}
+				if ( rnd(120) == 0 ) {
+					rtval = 972
+				}
+			}
 			if ( mdata(MDATA_TYPE) == MAP_TYPE_FOREST ) {
 				if ( rnd(5) == 0 ) {
 					rtval = 942
 				}
 				if ( rnd(100) == 0 ) {
@@ -4902,15 +4963,26 @@
 							}
 							if ( rnd(30) == 0 ) {
 								rtval = 38
 							}
 						}
-						if ( mdata(MDATA_TYPE) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) | mdata(MDATA_TYPE) == (27 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_LAKE]@!!! */) ) {
+						if ( mdata(MDATA_TYPE) == (20 /*!!!@[MAP_TYPE_DUNGEON @@@ MAP_TYPE_DUNGEON_MIN]@!!! */) ) {
 							if ( rnd(5) == 0 ) {
 								rtval = -1
 							}
 						}
+						if ( mdata(MDATA_TYPE) == (27 /*!!!@[MAP_TYPE_DUNGEON_MAX @@@ MAP_TYPE_LAKE]@!!! */) ) {
+							if ( rnd(10) == 0 ) {
+								rtval = 220
+							}
+							if ( rnd(100) == 0 ) {
+								rtval = 1178
+							}
+							if ( rnd(120) == 0 ) {
+								rtval = 972
+							}
+						}
 						if ( mdata(MDATA_TYPE) == MAP_TYPE_FOREST ) {
 							if ( rnd(5) == 0 ) {
 								rtval = 942
 							}
 							if ( rnd(100) == 0 ) {
@@ -5104,10 +5176,18 @@
 		if ( cdata(CDATA_THIRST, cc) < 12000 ) {
 			if ( synccheck(cc, -1) ) {
 				txt lang("さらに、付属していた飲み物も飲んだ。", name(cc) + " also drank the beverage that came with the food.")
 			}
 			cdata(CDATA_THIRST, cc) += 2000
+			if ( cc == CHARA_PLAYER ) {
+				if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+					snd SOUNDLIST_WRITE1
+					txtef COLOR_GREEN
+					txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+					cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+				}
+			}
 		}
 	}
 	gosub *insta_eat
 	rowactend cc
 	return
@@ -6129,10 +6209,18 @@
 	tc = cc
 	efsource = 4
 	if ( potionthrow ) {
 		cc = ccthrowpotion
 	}
+	if ( tc == CHARA_PLAYER ) {
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+			snd SOUNDLIST_WRITE1
+			txtef COLOR_GREEN
+			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+			cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+		}
+	}
 	if ( potionspill | potionthrow ) {
 		if ( potionthrow ) {
 			efp = sdata(SKILL_NORMAL_MAGIC_DEVICE, cc) * 5 + efp * potionthrow / 100
 			efstatus = inv(INV_ITEM_STATUS, ci)
 		}
@@ -6227,10 +6315,18 @@
 	if ( osakana == 100 ) {
 		valn = itemname(ci)
 		txt lang(name(cc) + "は" + valn + "の水をマグカップですくって飲んだ。", name(cc) + " draw" + _s(cc) + " water from " + valn + " by Mug of Ehekatl.")
 		txtmore
 	}
+	if ( cc == CHARA_PLAYER ) {
+		if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+			snd SOUNDLIST_WRITE1
+			txtef COLOR_GREEN
+			txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+			cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+		}
+	}
 	tc = cc
 	cibk = ci
 	p = rnd(100)
 	repeat 1
 		if ( 0 ) {
@@ -6675,11 +6771,11 @@
 	}
 	return 1
 
 *effect_selectTg
 	noeffect = 0
-	if ( efid > 848 ) {
+	if ( efid > MAX_SKILL ) {
 		tc = cc
 		return 1
 	}
 	tg = sdataref(SKILL_DATAREF_TG, efid) / 1000 * 1000
 	if ( efsource == 1 ) {
@@ -6928,11 +7024,11 @@
 
 
 
 
 	if ( efid >= SKILL_ACTIVE_PICKPOCKET ) {
-		if ( efid < 848 ) {
+		if ( efid < MAX_SKILL ) {
 			f = 0
 			if ( sdataref(SKILL_DATAREF_TYPE, efid) / 1000 == 1 ) {
 				f = 1
 				p = sdataref(SKILL_DATAREF_TYPE, efid) \ 1000
 				if ( bdataref(BDATAREF_BUFF_TYPE, p) == BUFF_TYPE_HEX ) {
@@ -7965,10 +8061,18 @@
 								}
 								else {
 									txt lang(name(cc) + "に血を吸われた。", name(cc) + " suck" + _s(cc) + " " + name(tc) + your(tc) + " blood.")
 								}
 							}
+							if ( cc == CHARA_PLAYER ) {
+								if ( cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) == 1 ) {
+									snd SOUNDLIST_WRITE1
+									txtef COLOR_GREEN
+									txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+									cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) += 1000
+								}
+							}
 							gain_iden tc, cc, 5
 						}
 						else {
 							if ( synccheck(cc, -1) ) {
 								if ( tc >= MAX_CHARA_FOLLOWER ) {
@@ -8368,22 +8472,10 @@
 								characreate -1, CREATURE_ID_YOMAGNTHO, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
 								cbitmod CHARA_BIT_SUMMONED, rc, TRUE
 							}
 						}
 						if ( 0 ) {
-							flt
-							characreate -1, 1072, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
-							flt
-							characreate -1, 1071, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
-							flt
-							characreate -1, 1070, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
-							flt
-							characreate -1, MAX_CREATURE_ID, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
-							flt
-							characreate -1, 1068, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
-							flt
-							characreate -1, 1067, cdata(CDATA_X, tc), cdata(CDATA_Y, tc)
 						}
 					}
 					if ( efid != SKILL_SPACT_SUMMON_SISTER ) {
 						if ( cdata(CDATA_ID, rc) == cdata(CDATA_ID, cc) ) {
 							if ( cdata(CDATA_ID, cc) != CREATURE_ID_POWERFUL_GREAT_WYRM ) {
@@ -12290,10 +12382,87 @@
 		}
 		attackskill = SKILL_WEAPON_CROSSBOW
 		goto *effect_end
 		_switch_sw++
 	}
+	if ( _switch_val == 849 | _switch_sw ) {
+		_switch_sw = 0
+		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
+			txt lang("何もおきない… ", "Nothing happens...")
+			goto *effect_end
+		}
+		cdata(CDATA_POWER_GAUGE, cc) -= 100
+		if ( cdata(CDATA_POWER_GAUGE, cc) >= 100 ) {
+			snd SOUNDLIST_POWER
+			exgauge = 100
+			if ( gdata(GDATA_TIME_STOP_TIME) == 0 ) {
+				gdata(GDATA_TIME_STOP_TIME) = 2
+			}
+		}
+		txtef COLOR_YELLOW
+		txt lang("*" + skillname(efid) + "*　", "*" + skillname(efid) + "* ")
+		weap = sdata(SKILL_ATTR_STR, cc) / 2
+		snd SOUNDLIST_ENC
+		animeload 40, cc
+		snd SOUNDLIST_ATK_ELEC
+		animeload 68, cc
+		customtalk cc, DBMODE_FLAVOR_SPECIAL
+		gosub *convert_word
+		if ( rnd(sdata(SKILL_NORMAL_GREATER_EVASION, tc) + 1000) > rnd(4000) ) {
+			if ( cbit(CHARA_BIT_SANDBAG, tc) != TRUE ) {
+				txtef COLOR_RED
+				txt lang(name(tc) + "は咄嗟に" + name(cc) + "の攻撃を防いだ！", name(cc) + " bluntly prevented the attack!")
+				snd SOUNDLIST_AMMO
+				weap = limit(weap * 2 - sdata(SKILL_NORMAL_GREATER_EVASION, tc), 2, 4000) / 2
+			}
+		}
+		potionc = inv(INV_ITEM_COL, cipk)
+		snd SOUNDLIST_HAWK1
+		animeid = ANIMATION_HYPER_PLUG_BURST
+		gosub *anime
+		inv_getheader cc
+		eqlv = 1
+		eqbui = 0
+		repeat invrange, invhead
+			if ( inv(INV_ITEM_NUM, cnt) == 0 | inv(INV_ITEM_EQUIP, cnt) == 0 ) {
+				continue
+			}
+			eqlv += limit(inv(INV_ITEM_LEVEL, cnt), 0, 20)
+			eqbui++
+		loop
+		if ( eqlv <= 0 ) {
+			eqlv = 1
+		}
+		if ( eqbui <= 0 ) {
+			eqbui = 1
+		}
+		eqlv = limit(eqlv / eqbui * 3, 3, 30)
+		dmghp tc, limit(cdata(CDATA_DAMAGE_FIX, cc) + (weap + 1) / 2, 2, 2500) * sqrt(weap) * sqrt(eqlv - 2) + rnd(weap + 1), cc, SKILL_SPACT_FLASH_OF_SWIFTNESS
+		if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != TRUE & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != TRUE & cbit(CHARA_BIT_SUMMONED, tc) != TRUE & cbit(CHARA_BIT_LIVESTOCK, tc) != TRUE & cbit(CHARA_BIT_NECRO, tc) != TRUE & cbit(CHARA_BIT_SANDBAG, tc) != TRUE ) {
+			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
+			skillexp SKILL_NORMAL_MARKSMAN, cc, 400
+		}
+		eqlv = 0
+		eqbui = 0
+		inv(INV_ITEM_LEVEL, cipk) = 3
+		if ( inv(INV_ITEM_ID, cipk) == ITEM_ID_CF_POTIOMAN ) {
+			inv(INV_ITEM_LEVEL, cipk) = 4
+		}
+		txtnew
+		txtef COLOR_SKY_BLUE
+		txt lang("Potion-charge Lv" + inv(INV_ITEM_LEVEL, cipk) + "!!", "Potion-charge Lv" + inv(INV_ITEM_LEVEL, cipk) + "!!")
+		hozyuu = 4 - inv(INV_ITEM_PARAM2, cipk)
+		if ( gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) >= hozyuu ) {
+			gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) -= hozyuu
+			txt lang(name(cc) + "はポーションの栓を込めた。[残り" + gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) + "個]", name(cc) + " put potion plugs.[Remaining plug " + gdata(GDATA_FLAG_TOTAL_POTION_PLUGS) + "]")
+			inv(INV_ITEM_PARAM2, cipk) = 4
+		}
+		cdata(CDATA_GAUGE_COOLDOWN, cc) = 1
+		weap = 0
+		goto *effect_end
+		_switch_sw++
+	}
 	if ( _switch_val == 796 | _switch_sw ) {
 		_switch_sw = 0
 		if ( cdata(CDATA_POWER_GAUGE, cc) < 100 ) {
 			txt lang("何もおきない… ", "Nothing happens...")
 			goto *effect_end
@@ -16075,10 +16244,69 @@
 			inv(INV_ITEM_VALUE, ci) = 1
 		}
 		goto *effect_end
 		_switch_sw++
 	}
+	if ( _switch_val == 848 | _switch_sw ) {
+		_switch_sw = 0
+		txt lang("対象にするアイテムは？", "Which item?")
+		invsubroutine = 1
+		invctrl = INVCTRL_MATERIAL_ENCHANT, 28
+		snd SOUNDLIST_INV
+		gosub *com_inventory
+		if ( stat == 1 ) {
+			item_separate ci
+			txtsetcustom 7
+			repeat 7
+				promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+				promptmax++
+			loop
+			val = promptx, prompty, 280, 1
+			gosub *prompt_key
+			if ( stat == 0 ) {
+				goto *effect_end
+			}
+			if ( rtval == 0 ) {
+				goto *effect_end
+			}
+			if ( rtval == inv(INV_ITEM_PARAM3, ci) \ 100 ) {
+				snd SOUNDLIST_FAIL1
+				txt lang("それは機能が被っている…。", "It has the same performance...")
+				goto *effect_end
+			}
+			snd SOUNDLIST_AMMO
+			inv(INV_ITEM_AMUR_CAGE, ci) = rtval
+			txtef COLOR_YELLOW
+			txt lang("Ｘフレームチェンジ！", "X-Frame Change!")
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 1 ) {
+				txtef COLOR_YELLOW
+				txt lang("スピニングフット！", "Spinning Foot!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 2 ) {
+				txtef COLOR_YELLOW
+				txt lang("マイティアーム！", "Mighty Arm!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 3 ) {
+				txtef COLOR_YELLOW
+				txt lang("デュアルコア！", "Dual Core!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 4 ) {
+				txtef COLOR_YELLOW
+				txt lang("ラピッドサーバー！", "Rapid Server!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 5 ) {
+				txtef COLOR_YELLOW
+				txt lang("スナイプヘッド！", "Snipe Head!")
+			}
+			if ( inv(INV_ITEM_AMUR_CAGE, ci) == 6 ) {
+				txtef COLOR_YELLOW
+				txt lang("デシーヴバレル！", "Deceive Barrel!")
+			}
+		}
+		goto *effect_end
+		_switch_sw++
+	}
 	if ( _switch_val == 700 | _switch_sw ) {
 		_switch_sw = 0
 		if ( cbit(CHARA_BIT_AWAKE_MAGIC_ATTACK, cc) ) {
 			tc = cdata(CDATA_TARGET, cc)
 			gosub *act_melee
@@ -17835,11 +18063,11 @@
 				cdata(CDATA_CONDITION_BIND, tc)++
 			}
 			if ( cbit(CHARA_BIT_SPLIT_KEEP_EFFECT, tc) != TRUE & cbit(CHARA_BIT_SPLIT_NO_EFFECT, tc) != TRUE & cbit(CHARA_BIT_SUMMONED, tc) != TRUE & cbit(CHARA_BIT_LIVESTOCK, tc) != TRUE & cbit(CHARA_BIT_NECRO, tc) != TRUE & cbit(CHARA_BIT_SANDBAG, tc) != TRUE & tc != CHARA_PLAYER ) {
 				f = 1
 			}
-			dmghp tc, dmg, cc, MAX_SKILL_RESDMG, 1000
+			dmghp tc, dmg, cc, SKILL_RESDMG_CONSTITUTION, 1000
 		loop
 		if ( f == 1 ) {
 			f = 0
 			skillexp SKILL_NORMAL_MAGIC_CAPACITY, cc, 50
 		}
@@ -19300,11 +19528,11 @@
 				txt lang("まるで生きているかのように、" + s + "が" + name(tc) + "に絡みついた！", "As if it were alive, the " + s + " caught " + name(tc) + "!")
 				snd SOUNDLIST_EAT1
 				if ( cdata(CDATA_CONDITION_BIND, tc) < 1 ) {
 					cdata(CDATA_CONDITION_BIND, tc) = 1
 				}
-				dmghp tc, (sdata(SKILL_ATTR_MAG, cc) / 5 + 5) * ((sdata(SKILL_NORMAL_CONTROL_MAGIC, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_MAG, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 2, cc, MAX_SKILL_RESDMG, 1000
+				dmghp tc, (sdata(SKILL_ATTR_MAG, cc) / 5 + 5) * ((sdata(SKILL_NORMAL_CONTROL_MAGIC, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_MAG, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 2, cc, SKILL_RESDMG_CONSTITUTION, 1000
 				if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
 					p = 12 - 10
 					if ( cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | encfind(tc, 6 * 10000 + 10 + p) != (-1) ) {
 						p = -1
 					}
@@ -19641,18 +19869,36 @@
 			dmgsp CHARA_PLAYER, dmg
 		}
 		if ( tc != CHARA_PLAYER ) {
 			dmgspt tc, dmg
 		}
-		if ( jp ) {
-			txt name(tc) + "は苦しそうに笑っている！", "「ひっ！ひィィ！やめっ…でっ！」", "「あはははははっはははははは！！！」", "「はははっはは…げほっ！げほっ！！ううう…ぐえっ！」", "「んぎいいい！？いっ…ひいいい！！！」", "「ぐっあああ…！はぁーっ！あはははっ…！」", "「こ、こしょばゆいいいいい！！！」"
+		if ( cdata(CDATA_CONDITION_SUFFOCATION, tc) == 0 ) {
+			cdata(CDATA_CONDITION_SUFFOCATION, tc) += 3
 		}
 		if ( sdata(SKILL_ATTR_PER, tc) > sdata(SKILL_ATTR_CON, tc) ) {
 			cdata(CDATA_POWER_GAUGE, tc) -= 10
+			if ( jp ) {
+				txt name(tc) + "は笑いながら悶えている！", name(tc) + "は目と口を必死に閉じようとしている！", name(tc) + "は激しく身をよじっている！", name(tc) + "は涙や汗を流して笑っている！"
+			}
+			if ( en ) {
+				txt name(tc) + " writh" + _s(tc) + " with a laugh!", name(tc) + " squirm" + _s(tc) + " hard!"
+			}
+		}
+		if ( jp ) {
+			txt "「ひっ！ひィィ！」", "「あはははっ！！」", "「はははっはは！」", "「んぎいいい！？」", "「ぐっああ…！はぁーっ！」", "「イッ…ひっひひいい…！」", "「くうっ…んん！！」", "「やめっ！やめ…！」"
+		}
+		if ( en ) {
+			txt name(tc) + " " + cnvtalk("Whe! hiii!"), name(tc) + " " + cnvtalk("Ahahahaaa!"), name(tc) + " " + cnvtalk("Haaa...!"), name(tc) + " " + cnvtalk("Ngiii!?")
 		}
 		if ( cdata(CDATA_SP, tc) < cdata(CDATA_MAX_SP, tc) / 2 ) {
 			dmgsan tc, rnd(rnd(1 + sdata(SKILL_ATTR_DEX, cc) / 20) * 10 + 2) + 1
+			if ( jp ) {
+				txt "「やめっ…でぇぇっ！」", "「ひゃはははは！！！」", "「…げほっ！げほっ！！ううう…ぐえっ！」", "「いっ…ひいいい！！！」", "「あ、あはははっ…！」", "「あ、ひゃあああアアアアアッ！！？」", "「んひいいいッ…！！！」", "「ぎいいいああああっ！！」"
+			}
+			if ( en ) {
+				txt name(tc) + " " + cnvtalk("Hyahahahaaa!!"), name(tc) + " " + cnvtalk("Ahyaaaaa!?"), name(tc) + " " + cnvtalk("Giyaaaaa!!"), name(tc) + " " + cnvtalk("S...stooop...!")
+			}
 		}
 		goto *effect_end
 		_switch_sw++
 	}
 	if ( _switch_val == 710 | _switch_sw ) {
@@ -19733,11 +19979,11 @@
 					goto *effect_end
 				}
 			loop
 		}
 		soine = 0
-		if ( gdata(GDATA_SLEEP) >= 15 ) {
+		if ( gdata(GDATA_SLEEP) >= 13 ) {
 			if ( cc == CHARA_PLAYER ) {
 				if ( map(cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), MAP_ITEM_CHIPS) != 0 ) {
 					cell_itemlist cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER)
 					f = 0
 					repeat listmax
@@ -19838,13 +20084,13 @@
 			snd SOUNDLIST_DRINK1
 			await 100
 			snd SOUNDLIST_DRINK1
 			await 100
 			snd SOUNDLIST_DRINK1
-			dmghp tc, (sdata(SKILL_ATTR_STR, cc) / 5 + 5) * ((sdata(SKILL_ATTR_STR, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_STR, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 2, cc, MAX_SKILL_RESDMG, 1000
+			dmghp tc, (sdata(SKILL_ATTR_STR, cc) / 5 + 5) * ((sdata(SKILL_ATTR_STR, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_STR, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 2, cc, SKILL_RESDMG_CONSTITUTION, 1000
 			if ( cbit(CHARA_BIT_VINDALIAN_JIUJITSU_ACTIVE, cc) == TRUE ) {
-				dmghp tc, (sdata(SKILL_ATTR_DEX, cc) / 5 + 5) * ((sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_DEX, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 4, cc, MAX_SKILL_RESDMG, 1000
+				dmghp tc, (sdata(SKILL_ATTR_DEX, cc) / 5 + 5) * ((sdata(SKILL_WEAPON_MARTIAL_ARTS, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_ATTR_DEX, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 4, cc, SKILL_RESDMG_CONSTITUTION, 1000
 				if ( cdata(CDATA_CONDITION_BIND, tc) == 1 ) {
 					cdata(CDATA_CONDITION_BIND, tc) = 2
 				}
 				if ( cdata(CDATA_CONDITION_BIND, cc) < 2 ) {
 					cdata(CDATA_CONDITION_BIND, cc) = 2
@@ -21289,11 +21535,11 @@
 		if ( inv_getspace(tc) == 0 ) {
 			txt lang("…しかし" + name(tc) + "はこれ以上持てなかった。", "...but " + name(tc) + " could not have any more.")
 			goto *effect_end
 		}
 		flt
-		itemcreate tc, 1267, -1, -1, 0
+		itemcreate tc, ITEM_ID_SLIME_FUKAGURUMI, -1, -1, 0
 		cdata(CDATA_POWER_GAUGE, tc) -= 20
 		if ( cdata(CDATA_POWER_GAUGE, tc) < 0 ) {
 			cdata(CDATA_POWER_GAUGE, tc) = 0
 		}
 		cdata(CDATA_POWER_GAUGE, cc) += 20
@@ -21337,12 +21583,20 @@
 				}
 				gdata(GDATA_FLAG_WORK_A_REMAINING) = 0
 				gdata(GDATA_FLAG_WORK_B_REMAINING) = 0
 				gdata(GDATA_FLAG_WORK_C_REMAINING) = 0
 				seiton = 4
-				flt
-				itemcreate -1, ITEM_ID_CF_POTIOMAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				repeat 10
+					flt
+					itemcreate -1, ITEM_ID_CF_POTIOMAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					flt
+					itemcreate -1, ITEM_ID_CRUSH_POTIOMAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					flt
+					itemcreate -1, ITEM_ID_BATTLE_POTIOMAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+					flt
+					itemcreate -1, ITEM_ID_SUPER_POTIOMAN, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+				loop
 				gdata(GDATA_FLAG_SUB_SLIME) = 1000
 				gdata(GDATA_FLAG_SUB_ROGUE) = 1000
 				gdata(GDATA_FLAG_SUB_NIGHTMARE) = 1000
 				gdata(GDATA_FLAG_SUB_MOTHER) = 1000
 				gdata(GDATA_FLAG_SUB_WIFE) = 1000
@@ -21396,10 +21650,11 @@
 				loop
 				cdata(CDATA_PIETY, CHARA_PLAYER) = sdata(SKILL_NORMAL_FAITH, CHARA_PLAYER) * 100
 				gdata(GDATA_RANK_HOME) = 100
 				gdata(GDATA_WORLD_RENEW) = TRUE
 				gdata(GDATA_MONTH) = 11
+				gdata(GDATA_HOUR) = 23
 				gosub *advance_hour
 				gdata(GDATA_GUEST) = 2
 				gdata(GDATA_WORLD) = AREA_LOST_YLVA
 				gdata(GDATA_FLAG_SCROLL_OF_WITCHCRAFT_TOTAL_SPELL_BONUS) += 95
 				cdata(CDATA_SKILLPOINT, CHARA_PLAYER) += 95
@@ -21429,11 +21684,10 @@
 					cdata(CDATA_SKILLPOINT, cnt) += 100
 					cdata(CDATA_AP_CURRENT, cnt) += 1000
 					cdata(CDATA_SALES_EXP, cnt) = 1000
 					cdata(CDATA_LIVESTOCK_QUALITY, cnt) = rnd(12) + 1
 					cdata(CDATA_LIVESTOCK_PRODUCE_QUALITY, cnt) = rnd(12) + 1
-					cbitmod CHARA_BIT_AWAKE_MP_BARRIER, cnt, TRUE
 					if ( cnt != 0 ) {
 						cdata(CDATA_SP, cnt) = 0
 					}
 					txt lang("deru" + gdata(GDATA_FLAG_RARE_DROP) + "、" + gdata(GDATA_FLAG_REALTIME_MINUTES) + "だ。運勢は" + sdata(SKILL_ATTR_LUC, CHARA_PLAYER) + "。", "*" + skillname(efid) + "* ")
 				loop
@@ -21853,10 +22107,143 @@
 			}
 		}
 		goto *effect_end
 		_switch_sw++
 	}
+	if ( _switch_val == 850 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *effect_end
+		}
+		if ( tc != CHARA_PLAYER & cdata(CDATA_ALLIED, tc) != 100 ) {
+			txt lang("何もおきない… ", "Nothing happens...")
+			goto *effect_end
+		}
+		txtsetlimitp 10
+		repeat 10
+			promptl(0, promptmax) = s(cnt), key_select(cnt), "" + promptmax
+			promptmax++
+		loop
+		val = promptx, prompty, 200, 1
+		gosub *prompt_key
+		if ( stat == 0 ) {
+			gosub *screen_draw
+			goto *effect_end
+		}
+		if ( rtval == 0 ) {
+			goto *effect_end
+		}
+		kaiwa = rtval
+		cdata(CDATA_POWER_GAUGE, tc) = 0
+		cdata(CDATA_HIRE_DATE, tc) = kaiwa
+		snd SOUNDLIST_LOCKED1
+		animeload 80, tc
+		txt lang(name(tc) + "の能力が一時的に制限された。", name(tc) + " status are temporarily limited.")
+		r1 = tc
+		gosub *charaRefresh
+		if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) ) {
+			cdata(CDATA_HP, tc) = cdata(CDATA_MAX_HP, tc)
+		}
+		if ( cdata(CDATA_MP, tc) > cdata(CDATA_MAX_MP, tc) ) {
+			cdata(CDATA_MP, tc) = cdata(CDATA_MAX_MP, tc)
+		}
+		if ( cdata(CDATA_SP, tc) > cdata(CDATA_MAX_SP, tc) ) {
+			cdata(CDATA_SP, tc) = cdata(CDATA_MAX_SP, tc)
+		}
+		goto *effect_end
+		_switch_sw++
+	}
+	if ( _switch_val == 851 | _switch_sw ) {
+		_switch_sw = 0
+		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
+			goto *effect_end
+		}
+		if ( tc != CHARA_PLAYER & cdata(CDATA_ALLIED, tc) != 100 ) {
+			txt lang("何もおきない… ", "Nothing happens...")
+			goto *effect_end
+		}
+		if ( cdata(CDATA_HIRE_DATE, tc) <= 0 | cdata(CDATA_HIRE_DATE, tc) >= 10 ) {
+			txt lang(name(tc) + "は能力を制限されていない。", name(tc) + " status are not limited.")
+			goto *effect_end
+		}
+		if ( cdata(CDATA_POWER_GAUGE, tc) < 50 ) {
+			txt lang("何もおきない… ", "Nothing happens...")
+			goto *effect_end
+		}
+		if ( synccheck(tc, -1) ) {
+			animeid = ANIMATION_GIGA
+			gosub *anime
+		}
+		waitbk = cfg_animewait
+		if ( cfg_animewait > 0 ) {
+			cfg_animewait = 1
+		}
+		map(cdata(CDATA_X, tc), cdata(CDATA_Y, tc), MAP_TILE_ID) = xy2pic(12, 0)
+		repeat 4
+			animeload 68, tc
+			snd SOUNDLIST_BREATH1
+		loop
+		cfg_animewait = waitbk
+		limitlv = cdata(CDATA_HIRE_DATE, tc)
+		cdata(CDATA_HIRE_DATE, tc) = 0
+		r1 = tc
+		gosub *charaRefresh
+		limitp = 0
+		repeat 20 - 10
+			if ( cnt == 18 ) {
+				limitp += sdata(10 + cnt, tc) * limitlv / 10
+			}
+			if ( cnt != 18 & cnt != 19 ) {
+				limitp += sdata(10 + cnt, tc) * limitlv / (limitlv + 1)
+			}
+		loop
+		cdata(CDATA_HIRE_DATE, tc) = 0
+		r1 = tc
+		gosub *charaRefresh
+		healsp tc, cdata(CDATA_MAX_SP, tc) / 2
+		healhp tc, cdata(CDATA_MAX_HP, tc) / 2
+		healmp tc, cdata(CDATA_MAX_MP, tc) / 2
+		addbuff tc, BUFF_HOLY_SHIELD, limitp, 200
+		addbuff tc, BUFF_FEATHER, limitp, 200
+		addbuff tc, BUFF_ATTRIBUTE_SHIELD, limitp, 200
+		addbuff tc, BUFF_SUPER_REGEN, limitp, 200
+		addbuff tc, BUFF_HOLY_VEIL, limitp, 200
+		cc = tc
+		repeat 245
+			if ( cdata(CDATA_EXIST, cnt) != CHAR_STATE_ALIVE ) {
+				continue
+			}
+			if ( cc == cnt ) {
+				continue
+			}
+			if ( cc < MAX_CHARA_FOLLOWER ) {
+				if ( cdata(CDATA_RELATION, cnt) != RELATION_ENEMY ) {
+					continue
+				}
+			}
+			if ( cc >= MAX_CHARA_FOLLOWER ) {
+				if ( cdata(CDATA_RELATION, cnt) == cdata(CDATA_RELATION, cc) ) {
+					continue
+				}
+			}
+			tc = cnt
+			dx = cdata(CDATA_X, tc)
+			dy = cdata(CDATA_Y, tc)
+			if ( dist(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) > sdataref(SKILL_DATAREF_TG, SKILL_SPACT_CHEER) \ 1000 + 1 ) {
+				continue
+			}
+			if ( fov_los(cdata(CDATA_X, cc), cdata(CDATA_Y, cc), dx, dy) == 0 ) {
+				continue
+			}
+			dmg = (limitp / 5 + 5) * (limitlv + 5) + rnd(limitp + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 10
+			dmghp tc, dmg, cc, SKILL_RESDMG_CONSTITUTION, 1000
+		loop
+		limitlv = 0
+		limitp = 0
+		goto *effect_end
+		_switch_sw++
+	}
 	if ( _switch_val == 845 | _switch_sw ) {
 		_switch_sw = 0
 		if ( mdata(MDATA_TYPE) == MAP_TYPE_WORLD ) {
 			goto *effect_end
 		}
@@ -21952,13 +22339,14 @@
 			}
 			if ( cc == CHARA_PLAYER ) {
 				cell_featset cdata(CDATA_X, tc), cdata(CDATA_Y, tc), tile_trap, -1, -1
 			}
 		}
-		gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) = 0
+		gdata(GDATA_TEMPORARY_FLAGS2) = 4771
+		dmghp tc, (sdata(SKILL_ATTR_PER, cc) / 5 + 5) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_NORMAL_GENE_ENGINEER, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 3, cc, SKILL_RES_NERVE, sdata(SKILL_ATTR_PER, cc) + 200
+		gdata(GDATA_TEMPORARY_FLAGS2) = 0
 		if ( cdata(CDATA_HP, tc) > cdata(CDATA_MAX_HP, tc) / 9 ) {
-			dmghp tc, (sdata(SKILL_ATTR_PER, cc) / 5 + 5) * ((sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 1) / 5 + 5) + rnd(sdata(SKILL_NORMAL_GENE_ENGINEER, cc) * 2 + 5) + ((limit(cdata(CDATA_LEVEL, cc) - 50, 1, 2000) + limit(cdata(CDATA_LEVEL, cc) - 100, 1, 2000)) * 2 * sqrt(limit(cdata(CDATA_LEVEL, cc), 1, 2000) * 3) + 30 + 1) / 3, cc, SKILL_RES_NERVE, sdata(SKILL_ATTR_PER, cc) + 200
 			goto *effect_end
 		}
 		if ( tc < MAX_CHARA_FOLLOWER | cdata(CDATA_RELATION, tc) == RELATION_ALLY | cdata(CDATA_ALLIED, tc) != 0 ) {
 			goto *effect_end
 		}
@@ -21987,69 +22375,18 @@
 		}
 		if ( gdata(GDATA_AREA) == AREA_SHOW_HOUSE ) {
 			goto *effect_end
 		}
 		skillexp SKILL_NORMAL_GENE_ENGINEER, cc, 50
-		if ( rnd(175) == 0 | gdata(GDATA_FLAG_DUEL_TARGET) == (-2) | cdata(CDATA_QUALITY, tc) == FIX_QUALITY_UNIQUE | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_KING | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_QUEEN | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JACK | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JOKER | cdata(CDATA_ID, tc) == CREATURE_ID_AILE_THE_ATTENDANT | (cdata(CDATA_QUALITY, tc) == FIX_QUALITY_MIRACLE & rnd(2) == 0) | (cdata(CDATA_QUALITY, tc) == FIX_QUALITY_GODLY & rnd(3) == 0) | (cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT & rnd(35) == 0) ) {
+		gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) = -1
+		if ( int(sqrt(sdata(SKILL_NORMAL_GENE_ENGINEER, cc) + 100)) > rnd(150) | rnd(60) == 0 | gdata(GDATA_FLAG_DUEL_TARGET) == (-2) | cdata(CDATA_QUALITY, tc) == FIX_QUALITY_UNIQUE | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_KING | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_QUEEN | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JACK | cdata(CDATA_ID, tc) == CREATURE_ID_UNITDEAD_JOKER | cdata(CDATA_ID, tc) == CREATURE_ID_AILE_THE_ATTENDANT | (cdata(CDATA_QUALITY, tc) == FIX_QUALITY_MIRACLE & rnd(2) == 0) | (cdata(CDATA_QUALITY, tc) == FIX_QUALITY_GODLY & rnd(3) == 0) | (cdata(CDATA_GOD, CHARA_PLAYER) == GOD_YACATECT & rnd(35) == 0) ) {
 			gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) = 100
 		}
 		if ( rollanatomy == 1 | cdata(CDATA_QUALITY, tc) >= FIX_QUALITY_MIRACLE | dbg_corpse | (adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, tc) == TRUE & cdata(CDATA_CONDITION_SICK, tc) == 0) ) {
 			gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) = 100
 		}
-		if ( 0 ) {
-			gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) = 100
-		}
-		if ( gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) == 100 ) {
-			if ( synccheck(tc, -1) ) {
-				snd SOUNDLIST_STAB
-				txtef COLOR_RED
-				if ( tc >= MAX_CHARA_FOLLOWER ) {
-					gdata(GDATA_DMG_TYPE) = 2
-					txt3rd = 1
-					txt lang(name(cc) + "は" + name(tc) + "を人形に変えて事実上", name(cc) + " change" + _s(cc) + " " + name(tc) + " into a doll and")
-				}
-				else {
-					txt lang(name(cc) + "は" + name(tc) + "の自由を奪い、人形に変えた。", name(cc) + " change" + _s(cc) + " " + name(tc) + " into a doll.")
-				}
-			}
-			situ = 0
-			if ( cdata(CDATA_LIVESTOCK_QUALITY, tc) >= 1 & cdata(CDATA_LIVESTOCK_QUALITY, tc) <= 3 ) {
-				situ = cdata(CDATA_LIVESTOCK_QUALITY, tc)
-			}
-			flt
-			itemcreate -1, ITEM_ID_CORPSE, cdata(CDATA_X, tc), cdata(CDATA_Y, tc), 0
-			inv(INV_ITEM_PIC, ci) = xy2pic(30, 33)
-			inv(INV_ITEM_PARAM2, ci) = 10
-			inv(INV_ITEM_PARAM3, ci) = gdata(GDATA_HOUR) + gdata(GDATA_DAY) * 24 + gdata(GDATA_MONTH) * 24 * 30 + gdata(GDATA_YEAR) * 24 * 30 * 12 + 240
-			if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_RANCH & cbit(CHARA_BIT_LIVESTOCK, tc) == TRUE ) {
-				inv(INV_ITEM_LEVEL, ci) += limit(rnd((sdata(SKILL_NORMAL_ANATOMY, cc) + 1) / 20 + 2) + situ, 1, 10) + cdata(CDATA_BRUSH_LEVEL, tc)
-			}
-			else {
-				inv(INV_ITEM_LEVEL, ci) += cdata(CDATA_BRUSH_LEVEL, tc)
-				if ( adata(ADATA_ID, gdata(GDATA_AREA)) == AREA_AMUR_CAGE ) {
-					inv(INV_ITEM_AMUR_CAGE, ci) = 1
-				}
-			}
-			remain_make ci, tc
-			inv(INV_ITEM_COL, ci) = cdata(CDATA_PIC, tc) \ 1000 + cdata(CDATA_CHARA_PIC, tc) * 1000
-			inv(INV_ITEM_SUB_NAME, ci) = cdata(CDATA_ID, tc)
-			cell_refresh inv(INV_ITEM_X, ci), inv(INV_ITEM_Y, ci)
-		}
-		else {
-			if ( synccheck(tc, -1) ) {
-				snd SOUNDLIST_STAB
-				txtef COLOR_RED
-				if ( tc >= MAX_CHARA_FOLLOWER ) {
-					gdata(GDATA_DMG_TYPE) = 2
-					txt3rd = 1
-					txt lang(name(cc) + "は" + name(tc) + "を内部から崩壊させて", name(cc) + " burst" + _s(cc) + " " + name(tc) + your(tc) + " head by thread and")
-				}
-				else {
-					txt lang(name(tc) + "の身体が耐え切れずに崩壊した。", name(cc) + " burst" + _s(cc) + " " + name(tc) + your(tc) + " head by thread.")
-				}
-			}
-		}
+		snd SOUNDLIST_STAB
 		dmghp tc, cdata(CDATA_MAX_HP, tc), cc, SKILL_SPACT_DECAPITATION
 		gdata(GDATA_FLAG_FLESH_DOLL_LOOT_SPAWN) = 0
 		goto *effect_end
 		_switch_sw++
 	}
@@ -22188,11 +22525,11 @@
 		if ( findbuff(tc, BUFF_FEATHER) != (-1) ) {
 			dmg = dmg / 10
 		}
 		addbuff tc, BUFF_SLOW, sdata(SKILL_ATTR_CON, cc) / 2 + 150, 5
 		cdata(CDATA_CONDITION_GRAVITY, tc) += limit(gdata(GDATA_LEVEL) / 10, 1, 50) + 10 + rnd(10)
-		dmghp tc, dmg, cc, MAX_SKILL_RESDMG, 1000
+		dmghp tc, dmg, cc, SKILL_RESDMG_CONSTITUTION, 1000
 		if ( cdata(CDATA_EXIST, tc) == CHAR_STATE_ALIVE ) {
 			powsel = 0
 			if ( gdata(GDATA_FLAG_MAIN) < 350 ) {
 				if ( cdata(CDATA_LEVEL, cc) >= 130 ) {
 					powsel = 100
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/quest.hsp ../2.17-borscht/quest.hsp
--- ../2.15R-borscht/quest.hsp	2023-05-12 09:08:04.363639100 +0800
+++ ../2.17-borscht/quest.hsp	2023-05-12 09:05:58.956003100 +0800
@@ -759,16 +759,21 @@
 			itemcreate -1, ITEM_ID_MUSIC_TICKET, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 1 + qdata(QDATA_PARAM2, rq) / 10
 		}
 	}
 	if ( qdata(QDATA_EXIST, rq) == QUEST_TYPE_MINEFIELD ) {
 		flt
-		itemcreate -1, ITEM_ID_DEVIL_FRAGMENT, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), limit(1 + qdata(QDATA_PARAM2, rq) / 5, 1, 30)
+		itemcreate -1, ITEM_ID_DEVIL_FRAGMENT, cdata(CDATA_X, CHARA_PLAYER), cdata(CDATA_Y, CHARA_PLAYER), 0
+		inv(INV_ITEM_PARAM2, ci) = limit(1 + qdata(QDATA_PARAM2, rq) / 5, 1, 30)
 		inv(INV_ITEM_STATUS, ci) = ITEM_STATUS_NORMAL
 		if ( qdata(QDATA_PARAM1, rq) * 125 / 100 <= qdata(QDATA_PARAM2, rq) | qdata(QDATA_VAR, rq) == 1 ) {
 			flt
 			itemcreate -1, ITEM_ID_BRONZE_COIN, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 1
 		}
+		repeat limit(1 + qdata(QDATA_PARAM1, rq) / 15, 1, 5)
+			flt calcobjlv(qdata(QDATA_PARAM2, rq))
+			itemcreate -1, ITEM_ID_ANCIENT_BOOK, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 1
+		loop
 	}
 	if ( qdata(QDATA_EXIST, rq) == QUEST_TYPE_HARVEST ) {
 		if ( qdata(QDATA_PARAM1, rq) * 125 / 100 < qdata(QDATA_PARAM2, rq) ) {
 			flt
 			itemcreate -1, ITEM_ID_BRONZE_COIN, cdata(CDATA_X, cc), cdata(CDATA_Y, cc), 1
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/screen.hsp ../2.17-borscht/screen.hsp
--- ../2.15R-borscht/screen.hsp	2023-05-12 09:08:04.446417400 +0800
+++ ../2.17-borscht/screen.hsp	2023-05-12 09:05:59.015441000 +0800
@@ -840,11 +840,11 @@
 		gcopy BUFFER_INF, 0 + en * 84, 416, 65 + en * 30, 15
 		pos sx + 6, sy + 1
 		mes _congravity
 		sy -= 20
 	}
-	if ( gdata(GDATA_SLEEP) >= 15 ) {
+	if ( gdata(GDATA_SLEEP) >= 13 ) {
 		if ( gdata(GDATA_SLEEP) >= 50 ) {
 			color 255, 0, 0
 			pos sx, sy
 			gcopy BUFFER_INF, 0 + en * 84, 416, 65 + en * 30, 15
 			pos sx + 6, sy + 1
@@ -1104,15 +1104,10 @@
 	}
 	if ( 0 ) {
 		paraa = tlocx
 		parab = tlocy
 		parac = gdata(GDATA_SLEEP_EXP)
-		if ( jp ) {
-			pos inf_clockw + 380, inf_clocky + 37
-			color 0, 0, 0
-			bmes "確認" + paraa + "、" + parab + "、" + parac + "。", 235, 235, 235
-		}
 	}
 	if ( gdata(GDATA_AREA) == AREA_AMUR_CAGE ) {
 		if ( gdata(GDATA_LEVEL) >= 10 ) {
 			if ( soulimit > 0 ) {
 				pos inf_clockw + 230, inf_clocky + 37
@@ -2136,15 +2131,10 @@
 			pos inf_clockw + 380, inf_clocky + 17
 			color 0, 0, 0
 			bmes " *Curtain Call* ", 235, 35, 35
 		}
 	}
-	if ( 0 ) {
-		pos inf_clockw + 380, inf_clocky + 7
-		color 0, 0, 0
-		bmes "*" + gdata(GDATA_FLAG_SUB_KARAVIKA_OF_SONG_AND_DANCE) + "*", 235, 235, 235
-	}
 	ap3 = 0
 	repeat 15
 		ap = gdata(750 + cnt) \ 10000
 		if ( ap == 0 ) {
 			continue
@@ -3371,10 +3361,14 @@
 		_switch_sw = 0
 		_switch_sw++
 	}
 	if ( _switch_val == 62 | _switch_sw ) {
 		_switch_sw = 0
+		_switch_sw++
+	}
+	if ( _switch_val == 63 | _switch_sw ) {
+		_switch_sw = 0
 		if ( synccheck(cc, -1) == 0 ) {
 			goto *anime_SWEND1
 		}
 		gsel BUFFER_ITEM
 		color 0
@@ -4048,10 +4042,62 @@
 						}
 					}
 				}
 			}
 		}
+		if ( animeid == ANIMATION_HYPER_PLUG_BURST ) {
+			gsel BUFFER_ITEM
+			color 0
+			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(8, 37)), chipi(CHIPI_HEIGHT, xy2pic(8, 37)) + 960
+			if ( 1229 == 528 ) {
+				gmode 2
+				pos 0, 960
+				gcopy BUFFER_ITEM, 0, 768, inf_tiles, inf_tiles
+				pos 0, 1008
+				gzoom 22, 20, 5, chipc(CHIPC_X, potionc) + 8, chipc(CHIPC_Y, potionc) + 4 + (chipc(CHIPC_HEIGHT, potionc) > inf_tiles) * 8, chipc(CHIPC_WIDTH, potionc) - 16, chipc(CHIPC_HEIGHT, potionc) - 8 - (chipc(CHIPC_HEIGHT, potionc) > inf_tiles) * 10, 1
+				pos 6, 974
+				gcopy BUFFER_ITEM, 0, 1008, 22, 20
+				gsel selcur
+			}
+			else {
+				if ( 1229 == 1119 ) {
+					pos 0, 1055 - chipc(CHIPC_HEIGHT, potionc)
+					gcopy BUFFER_CHR, chipc(CHIPC_X, potionc), chipc(CHIPC_Y, potionc), chipc(CHIPC_WIDTH, potionc), chipc(CHIPC_HEIGHT, potionc)
+					gmode 2
+					gsel selcur
+				}
+				else {
+					if ( 1229 == 1206 ) {
+						pos 0, 1055 - chipc(CHIPC_HEIGHT, potionc)
+						gcopy BUFFER_CHR, chipc(CHIPC_X, potionc), chipc(CHIPC_Y, potionc), chipc(CHIPC_WIDTH, potionc), chipc(CHIPC_HEIGHT, potionc)
+						gfini chipi(CHIPI_WIDTH, xy2pic(8, 37)), chipi(CHIPI_HEIGHT, xy2pic(8, 37))
+						gfdec2 0, 0, 255
+						gsel selcur
+					}
+					else {
+						if ( 1229 == 531 ) {
+							pos 8, 1058 - chipc(CHIPC_HEIGHT, potionc)
+							gcopy BUFFER_CHR, chipc(CHIPC_X, potionc) + 8, chipc(CHIPC_Y, potionc) + 2, chipc(CHIPC_WIDTH, potionc) - 16, chipc(CHIPC_HEIGHT, potionc) - 8
+							gmode 4, , , 150
+							color 0, 0, 0
+							pos 0, 960 + (chipc(CHIPC_HEIGHT, potionc) == inf_tiles) * 48
+							gcopy BUFFER_ITEM, 144, 768 + (chipc(CHIPC_HEIGHT, potionc) > inf_tiles) * 48, inf_tiles, chipc(CHIPC_HEIGHT, potionc) + (chipc(CHIPC_HEIGHT, potionc) > inf_tiles) * 48 * 0
+							gmode 2
+							gsel selcur
+						}
+						else {
+							pos 0, 960
+							gcopy BUFFER_ITEM, chipi(CHIPI_X, xy2pic(8, 37)), chipi(CHIPI_Y, xy2pic(8, 37)), chipi(CHIPI_WIDTH, xy2pic(8, 37)), chipi(CHIPI_HEIGHT, xy2pic(8, 37))
+							gfini chipi(CHIPI_WIDTH, xy2pic(8, 37)), chipi(CHIPI_HEIGHT, xy2pic(8, 37))
+							gfdec2 c_col(0, potionc), c_col(1, potionc), c_col(2, potionc)
+							gsel selcur
+							snd SOUNDLIST_BOLT1
+						}
+					}
+				}
+			}
+		}
 		if ( animeid == ANIMATION_SHINING_THROW ) {
 			gsel BUFFER_ITEM
 			color 0
 			boxf 0, 960, chipi(CHIPI_WIDTH, xy2pic(15, 36)), chipi(CHIPI_HEIGHT, xy2pic(15, 36)) + 960
 			if ( 1203 == 528 ) {
@@ -8630,10 +8676,15 @@
 	if ( cdata(CDATA_CONDITION_BLIND, cc) != 0 ) {
 		if ( tohit > 0 ) {
 			tohit /= 2
 		}
 	}
+	if ( gdata(GDATA_TEMPORARY_FLAGS2) == 888 ) {
+		if ( tohit > 0 ) {
+			tohit /= 2
+		}
+	}
 	if ( cdata(CDATA_CONDITION_BLIND, tc) != 0 ) {
 		if ( evade != 0 ) {
 			evade /= 2
 		}
 	}
@@ -9698,12 +9749,25 @@
 			rp2 = inv(STARTING_INV_ITEM_ENCHANT + cnt * 2, rp)
 			if ( rp2 >= 10000 ) {
 				rp3 = rp2 \ 10000
 				rp2 = rp2 / 10000
 				if ( rp2 == 1 ) {
-					sdata(rp3, r1) += inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, rp) / 50 + 1
-					continue
+					if ( gdata(GDATA_FLAG_GAME_MODE) == 5 ) {
+						sdata(rp3, r1) += inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, rp) / 50 + 1
+						continue
+					}
+				}
+				if ( rp2 == 1 ) {
+					if ( gdata(GDATA_FLAG_GAME_MODE) != 5 ) {
+						if ( sdata(rp3, r1) < sorg(rp3, r1) * 2 + 50 ) {
+							sdata(rp3, r1) = limit(sdata(rp3, r1) + (inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, rp) / 50 + 1), 1, sorg(rp3, r1) * 2 + 50)
+						}
+						else {
+							sdata(rp3, r1) = sorg(rp3, r1) * 2 + 50
+						}
+						continue
+					}
 				}
 				if ( rp2 == 2 ) {
 					sdata(rp3, r1) += inv(STARTING_INV_ITEM_ENCHANT + cnt * 2 + 1, rp) / 2
 					if ( sdata(rp3, r1) < 0 ) {
 						sdata(rp3, r1) = 1
@@ -9899,10 +9963,23 @@
 					cdata(STARTING_CDATA_ATTR + cnt, r1) = sorg(10 + cnt, r1) / 5
 				}
 			}
 			sdata(10 + cnt, r1) += cdata(STARTING_CDATA_ATTR + cnt, r1)
 		}
+		if ( r1 == 0 | cdata(CDATA_ALLIED, r1) == 100 ) {
+			if ( cdata(CDATA_HIRE_DATE, r1) != 0 ) {
+				if ( cdata(CDATA_HIRE_DATE, r1) > 10 ) {
+					cdata(CDATA_HIRE_DATE, r1) = 0
+				}
+				if ( cnt == 18 ) {
+					sdata(10 + cnt, r1) = sdata(10 + cnt, r1) * (10 - cdata(CDATA_HIRE_DATE, r1)) / 10
+				}
+				if ( cnt != 18 & cnt != 19 ) {
+					sdata(10 + cnt, r1) = sdata(10 + cnt, r1) / (cdata(CDATA_HIRE_DATE, r1) + 1)
+				}
+			}
+		}
 		if ( sdata(10 + cnt, r1) < 1 ) {
 			sdata(10 + cnt, r1) = 1
 		}
 	loop
 	if ( r1 == 0 ) {
@@ -9927,13 +10004,18 @@
 		if ( sdata(SKILL_ATTR_SPD, r1) < 1000000 ) {
 			sdata(SKILL_ATTR_SPD, r1) = 1000000
 		}
 	}
 	if ( cdata(CDATA_ATTACK_STYLE, r1) & 1 ) {
-		if ( cdata(CDATA_PV, r1) > 0 ) {
-			if ( cdata(CDATA_SHIELD_STYLE_TYPE, r1) == 1 ) {
-				cdata(CDATA_PV, r1) = cdata(CDATA_PV, r1) * (120 + int(sqrt(sdata(SKILL_NORMAL_SHIELD, r1))) * 2) / 100
+		if ( attacknum > 1 ) {
+			cdata(CDATA_ATTACK_STYLE, r1) += 4
+		}
+		if ( attacknum <= 1 ) {
+			if ( cdata(CDATA_PV, r1) > 0 ) {
+				if ( cdata(CDATA_SHIELD_STYLE_TYPE, r1) == 1 ) {
+					cdata(CDATA_PV, r1) = cdata(CDATA_PV, r1) * (120 + int(sqrt(sdata(SKILL_NORMAL_SHIELD, r1))) * 2) / 100
+				}
 			}
 		}
 	}
 	else {
 		if ( attacknum == 1 ) {
diff -U5 --recursive -x 'db_creature*' -x 'db_item*' '-I\*label_' ../2.15R-borscht/system.hsp ../2.17-borscht/system.hsp
--- ../2.15R-borscht/system.hsp	2023-05-12 09:08:04.478334500 +0800
+++ ../2.17-borscht/system.hsp	2023-05-12 09:05:59.035386200 +0800
@@ -38,11 +38,11 @@
 	}
 	gdata(GDATA_TEMPORARY_FLAGS2) = 0
 	return
 
 *fixSave
-	if ( gdata(GDATA_VERSION) != int(double("6.15") * 1000) ) {
+	if ( gdata(GDATA_VERSION) != int(double("6.17") * 1000) ) {
 		dialog lang("Ver." + gdata(GDATA_VERSION) + "のセーブデータをアップデートします。", "Updating your save data from Ver." + gdata(GDATA_VERSION) + " now.")
 	}
 	if ( gdata(GDATA_HEIR_DEED) < 0 ) {
 		gdata(GDATA_HEIR_DEED) = 1
 	}
@@ -827,15 +827,35 @@
 				cdata(CDATA_TAMER_WHIP_EAT, cnt) = 0
 				cbitmod CHARA_BIT_PROHIBIT_EATING_FROM_GROUND, cnt, TRUE
 			}
 		loop
 	}
-	if ( gdata(GDATA_VERSION) != int(double("6.15") * 1000) ) {
+	if ( gdata(GDATA_VERSION) < 6160 ) {
+		cdata(CDATA_MATERIAL5_COUNTER, CHARA_PLAYER) = 10
+		cdata(CDATA_MATERIAL4_COUNTER, CHARA_PLAYER) = 0
+		cdata(CDATA_MATERIAL1_COUNTER, CHARA_PLAYER) = 1
+		cdata(CDATA_SPINDLE_COMBINATION_B, CHARA_PLAYER) = 1
+		snd SOUNDLIST_WRITE1
+		txtef COLOR_GREEN
+		txt lang("ジャーナルが更新された。", "Your journal has been updated.")
+		if ( gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) > 0 ) {
+			gdata(GDATA_FLAG_GUILD_FIGHTER_THIEF) = 15
+			gdata(GDATA_FLAG_FIGHTER_GUILD_QUEST_LEVEL) = rnd(8)
+			gdata(GDATA_FLAG_GUILD_FIGHTER_NORMA) = 0
+		}
+		if ( gdata(GDATA_FLAG_GUILD_MAGE_NORMA) > 0 ) {
+			gdata(GDATA_FLAG_GUILD_MAGE_NORMA) = 0
+		}
+		if ( gdata(GDATA_FLAG_GUILD_THIEF_NORMA) > 0 ) {
+			gdata(GDATA_FLAG_GUILD_THIEF_NORMA) = 0
+		}
+	}
+	if ( gdata(GDATA_VERSION) != int(double("6.17") * 1000) ) {
 		gdata(GDATA_WORLD_RENEW) = TRUE
 	}
 	del_chara 56
-	if ( gdata(GDATA_VERSION) > int(double("6.15") * 1000) ) {
+	if ( gdata(GDATA_VERSION) > int(double("6.17") * 1000) ) {
 		dialog "invalid version"
 		goto *exit_game
 	}
 	if ( gdata(GDATA_PLAY_TIME) < 0 ) {
 		gdata(GDATA_PLAY_TIME) = 0
@@ -885,11 +905,11 @@
 		if ( gdata(GDATA_GAMEMODE_PENALTY) == 1 ) {
 			gdata(GDATA_GAMEMODE_PENALTY) = 0
 			snd SOUNDLIST_ENC
 		}
 	}
-	gdata(GDATA_VERSION) = int(double("6.15") * 1000)
+	gdata(GDATA_VERSION) = int(double("6.17") * 1000)
 	cbitmod CHARA_BIT_PCC, CHARA_PLAYER, TRUE
 	gdata(GDATA_SPEEDSUM_RESET) = 1
 	gosub *initial_recipe
 	return
 
@@ -1168,11 +1188,11 @@
 	cdata(CDATA_RELATION, rc) = limit(userdata(4, cun), -3, 10)
 	cdata(CDATA_AI_CALM, rc) = limit(userdata(7, cun), 1, 4)
 	cdata(CDATA_AI_MOVE_FREQ, rc) = limit(userdata(8, cun), 0, 100)
 	cdata(CDATA_AI_DISTANCE, rc) = limit(userdata(9, cun), 1, 100)
 	if ( userdata(11, cun) ) {
-		cdata(CDATA_ELEMENT, rc) = limit(userdata(11, cun), SKILL_RES_FIRE * 100000, 69 * 100000)
+		cdata(CDATA_ELEMENT, rc) = limit(userdata(11, cun), SKILL_RES_FIRE * 100000, MAX_SKILL_RESDMG * 100000)
 	}
 	cdata(CDATA_ACT_HEAL, rc) = userdata(10, cun)
 	dbidn = userdatan(2, cun)
 	dbmode = DBMODE_SET
 	gosub *db_race
@@ -3352,11 +3372,11 @@
 		pos x, y
 		mesbox inputlog, 600, 0, 5, val(2) * (1 + en)
 		pos x + 4, y + 4
 		gfini dx - 1, 35
 		gfdec 60, 60, 60
-		aplsel "ElonaPlus 2.15R"
+		aplsel "ElonaPlus 2.17"
 		if ( stat == 1 ) {
 			dialog "Failed to get WINDOW ID", 1
 			clrobj 1
 			cfg_msg_box = 0
 			goto *prompt_word
@@ -3715,11 +3735,11 @@
 
 *game_debug
 	notesel dbm
 	buff = ""
 	if ( dbm == "" ) {
-		noteadd "ElonaPlus 2.15R" + " v" + "6.15" + " Debug Console    Type \"?\" for help. Hit ESC to exit."
+		noteadd "ElonaPlus 2.17" + " v" + "6.17" + " Debug Console    Type \"?\" for help. Hit ESC to exit."
 		noteadd ""
 	}
 	font lang(cfg_font1, cfg_font2), 14 - en * 2, 0
 	objmode 2
 	pos 0, 24
@@ -4068,11 +4088,11 @@
 			loop
 			noteadd "Done."
 			goto *console_write
 		}
 		if ( instr(buff, 0, "gain_spact") != (-1) ) {
-			repeat 848 - 600
+			repeat 852 - 600
 				spact(cnt + STARTING_SKILL_SPACT - STARTING_SKILL_SPACT) = 1
 			loop
 			noteadd "Done."
 			goto *console_write
 		}
@@ -4126,11 +4146,11 @@
 	objprm 1, dbm
 	objprm 2, ""
 	return
 
 *mutexobj
-	CreateMutexA 0, 0, "ElonaPlus 2.15R"
+	CreateMutexA 0, 0, "ElonaPlus 2.17"
 	mutex_handle = stat
 	func_3
 	if ( stat == 183 ) {
 		dialog lang("二重起動のため終了します。", "The program is already running."), 1
 		end
